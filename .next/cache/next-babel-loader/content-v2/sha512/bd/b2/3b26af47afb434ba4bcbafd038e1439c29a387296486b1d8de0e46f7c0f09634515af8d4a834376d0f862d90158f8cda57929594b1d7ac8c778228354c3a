{"ast":null,"code":"import React, { useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport { Controller } from 'react-hook-form';\nimport { useSelector } from 'react-redux';\nimport { useQuery } from '@apollo/react-hooks';\nimport Row from '../../atomic-ui/components/Row';\nimport Column from '../../atomic-ui/components/Column';\nimport Title from '../../atomic-ui/components/Title';\nimport Input from '../../atomic-ui/components/Input';\nimport Button from '../../atomic-ui/components/Button';\nimport Select from '../../atomic-ui/components/Select';\nimport TextEditor from '../../atomic-ui/components/TextEditor';\nimport Dropzone from '../../atomic-ui/components/Dropzone';\nimport Alert from '../../atomic-ui/components/Alert';\nimport Comment from '../../atomic-ui/components/Comment';\nimport Divider from '../../atomic-ui/components/Divider';\nimport Spinner from '../../atomic-ui/components/Spinner';\nimport { getLabelStatus, getLabelCategory } from '../../atomic-ui/utils/functions';\nimport Form from '../Form';\nimport { Loader } from '../Styled';\nimport queries from '../../graphql/queries';\nimport config from '../../config';\nimport Checkbox from '../../atomic-ui/components/Checkbox';\nexport const Header = styled(Row).withConfig({\n  displayName: \"FormArticle__Header\",\n  componentId: \"sc-1ftxonu-0\"\n})([\"justify-content:space-between;@media only screen and (max-width:480px){flex-direction:column;align-items:end;grid-gap:var(--default-gap);}\"]);\nexport const Comments = ({\n  article,\n  setValue\n}) => {\n  const [comments, setComments] = useState([]);\n  const user = useSelector(state => state.user);\n  const [checkedAll, setCheckedAll] = useState(false);\n  const {\n    data: dataComments,\n    loading: loadingComments\n  } = useQuery(queries.GET_COMMENTS, {\n    variables: {\n      id: article\n    }\n  });\n\n  const handleCheckedComments = e => {\n    setCheckedAll(e.target.checked);\n    setComments(prev => prev.map(item => ({ ...item,\n      checked: !item.checked\n    })));\n  };\n\n  const handleCheckedComment = (message, value) => {\n    setComments(prev => prev.map(item => item.id === message.id ? { ...item,\n      checked: value\n    } : item));\n  };\n\n  const handleDeleteChecked = () => {\n    setComments(prev => prev.filter(message => !message.checked));\n  };\n\n  const handleCommentEdit = (message, text) => {\n    setComments(prev => prev.map(item => item.id === message.id ? { ...item,\n      updatedAt: new Date(),\n      text\n    } : item));\n  };\n\n  const handleCommentDelete = message => {\n    setComments(prev => prev.filter(item => item.id !== message.id));\n  };\n\n  useEffect(() => {\n    if (article && !loadingComments && dataComments) {\n      setComments(dataComments.getComments.map(comment => ({ ...comment,\n        checked: false\n      })));\n    }\n  }, [article, dataComments, loadingComments]);\n  useEffect(() => {\n    setValue('comments', comments);\n  }, [comments]);\n\n  if (!article || comments.length === 0) {\n    return null;\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Divider, {\n    clear: true\n  }), /*#__PURE__*/React.createElement(Title, {\n    tag: 'h4'\n  }, \"\\u041A\\u043E\\u043C\\u043C\\u0435\\u043D\\u0442\\u0430\\u0440\\u0438\\u0438\"), /*#__PURE__*/React.createElement(Header, null, /*#__PURE__*/React.createElement(Checkbox, {\n    label: 'Выделить все',\n    checked: checkedAll,\n    onChange: handleCheckedComments\n  }), /*#__PURE__*/React.createElement(Button, {\n    style: {\n      color: 'var(--default-color-red)'\n    },\n    appearance: 'clear',\n    onClick: handleDeleteChecked\n  }, \"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C \\u0432\\u044B\\u0434\\u0435\\u043B\\u0435\\u043D\\u043D\\u043E\\u0435\")), /*#__PURE__*/React.createElement(Column, {\n    style: {\n      gridGap: 5\n    }\n  }, comments.map(comment => {\n    var _comment$likes;\n\n    return /*#__PURE__*/React.createElement(Comment, {\n      key: `${comment.id}_${comment.checked}`,\n      user: comment.author,\n      message: comment.text,\n      likes: (_comment$likes = comment.likes) === null || _comment$likes === void 0 ? void 0 : _comment$likes.length,\n      time: comment.createdAt !== comment.updatedAt ? comment.updatedAt : comment.createdAt,\n      isLiked: comment.likes.find(likedUser => likedUser.email === user.email),\n      isChecked: comment.checked,\n      isUpdated: comment.createdAt !== comment.updatedAt,\n      onChecked: value => handleCheckedComment(comment, value),\n      onEdit: text => handleCommentEdit(comment, text),\n      onDelete: () => handleCommentDelete(comment),\n      compact: true\n    });\n  })));\n};\nexport const Article = ({\n  article,\n  categories,\n  statuses,\n  mutation,\n  appearance,\n  className,\n  canEditStatus,\n  onSubmit\n}) => {\n  const {\n    data,\n    loading: loadingArticle,\n    error: errorArticle\n  } = article ? useQuery(queries.GET_ARTICLE, {\n    variables: {\n      id: article\n    }\n  }) : {\n    data: {\n      getArticle: {}\n    },\n    loading: false,\n    error: false\n  };\n  return /*#__PURE__*/React.createElement(Form, {\n    className: className,\n    appearance: appearance,\n    mutation: mutation,\n    onSubmit: onSubmit\n  }, ({\n    register,\n    loading,\n    errors,\n    control,\n    getValues,\n    setValue\n  }) => {\n    var _data$getArticle, _data$getArticle2, _data$getArticle3, _data$getArticle4, _data$getArticle5;\n\n    return !loadingArticle && data ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Column, null, /*#__PURE__*/React.createElement(Title, {\n      tag: 'h4'\n    }, \"\\u041E\\u0441\\u043D\\u043E\\u0432\\u043D\\u043E\\u0435\"), errors && errors.preview && /*#__PURE__*/React.createElement(Alert, {\n      style: {\n        width: '100%'\n      },\n      appearance: 'error'\n    }, \"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0438\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0435 \\u0434\\u043B\\u044F \\u043F\\u0440\\u0435\\u0432\\u044C\\u044E\"), /*#__PURE__*/React.createElement(Controller, {\n      name: 'preview',\n      control: control,\n      rules: {\n        required: true\n      },\n      defaultValue: ((_data$getArticle = data.getArticle) === null || _data$getArticle === void 0 ? void 0 : _data$getArticle.preview) || null,\n      render: ({\n        value,\n        onChange\n      }) => /*#__PURE__*/React.createElement(Dropzone, {\n        accept: 'image/*',\n        defaultValue: value,\n        onChange: onChange,\n        placeholder: 'Перетащите сюда изображение для превью',\n        tooltip: 'Разрешение: 960x480px. Допустимые форматы: jpeg, jpg, png. Макс. размер: 15 MB'\n      })\n    }), errors && errors.title && /*#__PURE__*/React.createElement(Alert, {\n      style: {\n        width: '100%'\n      },\n      appearance: 'error'\n    }, \"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0437\\u0430\\u0433\\u043E\\u043B\\u043E\\u0432\\u043E\\u043A \\u0441\\u0442\\u0430\\u0442\\u044C\\u0438\"), /*#__PURE__*/React.createElement(Input, {\n      type: 'text',\n      name: 'title',\n      ref: register({\n        required: true\n      }),\n      defaultValue: getValues('title') || ((_data$getArticle2 = data.getArticle) === null || _data$getArticle2 === void 0 ? void 0 : _data$getArticle2.title),\n      placeholder: 'Название',\n      appearance: 'ghost',\n      disabled: loading\n    }), /*#__PURE__*/React.createElement(Controller, {\n      name: 'category',\n      control: control,\n      defaultValue: (_data$getArticle3 = data.getArticle) !== null && _data$getArticle3 !== void 0 && _data$getArticle3.category ? {\n        value: data.getArticle.category.id,\n        label: getLabelCategory(data.getArticle.category.name)\n      } : null,\n      render: ({\n        value,\n        onChange\n      }) => /*#__PURE__*/React.createElement(Select, {\n        appearance: 'ghost',\n        placeholder: 'Выберите раздел',\n        options: categories.filter(item => item.type === 'DIVISION').map(item => ({\n          value: item.id,\n          label: getLabelCategory(item.name)\n        })),\n        onChange: onChange,\n        defaultValue: value,\n        isLoading: loading,\n        isClearable: true\n      })\n    }), errors && errors.body && /*#__PURE__*/React.createElement(Alert, {\n      style: {\n        width: '100%'\n      },\n      appearance: 'error'\n    }, \"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0441\\u043E\\u0434\\u0435\\u0440\\u0436\\u0430\\u043D\\u0438\\u0435 \\u0441\\u0442\\u0430\\u0442\\u044C\\u0438\"), /*#__PURE__*/React.createElement(Controller, {\n      name: 'body',\n      control: control,\n      defaultValue: getValues('body') || ((_data$getArticle4 = data.getArticle) === null || _data$getArticle4 === void 0 ? void 0 : _data$getArticle4.body) || null,\n      rules: {\n        required: true\n      },\n      render: ({\n        value,\n        onChange\n      }) => /*#__PURE__*/React.createElement(TextEditor, {\n        apiKey: config.get('tiny-key'),\n        appearance: 'ghost',\n        defaultValue: value,\n        onChange: onChange\n      })\n    }), /*#__PURE__*/React.createElement(Comments, {\n      article: article,\n      setValue: setValue\n    }), canEditStatus && /*#__PURE__*/React.createElement(Divider, {\n      clear: true\n    }), canEditStatus && /*#__PURE__*/React.createElement(Controller, {\n      name: 'status',\n      control: control,\n      defaultValue: (_data$getArticle5 = data.getArticle) !== null && _data$getArticle5 !== void 0 && _data$getArticle5.status ? {\n        value: data.getArticle.status,\n        label: getLabelStatus(data.getArticle.status)\n      } : null,\n      render: ({\n        value,\n        onChange\n      }) => /*#__PURE__*/React.createElement(Select, {\n        appearance: 'ghost',\n        placeholder: 'Выберите статус',\n        options: statuses.map(item => ({\n          value: item,\n          label: getLabelStatus(item)\n        })),\n        onChange: onChange,\n        defaultValue: value,\n        menuPlacement: 'top',\n        isLoading: loading,\n        isClearable: true\n      })\n    })), /*#__PURE__*/React.createElement(Divider, {\n      clear: true\n    }), /*#__PURE__*/React.createElement(Row, null, /*#__PURE__*/React.createElement(Button, {\n      style: {\n        flexGrow: 1\n      },\n      type: 'submit',\n      disabled: loading\n    }, article ? 'Сохранить' : 'Создать'))) : errorArticle ? /*#__PURE__*/React.createElement(Alert, {\n      appearance: 'error',\n      style: {\n        width: '100%',\n        textAlign: 'center'\n      }\n    }, \"\\u0423\\u043F\\u0441! \\u041D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u044E \\u043E \\u0441\\u0442\\u0430\\u0442\\u044C\\u0435\") : /*#__PURE__*/React.createElement(Loader, null, /*#__PURE__*/React.createElement(Spinner, null));\n  });\n};\nexport default Article;","map":{"version":3,"sources":["C:/Users/dan82/Documents/workspace/FREELANCE/atomic/atomic-frontend/components/FormArticle/index.js"],"names":["React","useEffect","useState","styled","Controller","useSelector","useQuery","Row","Column","Title","Input","Button","Select","TextEditor","Dropzone","Alert","Comment","Divider","Spinner","getLabelStatus","getLabelCategory","Form","Loader","queries","config","Checkbox","Header","Comments","article","setValue","comments","setComments","user","state","checkedAll","setCheckedAll","data","dataComments","loading","loadingComments","GET_COMMENTS","variables","id","handleCheckedComments","e","target","checked","prev","map","item","handleCheckedComment","message","value","handleDeleteChecked","filter","handleCommentEdit","text","updatedAt","Date","handleCommentDelete","getComments","comment","length","color","gridGap","author","likes","createdAt","find","likedUser","email","Article","categories","statuses","mutation","appearance","className","canEditStatus","onSubmit","loadingArticle","error","errorArticle","GET_ARTICLE","getArticle","register","errors","control","getValues","preview","width","required","onChange","title","category","label","name","type","body","get","status","flexGrow","textAlign"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\nimport styled from 'styled-components'\nimport { Controller } from 'react-hook-form'\nimport { useSelector } from 'react-redux'\nimport { useQuery } from '@apollo/react-hooks'\n\nimport Row from '../../atomic-ui/components/Row'\nimport Column from '../../atomic-ui/components/Column'\nimport Title from '../../atomic-ui/components/Title'\nimport Input from '../../atomic-ui/components/Input'\nimport Button from '../../atomic-ui/components/Button'\nimport Select from '../../atomic-ui/components/Select'\nimport TextEditor from '../../atomic-ui/components/TextEditor'\nimport Dropzone from '../../atomic-ui/components/Dropzone'\nimport Alert from '../../atomic-ui/components/Alert'\nimport Comment from '../../atomic-ui/components/Comment'\nimport Divider from '../../atomic-ui/components/Divider'\nimport Spinner from '../../atomic-ui/components/Spinner'\nimport { getLabelStatus, getLabelCategory } from '../../atomic-ui/utils/functions'\n\nimport Form from '../Form'\nimport { Loader } from '../Styled'\nimport queries from '../../graphql/queries'\nimport config from '../../config'\nimport Checkbox from '../../atomic-ui/components/Checkbox'\n\nexport const Header = styled(Row)`\n  justify-content: space-between;\n\n  @media only screen and (max-width: 480px) {\n    flex-direction: column;\n    align-items: end;\n    grid-gap: var(--default-gap);\n  }\n`\n\nexport const Comments = ({ article, setValue }) => {\n  const [comments, setComments] = useState([])\n\n  const user = useSelector((state) => state.user)\n  const [checkedAll, setCheckedAll] = useState(false)\n\n  const { data: dataComments, loading: loadingComments } = useQuery(queries.GET_COMMENTS, {\n    variables: {\n      id: article\n    }\n  })\n\n  const handleCheckedComments = (e) => {\n    setCheckedAll(e.target.checked)\n    setComments((prev) =>\n      prev.map((item) => ({\n        ...item,\n        checked: !item.checked\n      }))\n    )\n  }\n\n  const handleCheckedComment = (message, value) => {\n    setComments((prev) =>\n      prev.map((item) =>\n        item.id === message.id\n          ? {\n              ...item,\n              checked: value\n            }\n          : item\n      )\n    )\n  }\n\n  const handleDeleteChecked = () => {\n    setComments((prev) => prev.filter((message) => !message.checked))\n  }\n\n  const handleCommentEdit = (message, text) => {\n    setComments((prev) =>\n      prev.map((item) =>\n        item.id === message.id\n          ? {\n              ...item,\n              updatedAt: new Date(),\n              text\n            }\n          : item\n      )\n    )\n  }\n\n  const handleCommentDelete = (message) => {\n    setComments((prev) => prev.filter((item) => item.id !== message.id))\n  }\n\n  useEffect(() => {\n    if (article && !loadingComments && dataComments) {\n      setComments(\n        dataComments.getComments.map((comment) => ({\n          ...comment,\n          checked: false\n        }))\n      )\n    }\n  }, [article, dataComments, loadingComments])\n\n  useEffect(() => {\n    setValue('comments', comments)\n  }, [comments])\n\n  if (!article || comments.length === 0) {\n    return null\n  }\n\n  return (\n    <React.Fragment>\n      <Divider clear />\n\n      <Title tag={'h4'}>Комментарии</Title>\n\n      <Header>\n        <Checkbox label={'Выделить все'} checked={checkedAll} onChange={handleCheckedComments} />\n        <Button\n          style={{ color: 'var(--default-color-red)' }}\n          appearance={'clear'}\n          onClick={handleDeleteChecked}>\n          Удалить выделенное\n        </Button>\n      </Header>\n      <Column style={{ gridGap: 5 }}>\n        {comments.map((comment) => (\n          <Comment\n            key={`${comment.id}_${comment.checked}`}\n            user={comment.author}\n            message={comment.text}\n            likes={comment.likes?.length}\n            time={comment.createdAt !== comment.updatedAt ? comment.updatedAt : comment.createdAt}\n            isLiked={comment.likes.find((likedUser) => likedUser.email === user.email)}\n            isChecked={comment.checked}\n            isUpdated={comment.createdAt !== comment.updatedAt}\n            onChecked={(value) => handleCheckedComment(comment, value)}\n            onEdit={(text) => handleCommentEdit(comment, text)}\n            onDelete={() => handleCommentDelete(comment)}\n            compact\n          />\n        ))}\n      </Column>\n    </React.Fragment>\n  )\n}\n\nexport const Article = ({\n  article,\n  categories,\n  statuses,\n  mutation,\n  appearance,\n  className,\n  canEditStatus,\n  onSubmit\n}) => {\n  const { data, loading: loadingArticle, error: errorArticle } = article\n    ? useQuery(queries.GET_ARTICLE, {\n        variables: {\n          id: article\n        }\n      })\n    : { data: { getArticle: {} }, loading: false, error: false }\n\n  return (\n    <Form className={className} appearance={appearance} mutation={mutation} onSubmit={onSubmit}>\n      {({ register, loading, errors, control, getValues, setValue }) =>\n        !loadingArticle && data ? (\n          <React.Fragment>\n            <Column>\n              <Title tag={'h4'}>Основное</Title>\n\n              {errors && errors.preview && (\n                <Alert style={{ width: '100%' }} appearance={'error'}>\n                  Выберите изображение для превью\n                </Alert>\n              )}\n              <Controller\n                name={'preview'}\n                control={control}\n                rules={{ required: true }}\n                defaultValue={data.getArticle?.preview || null}\n                render={({ value, onChange }) => (\n                  <Dropzone\n                    accept={'image/*'}\n                    defaultValue={value}\n                    onChange={onChange}\n                    placeholder={'Перетащите сюда изображение для превью'}\n                    tooltip={\n                      'Разрешение: 960x480px. Допустимые форматы: jpeg, jpg, png. Макс. размер: 15 MB'\n                    }\n                  />\n                )}\n              />\n\n              {errors && errors.title && (\n                <Alert style={{ width: '100%' }} appearance={'error'}>\n                  Введите заголовок статьи\n                </Alert>\n              )}\n              <Input\n                type={'text'}\n                name={'title'}\n                ref={register({ required: true })}\n                defaultValue={getValues('title') || data.getArticle?.title}\n                placeholder={'Название'}\n                appearance={'ghost'}\n                disabled={loading}\n              />\n\n              <Controller\n                name={'category'}\n                control={control}\n                defaultValue={\n                  data.getArticle?.category\n                    ? {\n                        value: data.getArticle.category.id,\n                        label: getLabelCategory(data.getArticle.category.name)\n                      }\n                    : null\n                }\n                render={({ value, onChange }) => (\n                  <Select\n                    appearance={'ghost'}\n                    placeholder={'Выберите раздел'}\n                    options={categories\n                      .filter((item) => item.type === 'DIVISION')\n                      .map((item) => ({\n                        value: item.id,\n                        label: getLabelCategory(item.name)\n                      }))}\n                    onChange={onChange}\n                    defaultValue={value}\n                    isLoading={loading}\n                    isClearable\n                  />\n                )}\n              />\n\n              {errors && errors.body && (\n                <Alert style={{ width: '100%' }} appearance={'error'}>\n                  Введите содержание статьи\n                </Alert>\n              )}\n              <Controller\n                name={'body'}\n                control={control}\n                defaultValue={getValues('body') || data.getArticle?.body || null}\n                rules={{ required: true }}\n                render={({ value, onChange }) => (\n                  <TextEditor\n                    apiKey={config.get('tiny-key')}\n                    appearance={'ghost'}\n                    defaultValue={value}\n                    onChange={onChange}\n                  />\n                )}\n              />\n\n              <Comments article={article} setValue={setValue} />\n\n              {canEditStatus && <Divider clear />}\n\n              {canEditStatus && (\n                <Controller\n                  name={'status'}\n                  control={control}\n                  defaultValue={\n                    data.getArticle?.status\n                      ? {\n                          value: data.getArticle.status,\n                          label: getLabelStatus(data.getArticle.status)\n                        }\n                      : null\n                  }\n                  render={({ value, onChange }) => (\n                    <Select\n                      appearance={'ghost'}\n                      placeholder={'Выберите статус'}\n                      options={statuses.map((item) => ({\n                        value: item,\n                        label: getLabelStatus(item)\n                      }))}\n                      onChange={onChange}\n                      defaultValue={value}\n                      menuPlacement={'top'}\n                      isLoading={loading}\n                      isClearable\n                    />\n                  )}\n                />\n              )}\n            </Column>\n\n            <Divider clear />\n\n            <Row>\n              <Button style={{ flexGrow: 1 }} type={'submit'} disabled={loading}>\n                {article ? 'Сохранить' : 'Создать'}\n              </Button>\n            </Row>\n          </React.Fragment>\n        ) : errorArticle ? (\n          <Alert appearance={'error'} style={{ width: '100%', textAlign: 'center' }}>\n            Упс! Не удалось загрузить информацию о статье\n          </Alert>\n        ) : (\n          <Loader>\n            <Spinner />\n          </Loader>\n        )\n      }\n    </Form>\n  )\n}\n\nexport default Article\n"]},"metadata":{},"sourceType":"module"}