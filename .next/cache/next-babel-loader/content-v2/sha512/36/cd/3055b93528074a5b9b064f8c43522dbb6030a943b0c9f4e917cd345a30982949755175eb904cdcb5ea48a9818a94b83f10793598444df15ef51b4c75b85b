{"ast":null,"code":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React, { useState, useEffect } from 'react';\nimport styled, { css } from 'styled-components';\nimport { useQuery } from '@apollo/react-hooks';\nimport Row from '../../atomic-ui/components/Row';\nimport Column from '../../atomic-ui/components/Column';\nimport Grid from '../../atomic-ui/components/Grid';\nimport Title from '../../atomic-ui/components/Title';\nimport Text from '../../atomic-ui/components/Text';\nimport Image from '../../atomic-ui/components/Image';\nimport Meta from '../../atomic-ui/components/Meta';\nimport Button from '../../atomic-ui/components/Button';\nimport Icon from '../../atomic-ui/components/Icon';\nimport Alert from '../../atomic-ui/components/Alert';\nimport Divider from '../../atomic-ui/components/Divider';\nimport Difinition from '../../atomic-ui/components/Difinition';\nimport VideoPresentation, { parseUrl } from '../../atomic-ui/components/VideoPresentation';\nimport Tooltip, { Wrap as WrapTooltip } from '../../atomic-ui/components/Tooltip';\nimport { getFileSize, getLabelRole } from '../../atomic-ui/utils/functions';\nimport { useEntityQuery } from '../../hooks/useEntityQuery';\nimport HTMLView from '../HTMLView';\nimport Processed from '../Processed';\nimport queries from '../../graphql/queries';\nimport config from '../../config';\nconst HOST_URL = config.get('host-url');\nexport const Wrap = styled(Column).withConfig({\n  displayName: \"ProjectView__Wrap\",\n  componentId: \"sc-1fg5jgh-0\"\n})([\"flex-grow:1;iframe{width:100%;}\", \" \", \" \", \"\"], ({\n  appearance\n}) => appearance === 'default' && css([\"padding:var(--default-gap);background:var(--surface-background);border:var(--surface-border);border-radius:var(--surface-border-radius);box-shadow:var(--surface-shadow);\"]), ({\n  appearance\n}) => appearance === 'ghost' && css([\"padding:0;border:none;background:none;border-radius:0;box-shadow:none;\"]), ({\n  appearance\n}) => appearance === 'clear' && css([\"padding:0;border:none;background:none;border-radius:0;box-shadow:none;\"]));\nexport const Container = styled(Row).withConfig({\n  displayName: \"ProjectView__Container\",\n  componentId: \"sc-1fg5jgh-1\"\n})([\"@media only screen and (max-width:768px){flex-direction:column;grid-gap:var(--default-gap);}\"]);\nexport const Media = styled(Column).withConfig({\n  displayName: \"ProjectView__Media\",\n  componentId: \"sc-1fg5jgh-2\"\n})([\"grid-gap:5px;flex-basis:35%;& > span{display:flex;flex-grow:1;}@media only screen and (max-width:480px){flex-basis:100%;}\"]);\nexport const Content = styled(Column).withConfig({\n  displayName: \"ProjectView__Content\",\n  componentId: \"sc-1fg5jgh-3\"\n})([\"justify-content:space-between;flex-basis:65%;@media only screen and (max-width:480px){flex-basis:100%;}\"]);\nexport const Screenshots = styled(Row).withConfig({\n  displayName: \"ProjectView__Screenshots\",\n  componentId: \"sc-1fg5jgh-4\"\n})([\"justify-content:space-between;grid-gap:5px;\"]);\nexport const Screenshot = styled.div.withConfig({\n  displayName: \"ProjectView__Screenshot\",\n  componentId: \"sc-1fg5jgh-5\"\n})([\"position:relative;z-index:var(--z-12);width:auto;height:var(--input-height-s);min-width:var(--input-height-s);min-height:var(--input-height-s);border-radius:var(--surface-border-radius);overflow:hidden;transition:opacity 150ms ease;span,span > img{display:flex;justify-content:center;align-items:center;flex-grow:1;width:100%;height:100%;}img{width:100%;height:100%;object-fit:cover;}\", \"\"], ({\n  onClick\n}) => onClick && css([\"cursor:pointer;&:hover{opacity:0.65;}\"]));\nexport const ScreenshotsCounter = styled(Text).withConfig({\n  displayName: \"ProjectView__ScreenshotsCounter\",\n  componentId: \"sc-1fg5jgh-6\"\n})([\"position:absolute;top:0;left:0;z-index:var(--z-10);display:flex;justify-content:center;align-items:center;width:100%;height:100%;span{position:relative;z-index:var(--z-12);color:white;}&::before{content:'';position:absolute;top:0;left:0;z-index:var(--z-10);display:flex;justify-content:center;align-items:center;width:100%;height:100%;background:var(--default-color-accent);border-radius:var(--surface-border-radius);opacity:0.65;}\"]);\nexport const CentralAlert = styled(Alert).withConfig({\n  displayName: \"ProjectView__CentralAlert\",\n  componentId: \"sc-1fg5jgh-7\"\n})([\"display:flex;justify-content:center;align-items:center;width:100%;height:100%;text-align:center;\"]);\nexport const Poster = styled(Image).withConfig({\n  displayName: \"ProjectView__Poster\",\n  componentId: \"sc-1fg5jgh-8\"\n})([\"width:100%;height:100%;max-height:285px;object-fit:cover;border-radius:var(--surface-border-radius);flex-grow:1;transition:opacity 150ms ease;\", \"\"], ({\n  onClick\n}) => onClick && css([\"cursor:pointer;&:hover{opacity:0.65;}\"]));\nexport const Difinitions = styled(Row).withConfig({\n  displayName: \"ProjectView__Difinitions\",\n  componentId: \"sc-1fg5jgh-9\"\n})([\"flex-grow:100;justify-content:space-between;grid-gap:var(--default-gap);@media only screen and (max-width:480px){flex-direction:column;}\"]);\nexport const Presentation = styled(VideoPresentation).withConfig({\n  displayName: \"ProjectView__Presentation\",\n  componentId: \"sc-1fg5jgh-10\"\n})([\"display:flex;flex-grow:1;width:100%;border-radius:var(--surface-border-radius);overflow:hidden;\"]);\nexport const Actions = styled(Row).withConfig({\n  displayName: \"ProjectView__Actions\",\n  componentId: \"sc-1fg5jgh-11\"\n})([\"@media only screen and (max-width:480px){\", \"{flex-grow:1;button{flex-grow:1;}}}\"], WrapTooltip);\nexport const Files = styled(Grid).withConfig({\n  displayName: \"ProjectView__Files\",\n  componentId: \"sc-1fg5jgh-12\"\n})([\"\"]);\nexport const Members = styled(Grid).withConfig({\n  displayName: \"ProjectView__Members\",\n  componentId: \"sc-1fg5jgh-13\"\n})([\"\"]);\nexport const View = ({\n  project,\n  appearance,\n  className,\n  style,\n  slicedFactor = 6,\n  owned,\n  liked,\n  onAdd,\n  onLike,\n  onScreenshotClick,\n  onFileLink,\n  onMemberLink,\n  onCompanyLink\n}) => {\n  var _data$getProject, _data$getProject2, _data$getProject2$pre, _data$getProject7, _data$getProject8, _data$getProject8$scr, _data$getProject11, _data$getProject12, _data$getProject12$ca, _data$getProject13, _data$getProject14, _data$getProject15, _data$getProject16, _data$getProject16$co, _data$getProject16$co2, _data$getProject17, _data$getProject17$co, _data$getProject19, _data$getProject20, _data$getProject21, _data$getProject22, _data$getProject23, _data$getProject23$me, _data$getProject24, _data$getProject25, _data$getProject26, _data$getProject26$me, _data$getProject27, _data$getProject28, _data$getProject28$fi, _data$getProject29, _data$getProject30, _data$getProject31, _data$getProject31$fi;\n\n  const {\n    setQuery\n  } = useEntityQuery();\n  const {\n    data,\n    loading,\n    error\n  } = useQuery(queries.GET_PROJECT, {\n    variables: {\n      id: project\n    }\n  });\n  const [isLiked, setLike] = useState(liked);\n  const [screenshots, setScreenshots] = useState([]);\n  const [residue, setResidue] = useState(0);\n  const [videoPresentationObject, setVideoPresentationObject] = useState(null);\n\n  const onClickLike = () => {\n    if (onLike) onLike();\n    setLike(!isLiked);\n  };\n\n  useEffect(() => {\n    if (!loading && data.getProject) {\n      const response = data.getProject;\n      const images = [response.preview, ...response.screenshots];\n      const slicedImages = images.slice(0, slicedFactor);\n      const url = URL && response.presentation && new URL(response.presentation);\n      const videoPresentationObject = parseUrl(url);\n      setResidue((images.length || slicedFactor) - slicedFactor);\n      setVideoPresentationObject(videoPresentationObject);\n      setScreenshots(slicedImages);\n    }\n  }, [loading, data, slicedFactor]);\n  return /*#__PURE__*/React.createElement(Wrap, {\n    className: className,\n    style: style,\n    appearance: appearance\n  }, /*#__PURE__*/React.createElement(Processed, {\n    data: data === null || data === void 0 ? void 0 : data.getProject,\n    loading: loading,\n    error: error,\n    errorMessage: 'Упс! Не удалось загрузить информацию о проекте',\n    emptyMessage: 'Кажется такого проекта не существует'\n  }, /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Container, null, /*#__PURE__*/React.createElement(Media, null, data !== null && data !== void 0 && (_data$getProject = data.getProject) !== null && _data$getProject !== void 0 && _data$getProject.preview ? /*#__PURE__*/React.createElement(Poster, {\n    src: data === null || data === void 0 ? void 0 : (_data$getProject2 = data.getProject) === null || _data$getProject2 === void 0 ? void 0 : (_data$getProject2$pre = _data$getProject2.preview) === null || _data$getProject2$pre === void 0 ? void 0 : _data$getProject2$pre.path,\n    onClick: () => {\n      var _data$getProject3, _data$getProject4, _data$getProject4$pre, _data$getProject5, _data$getProject6;\n\n      return onScreenshotClick && onScreenshotClick(data === null || data === void 0 ? void 0 : (_data$getProject3 = data.getProject) === null || _data$getProject3 === void 0 ? void 0 : _data$getProject3.preview, data === null || data === void 0 ? void 0 : (_data$getProject4 = data.getProject) === null || _data$getProject4 === void 0 ? void 0 : (_data$getProject4$pre = _data$getProject4.preview) === null || _data$getProject4$pre === void 0 ? void 0 : _data$getProject4$pre.id, [data === null || data === void 0 ? void 0 : (_data$getProject5 = data.getProject) === null || _data$getProject5 === void 0 ? void 0 : _data$getProject5.preview, ...(data === null || data === void 0 ? void 0 : (_data$getProject6 = data.getProject) === null || _data$getProject6 === void 0 ? void 0 : _data$getProject6.screenshots)]);\n    }\n  }) : /*#__PURE__*/React.createElement(CentralAlert, null, \"\\u041F\\u0440\\u0435\\u0432\\u044C\\u044E \\u043D\\u0435\\u0442\"), (data === null || data === void 0 ? void 0 : (_data$getProject7 = data.getProject) === null || _data$getProject7 === void 0 ? void 0 : _data$getProject7.screenshots) && (data === null || data === void 0 ? void 0 : (_data$getProject8 = data.getProject) === null || _data$getProject8 === void 0 ? void 0 : (_data$getProject8$scr = _data$getProject8.screenshots) === null || _data$getProject8$scr === void 0 ? void 0 : _data$getProject8$scr.length) > 0 && /*#__PURE__*/React.createElement(Screenshots, null, screenshots.map((screenshot, index) => /*#__PURE__*/React.createElement(Screenshot, {\n    key: screenshot.id,\n    onClick: () => {\n      var _data$getProject9, _data$getProject10;\n\n      return onScreenshotClick && onScreenshotClick(screenshot, screenshot.id, [data === null || data === void 0 ? void 0 : (_data$getProject9 = data.getProject) === null || _data$getProject9 === void 0 ? void 0 : _data$getProject9.preview, ...(data === null || data === void 0 ? void 0 : (_data$getProject10 = data.getProject) === null || _data$getProject10 === void 0 ? void 0 : _data$getProject10.screenshots)]);\n    }\n  }, /*#__PURE__*/React.createElement(Image, {\n    src: screenshot.path,\n    alt: screenshot.name\n  }), index === (screenshots === null || screenshots === void 0 ? void 0 : screenshots.length) - 1 && residue > 0 && /*#__PURE__*/React.createElement(ScreenshotsCounter, null, /*#__PURE__*/React.createElement(\"span\", null, \"+\", residue)))))), /*#__PURE__*/React.createElement(Content, null, /*#__PURE__*/React.createElement(Column, null, /*#__PURE__*/React.createElement(Meta, {\n    shareTitle: data === null || data === void 0 ? void 0 : (_data$getProject11 = data.getProject) === null || _data$getProject11 === void 0 ? void 0 : _data$getProject11.title,\n    shareUrl: false ? location.href : HOST_URL,\n    category: data === null || data === void 0 ? void 0 : (_data$getProject12 = data.getProject) === null || _data$getProject12 === void 0 ? void 0 : (_data$getProject12$ca = _data$getProject12.category) === null || _data$getProject12$ca === void 0 ? void 0 : _data$getProject12$ca.name\n  }), /*#__PURE__*/React.createElement(Title, {\n    tag: 'h3',\n    style: {\n      marginTop: -5,\n      marginBottom: 5\n    }\n  }, data === null || data === void 0 ? void 0 : (_data$getProject13 = data.getProject) === null || _data$getProject13 === void 0 ? void 0 : _data$getProject13.title), /*#__PURE__*/React.createElement(Text, null, data === null || data === void 0 ? void 0 : (_data$getProject14 = data.getProject) === null || _data$getProject14 === void 0 ? void 0 : _data$getProject14.description)), /*#__PURE__*/React.createElement(Column, null, /*#__PURE__*/React.createElement(Divider, {\n    clear: true\n  }), /*#__PURE__*/React.createElement(Difinitions, null, /*#__PURE__*/React.createElement(Difinition, _extends({}, data !== null && data !== void 0 && (_data$getProject15 = data.getProject) !== null && _data$getProject15 !== void 0 && _data$getProject15.company ? {\n    img: data === null || data === void 0 ? void 0 : (_data$getProject16 = data.getProject) === null || _data$getProject16 === void 0 ? void 0 : (_data$getProject16$co = _data$getProject16.company) === null || _data$getProject16$co === void 0 ? void 0 : (_data$getProject16$co2 = _data$getProject16$co.avatar) === null || _data$getProject16$co2 === void 0 ? void 0 : _data$getProject16$co2.path\n  } : {\n    icon: 'work'\n  }, {\n    label: 'Компания',\n    text: (data === null || data === void 0 ? void 0 : (_data$getProject17 = data.getProject) === null || _data$getProject17 === void 0 ? void 0 : (_data$getProject17$co = _data$getProject17.company) === null || _data$getProject17$co === void 0 ? void 0 : _data$getProject17$co.name) || '-',\n    onLink: () => {\n      var _data$getProject18, _data$getProject18$co;\n\n      return setQuery(data === null || data === void 0 ? void 0 : (_data$getProject18 = data.getProject) === null || _data$getProject18 === void 0 ? void 0 : (_data$getProject18$co = _data$getProject18.company) === null || _data$getProject18$co === void 0 ? void 0 : _data$getProject18$co.email, 'user', onCompanyLink);\n    }\n  })), !owned && (onLike || onAdd) && /*#__PURE__*/React.createElement(Actions, null, onLike && /*#__PURE__*/React.createElement(Tooltip, {\n    text: 'Мне нравится'\n  }, /*#__PURE__*/React.createElement(Button, {\n    type: 'button',\n    kind: 'icon',\n    onClick: onClickLike,\n    revert: !isLiked\n  }, /*#__PURE__*/React.createElement(Icon, {\n    icon: 'heart',\n    stroke: isLiked ? 'white' : 'var(--default-color-accent)'\n  }))), onAdd && /*#__PURE__*/React.createElement(Tooltip, {\n    text: 'Добавить проект к себе'\n  }, /*#__PURE__*/React.createElement(Button, {\n    type: 'button',\n    kind: 'icon',\n    onClick: onAdd,\n    revert: true\n  }, /*#__PURE__*/React.createElement(Icon, {\n    icon: 'add',\n    stroke: 'var(--default-color-accent)'\n  })))))))), /*#__PURE__*/React.createElement(Divider, {\n    clear: true\n  }), (data === null || data === void 0 ? void 0 : (_data$getProject19 = data.getProject) === null || _data$getProject19 === void 0 ? void 0 : _data$getProject19.body) && /*#__PURE__*/React.createElement(HTMLView, {\n    content: data === null || data === void 0 ? void 0 : (_data$getProject20 = data.getProject) === null || _data$getProject20 === void 0 ? void 0 : _data$getProject20.body\n  }), /*#__PURE__*/React.createElement(Divider, {\n    clear: true\n  }), (data === null || data === void 0 ? void 0 : (_data$getProject21 = data.getProject) === null || _data$getProject21 === void 0 ? void 0 : _data$getProject21.presentation) && videoPresentationObject && /*#__PURE__*/React.createElement(Presentation, {\n    type: videoPresentationObject.type,\n    videoId: videoPresentationObject.videoId\n  }), /*#__PURE__*/React.createElement(Title, {\n    tag: 'h4'\n  }, \"\\u0423\\u0447\\u0430\\u0441\\u0442\\u043D\\u0438\\u043A\\u0438 \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u0430\"), (data === null || data === void 0 ? void 0 : (_data$getProject22 = data.getProject) === null || _data$getProject22 === void 0 ? void 0 : _data$getProject22.members) && (data === null || data === void 0 ? void 0 : (_data$getProject23 = data.getProject) === null || _data$getProject23 === void 0 ? void 0 : (_data$getProject23$me = _data$getProject23.members) === null || _data$getProject23$me === void 0 ? void 0 : _data$getProject23$me.length) > 0 && /*#__PURE__*/React.createElement(Members, {\n    percentage: 'minmax(320px, 1fr)'\n  }, data === null || data === void 0 ? void 0 : (_data$getProject24 = data.getProject) === null || _data$getProject24 === void 0 ? void 0 : _data$getProject24.members.map(member => {\n    var _member$avatar;\n\n    return /*#__PURE__*/React.createElement(Difinition, {\n      key: member === null || member === void 0 ? void 0 : member.email,\n      img: (member === null || member === void 0 ? void 0 : (_member$avatar = member.avatar) === null || _member$avatar === void 0 ? void 0 : _member$avatar.path) || '/images/avatar-default.png',\n      label: getLabelRole(member === null || member === void 0 ? void 0 : member.account),\n      text: member === null || member === void 0 ? void 0 : member.name,\n      onLink: onMemberLink && (() => setQuery(member === null || member === void 0 ? void 0 : member.email, 'user', onMemberLink))\n    });\n  })), (!(data !== null && data !== void 0 && (_data$getProject25 = data.getProject) !== null && _data$getProject25 !== void 0 && _data$getProject25.members) || (data === null || data === void 0 ? void 0 : (_data$getProject26 = data.getProject) === null || _data$getProject26 === void 0 ? void 0 : (_data$getProject26$me = _data$getProject26.members) === null || _data$getProject26$me === void 0 ? void 0 : _data$getProject26$me.length) === 0) && /*#__PURE__*/React.createElement(Alert, {\n    style: {\n      width: '100%',\n      textAlign: 'center'\n    }\n  }, \"\\u0423\\u0447\\u0430\\u0441\\u0442\\u043D\\u0438\\u043A\\u043E\\u0432 \\u043D\\u0435\\u0442\"), /*#__PURE__*/React.createElement(Divider, {\n    clear: true\n  }), /*#__PURE__*/React.createElement(Title, {\n    tag: 'h4'\n  }, \"\\u0424\\u0430\\u0439\\u043B\\u044B\"), (data === null || data === void 0 ? void 0 : (_data$getProject27 = data.getProject) === null || _data$getProject27 === void 0 ? void 0 : _data$getProject27.files) && (data === null || data === void 0 ? void 0 : (_data$getProject28 = data.getProject) === null || _data$getProject28 === void 0 ? void 0 : (_data$getProject28$fi = _data$getProject28.files) === null || _data$getProject28$fi === void 0 ? void 0 : _data$getProject28$fi.length) > 0 && /*#__PURE__*/React.createElement(Files, {\n    percentage: 'minmax(256px, 1fr)'\n  }, data === null || data === void 0 ? void 0 : (_data$getProject29 = data.getProject) === null || _data$getProject29 === void 0 ? void 0 : _data$getProject29.files.map(file => /*#__PURE__*/React.createElement(Difinition, {\n    key: file.id,\n    icon: 'paper',\n    label: file.filename,\n    text: getFileSize(file.size),\n    onLink: () => onFileLink && onFileLink(file)\n  }))), (!(data !== null && data !== void 0 && (_data$getProject30 = data.getProject) !== null && _data$getProject30 !== void 0 && _data$getProject30.files) || (data === null || data === void 0 ? void 0 : (_data$getProject31 = data.getProject) === null || _data$getProject31 === void 0 ? void 0 : (_data$getProject31$fi = _data$getProject31.files) === null || _data$getProject31$fi === void 0 ? void 0 : _data$getProject31$fi.length) === 0) && /*#__PURE__*/React.createElement(Alert, {\n    style: {\n      width: '100%',\n      textAlign: 'center'\n    }\n  }, \"\\u0424\\u0430\\u0439\\u043B\\u043E\\u0432 \\u043D\\u0435\\u0442\"))));\n};\nView.defaultProps = {\n  appearance: 'default'\n};\nexport default View;","map":null,"metadata":{},"sourceType":"module"}