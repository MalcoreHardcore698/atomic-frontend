{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport styled from 'styled-components';\nimport { useSelector } from 'react-redux';\nimport { useQuery, useLazyQuery } from '@apollo/react-hooks';\nimport { motion } from 'framer-motion';\nimport Column from '../atomic-ui/components/Column';\nimport Alert from '../atomic-ui/components/Alert';\nimport DatePicker from '../atomic-ui/components/DatePicker';\nimport Spinner from '../atomic-ui/components/Spinner';\nimport Select from '../atomic-ui/components/Select';\nimport { useHelper } from '../hooks/useHelper';\nimport { useInfiniteScroll } from '../hooks/useInfiniteScroll';\nimport DefaultLayout from '../layouts/default';\nimport UserCard from '../components/UserCard';\nimport FilterBar from '../components/FilterBar';\nimport SearchBar from '../components/SearchBar';\nimport { onUserLink, onUserMembers } from '../store/helpers/user';\nimport { onChat } from '../store/helpers';\nimport queries from '../graphql/queries';\nimport { categories, filters } from '../__mock__';\nconst TITLE = 'Авторы';\nconst START_OFFSET = 6;\nconst LIMIT = 6;\nconst Wrap = styled(Column).withConfig({\n  displayName: \"creators__Wrap\",\n  componentId: \"sc-1n5fua5-0\"\n})([\"margin-top:120px;margin-bottom:80px;@media only screen and (max-width:480px){margin-top:0;}\"]);\n_c = Wrap;\nconst Container = styled.aside.withConfig({\n  displayName: \"creators__Container\",\n  componentId: \"sc-1n5fua5-1\"\n})([\"display:grid;grid-template-columns:repeat(auto-fit,minmax(442px,1fr));grid-gap:var(--default-gap);@media only screen and (max-width:768px){grid-template-columns:repeat(auto-fit,minmax(285px,1fr));}\"]);\n_c2 = Container;\nconst Loader = styled.div.withConfig({\n  displayName: \"creators__Loader\",\n  componentId: \"sc-1n5fua5-2\"\n})([\"display:flex;justify-content:center;width:100%;height:80px;\"]);\n_c3 = Loader;\nconst chatQueries = {\n  userChats: queries.GET_USER_CHATS,\n  chat: queries.GET_CHAT\n};\nconst chatMutations = {\n  addUserChat: queries.ADD_USER_CHAT,\n  sendMessage: queries.SEND_MESSAGE\n};\n\nconst Creators = ({\n  store\n}) => {\n  _s();\n\n  var _dataLoadUsers$getUse, _dataLoadUsers$getUse2;\n\n  const recall = useHelper();\n  const user = useSelector(state => state.user);\n  const [date, onChangeDate] = useState();\n  const [select, onChangeSelect] = useState();\n  const [search, setSearch] = useState(null);\n  const [visibleFilter, setVisibleFilter] = useState(false);\n  const [offset, setOffset] = useState(START_OFFSET);\n  const [users, setUsers] = useState(store.users || []);\n  const [loadUsersBySearch, {\n    data: dataLoadUsers,\n    loading: loadingLoadUsers,\n    error: errorLoadUsers,\n    refetch: refetchBySearch\n  }] = useLazyQuery(queries.GET_USERS);\n  const {\n    loading,\n    refetch\n  } = useQuery(queries.GET_USERS, {\n    variables: {\n      offset: 0,\n      limit: LIMIT\n    }\n  });\n  const [isFetching, setIsFetching] = useInfiniteScroll(async () => {\n    const response = await (search ? refetchBySearch : refetch)({\n      offset,\n      limit: LIMIT\n    });\n\n    if (!response.errors) {\n      setUsers(prev => [...prev, ...response.data.getUsers]);\n    }\n\n    setOffset(prev => prev + LIMIT);\n    setIsFetching(false);\n  }, 800);\n  return /*#__PURE__*/React.createElement(DefaultLayout, {\n    title: TITLE\n  }, /*#__PURE__*/React.createElement(Wrap, null, /*#__PURE__*/React.createElement(SearchBar, {\n    onChangeFilter: () => setVisibleFilter(!visibleFilter),\n    onSubmit: async search => {\n      setUsers([]);\n      setSearch(search);\n      setOffset(START_OFFSET);\n      console.log(search);\n\n      if (!search) {\n        setIsFetching(true);\n        const response = await refetch({\n          offset,\n          limit: LIMIT\n        });\n        console.log(response);\n\n        if (!response.errors) {\n          setUsers(response.data.getUsers);\n        }\n\n        setIsFetching(false);\n      } else {\n        loadUsersBySearch({\n          variables: {\n            search,\n            offset: 0,\n            limit: START_OFFSET\n          }\n        });\n      }\n    }\n  }), /*#__PURE__*/React.createElement(FilterBar, {\n    isOpen: visibleFilter,\n    filters: [/*#__PURE__*/React.createElement(DatePicker, {\n      key: 0,\n      value: date,\n      placeholder: 'Дата публикации',\n      onChange: onChangeDate,\n      withNavigate: true\n    }), /*#__PURE__*/React.createElement(Select, {\n      key: 1,\n      options: categories,\n      placeholder: 'Раздел',\n      selected: select,\n      onChange: item => onChangeSelect(item)\n    })],\n    options: filters\n  }), /*#__PURE__*/React.createElement(Container, null, ((dataLoadUsers === null || dataLoadUsers === void 0 ? void 0 : dataLoadUsers.getUsers) || users).map(author => {\n    var _author$company;\n\n    const owned = author.name === user.name;\n    return /*#__PURE__*/React.createElement(motion.div, {\n      key: author.email,\n      initial: 'pageInitial',\n      animate: 'pageAnimate',\n      variants: {\n        pageInitial: {\n          opacity: 0\n        },\n        pageAnimate: {\n          opacity: 1\n        }\n      }\n    }, /*#__PURE__*/React.createElement(UserCard, {\n      user: author,\n      owned: owned,\n      onChat: user.email && recall(onChat, {\n        sender: user,\n        recipient: author,\n        queries: chatQueries,\n        mutations: chatMutations\n      }),\n      onMembers: recall(onUserMembers, {\n        id: author === null || author === void 0 ? void 0 : author.email,\n        auth: user === null || user === void 0 ? void 0 : user.email\n      }),\n      onLink: recall(onUserLink, {\n        id: author.email,\n        auth: user === null || user === void 0 ? void 0 : user.email,\n        owned,\n        queries: chatQueries,\n        mutations: chatMutations\n      }),\n      onCompanyLink: recall(onUserLink, {\n        id: (_author$company = author.company) === null || _author$company === void 0 ? void 0 : _author$company.email,\n        auth: user === null || user === void 0 ? void 0 : user.email,\n        queries: chatQueries,\n        mutations: chatMutations\n      })\n    }));\n  }), search && dataLoadUsers && ((_dataLoadUsers$getUse = dataLoadUsers.getUsers) === null || _dataLoadUsers$getUse === void 0 ? void 0 : _dataLoadUsers$getUse.length) === 0 && /*#__PURE__*/React.createElement(Alert, {\n    style: {\n      width: '100%',\n      textAlign: 'center'\n    }\n  }, \"\\u041F\\u043E \\u0432\\u0430\\u0448\\u0435\\u043C\\u0443 \\u0437\\u0430\\u043F\\u0440\\u043E\\u0441\\u0443 \\u043D\\u0438\\u0447\\u0435\\u0433\\u043E \\u043D\\u0435 \\u043D\\u0430\\u0439\\u0434\\u0435\\u043D\\u043E\"), search && errorLoadUsers && /*#__PURE__*/React.createElement(Alert, {\n    appearance: 'error',\n    style: {\n      width: '100%',\n      textAlign: 'center'\n    }\n  }, \"\\u041D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0430\\u0432\\u0442\\u043E\\u0440\\u043E\\u0432\"), (!errorLoadUsers && loading || search && loadingLoadUsers && !dataLoadUsers || isFetching) && /*#__PURE__*/React.createElement(Loader, null, /*#__PURE__*/React.createElement(Spinner, null)), !search && !loading && !loadingLoadUsers && !errorLoadUsers && users.length === 0 && (!(dataLoadUsers !== null && dataLoadUsers !== void 0 && dataLoadUsers.getUsers) || (dataLoadUsers === null || dataLoadUsers === void 0 ? void 0 : (_dataLoadUsers$getUse2 = dataLoadUsers.getUsers) === null || _dataLoadUsers$getUse2 === void 0 ? void 0 : _dataLoadUsers$getUse2.length) === 0) && /*#__PURE__*/React.createElement(Alert, {\n    style: {\n      width: '100%',\n      textAlign: 'center'\n    }\n  }, \"\\u0410\\u0432\\u0442\\u043E\\u0440\\u043E\\u0432 \\u043D\\u0435\\u0442\"))));\n};\n\n_s(Creators, \"PH53OVsTmhypvmefe8zydPIdrFE=\", false, function () {\n  return [useHelper, useSelector, useLazyQuery, useQuery, useInfiniteScroll];\n});\n\n_c4 = Creators;\nexport var __N_SSP = true;\nexport default Creators;\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"Wrap\");\n$RefreshReg$(_c2, \"Container\");\n$RefreshReg$(_c3, \"Loader\");\n$RefreshReg$(_c4, \"Creators\");","map":{"version":3,"sources":["C:/Users/dan82/Documents/workspace/FREELANCE/atomic/atomic-frontend/pages/creators.js"],"names":["React","useState","styled","useSelector","useQuery","useLazyQuery","motion","Column","Alert","DatePicker","Spinner","Select","useHelper","useInfiniteScroll","DefaultLayout","UserCard","FilterBar","SearchBar","onUserLink","onUserMembers","onChat","queries","categories","filters","TITLE","START_OFFSET","LIMIT","Wrap","Container","aside","Loader","div","chatQueries","userChats","GET_USER_CHATS","chat","GET_CHAT","chatMutations","addUserChat","ADD_USER_CHAT","sendMessage","SEND_MESSAGE","Creators","store","recall","user","state","date","onChangeDate","select","onChangeSelect","search","setSearch","visibleFilter","setVisibleFilter","offset","setOffset","users","setUsers","loadUsersBySearch","data","dataLoadUsers","loading","loadingLoadUsers","error","errorLoadUsers","refetch","refetchBySearch","GET_USERS","variables","limit","isFetching","setIsFetching","response","errors","prev","getUsers","console","log","item","map","author","owned","name","email","pageInitial","opacity","pageAnimate","sender","recipient","mutations","id","auth","company","length","width","textAlign"],"mappings":"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","sourcesContent":["import React, { useState } from 'react'\nimport styled from 'styled-components'\nimport { useSelector } from 'react-redux'\nimport { useQuery, useLazyQuery } from '@apollo/react-hooks'\nimport { motion } from 'framer-motion'\n\nimport Column from '../atomic-ui/components/Column'\nimport Alert from '../atomic-ui/components/Alert'\nimport DatePicker from '../atomic-ui/components/DatePicker'\nimport Spinner from '../atomic-ui/components/Spinner'\nimport Select from '../atomic-ui/components/Select'\n\nimport { initializeApollo } from '../apollo'\nimport { useHelper } from '../hooks/useHelper'\nimport { useInfiniteScroll } from '../hooks/useInfiniteScroll'\nimport DefaultLayout from '../layouts/default'\nimport UserCard from '../components/UserCard'\nimport FilterBar from '../components/FilterBar'\nimport SearchBar from '../components/SearchBar'\nimport { onUserLink, onUserMembers } from '../store/helpers/user'\nimport { onChat } from '../store/helpers'\nimport queries from '../graphql/queries'\nimport { categories, filters } from '../__mock__'\n\nconst TITLE = 'Авторы'\nconst START_OFFSET = 6\nconst LIMIT = 6\n\nconst Wrap = styled(Column)`\n  margin-top: 120px;\n  margin-bottom: 80px;\n\n  @media only screen and (max-width: 480px) {\n    margin-top: 0;\n  }\n`\n\nconst Container = styled.aside`\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(442px, 1fr));\n  grid-gap: var(--default-gap);\n\n  @media only screen and (max-width: 768px) {\n    grid-template-columns: repeat(auto-fit, minmax(285px, 1fr));\n  }\n`\n\nconst Loader = styled.div`\n  display: flex;\n  justify-content: center;\n  width: 100%;\n  height: 80px;\n`\n\nconst chatQueries = {\n  userChats: queries.GET_USER_CHATS,\n  chat: queries.GET_CHAT\n}\n\nconst chatMutations = {\n  addUserChat: queries.ADD_USER_CHAT,\n  sendMessage: queries.SEND_MESSAGE\n}\n\nconst Creators = ({ store }) => {\n  const recall = useHelper()\n  const user = useSelector((state) => state.user)\n  const [date, onChangeDate] = useState()\n  const [select, onChangeSelect] = useState()\n  const [search, setSearch] = useState(null)\n  const [visibleFilter, setVisibleFilter] = useState(false)\n  const [offset, setOffset] = useState(START_OFFSET)\n  const [users, setUsers] = useState(store.users || [])\n\n  const [\n    loadUsersBySearch,\n    {\n      data: dataLoadUsers,\n      loading: loadingLoadUsers,\n      error: errorLoadUsers,\n      refetch: refetchBySearch\n    }\n  ] = useLazyQuery(queries.GET_USERS)\n\n  const { loading, refetch } = useQuery(queries.GET_USERS, {\n    variables: {\n      offset: 0,\n      limit: LIMIT\n    }\n  })\n\n  const [isFetching, setIsFetching] = useInfiniteScroll(async () => {\n    const response = await (search ? refetchBySearch : refetch)({ offset, limit: LIMIT })\n    if (!response.errors) {\n      setUsers((prev) => [...prev, ...response.data.getUsers])\n    }\n    setOffset((prev) => prev + LIMIT)\n    setIsFetching(false)\n  }, 800)\n\n  return (\n    <DefaultLayout title={TITLE}>\n      <Wrap>\n        <SearchBar\n          onChangeFilter={() => setVisibleFilter(!visibleFilter)}\n          onSubmit={async (search) => {\n            setUsers([])\n            setSearch(search)\n            setOffset(START_OFFSET)\n            console.log(search)\n            if (!search) {\n              setIsFetching(true)\n              const response = await refetch({ offset, limit: LIMIT })\n              console.log(response)\n              if (!response.errors) {\n                setUsers(response.data.getUsers)\n              }\n              setIsFetching(false)\n            } else {\n              loadUsersBySearch({\n                variables: {\n                  search,\n                  offset: 0,\n                  limit: START_OFFSET\n                }\n              })\n            }\n          }}\n        />\n\n        <FilterBar\n          isOpen={visibleFilter}\n          filters={[\n            <DatePicker\n              key={0}\n              value={date}\n              placeholder={'Дата публикации'}\n              onChange={onChangeDate}\n              withNavigate\n            />,\n            <Select\n              key={1}\n              options={categories}\n              placeholder={'Раздел'}\n              selected={select}\n              onChange={(item) => onChangeSelect(item)}\n            />\n          ]}\n          options={filters}\n        />\n\n        <Container>\n          {(dataLoadUsers?.getUsers || users).map((author) => {\n            const owned = author.name === user.name\n\n            return (\n              <motion.div\n                key={author.email}\n                initial={'pageInitial'}\n                animate={'pageAnimate'}\n                variants={{\n                  pageInitial: {\n                    opacity: 0\n                  },\n                  pageAnimate: {\n                    opacity: 1\n                  }\n                }}>\n                <UserCard\n                  user={author}\n                  owned={owned}\n                  onChat={\n                    user.email &&\n                    recall(onChat, {\n                      sender: user,\n                      recipient: author,\n                      queries: chatQueries,\n                      mutations: chatMutations\n                    })\n                  }\n                  onMembers={recall(onUserMembers, { id: author?.email, auth: user?.email })}\n                  onLink={recall(onUserLink, {\n                    id: author.email,\n                    auth: user?.email,\n                    owned,\n                    queries: chatQueries,\n                    mutations: chatMutations\n                  })}\n                  onCompanyLink={recall(onUserLink, {\n                    id: author.company?.email,\n                    auth: user?.email,\n                    queries: chatQueries,\n                    mutations: chatMutations\n                  })}\n                />\n              </motion.div>\n            )\n          })}\n\n          {search && dataLoadUsers && dataLoadUsers.getUsers?.length === 0 && (\n            <Alert style={{ width: '100%', textAlign: 'center' }}>\n              По вашему запросу ничего не найдено\n            </Alert>\n          )}\n\n          {search && errorLoadUsers && (\n            <Alert appearance={'error'} style={{ width: '100%', textAlign: 'center' }}>\n              Не удалось загрузить авторов\n            </Alert>\n          )}\n\n          {((!errorLoadUsers && loading) ||\n            (search && loadingLoadUsers && !dataLoadUsers) ||\n            isFetching) && (\n            <Loader>\n              <Spinner />\n            </Loader>\n          )}\n\n          {!search &&\n            !loading &&\n            !loadingLoadUsers &&\n            !errorLoadUsers &&\n            users.length === 0 &&\n            (!dataLoadUsers?.getUsers || dataLoadUsers?.getUsers?.length === 0) && (\n              <Alert style={{ width: '100%', textAlign: 'center' }}>Авторов нет</Alert>\n            )}\n        </Container>\n      </Wrap>\n    </DefaultLayout>\n  )\n}\n\nexport async function getServerSideProps() {\n  const client = initializeApollo()\n\n  let users = []\n\n  try {\n    const response = await client.query({\n      query: queries.GET_META_AUTHORS,\n      variables: {\n        offset: 0,\n        limit: START_OFFSET\n      }\n    })\n\n    if (response && response.data) {\n      users = response.data.getUsers\n    }\n  } catch (err) {\n    console.log(err)\n  }\n\n  return {\n    props: {\n      store: { users }\n    }\n  }\n}\n\nexport default Creators\n"]},"metadata":{},"sourceType":"module"}