{"ast":null,"code":"var _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { useRouter } from 'next/router';\nimport styled, { css } from 'styled-components';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useLazyQuery } from '@apollo/react-hooks';\nimport Row from '../atomic-ui/components/Row';\nimport Column from '../atomic-ui/components/Column';\nimport Switch from '../atomic-ui/components/Switch';\nimport Alert from '../atomic-ui/components/Alert';\nimport DatePicker from '../atomic-ui/components/DatePicker';\nimport Select from '../atomic-ui/components/Select';\nimport Button from '../atomic-ui/components/Button';\nimport Spinner from '../atomic-ui/components/Spinner';\nimport Tooltip from '../atomic-ui/components/Tooltip';\nimport { Wrap as WrapText } from '../atomic-ui/components/Text';\nimport Icon from '../atomic-ui/components/Icon';\nimport templates from '../atomic-ui/components/Table/templates';\nimport { useHelper } from '../hooks/useHelper';\nimport DefaultLayout from '../layouts/default';\nimport UserBar from '../components/UserBar';\nimport FilterBar from '../components/FilterBar';\nimport SearchBar from '../components/SearchBar';\nimport ProjectList from '../components/ProjectList';\nimport Difinition from '../atomic-ui/components/Difinition';\nimport { Loader } from '../components/Styled';\nimport { setUserFolder } from '../store/actions/user';\nimport { setFolder } from '../store/actions/root';\nimport { onUserClientEdit, onUserAboutMore, onUserFolderAdd, onUserFolderDelete } from '../store/helpers/user';\nimport queries from '../graphql/queries';\nimport { profilePages } from '../__mock__';\nconst TITLE = 'Профиль';\nconst ContainerInProgress = styled(Row).withConfig({\n  displayName: \"profile__ContainerInProgress\",\n  componentId: \"sc-84d5hd-0\"\n})([\"grid-gap:var(--default-gap);@media only screen and (max-width:768px){flex-direction:column;}\"]);\n_c = ContainerInProgress;\nconst CreateButton = styled(Button).withConfig({\n  displayName: \"profile__CreateButton\",\n  componentId: \"sc-84d5hd-1\"\n})([\"display:flex;justify-content:center;align-items:center;grid-gap:10px;span{white-space:nowrap;}\"]);\n_c2 = CreateButton;\nconst Organizer = styled(Column).withConfig({\n  displayName: \"profile__Organizer\",\n  componentId: \"sc-84d5hd-2\"\n})([\"width:265px;min-width:265px;\"]);\n_c3 = Organizer;\nconst RemoveTooltip = styled(Tooltip).withConfig({\n  displayName: \"profile__RemoveTooltip\",\n  componentId: \"sc-84d5hd-3\"\n})([\"position:absolute;right:5px;display:none;\"]);\n_c4 = RemoveTooltip;\nconst CentralAlert = styled(Alert).withConfig({\n  displayName: \"profile__CentralAlert\",\n  componentId: \"sc-84d5hd-4\"\n})([\"display:flex;justify-content:center;align-items:center;width:100%;flex-grow:10;\"]);\n_c5 = CentralAlert;\nconst ListItem = styled(Difinition).withConfig({\n  displayName: \"profile__ListItem\",\n  componentId: \"sc-84d5hd-5\"\n})([\"position:relative;display:flex;justify-content:space-between;align-items:center;height:var(--input-height-s);background:var(--ghost-color-background);border-radius:var(--surface-border-radius);padding:8px 10px;width:100%;height:auto;cursor:pointer;transition:all 150ms ease;\", \",h4{color:var(--ghost-color-text);}&:hover{\", \",h4{color:black;}}\", \"\"], WrapText, WrapText, ({\n  active\n}) => active && css([\"color:var(--default-color-accent);background:var(--default-color-accent-dim);\", \",h4,p{color:var(--default-color-accent);}&:hover{\", \",h4,p{color:var(--default-color-accent);}}\"], WrapText, WrapText));\n_c6 = ListItem;\n\nconst Projects = ({\n  variables,\n  projects\n}) => /*#__PURE__*/React.createElement(ProjectList, {\n  variables: variables,\n  initialList: projects,\n  layout: true\n});\n\n_c7 = Projects;\n\nconst InProgress = () => {\n  _s();\n\n  const recall = useHelper();\n  const {\n    user,\n    folder\n  } = useSelector(state => ({\n    user: state.user,\n    folder: state.root.folder\n  }));\n  const dispatch = useDispatch();\n  const defaultFolder = useMemo(() => user === null || user === void 0 ? void 0 : user.folders[0], [user]);\n  const [getProjects, {\n    data,\n    loading,\n    refetch\n  }] = useLazyQuery(queries.GET_PROJECTS_BY_IDS);\n  const [customLoading, setCustomLoading] = useState(false);\n\n  const onRefetch = async (item, projects) => {\n    if (projects && refetch) {\n      setCustomLoading(true);\n\n      if (item) {\n        const result = { ...item,\n          projects\n        };\n        dispatch(setFolder(result));\n        dispatch(setUserFolder(result));\n      }\n\n      await refetch({\n        projects\n      });\n      setCustomLoading(false);\n    }\n  };\n\n  const onFolderClick = item => onRefetch(item, item.projects);\n\n  useEffect(() => {\n    if (defaultFolder) {\n      dispatch(setFolder(defaultFolder));\n    }\n  }, [defaultFolder, dispatch]);\n  useEffect(() => {\n    if (!refetch && !data && defaultFolder) {\n      getProjects({\n        variables: {\n          projects: defaultFolder.projects\n        }\n      });\n    }\n  }, [data, refetch, defaultFolder, getProjects]);\n  return /*#__PURE__*/React.createElement(ContainerInProgress, null, /*#__PURE__*/React.createElement(Organizer, null, user.folders && user.folders.length > 0 ? /*#__PURE__*/React.createElement(Column, null, user.folders.map(item => {\n    const length = item.projects.length;\n    const label = length === 1 ? 'проект' : length > 1 && length < 5 ? 'проекта' : 'проектов';\n    return /*#__PURE__*/React.createElement(ListItem, {\n      key: item.id,\n      active: folder && item.id === folder.id,\n      text: item.name,\n      label: `${length} ${label}`,\n      onLink: () => onFolderClick(item),\n      revert: true\n    }, /*#__PURE__*/React.createElement(RemoveTooltip, {\n      place: 'left',\n      text: 'Удалить'\n    }, /*#__PURE__*/React.createElement(Button, {\n      type: 'button',\n      kind: 'icon',\n      size: 'xs',\n      disabled: loading,\n      onClick: recall(onUserFolderDelete, {\n        id: item.id,\n        mutation: queries.DELETE_USER_FOLDER,\n        callback: () => onFolderClick(defaultFolder)\n      })\n    }, /*#__PURE__*/React.createElement(Icon, {\n      size: 'xs',\n      icon: 'delete',\n      stroke: 'white'\n    }))));\n  })) : /*#__PURE__*/React.createElement(Alert, {\n    style: {\n      width: '100%',\n      textAlign: 'center'\n    }\n  }, \"\\u041F\\u0430\\u043F\\u043E\\u043A \\u043D\\u0435\\u0442\"), /*#__PURE__*/React.createElement(CreateButton, {\n    onClick: recall(onUserFolderAdd, {\n      mutation: queries.ADD_USER_FOLDER\n    })\n  }, /*#__PURE__*/React.createElement(\"span\", null, \"\\u041D\\u043E\\u0432\\u0430\\u044F \\u043F\\u0430\\u043F\\u043A\\u0430\"), /*#__PURE__*/React.createElement(Icon, {\n    icon: 'add',\n    stroke: 'white'\n  }))), !loading && !customLoading && data && data.getProjectsByIds.length > 0 ? /*#__PURE__*/React.createElement(ProjectList, {\n    initialList: folder ? data.getProjectsByIds : [],\n    initialRefetch: projects => onRefetch(folder, projects),\n    eliminable: true,\n    layout: true\n  }) : loading || customLoading ? /*#__PURE__*/React.createElement(Loader, {\n    style: {\n      height: 'auto'\n    }\n  }, /*#__PURE__*/React.createElement(Spinner, null)) : /*#__PURE__*/React.createElement(CentralAlert, null, \"\\u0412 \\u044D\\u0442\\u043E\\u0439 \\u043F\\u0430\\u043F\\u043A\\u0435 \\u043D\\u0435\\u0442 \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u043E\\u0432\"));\n};\n\n_s(InProgress, \"7r5pF/oE5+cw5ndHlcWxUGfnDSM=\", false, function () {\n  return [useHelper, useSelector, useDispatch, useLazyQuery];\n});\n\n_c8 = InProgress;\n\nconst Profile = ({\n  categories\n}) => {\n  _s2();\n\n  const recall = useHelper();\n  const router = useRouter();\n  const user = useSelector(state => state.user);\n  const [date, onChangeDate] = useState();\n  const [select, onChangeSelect] = useState();\n  const [currentPage, setCurrentPage] = useState(profilePages[0]);\n  const [visibleFilter, setVisibleFilter] = useState(false);\n  const isAdmin = useMemo(() => (user === null || user === void 0 ? void 0 : user.account) === 'ADMIN', [user]);\n  const renderContentPage = useCallback(() => {\n    if (!user) return null;\n\n    switch (currentPage.value) {\n      case '/projects':\n        return /*#__PURE__*/React.createElement(Projects, {\n          variables: {\n            author: user.email\n          },\n          projects: user.projects\n        });\n\n      case '/liked':\n        return /*#__PURE__*/React.createElement(Projects, {\n          variables: {\n            rating: user.email\n          },\n          projects: user.likedProjects\n        });\n\n      default:\n        return /*#__PURE__*/React.createElement(InProgress, null);\n    }\n  }, [user, currentPage]);\n  useEffect(() => {\n    if (!user.authenticated) {\n      router.push('/auth');\n    }\n  }, [user]);\n\n  if (!user.authenticated) {\n    return /*#__PURE__*/React.createElement(Loader, null, /*#__PURE__*/React.createElement(Spinner, null));\n  }\n\n  return /*#__PURE__*/React.createElement(DefaultLayout, {\n    title: user.authenticated ? user.name || TITLE : 'Авторизация'\n  }, /*#__PURE__*/React.createElement(Column, null, /*#__PURE__*/React.createElement(UserBar, {\n    user: user,\n    onEdit: recall(onUserClientEdit, {\n      user: user === null || user === void 0 ? void 0 : user.email,\n      canEditAccount: !isAdmin,\n      mutations: {\n        update: queries.UPDATE_CLIENT_USER,\n        del: queries.DELETE_USER,\n        changePassword: queries.UPDATE_CLIENT_USER\n      }\n    }),\n    onAboutMore: recall(onUserAboutMore, {\n      user\n    })\n  }), /*#__PURE__*/React.createElement(Switch, {\n    defaultValue: currentPage,\n    options: profilePages,\n    onChange: item => setCurrentPage(item),\n    stretch: true\n  }), /*#__PURE__*/React.createElement(SearchBar, {\n    onChangeFilter: () => setVisibleFilter(!visibleFilter)\n  }), /*#__PURE__*/React.createElement(FilterBar, {\n    isOpen: visibleFilter,\n    filters: [/*#__PURE__*/React.createElement(DatePicker, {\n      key: 'publishedAt',\n      value: date,\n      placeholder: 'Дата публикации',\n      onChange: onChangeDate,\n      withNavigate: true\n    }), /*#__PURE__*/React.createElement(Select, {\n      key: 'categories',\n      options: categories.map(category => ({\n        value: category.id,\n        label: category.name\n      })),\n      placeholder: 'Раздел',\n      selected: select,\n      onChange: item => onChangeSelect(item)\n    })],\n    options: templates.project.map((item, index) => ({\n      label: item.header,\n      value: index\n    }))\n  }), renderContentPage()));\n};\n\n_s2(Profile, \"sK6DPOnI4LeoiBZLPr9xIv11Bc4=\", false, function () {\n  return [useHelper, useRouter, useSelector];\n});\n\n_c9 = Profile;\nexport var __N_SSP = true;\nexport default Profile;\n\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9;\n\n$RefreshReg$(_c, \"ContainerInProgress\");\n$RefreshReg$(_c2, \"CreateButton\");\n$RefreshReg$(_c3, \"Organizer\");\n$RefreshReg$(_c4, \"RemoveTooltip\");\n$RefreshReg$(_c5, \"CentralAlert\");\n$RefreshReg$(_c6, \"ListItem\");\n$RefreshReg$(_c7, \"Projects\");\n$RefreshReg$(_c8, \"InProgress\");\n$RefreshReg$(_c9, \"Profile\");","map":{"version":3,"sources":["C:/Users/dan82/Documents/workspace/FREELANCE/atomic/atomic-frontend/pages/profile.js"],"names":["React","useState","useEffect","useCallback","useMemo","useRouter","styled","css","useSelector","useDispatch","useLazyQuery","Row","Column","Switch","Alert","DatePicker","Select","Button","Spinner","Tooltip","Wrap","WrapText","Icon","templates","useHelper","DefaultLayout","UserBar","FilterBar","SearchBar","ProjectList","Difinition","Loader","setUserFolder","setFolder","onUserClientEdit","onUserAboutMore","onUserFolderAdd","onUserFolderDelete","queries","profilePages","TITLE","ContainerInProgress","CreateButton","Organizer","RemoveTooltip","CentralAlert","ListItem","active","Projects","variables","projects","InProgress","recall","user","folder","state","root","dispatch","defaultFolder","folders","getProjects","data","loading","refetch","GET_PROJECTS_BY_IDS","customLoading","setCustomLoading","onRefetch","item","result","onFolderClick","length","map","label","id","name","mutation","DELETE_USER_FOLDER","callback","width","textAlign","ADD_USER_FOLDER","getProjectsByIds","height","Profile","categories","router","date","onChangeDate","select","onChangeSelect","currentPage","setCurrentPage","visibleFilter","setVisibleFilter","isAdmin","account","renderContentPage","value","author","email","rating","likedProjects","authenticated","push","canEditAccount","mutations","update","UPDATE_CLIENT_USER","del","DELETE_USER","changePassword","category","project","index","header"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,WAArC,EAAkDC,OAAlD,QAAiE,OAAjE;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,OAAOC,MAAP,IAAiBC,GAAjB,QAA4B,mBAA5B;AACA,SAASC,WAAT,EAAsBC,WAAtB,QAAyC,aAAzC;AACA,SAASC,YAAT,QAA6B,qBAA7B;AAEA,OAAOC,GAAP,MAAgB,6BAAhB;AACA,OAAOC,MAAP,MAAmB,gCAAnB;AACA,OAAOC,MAAP,MAAmB,gCAAnB;AACA,OAAOC,KAAP,MAAkB,+BAAlB;AACA,OAAOC,UAAP,MAAuB,oCAAvB;AACA,OAAOC,MAAP,MAAmB,gCAAnB;AACA,OAAOC,MAAP,MAAmB,gCAAnB;AACA,OAAOC,OAAP,MAAoB,iCAApB;AACA,OAAOC,OAAP,MAAoB,iCAApB;AACA,SAASC,IAAI,IAAIC,QAAjB,QAAiC,8BAAjC;AACA,OAAOC,IAAP,MAAiB,8BAAjB;AACA,OAAOC,SAAP,MAAsB,yCAAtB;AAGA,SAASC,SAAT,QAA0B,oBAA1B;AACA,OAAOC,aAAP,MAA0B,oBAA1B;AACA,OAAOC,OAAP,MAAoB,uBAApB;AACA,OAAOC,SAAP,MAAsB,yBAAtB;AACA,OAAOC,SAAP,MAAsB,yBAAtB;AACA,OAAOC,WAAP,MAAwB,2BAAxB;AACA,OAAOC,UAAP,MAAuB,oCAAvB;AACA,SAASC,MAAT,QAAuB,sBAAvB;AACA,SAASC,aAAT,QAA8B,uBAA9B;AACA,SAASC,SAAT,QAA0B,uBAA1B;AACA,SACEC,gBADF,EAEEC,eAFF,EAGEC,eAHF,EAIEC,kBAJF,QAKO,uBALP;AAMA,OAAOC,OAAP,MAAoB,oBAApB;AACA,SAASC,YAAT,QAA6B,aAA7B;AAEA,MAAMC,KAAK,GAAG,SAAd;AAEA,MAAMC,mBAAmB,GAAGnC,MAAM,CAACK,GAAD,CAAT;AAAA;AAAA;AAAA,oGAAzB;KAAM8B,mB;AAQN,MAAMC,YAAY,GAAGpC,MAAM,CAACW,MAAD,CAAT;AAAA;AAAA;AAAA,sGAAlB;MAAMyB,Y;AAWN,MAAMC,SAAS,GAAGrC,MAAM,CAACM,MAAD,CAAT;AAAA;AAAA;AAAA,oCAAf;MAAM+B,S;AAKN,MAAMC,aAAa,GAAGtC,MAAM,CAACa,OAAD,CAAT;AAAA;AAAA;AAAA,iDAAnB;MAAMyB,a;AAMN,MAAMC,YAAY,GAAGvC,MAAM,CAACQ,KAAD,CAAT;AAAA;AAAA;AAAA,uFAAlB;MAAM+B,Y;AAQN,MAAMC,QAAQ,GAAGxC,MAAM,CAACwB,UAAD,CAAT;AAAA;AAAA;AAAA,oWAcVT,QAdU,EAmBRA,QAnBQ,EAwBV,CAAC;AAAE0B,EAAAA;AAAF,CAAD,KACAA,MAAM,IACNxC,GADM,uLAKFc,QALE,EAUAA,QAVA,CAzBI,CAAd;MAAMyB,Q;;AA0CN,MAAME,QAAQ,GAAG,CAAC;AAAEC,EAAAA,SAAF;AAAaC,EAAAA;AAAb,CAAD,kBACf,oBAAC,WAAD;AAAa,EAAA,SAAS,EAAED,SAAxB;AAAmC,EAAA,WAAW,EAAEC,QAAhD;AAA0D,EAAA,MAAM;AAAhE,EADF;;MAAMF,Q;;AAIN,MAAMG,UAAU,GAAG,MAAM;AAAA;;AACvB,QAAMC,MAAM,GAAG5B,SAAS,EAAxB;AACA,QAAM;AAAE6B,IAAAA,IAAF;AAAQC,IAAAA;AAAR,MAAmB9C,WAAW,CAAE+C,KAAD,KAAY;AAC/CF,IAAAA,IAAI,EAAEE,KAAK,CAACF,IADmC;AAE/CC,IAAAA,MAAM,EAAEC,KAAK,CAACC,IAAN,CAAWF;AAF4B,GAAZ,CAAD,CAApC;AAIA,QAAMG,QAAQ,GAAGhD,WAAW,EAA5B;AAEA,QAAMiD,aAAa,GAAGtD,OAAO,CAAC,MAAMiD,IAAN,aAAMA,IAAN,uBAAMA,IAAI,CAAEM,OAAN,CAAc,CAAd,CAAP,EAAyB,CAACN,IAAD,CAAzB,CAA7B;AACA,QAAM,CAACO,WAAD,EAAc;AAAEC,IAAAA,IAAF;AAAQC,IAAAA,OAAR;AAAiBC,IAAAA;AAAjB,GAAd,IAA4CrD,YAAY,CAAC4B,OAAO,CAAC0B,mBAAT,CAA9D;AACA,QAAM,CAACC,aAAD,EAAgBC,gBAAhB,IAAoCjE,QAAQ,CAAC,KAAD,CAAlD;;AAEA,QAAMkE,SAAS,GAAG,OAAOC,IAAP,EAAalB,QAAb,KAA0B;AAC1C,QAAIA,QAAQ,IAAIa,OAAhB,EAAyB;AACvBG,MAAAA,gBAAgB,CAAC,IAAD,CAAhB;;AAEA,UAAIE,IAAJ,EAAU;AACR,cAAMC,MAAM,GAAG,EAAE,GAAGD,IAAL;AAAWlB,UAAAA;AAAX,SAAf;AACAO,QAAAA,QAAQ,CAACxB,SAAS,CAACoC,MAAD,CAAV,CAAR;AACAZ,QAAAA,QAAQ,CAACzB,aAAa,CAACqC,MAAD,CAAd,CAAR;AACD;;AAED,YAAMN,OAAO,CAAC;AAAEb,QAAAA;AAAF,OAAD,CAAb;AACAgB,MAAAA,gBAAgB,CAAC,KAAD,CAAhB;AACD;AACF,GAbD;;AAeA,QAAMI,aAAa,GAAIF,IAAD,IAAUD,SAAS,CAACC,IAAD,EAAOA,IAAI,CAAClB,QAAZ,CAAzC;;AAEAhD,EAAAA,SAAS,CAAC,MAAM;AACd,QAAIwD,aAAJ,EAAmB;AACjBD,MAAAA,QAAQ,CAACxB,SAAS,CAACyB,aAAD,CAAV,CAAR;AACD;AACF,GAJQ,EAIN,CAACA,aAAD,EAAgBD,QAAhB,CAJM,CAAT;AAMAvD,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI,CAAC6D,OAAD,IAAY,CAACF,IAAb,IAAqBH,aAAzB,EAAwC;AACtCE,MAAAA,WAAW,CAAC;AACVX,QAAAA,SAAS,EAAE;AAAEC,UAAAA,QAAQ,EAAEQ,aAAa,CAACR;AAA1B;AADD,OAAD,CAAX;AAGD;AACF,GANQ,EAMN,CAACW,IAAD,EAAOE,OAAP,EAAgBL,aAAhB,EAA+BE,WAA/B,CANM,CAAT;AAQA,sBACE,oBAAC,mBAAD,qBACE,oBAAC,SAAD,QACGP,IAAI,CAACM,OAAL,IAAgBN,IAAI,CAACM,OAAL,CAAaY,MAAb,GAAsB,CAAtC,gBACC,oBAAC,MAAD,QACGlB,IAAI,CAACM,OAAL,CAAaa,GAAb,CAAkBJ,IAAD,IAAU;AAC1B,UAAMG,MAAM,GAAGH,IAAI,CAAClB,QAAL,CAAcqB,MAA7B;AACA,UAAME,KAAK,GACTF,MAAM,KAAK,CAAX,GAAe,QAAf,GAA0BA,MAAM,GAAG,CAAT,IAAcA,MAAM,GAAG,CAAvB,GAA2B,SAA3B,GAAuC,UADnE;AAGA,wBACE,oBAAC,QAAD;AACE,MAAA,GAAG,EAAEH,IAAI,CAACM,EADZ;AAEE,MAAA,MAAM,EAAEpB,MAAM,IAAIc,IAAI,CAACM,EAAL,KAAYpB,MAAM,CAACoB,EAFvC;AAGE,MAAA,IAAI,EAAEN,IAAI,CAACO,IAHb;AAIE,MAAA,KAAK,EAAG,GAAEJ,MAAO,IAAGE,KAAM,EAJ5B;AAKE,MAAA,MAAM,EAAE,MAAMH,aAAa,CAACF,IAAD,CAL7B;AAME,MAAA,MAAM;AANR,oBAOE,oBAAC,aAAD;AAAe,MAAA,KAAK,EAAE,MAAtB;AAA8B,MAAA,IAAI,EAAE;AAApC,oBACE,oBAAC,MAAD;AACE,MAAA,IAAI,EAAE,QADR;AAEE,MAAA,IAAI,EAAE,MAFR;AAGE,MAAA,IAAI,EAAE,IAHR;AAIE,MAAA,QAAQ,EAAEN,OAJZ;AAKE,MAAA,OAAO,EAAEV,MAAM,CAACf,kBAAD,EAAqB;AAClCqC,QAAAA,EAAE,EAAEN,IAAI,CAACM,EADyB;AAElCE,QAAAA,QAAQ,EAAEtC,OAAO,CAACuC,kBAFgB;AAGlCC,QAAAA,QAAQ,EAAE,MAAMR,aAAa,CAACZ,aAAD;AAHK,OAArB;AALjB,oBAUE,oBAAC,IAAD;AAAM,MAAA,IAAI,EAAE,IAAZ;AAAkB,MAAA,IAAI,EAAE,QAAxB;AAAkC,MAAA,MAAM,EAAE;AAA1C,MAVF,CADF,CAPF,CADF;AAwBD,GA7BA,CADH,CADD,gBAkCC,oBAAC,KAAD;AAAO,IAAA,KAAK,EAAE;AAAEqB,MAAAA,KAAK,EAAE,MAAT;AAAiBC,MAAAA,SAAS,EAAE;AAA5B;AAAd,yDAnCJ,eAqCE,oBAAC,YAAD;AAAc,IAAA,OAAO,EAAE5B,MAAM,CAAChB,eAAD,EAAkB;AAAEwC,MAAAA,QAAQ,EAAEtC,OAAO,CAAC2C;AAApB,KAAlB;AAA7B,kBACE,kGADF,eAEE,oBAAC,IAAD;AAAM,IAAA,IAAI,EAAE,KAAZ;AAAmB,IAAA,MAAM,EAAE;AAA3B,IAFF,CArCF,CADF,EA4CG,CAACnB,OAAD,IAAY,CAACG,aAAb,IAA8BJ,IAA9B,IAAsCA,IAAI,CAACqB,gBAAL,CAAsBX,MAAtB,GAA+B,CAArE,gBACC,oBAAC,WAAD;AACE,IAAA,WAAW,EAAEjB,MAAM,GAAGO,IAAI,CAACqB,gBAAR,GAA2B,EADhD;AAEE,IAAA,cAAc,EAAGhC,QAAD,IAAciB,SAAS,CAACb,MAAD,EAASJ,QAAT,CAFzC;AAGE,IAAA,UAAU,MAHZ;AAIE,IAAA,MAAM;AAJR,IADD,GAOGY,OAAO,IAAIG,aAAX,gBACF,oBAAC,MAAD;AAAQ,IAAA,KAAK,EAAE;AAAEkB,MAAAA,MAAM,EAAE;AAAV;AAAf,kBACE,oBAAC,OAAD,OADF,CADE,gBAKF,oBAAC,YAAD,6IAxDJ,CADF;AA6DD,CAxGD;;GAAMhC,U;UACW3B,S,EACUhB,W,EAIRC,W,EAGiCC,Y;;;MAT9CyC,U;;AA0GN,MAAMiC,OAAO,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,KAAoB;AAAA;;AAClC,QAAMjC,MAAM,GAAG5B,SAAS,EAAxB;AACA,QAAM8D,MAAM,GAAGjF,SAAS,EAAxB;AACA,QAAMgD,IAAI,GAAG7C,WAAW,CAAE+C,KAAD,IAAWA,KAAK,CAACF,IAAlB,CAAxB;AACA,QAAM,CAACkC,IAAD,EAAOC,YAAP,IAAuBvF,QAAQ,EAArC;AACA,QAAM,CAACwF,MAAD,EAASC,cAAT,IAA2BzF,QAAQ,EAAzC;AACA,QAAM,CAAC0F,WAAD,EAAcC,cAAd,IAAgC3F,QAAQ,CAACsC,YAAY,CAAC,CAAD,CAAb,CAA9C;AACA,QAAM,CAACsD,aAAD,EAAgBC,gBAAhB,IAAoC7F,QAAQ,CAAC,KAAD,CAAlD;AACA,QAAM8F,OAAO,GAAG3F,OAAO,CAAC,MAAM,CAAAiD,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAE2C,OAAN,MAAkB,OAAzB,EAAkC,CAAC3C,IAAD,CAAlC,CAAvB;AAEA,QAAM4C,iBAAiB,GAAG9F,WAAW,CAAC,MAAM;AAC1C,QAAI,CAACkD,IAAL,EAAW,OAAO,IAAP;;AACX,YAAQsC,WAAW,CAACO,KAApB;AACE,WAAK,WAAL;AACE,4BAAO,oBAAC,QAAD;AAAU,UAAA,SAAS,EAAE;AAAEC,YAAAA,MAAM,EAAE9C,IAAI,CAAC+C;AAAf,WAArB;AAA6C,UAAA,QAAQ,EAAE/C,IAAI,CAACH;AAA5D,UAAP;;AACF,WAAK,QAAL;AACE,4BAAO,oBAAC,QAAD;AAAU,UAAA,SAAS,EAAE;AAAEmD,YAAAA,MAAM,EAAEhD,IAAI,CAAC+C;AAAf,WAArB;AAA6C,UAAA,QAAQ,EAAE/C,IAAI,CAACiD;AAA5D,UAAP;;AACF;AACE,4BAAO,oBAAC,UAAD,OAAP;AANJ;AAQD,GAVoC,EAUlC,CAACjD,IAAD,EAAOsC,WAAP,CAVkC,CAArC;AAYAzF,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI,CAACmD,IAAI,CAACkD,aAAV,EAAyB;AACvBjB,MAAAA,MAAM,CAACkB,IAAP,CAAY,OAAZ;AACD;AACF,GAJQ,EAIN,CAACnD,IAAD,CAJM,CAAT;;AAMA,MAAI,CAACA,IAAI,CAACkD,aAAV,EAAyB;AACvB,wBACE,oBAAC,MAAD,qBACE,oBAAC,OAAD,OADF,CADF;AAKD;;AAED,sBACE,oBAAC,aAAD;AAAe,IAAA,KAAK,EAAElD,IAAI,CAACkD,aAAL,GAAqBlD,IAAI,CAACsB,IAAL,IAAanC,KAAlC,GAA0C;AAAhE,kBACE,oBAAC,MAAD,qBACE,oBAAC,OAAD;AACE,IAAA,IAAI,EAAEa,IADR;AAEE,IAAA,MAAM,EAAED,MAAM,CAAClB,gBAAD,EAAmB;AAC/BmB,MAAAA,IAAI,EAAEA,IAAF,aAAEA,IAAF,uBAAEA,IAAI,CAAE+C,KADmB;AAE/BK,MAAAA,cAAc,EAAE,CAACV,OAFc;AAG/BW,MAAAA,SAAS,EAAE;AACTC,QAAAA,MAAM,EAAErE,OAAO,CAACsE,kBADP;AAETC,QAAAA,GAAG,EAAEvE,OAAO,CAACwE,WAFJ;AAGTC,QAAAA,cAAc,EAAEzE,OAAO,CAACsE;AAHf;AAHoB,KAAnB,CAFhB;AAWE,IAAA,WAAW,EAAExD,MAAM,CAACjB,eAAD,EAAkB;AAAEkB,MAAAA;AAAF,KAAlB;AAXrB,IADF,eAeE,oBAAC,MAAD;AACE,IAAA,YAAY,EAAEsC,WADhB;AAEE,IAAA,OAAO,EAAEpD,YAFX;AAGE,IAAA,QAAQ,EAAG6B,IAAD,IAAUwB,cAAc,CAACxB,IAAD,CAHpC;AAIE,IAAA,OAAO;AAJT,IAfF,eAsBE,oBAAC,SAAD;AAAW,IAAA,cAAc,EAAE,MAAM0B,gBAAgB,CAAC,CAACD,aAAF;AAAjD,IAtBF,eAwBE,oBAAC,SAAD;AACE,IAAA,MAAM,EAAEA,aADV;AAEE,IAAA,OAAO,EAAE,cACP,oBAAC,UAAD;AACE,MAAA,GAAG,EAAE,aADP;AAEE,MAAA,KAAK,EAAEN,IAFT;AAGE,MAAA,WAAW,EAAE,iBAHf;AAIE,MAAA,QAAQ,EAAEC,YAJZ;AAKE,MAAA,YAAY;AALd,MADO,eAQP,oBAAC,MAAD;AACE,MAAA,GAAG,EAAE,YADP;AAEE,MAAA,OAAO,EAAEH,UAAU,CAACb,GAAX,CAAgBwC,QAAD,KAAe;AACrCd,QAAAA,KAAK,EAAEc,QAAQ,CAACtC,EADqB;AAErCD,QAAAA,KAAK,EAAEuC,QAAQ,CAACrC;AAFqB,OAAf,CAAf,CAFX;AAME,MAAA,WAAW,EAAE,QANf;AAOE,MAAA,QAAQ,EAAEc,MAPZ;AAQE,MAAA,QAAQ,EAAGrB,IAAD,IAAUsB,cAAc,CAACtB,IAAD;AARpC,MARO,CAFX;AAqBE,IAAA,OAAO,EAAE7C,SAAS,CAAC0F,OAAV,CAAkBzC,GAAlB,CAAsB,CAACJ,IAAD,EAAO8C,KAAP,MAAkB;AAC/CzC,MAAAA,KAAK,EAAEL,IAAI,CAAC+C,MADmC;AAE/CjB,MAAAA,KAAK,EAAEgB;AAFwC,KAAlB,CAAtB;AArBX,IAxBF,EAmDGjB,iBAAiB,EAnDpB,CADF,CADF;AAyDD,CA7FD;;IAAMb,O;UACW5D,S,EACAnB,S,EACFG,W;;;MAHT4E,O;;AAuHN,eAAeA,OAAf","sourcesContent":["import React, { useState, useEffect, useCallback, useMemo } from 'react'\nimport { useRouter } from 'next/router'\nimport styled, { css } from 'styled-components'\nimport { useSelector, useDispatch } from 'react-redux'\nimport { useLazyQuery } from '@apollo/react-hooks'\n\nimport Row from '../atomic-ui/components/Row'\nimport Column from '../atomic-ui/components/Column'\nimport Switch from '../atomic-ui/components/Switch'\nimport Alert from '../atomic-ui/components/Alert'\nimport DatePicker from '../atomic-ui/components/DatePicker'\nimport Select from '../atomic-ui/components/Select'\nimport Button from '../atomic-ui/components/Button'\nimport Spinner from '../atomic-ui/components/Spinner'\nimport Tooltip from '../atomic-ui/components/Tooltip'\nimport { Wrap as WrapText } from '../atomic-ui/components/Text'\nimport Icon from '../atomic-ui/components/Icon'\nimport templates from '../atomic-ui/components/Table/templates'\n\nimport { initializeApollo } from '../apollo'\nimport { useHelper } from '../hooks/useHelper'\nimport DefaultLayout from '../layouts/default'\nimport UserBar from '../components/UserBar'\nimport FilterBar from '../components/FilterBar'\nimport SearchBar from '../components/SearchBar'\nimport ProjectList from '../components/ProjectList'\nimport Difinition from '../atomic-ui/components/Difinition'\nimport { Loader } from '../components/Styled'\nimport { setUserFolder } from '../store/actions/user'\nimport { setFolder } from '../store/actions/root'\nimport {\n  onUserClientEdit,\n  onUserAboutMore,\n  onUserFolderAdd,\n  onUserFolderDelete\n} from '../store/helpers/user'\nimport queries from '../graphql/queries'\nimport { profilePages } from '../__mock__'\n\nconst TITLE = 'Профиль'\n\nconst ContainerInProgress = styled(Row)`\n  grid-gap: var(--default-gap);\n\n  @media only screen and (max-width: 768px) {\n    flex-direction: column;\n  }\n`\n\nconst CreateButton = styled(Button)`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  grid-gap: 10px;\n\n  span {\n    white-space: nowrap;\n  }\n`\n\nconst Organizer = styled(Column)`\n  width: 265px;\n  min-width: 265px;\n`\n\nconst RemoveTooltip = styled(Tooltip)`\n  position: absolute;\n  right: 5px;\n  display: none;\n`\n\nconst CentralAlert = styled(Alert)`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  flex-grow: 10;\n`\n\nconst ListItem = styled(Difinition)`\n  position: relative;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  height: var(--input-height-s);\n  background: var(--ghost-color-background);\n  border-radius: var(--surface-border-radius);\n  padding: 8px 10px;\n  width: 100%;\n  height: auto;\n  cursor: pointer;\n  transition: all 150ms ease;\n\n  ${WrapText}, h4 {\n    color: var(--ghost-color-text);\n  }\n\n  &:hover {\n    ${WrapText}, h4 {\n      color: black;\n    }\n  }\n\n  ${({ active }) =>\n    active &&\n    css`\n      color: var(--default-color-accent);\n      background: var(--default-color-accent-dim);\n\n      ${WrapText}, h4, p {\n        color: var(--default-color-accent);\n      }\n\n      &:hover {\n        ${WrapText}, h4, p {\n          color: var(--default-color-accent);\n        }\n      }\n    `}\n`\n\nconst Projects = ({ variables, projects }) => (\n  <ProjectList variables={variables} initialList={projects} layout />\n)\n\nconst InProgress = () => {\n  const recall = useHelper()\n  const { user, folder } = useSelector((state) => ({\n    user: state.user,\n    folder: state.root.folder\n  }))\n  const dispatch = useDispatch()\n\n  const defaultFolder = useMemo(() => user?.folders[0], [user])\n  const [getProjects, { data, loading, refetch }] = useLazyQuery(queries.GET_PROJECTS_BY_IDS)\n  const [customLoading, setCustomLoading] = useState(false)\n\n  const onRefetch = async (item, projects) => {\n    if (projects && refetch) {\n      setCustomLoading(true)\n\n      if (item) {\n        const result = { ...item, projects }\n        dispatch(setFolder(result))\n        dispatch(setUserFolder(result))\n      }\n\n      await refetch({ projects })\n      setCustomLoading(false)\n    }\n  }\n\n  const onFolderClick = (item) => onRefetch(item, item.projects)\n\n  useEffect(() => {\n    if (defaultFolder) {\n      dispatch(setFolder(defaultFolder))\n    }\n  }, [defaultFolder, dispatch])\n\n  useEffect(() => {\n    if (!refetch && !data && defaultFolder) {\n      getProjects({\n        variables: { projects: defaultFolder.projects }\n      })\n    }\n  }, [data, refetch, defaultFolder, getProjects])\n\n  return (\n    <ContainerInProgress>\n      <Organizer>\n        {user.folders && user.folders.length > 0 ? (\n          <Column>\n            {user.folders.map((item) => {\n              const length = item.projects.length\n              const label =\n                length === 1 ? 'проект' : length > 1 && length < 5 ? 'проекта' : 'проектов'\n\n              return (\n                <ListItem\n                  key={item.id}\n                  active={folder && item.id === folder.id}\n                  text={item.name}\n                  label={`${length} ${label}`}\n                  onLink={() => onFolderClick(item)}\n                  revert>\n                  <RemoveTooltip place={'left'} text={'Удалить'}>\n                    <Button\n                      type={'button'}\n                      kind={'icon'}\n                      size={'xs'}\n                      disabled={loading}\n                      onClick={recall(onUserFolderDelete, {\n                        id: item.id,\n                        mutation: queries.DELETE_USER_FOLDER,\n                        callback: () => onFolderClick(defaultFolder)\n                      })}>\n                      <Icon size={'xs'} icon={'delete'} stroke={'white'} />\n                    </Button>\n                  </RemoveTooltip>\n                </ListItem>\n              )\n            })}\n          </Column>\n        ) : (\n          <Alert style={{ width: '100%', textAlign: 'center' }}>Папок нет</Alert>\n        )}\n        <CreateButton onClick={recall(onUserFolderAdd, { mutation: queries.ADD_USER_FOLDER })}>\n          <span>Новая папка</span>\n          <Icon icon={'add'} stroke={'white'} />\n        </CreateButton>\n      </Organizer>\n\n      {!loading && !customLoading && data && data.getProjectsByIds.length > 0 ? (\n        <ProjectList\n          initialList={folder ? data.getProjectsByIds : []}\n          initialRefetch={(projects) => onRefetch(folder, projects)}\n          eliminable\n          layout\n        />\n      ) : loading || customLoading ? (\n        <Loader style={{ height: 'auto' }}>\n          <Spinner />\n        </Loader>\n      ) : (\n        <CentralAlert>В этой папке нет проектов</CentralAlert>\n      )}\n    </ContainerInProgress>\n  )\n}\n\nconst Profile = ({ categories }) => {\n  const recall = useHelper()\n  const router = useRouter()\n  const user = useSelector((state) => state.user)\n  const [date, onChangeDate] = useState()\n  const [select, onChangeSelect] = useState()\n  const [currentPage, setCurrentPage] = useState(profilePages[0])\n  const [visibleFilter, setVisibleFilter] = useState(false)\n  const isAdmin = useMemo(() => user?.account === 'ADMIN', [user])\n\n  const renderContentPage = useCallback(() => {\n    if (!user) return null\n    switch (currentPage.value) {\n      case '/projects':\n        return <Projects variables={{ author: user.email }} projects={user.projects} />\n      case '/liked':\n        return <Projects variables={{ rating: user.email }} projects={user.likedProjects} />\n      default:\n        return <InProgress />\n    }\n  }, [user, currentPage])\n\n  useEffect(() => {\n    if (!user.authenticated) {\n      router.push('/auth')\n    }\n  }, [user])\n\n  if (!user.authenticated) {\n    return (\n      <Loader>\n        <Spinner />\n      </Loader>\n    )\n  }\n\n  return (\n    <DefaultLayout title={user.authenticated ? user.name || TITLE : 'Авторизация'}>\n      <Column>\n        <UserBar\n          user={user}\n          onEdit={recall(onUserClientEdit, {\n            user: user?.email,\n            canEditAccount: !isAdmin,\n            mutations: {\n              update: queries.UPDATE_CLIENT_USER,\n              del: queries.DELETE_USER,\n              changePassword: queries.UPDATE_CLIENT_USER\n            }\n          })}\n          onAboutMore={recall(onUserAboutMore, { user })}\n        />\n\n        <Switch\n          defaultValue={currentPage}\n          options={profilePages}\n          onChange={(item) => setCurrentPage(item)}\n          stretch\n        />\n\n        <SearchBar onChangeFilter={() => setVisibleFilter(!visibleFilter)} />\n\n        <FilterBar\n          isOpen={visibleFilter}\n          filters={[\n            <DatePicker\n              key={'publishedAt'}\n              value={date}\n              placeholder={'Дата публикации'}\n              onChange={onChangeDate}\n              withNavigate\n            />,\n            <Select\n              key={'categories'}\n              options={categories.map((category) => ({\n                value: category.id,\n                label: category.name\n              }))}\n              placeholder={'Раздел'}\n              selected={select}\n              onChange={(item) => onChangeSelect(item)}\n            />\n          ]}\n          options={templates.project.map((item, index) => ({\n            label: item.header,\n            value: index\n          }))}\n        />\n\n        {renderContentPage()}\n      </Column>\n    </DefaultLayout>\n  )\n}\n\nexport async function getServerSideProps() {\n  const client = initializeApollo()\n\n  let categories = []\n\n  try {\n    const response = await client.query({\n      query: queries.GET_CATEGORIES\n    })\n\n    if (response && response.data) {\n      categories = response.data.getCategories\n    }\n  } catch (err) {\n    console.log(err)\n  }\n\n  return {\n    props: {\n      categories\n    }\n  }\n}\n\nexport default Profile\n"]},"metadata":{},"sourceType":"module"}