{"ast":null,"code":"import React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useLazyQuery } from '@apollo/react-hooks';\nimport styled, { css } from 'styled-components';\nimport { useRouter } from 'next/router';\nimport Row from '../atomic-ui/components/Row';\nimport Column from '../atomic-ui/components/Column';\nimport Switch from '../atomic-ui/components/Switch';\nimport Alert from '../atomic-ui/components/Alert';\nimport Icon from '../atomic-ui/components/Icon';\nimport Difinition from '../atomic-ui/components/Difinition';\nimport DatePicker from '../atomic-ui/components/DatePicker';\nimport Select from '../atomic-ui/components/Select';\nimport Button from '../atomic-ui/components/Button';\nimport Spinner from '../atomic-ui/components/Spinner';\nimport Tooltip from '../atomic-ui/components/Tooltip';\nimport { Wrap as WrapText } from '../atomic-ui/components/Text';\nimport templates from '../atomic-ui/components/Table/templates';\nimport { hasAccess } from '../atomic-ui/utils/functions';\nimport { initializeApollo } from '../apollo';\nimport { useHelper } from '../hooks/useHelper';\nimport DefaultLayout from '../layouts/default';\nimport UserBar from '../components/UserBar';\nimport FilterBar from '../components/FilterBar';\nimport SearchBar from '../components/SearchBar';\nimport ProjectList from '../components/ProjectList';\nimport ArticleList from '../components/ArticleList';\nimport { hasResponsibleMember } from '../components/Members';\nimport { Loader } from '../components/Styled';\nimport List from '../components/List';\nimport ProjectCard from '../components/ProjectCard';\nimport { INITIAL_DISPLAY_METHOD } from '../layouts/content';\nimport { setUserFolder, updateUser } from '../store/actions/user';\nimport { setFolder, setCompanies, setCategories, setStatuses } from '../store/actions/root';\nimport { onUserClientEdit, onUserAboutMore, onUserFolderAdd, onUserFolderDelete, onUserMembers, onUserLink } from '../store/helpers/user';\nimport { onProjectAdd, onProjectCreate, onProjectRemove, onProjectScreenshot } from '../store/helpers/project';\nimport { onArticleCreate } from '../store/helpers/article';\nimport { useMutate } from '../hooks/useMutate';\nimport { profilePages } from '../__mock__';\nimport queries from '../graphql/queries';\nconst TITLE = 'Профиль';\nconst START_OFFSET = 0;\nconst LIMIT = 4;\nconst ContainerInProgress = styled(Row).withConfig({\n  displayName: \"profile__ContainerInProgress\",\n  componentId: \"sc-84d5hd-0\"\n})([\"grid-gap:var(--default-gap);@media only screen and (max-width:768px){flex-direction:column;}\"]);\nconst CreateButton = styled(Button).withConfig({\n  displayName: \"profile__CreateButton\",\n  componentId: \"sc-84d5hd-1\"\n})([\"display:flex;justify-content:center;align-items:center;grid-gap:10px;span{white-space:nowrap;}\"]);\nconst Organizer = styled(Column).withConfig({\n  displayName: \"profile__Organizer\",\n  componentId: \"sc-84d5hd-2\"\n})([\"width:265px;min-width:265px;\"]);\nconst RemoveTooltip = styled(Tooltip).withConfig({\n  displayName: \"profile__RemoveTooltip\",\n  componentId: \"sc-84d5hd-3\"\n})([\"position:absolute;right:8px;z-index:var(--z-11);display:none;\"]);\nconst CentralAlert = styled(Alert).withConfig({\n  displayName: \"profile__CentralAlert\",\n  componentId: \"sc-84d5hd-4\"\n})([\"display:flex;justify-content:center;align-items:center;width:100%;flex-grow:10;\"]);\nconst ListItem = styled.div.withConfig({\n  displayName: \"profile__ListItem\",\n  componentId: \"sc-84d5hd-5\"\n})([\"position:relative;display:flex;justify-content:space-between;align-items:center;height:var(--input-height-s);background:var(--ghost-color-background);border-radius:var(--surface-border-radius);padding:8px 10px;width:100%;height:auto;cursor:pointer;transition:all 150ms ease;\", \",h4{color:var(--ghost-color-text);}\", \"{svg path{color:var(--ghost-color-text);}}&:hover{\", \"{display:flex;svg path{stroke:black;}}\", \",h4{color:black;}}\", \"\"], WrapText, RemoveTooltip, RemoveTooltip, WrapText, ({\n  active\n}) => active && css([\"color:var(--default-color-accent);background:var(--default-color-accent-dim);\", \"{svg path{stroke:var(--default-color-accent) !important;}}\", \",h4,p{color:var(--default-color-accent);}&:hover{\", \",h4,p{color:var(--default-color-accent);}}\"], RemoveTooltip, WrapText, WrapText));\n\nconst Projects = ({\n  variables\n}) => {\n  const recall = useHelper();\n  const mutate = useMutate();\n  const {\n    user,\n    folder\n  } = useSelector(state => ({\n    user: state.user,\n    folder: state.root.folder,\n    search: state.root.search\n  }));\n  const dispatch = useDispatch();\n  const onAdd = useCallback(project => recall(onProjectAdd, {\n    id: project.id,\n    folders: user === null || user === void 0 ? void 0 : user.folders,\n    mutations: {\n      addProject: queries.ADD_USER_PROJECT,\n      createFolder: queries.ADD_USER_FOLDER\n    },\n    callback: item => {\n      const result = { ...item,\n        projects: [...item.projects, project.id]\n      };\n      dispatch(setUserFolder(result));\n    }\n  })(), [user]);\n  const onRemove = useCallback(project => recall(onProjectRemove, {\n    id: project.id,\n    folder,\n    mutation: queries.REMOVE_USER_PROJECT\n  })(), [user]);\n  return /*#__PURE__*/React.createElement(List, {\n    limit: LIMIT,\n    type: 'getProjects',\n    query: queries.GET_PROJECTS,\n    variables: variables,\n    emptyMessage: 'Проектов нет',\n    startOffset: START_OFFSET,\n    initialDisplayMethod: INITIAL_DISPLAY_METHOD,\n    component: document => {\n      var _user$folders, _document$company;\n\n      return /*#__PURE__*/React.createElement(ProjectCard, {\n        project: document,\n        added: !!(user !== null && user !== void 0 && (_user$folders = user.folders) !== null && _user$folders !== void 0 && _user$folders.find(folder => !!(folder !== null && folder !== void 0 && folder.projects.find(item => item === item.id)))),\n        liked: !!(document.rating || []).find(item => item.email === user.email),\n        onLike: user.email && mutate(queries.LIKE_PROJECT, {\n          id: document.id\n        }, response => dispatch(updateUser(response.data.likeProject))),\n        onAdd: user.email && (() => onAdd(document)),\n        onRemove: user.email && (() => onRemove(document)),\n        onAboutMore: recall(onUserAboutMore, {\n          user: document\n        }),\n        onCompanyLink: recall(onUserLink, {\n          id: (_document$company = document.company) === null || _document$company === void 0 ? void 0 : _document$company.email,\n          auth: user === null || user === void 0 ? void 0 : user.email,\n          recipient: document.author,\n          query: queries.GET_USER_CHATS,\n          mutation: queries.SEND_MESSAGE\n        }),\n        onScreenshotClick: (_, key) => recall(onProjectScreenshot, {\n          screenshots: [document.preview, ...document.screenshots],\n          key\n        })(),\n        withSocials: true\n      });\n    }\n  });\n};\n\nconst Articles = ({\n  variables\n}) => /*#__PURE__*/React.createElement(ArticleList, {\n  variables: variables,\n  layout: true\n});\n\nconst InProgress = () => {\n  const recall = useHelper();\n  const {\n    user,\n    folder\n  } = useSelector(state => ({\n    user: state.user,\n    folder: state.root.folder\n  }));\n  const dispatch = useDispatch();\n  const defaultFolder = useMemo(() => user === null || user === void 0 ? void 0 : user.folders[0], [user]);\n  const [getProjects, {\n    data,\n    loading,\n    refetch\n  }] = useLazyQuery(queries.GET_PROJECTS_BY_IDS);\n  const [customLoading, setCustomLoading] = useState(false);\n\n  const onRefetch = async (item, projects) => {\n    if (projects && refetch) {\n      setCustomLoading(true);\n\n      if (item) {\n        const result = { ...item,\n          projects\n        };\n        dispatch(setFolder(result));\n        dispatch(setUserFolder(result));\n      }\n\n      await refetch({\n        projects\n      });\n      setCustomLoading(false);\n    }\n  };\n\n  const onFolderClick = item => onRefetch(item, item.projects);\n\n  useEffect(() => {\n    if (defaultFolder) {\n      dispatch(setFolder(defaultFolder));\n    }\n  }, [defaultFolder, dispatch]);\n  useEffect(() => {\n    if (!refetch && !data && defaultFolder) {\n      getProjects({\n        variables: {\n          projects: defaultFolder.projects\n        }\n      });\n    }\n  }, [data, refetch, defaultFolder, getProjects]);\n  return /*#__PURE__*/React.createElement(ContainerInProgress, null, /*#__PURE__*/React.createElement(Organizer, null, user.folders && user.folders.length > 0 ? /*#__PURE__*/React.createElement(Column, null, user.folders.map(item => {\n    const length = item.projects.length;\n    const label = length === 1 ? 'проект' : length > 1 && length < 5 ? 'проекта' : 'проектов';\n    return /*#__PURE__*/React.createElement(ListItem, {\n      key: item.id,\n      active: folder && item.id === folder.id\n    }, /*#__PURE__*/React.createElement(Difinition, {\n      text: item.name,\n      label: `${length} ${label}`,\n      onLink: () => onFolderClick(item),\n      revert: true\n    }), /*#__PURE__*/React.createElement(RemoveTooltip, {\n      place: 'left',\n      text: 'Удалить'\n    }, /*#__PURE__*/React.createElement(Button, {\n      size: 'xs',\n      kind: 'icon',\n      type: 'button',\n      disabled: loading,\n      appearance: 'clear',\n      onClick: recall(onUserFolderDelete, {\n        id: item.id,\n        mutation: queries.DELETE_USER_FOLDER,\n        callback: () => onFolderClick(defaultFolder)\n      })\n    }, /*#__PURE__*/React.createElement(Icon, {\n      size: 'xs',\n      icon: 'delete',\n      stroke: 'var(--ghost-color-text)'\n    }))));\n  })) : /*#__PURE__*/React.createElement(Alert, {\n    style: {\n      width: '100%',\n      textAlign: 'center'\n    }\n  }, \"\\u041F\\u0430\\u043F\\u043E\\u043A \\u043D\\u0435\\u0442\"), /*#__PURE__*/React.createElement(CreateButton, {\n    onClick: recall(onUserFolderAdd, {\n      mutation: queries.ADD_USER_FOLDER\n    })\n  }, /*#__PURE__*/React.createElement(\"span\", null, \"\\u041D\\u043E\\u0432\\u0430\\u044F \\u043F\\u0430\\u043F\\u043A\\u0430\"), /*#__PURE__*/React.createElement(Icon, {\n    icon: 'add',\n    stroke: 'white'\n  }))), !loading && !customLoading && data && data.getProjectsByIds.length > 0 ? /*#__PURE__*/React.createElement(ProjectList, {\n    initialList: folder ? data.getProjectsByIds : [],\n    initialRefetch: projects => onRefetch(folder, projects),\n    eliminable: true,\n    layout: true\n  }) : loading || customLoading ? /*#__PURE__*/React.createElement(Loader, {\n    style: {\n      height: 'auto'\n    }\n  }, /*#__PURE__*/React.createElement(Spinner, null)) : /*#__PURE__*/React.createElement(CentralAlert, null, \"\\u0412 \\u044D\\u0442\\u043E\\u0439 \\u043F\\u0430\\u043F\\u043A\\u0435 \\u043D\\u0435\\u0442 \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u043E\\u0432\"));\n};\n\nconst Profile = () => {\n  var _user$company;\n\n  const recall = useHelper();\n  const router = useRouter();\n  const {\n    user,\n    companies,\n    categories,\n    statuses\n  } = useSelector(state => ({\n    user: state.user,\n    companies: state.root.companies,\n    categories: state.root.categories,\n    statuses: state.root.statuses\n  }));\n  const dispatch = useDispatch();\n  const [date, onChangeDate] = useState();\n  const [select, onChangeSelect] = useState();\n  const [currentPage, setCurrentPage] = useState(profilePages[0]);\n  const [visibleFilter, setVisibleFilter] = useState(false);\n  const isAdmin = useMemo(() => (user === null || user === void 0 ? void 0 : user.account) === 'ADMIN', [user]);\n  const [loadCompanies] = useLazyQuery(queries.GET_USERS);\n  const [loadCategories] = useLazyQuery(queries.GET_CATEGORIES);\n  const [loadStatuses] = useLazyQuery(queries.GET_POST_STATUSES);\n  const isProjects = useMemo(() => currentPage.value === '/projects', [currentPage]);\n  const isArticles = useMemo(() => currentPage.value === '/articles', [currentPage]);\n\n  const addProject = async () => {\n    var _companiesResponse$da, _categoriesResponse$d, _statusesResponse$dat;\n\n    const companiesResponse = (companies === null || companies === void 0 ? void 0 : companies.length) === 0 && loadCompanies && (await loadCompanies({\n      variables: {\n        account: ['ENTITY']\n      }\n    }));\n    const categoriesResponse = (categories === null || categories === void 0 ? void 0 : categories.length) === 0 && loadCategories && (await loadCategories({\n      variables: {\n        type: 'DIVISION'\n      }\n    }));\n    const statusesResponse = (statuses === null || statuses === void 0 ? void 0 : statuses.length) === 0 && loadStatuses && (await loadStatuses());\n    const companiesResult = companiesResponse === null || companiesResponse === void 0 ? void 0 : (_companiesResponse$da = companiesResponse.data) === null || _companiesResponse$da === void 0 ? void 0 : _companiesResponse$da.getUsers;\n    const categoriesResult = categoriesResponse === null || categoriesResponse === void 0 ? void 0 : (_categoriesResponse$d = categoriesResponse.data) === null || _categoriesResponse$d === void 0 ? void 0 : _categoriesResponse$d.getCategories;\n    const statusesResult = statusesResponse === null || statusesResponse === void 0 ? void 0 : (_statusesResponse$dat = statusesResponse.data) === null || _statusesResponse$dat === void 0 ? void 0 : _statusesResponse$dat.getPostStatus;\n    if (companiesResult) dispatch(setCompanies(companiesResult));\n    if (categoriesResult) dispatch(setCategories(categoriesResult));\n    if (statusesResult) dispatch(setStatuses(statusesResult));\n    recall(onProjectCreate, {\n      companies: companiesResult || companies,\n      categories: categoriesResult || categories,\n      statuses: statusesResult || statuses,\n      mutation: queries.CREATE_PROJECT,\n      query: queries.GET_USERS,\n      isPurpose: true\n    })();\n  };\n\n  const addArticle = async () => {\n    var _categoriesResponse$d2, _statusesResponse$dat2;\n\n    const categoriesResponse = (categories === null || categories === void 0 ? void 0 : categories.length) === 0 && loadCategories && (await loadCategories({\n      variables: {\n        type: 'DIVISION'\n      }\n    }));\n    const statusesResponse = (statuses === null || statuses === void 0 ? void 0 : statuses.length) === 0 && loadStatuses && (await loadStatuses());\n    const categoriesResult = categoriesResponse === null || categoriesResponse === void 0 ? void 0 : (_categoriesResponse$d2 = categoriesResponse.data) === null || _categoriesResponse$d2 === void 0 ? void 0 : _categoriesResponse$d2.getCategories;\n    const statusesResult = statusesResponse === null || statusesResponse === void 0 ? void 0 : (_statusesResponse$dat2 = statusesResponse.data) === null || _statusesResponse$dat2 === void 0 ? void 0 : _statusesResponse$dat2.getPostStatus;\n    if (categoriesResult) dispatch(setCategories(categoriesResult));\n    if (statusesResult) dispatch(setStatuses(statusesResult));\n    recall(onArticleCreate, {\n      categories: categoriesResult || categories,\n      statuses: statusesResult || statuses,\n      mutation: queries.CREATE_ARTICLE,\n      isPurpose: true\n    })();\n  };\n\n  const renderContentPage = useCallback(() => {\n    if (!user) return null;\n\n    switch (currentPage.value) {\n      case '/projects':\n        return /*#__PURE__*/React.createElement(Projects, {\n          variables: {\n            author: user.email\n          },\n          projects: user.projects\n        });\n\n      case '/liked':\n        return /*#__PURE__*/React.createElement(Projects, {\n          variables: {\n            rating: user.email\n          },\n          projects: user.likedProjects\n        });\n\n      case '/articles':\n        return /*#__PURE__*/React.createElement(Articles, {\n          variables: {\n            author: user.email\n          }\n        });\n\n      default:\n        return /*#__PURE__*/React.createElement(InProgress, null);\n    }\n  }, [user, currentPage]);\n  useEffect(() => {\n    if (!user.authenticated) {\n      router.push('/auth');\n    }\n  }, [user]);\n\n  if (!user.authenticated) {\n    return /*#__PURE__*/React.createElement(Loader, null, /*#__PURE__*/React.createElement(Spinner, null));\n  }\n\n  return /*#__PURE__*/React.createElement(DefaultLayout, {\n    title: user.authenticated ? user.name || TITLE : 'Авторизация'\n  }, /*#__PURE__*/React.createElement(Column, null, /*#__PURE__*/React.createElement(UserBar, {\n    user: user,\n    onEdit: recall(onUserClientEdit, {\n      user: user === null || user === void 0 ? void 0 : user.email,\n      canEditAccount: !isAdmin,\n      mutations: {\n        del: queries.DELETE_USER,\n        forgotEmail: queries.LOGIN,\n        forgotPassword: queries.RESET,\n        changePassword: queries.UPDATE_CLIENT_USER,\n        checkResetToken: queries.CHECK_RESET_TOKEN,\n        update: queries.UPDATE_CLIENT_USER\n      }\n    }),\n    onAboutMore: recall(onUserAboutMore, {\n      user\n    }),\n    onCompanyLink: (user === null || user === void 0 ? void 0 : user.company) && recall(onUserLink, {\n      id: user === null || user === void 0 ? void 0 : (_user$company = user.company) === null || _user$company === void 0 ? void 0 : _user$company.email,\n      auth: user === null || user === void 0 ? void 0 : user.email,\n      queries: {\n        userChats: queries.GET_USER_CHATS,\n        chat: queries.GET_CHAT\n      },\n      mutations: {\n        addUserChat: queries.ADD_USER_CHAT,\n        sendMessage: queries.SEND_MESSAGE\n      }\n    }),\n    onMembers: recall(onUserMembers, {\n      id: user === null || user === void 0 ? void 0 : user.email,\n      auth: user === null || user === void 0 ? void 0 : user.email\n    })\n  }), /*#__PURE__*/React.createElement(Switch, {\n    defaultValue: currentPage,\n    options: profilePages.filter(page => !hasResponsibleMember(user) ? page.value !== '/articles' : true),\n    onChange: item => setCurrentPage(item),\n    stretch: true\n  }), /*#__PURE__*/React.createElement(SearchBar, {\n    buttonCreateText: isProjects ? 'Предложить проект' : isArticles ? 'Предложить статью' : '',\n    onCreate: isProjects && hasAccess(user, 'PURPOSE_PROJECT') && addProject || isArticles && hasAccess(user, 'PURPOSE_ARTICLE') && addArticle,\n    onChangeFilter: () => setVisibleFilter(!visibleFilter)\n  }), /*#__PURE__*/React.createElement(FilterBar, {\n    isOpen: visibleFilter,\n    filters: [/*#__PURE__*/React.createElement(DatePicker, {\n      key: 'publishedAt',\n      value: date,\n      placeholder: 'Дата публикации',\n      onChange: onChangeDate,\n      withNavigate: true\n    }), /*#__PURE__*/React.createElement(Select, {\n      key: 'categories',\n      options: [].map(category => ({\n        value: category.id,\n        label: category.name\n      })),\n      placeholder: 'Раздел',\n      selected: select,\n      onChange: item => onChangeSelect(item)\n    })],\n    options: templates.project.map((item, index) => ({\n      label: item.header,\n      value: index\n    }))\n  }), renderContentPage()));\n};\n\nexport async function getServerSideProps() {\n  const client = initializeApollo();\n  let categories = [];\n\n  try {\n    const response = await client.query({\n      query: queries.GET_CATEGORIES\n    });\n\n    if (response && response.data) {\n      categories = response.data.getCategories;\n    }\n  } catch (err) {\n    console.log(err);\n  }\n\n  return {\n    props: {\n      categories\n    }\n  };\n}\nexport default Profile;","map":{"version":3,"sources":["C:/Users/dan82/Documents/workspace/FREELANCE/atomic/atomic-frontend/pages/profile.js"],"names":["React","useState","useEffect","useCallback","useMemo","useSelector","useDispatch","useLazyQuery","styled","css","useRouter","Row","Column","Switch","Alert","Icon","Difinition","DatePicker","Select","Button","Spinner","Tooltip","Wrap","WrapText","templates","hasAccess","initializeApollo","useHelper","DefaultLayout","UserBar","FilterBar","SearchBar","ProjectList","ArticleList","hasResponsibleMember","Loader","List","ProjectCard","INITIAL_DISPLAY_METHOD","setUserFolder","updateUser","setFolder","setCompanies","setCategories","setStatuses","onUserClientEdit","onUserAboutMore","onUserFolderAdd","onUserFolderDelete","onUserMembers","onUserLink","onProjectAdd","onProjectCreate","onProjectRemove","onProjectScreenshot","onArticleCreate","useMutate","profilePages","queries","TITLE","START_OFFSET","LIMIT","ContainerInProgress","CreateButton","Organizer","RemoveTooltip","CentralAlert","ListItem","div","active","Projects","variables","recall","mutate","user","folder","state","root","search","dispatch","onAdd","project","id","folders","mutations","addProject","ADD_USER_PROJECT","createFolder","ADD_USER_FOLDER","callback","item","result","projects","onRemove","mutation","REMOVE_USER_PROJECT","GET_PROJECTS","document","find","rating","email","LIKE_PROJECT","response","data","likeProject","company","auth","recipient","author","query","GET_USER_CHATS","SEND_MESSAGE","_","key","screenshots","preview","Articles","InProgress","defaultFolder","getProjects","loading","refetch","GET_PROJECTS_BY_IDS","customLoading","setCustomLoading","onRefetch","onFolderClick","length","map","label","name","DELETE_USER_FOLDER","width","textAlign","getProjectsByIds","height","Profile","router","companies","categories","statuses","date","onChangeDate","select","onChangeSelect","currentPage","setCurrentPage","visibleFilter","setVisibleFilter","isAdmin","account","loadCompanies","GET_USERS","loadCategories","GET_CATEGORIES","loadStatuses","GET_POST_STATUSES","isProjects","value","isArticles","companiesResponse","categoriesResponse","type","statusesResponse","companiesResult","getUsers","categoriesResult","getCategories","statusesResult","getPostStatus","CREATE_PROJECT","isPurpose","addArticle","CREATE_ARTICLE","renderContentPage","likedProjects","authenticated","push","canEditAccount","del","DELETE_USER","forgotEmail","LOGIN","forgotPassword","RESET","changePassword","UPDATE_CLIENT_USER","checkResetToken","CHECK_RESET_TOKEN","update","userChats","chat","GET_CHAT","addUserChat","ADD_USER_CHAT","sendMessage","filter","page","category","index","header","getServerSideProps","client","err","console","log","props"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback, useMemo } from 'react'\nimport { useSelector, useDispatch } from 'react-redux'\nimport { useLazyQuery } from '@apollo/react-hooks'\nimport styled, { css } from 'styled-components'\nimport { useRouter } from 'next/router'\n\nimport Row from '../atomic-ui/components/Row'\nimport Column from '../atomic-ui/components/Column'\nimport Switch from '../atomic-ui/components/Switch'\nimport Alert from '../atomic-ui/components/Alert'\nimport Icon from '../atomic-ui/components/Icon'\nimport Difinition from '../atomic-ui/components/Difinition'\nimport DatePicker from '../atomic-ui/components/DatePicker'\nimport Select from '../atomic-ui/components/Select'\nimport Button from '../atomic-ui/components/Button'\nimport Spinner from '../atomic-ui/components/Spinner'\nimport Tooltip from '../atomic-ui/components/Tooltip'\nimport { Wrap as WrapText } from '../atomic-ui/components/Text'\nimport templates from '../atomic-ui/components/Table/templates'\nimport { hasAccess } from '../atomic-ui/utils/functions'\n\nimport { initializeApollo } from '../apollo'\nimport { useHelper } from '../hooks/useHelper'\nimport DefaultLayout from '../layouts/default'\nimport UserBar from '../components/UserBar'\nimport FilterBar from '../components/FilterBar'\nimport SearchBar from '../components/SearchBar'\nimport ProjectList from '../components/ProjectList'\nimport ArticleList from '../components/ArticleList'\nimport { hasResponsibleMember } from '../components/Members'\nimport { Loader } from '../components/Styled'\n\nimport List from '../components/List'\nimport ProjectCard from '../components/ProjectCard'\nimport { INITIAL_DISPLAY_METHOD } from '../layouts/content'\nimport { setUserFolder, updateUser } from '../store/actions/user'\nimport { setFolder, setCompanies, setCategories, setStatuses } from '../store/actions/root'\nimport {\n  onUserClientEdit,\n  onUserAboutMore,\n  onUserFolderAdd,\n  onUserFolderDelete,\n  onUserMembers,\n  onUserLink\n} from '../store/helpers/user'\nimport {\n  onProjectAdd,\n  onProjectCreate,\n  onProjectRemove,\n  onProjectScreenshot\n} from '../store/helpers/project'\nimport { onArticleCreate } from '../store/helpers/article'\nimport { useMutate } from '../hooks/useMutate'\nimport { profilePages } from '../__mock__'\nimport queries from '../graphql/queries'\n\nconst TITLE = 'Профиль'\nconst START_OFFSET = 0\nconst LIMIT = 4\n\nconst ContainerInProgress = styled(Row)`\n  grid-gap: var(--default-gap);\n\n  @media only screen and (max-width: 768px) {\n    flex-direction: column;\n  }\n`\n\nconst CreateButton = styled(Button)`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  grid-gap: 10px;\n\n  span {\n    white-space: nowrap;\n  }\n`\n\nconst Organizer = styled(Column)`\n  width: 265px;\n  min-width: 265px;\n`\n\nconst RemoveTooltip = styled(Tooltip)`\n  position: absolute;\n  right: 8px;\n  z-index: var(--z-11);\n  display: none;\n`\n\nconst CentralAlert = styled(Alert)`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  flex-grow: 10;\n`\n\nconst ListItem = styled.div`\n  position: relative;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  height: var(--input-height-s);\n  background: var(--ghost-color-background);\n  border-radius: var(--surface-border-radius);\n  padding: 8px 10px;\n  width: 100%;\n  height: auto;\n  cursor: pointer;\n  transition: all 150ms ease;\n\n  ${WrapText}, h4 {\n    color: var(--ghost-color-text);\n  }\n\n  ${RemoveTooltip} {\n    svg path {\n      color: var(--ghost-color-text);\n    }\n  }\n\n  &:hover {\n    ${RemoveTooltip} {\n      display: flex;\n\n      svg path {\n        stroke: black;\n      }\n    }\n\n    ${WrapText}, h4 {\n      color: black;\n    }\n  }\n\n  ${({ active }) =>\n    active &&\n    css`\n      color: var(--default-color-accent);\n      background: var(--default-color-accent-dim);\n\n      ${RemoveTooltip} {\n        svg path {\n          stroke: var(--default-color-accent) !important;\n        }\n      }\n\n      ${WrapText}, h4, p {\n        color: var(--default-color-accent);\n      }\n\n      &:hover {\n        ${WrapText}, h4, p {\n          color: var(--default-color-accent);\n        }\n      }\n    `}\n`\n\nconst Projects = ({ variables }) => {\n  const recall = useHelper()\n  const mutate = useMutate()\n  const { user, folder } = useSelector((state) => ({\n    user: state.user,\n    folder: state.root.folder,\n    search: state.root.search\n  }))\n  const dispatch = useDispatch()\n\n  const onAdd = useCallback(\n    (project) =>\n      recall(onProjectAdd, {\n        id: project.id,\n        folders: user?.folders,\n        mutations: {\n          addProject: queries.ADD_USER_PROJECT,\n          createFolder: queries.ADD_USER_FOLDER\n        },\n        callback: (item) => {\n          const result = { ...item, projects: [...item.projects, project.id] }\n          dispatch(setUserFolder(result))\n        }\n      })(),\n    [user]\n  )\n\n  const onRemove = useCallback(\n    (project) =>\n      recall(onProjectRemove, {\n        id: project.id,\n        folder,\n        mutation: queries.REMOVE_USER_PROJECT\n      })(),\n    [user]\n  )\n\n  return (\n    <List\n      limit={LIMIT}\n      type={'getProjects'}\n      query={queries.GET_PROJECTS}\n      variables={variables}\n      emptyMessage={'Проектов нет'}\n      startOffset={START_OFFSET}\n      initialDisplayMethod={INITIAL_DISPLAY_METHOD}\n      component={(document) => (\n        <ProjectCard\n          project={document}\n          added={\n            !!user?.folders?.find((folder) => !!folder?.projects.find((item) => item === item.id))\n          }\n          liked={!!(document.rating || []).find((item) => item.email === user.email)}\n          onLike={\n            user.email &&\n            mutate(queries.LIKE_PROJECT, { id: document.id }, (response) =>\n              dispatch(updateUser(response.data.likeProject))\n            )\n          }\n          onAdd={user.email && (() => onAdd(document))}\n          onRemove={user.email && (() => onRemove(document))}\n          onAboutMore={recall(onUserAboutMore, { user: document })}\n          onCompanyLink={recall(onUserLink, {\n            id: document.company?.email,\n            auth: user?.email,\n            recipient: document.author,\n            query: queries.GET_USER_CHATS,\n            mutation: queries.SEND_MESSAGE\n          })}\n          onScreenshotClick={(_, key) =>\n            recall(onProjectScreenshot, {\n              screenshots: [document.preview, ...document.screenshots],\n              key\n            })()\n          }\n          withSocials\n        />\n      )}\n    />\n  )\n}\n\nconst Articles = ({ variables }) => <ArticleList variables={variables} layout />\n\nconst InProgress = () => {\n  const recall = useHelper()\n  const { user, folder } = useSelector((state) => ({\n    user: state.user,\n    folder: state.root.folder\n  }))\n  const dispatch = useDispatch()\n\n  const defaultFolder = useMemo(() => user?.folders[0], [user])\n  const [getProjects, { data, loading, refetch }] = useLazyQuery(queries.GET_PROJECTS_BY_IDS)\n  const [customLoading, setCustomLoading] = useState(false)\n\n  const onRefetch = async (item, projects) => {\n    if (projects && refetch) {\n      setCustomLoading(true)\n\n      if (item) {\n        const result = { ...item, projects }\n        dispatch(setFolder(result))\n        dispatch(setUserFolder(result))\n      }\n\n      await refetch({ projects })\n      setCustomLoading(false)\n    }\n  }\n\n  const onFolderClick = (item) => onRefetch(item, item.projects)\n\n  useEffect(() => {\n    if (defaultFolder) {\n      dispatch(setFolder(defaultFolder))\n    }\n  }, [defaultFolder, dispatch])\n\n  useEffect(() => {\n    if (!refetch && !data && defaultFolder) {\n      getProjects({\n        variables: { projects: defaultFolder.projects }\n      })\n    }\n  }, [data, refetch, defaultFolder, getProjects])\n\n  return (\n    <ContainerInProgress>\n      <Organizer>\n        {user.folders && user.folders.length > 0 ? (\n          <Column>\n            {user.folders.map((item) => {\n              const length = item.projects.length\n              const label =\n                length === 1 ? 'проект' : length > 1 && length < 5 ? 'проекта' : 'проектов'\n\n              return (\n                <ListItem key={item.id} active={folder && item.id === folder.id}>\n                  <Difinition\n                    text={item.name}\n                    label={`${length} ${label}`}\n                    onLink={() => onFolderClick(item)}\n                    revert\n                  />\n                  <RemoveTooltip place={'left'} text={'Удалить'}>\n                    <Button\n                      size={'xs'}\n                      kind={'icon'}\n                      type={'button'}\n                      disabled={loading}\n                      appearance={'clear'}\n                      onClick={recall(onUserFolderDelete, {\n                        id: item.id,\n                        mutation: queries.DELETE_USER_FOLDER,\n                        callback: () => onFolderClick(defaultFolder)\n                      })}>\n                      <Icon size={'xs'} icon={'delete'} stroke={'var(--ghost-color-text)'} />\n                    </Button>\n                  </RemoveTooltip>\n                </ListItem>\n              )\n            })}\n          </Column>\n        ) : (\n          <Alert style={{ width: '100%', textAlign: 'center' }}>Папок нет</Alert>\n        )}\n        <CreateButton onClick={recall(onUserFolderAdd, { mutation: queries.ADD_USER_FOLDER })}>\n          <span>Новая папка</span>\n          <Icon icon={'add'} stroke={'white'} />\n        </CreateButton>\n      </Organizer>\n\n      {!loading && !customLoading && data && data.getProjectsByIds.length > 0 ? (\n        <ProjectList\n          initialList={folder ? data.getProjectsByIds : []}\n          initialRefetch={(projects) => onRefetch(folder, projects)}\n          eliminable\n          layout\n        />\n      ) : loading || customLoading ? (\n        <Loader style={{ height: 'auto' }}>\n          <Spinner />\n        </Loader>\n      ) : (\n        <CentralAlert>В этой папке нет проектов</CentralAlert>\n      )}\n    </ContainerInProgress>\n  )\n}\n\nconst Profile = () => {\n  const recall = useHelper()\n  const router = useRouter()\n  const { user, companies, categories, statuses } = useSelector((state) => ({\n    user: state.user,\n    companies: state.root.companies,\n    categories: state.root.categories,\n    statuses: state.root.statuses\n  }))\n  const dispatch = useDispatch()\n  const [date, onChangeDate] = useState()\n  const [select, onChangeSelect] = useState()\n  const [currentPage, setCurrentPage] = useState(profilePages[0])\n  const [visibleFilter, setVisibleFilter] = useState(false)\n  const isAdmin = useMemo(() => user?.account === 'ADMIN', [user])\n\n  const [loadCompanies] = useLazyQuery(queries.GET_USERS)\n  const [loadCategories] = useLazyQuery(queries.GET_CATEGORIES)\n  const [loadStatuses] = useLazyQuery(queries.GET_POST_STATUSES)\n\n  const isProjects = useMemo(() => currentPage.value === '/projects', [currentPage])\n  const isArticles = useMemo(() => currentPage.value === '/articles', [currentPage])\n\n  const addProject = async () => {\n    const companiesResponse =\n      companies?.length === 0 &&\n      loadCompanies &&\n      (await loadCompanies({ variables: { account: ['ENTITY'] } }))\n    const categoriesResponse =\n      categories?.length === 0 &&\n      loadCategories &&\n      (await loadCategories({ variables: { type: 'DIVISION' } }))\n    const statusesResponse = statuses?.length === 0 && loadStatuses && (await loadStatuses())\n\n    const companiesResult = companiesResponse?.data?.getUsers\n    const categoriesResult = categoriesResponse?.data?.getCategories\n    const statusesResult = statusesResponse?.data?.getPostStatus\n\n    if (companiesResult) dispatch(setCompanies(companiesResult))\n    if (categoriesResult) dispatch(setCategories(categoriesResult))\n    if (statusesResult) dispatch(setStatuses(statusesResult))\n\n    recall(onProjectCreate, {\n      companies: companiesResult || companies,\n      categories: categoriesResult || categories,\n      statuses: statusesResult || statuses,\n      mutation: queries.CREATE_PROJECT,\n      query: queries.GET_USERS,\n      isPurpose: true\n    })()\n  }\n\n  const addArticle = async () => {\n    const categoriesResponse =\n      categories?.length === 0 &&\n      loadCategories &&\n      (await loadCategories({ variables: { type: 'DIVISION' } }))\n    const statusesResponse = statuses?.length === 0 && loadStatuses && (await loadStatuses())\n\n    const categoriesResult = categoriesResponse?.data?.getCategories\n    const statusesResult = statusesResponse?.data?.getPostStatus\n\n    if (categoriesResult) dispatch(setCategories(categoriesResult))\n    if (statusesResult) dispatch(setStatuses(statusesResult))\n\n    recall(onArticleCreate, {\n      categories: categoriesResult || categories,\n      statuses: statusesResult || statuses,\n      mutation: queries.CREATE_ARTICLE,\n      isPurpose: true\n    })()\n  }\n\n  const renderContentPage = useCallback(() => {\n    if (!user) return null\n    switch (currentPage.value) {\n      case '/projects':\n        return <Projects variables={{ author: user.email }} projects={user.projects} />\n      case '/liked':\n        return <Projects variables={{ rating: user.email }} projects={user.likedProjects} />\n      case '/articles':\n        return <Articles variables={{ author: user.email }} />\n      default:\n        return <InProgress />\n    }\n  }, [user, currentPage])\n\n  useEffect(() => {\n    if (!user.authenticated) {\n      router.push('/auth')\n    }\n  }, [user])\n\n  if (!user.authenticated) {\n    return (\n      <Loader>\n        <Spinner />\n      </Loader>\n    )\n  }\n\n  return (\n    <DefaultLayout title={user.authenticated ? user.name || TITLE : 'Авторизация'}>\n      <Column>\n        <UserBar\n          user={user}\n          onEdit={recall(onUserClientEdit, {\n            user: user?.email,\n            canEditAccount: !isAdmin,\n            mutations: {\n              del: queries.DELETE_USER,\n              forgotEmail: queries.LOGIN,\n              forgotPassword: queries.RESET,\n              changePassword: queries.UPDATE_CLIENT_USER,\n              checkResetToken: queries.CHECK_RESET_TOKEN,\n              update: queries.UPDATE_CLIENT_USER\n            }\n          })}\n          onAboutMore={recall(onUserAboutMore, { user })}\n          onCompanyLink={\n            user?.company &&\n            recall(onUserLink, {\n              id: user?.company?.email,\n              auth: user?.email,\n              queries: {\n                userChats: queries.GET_USER_CHATS,\n                chat: queries.GET_CHAT\n              },\n              mutations: {\n                addUserChat: queries.ADD_USER_CHAT,\n                sendMessage: queries.SEND_MESSAGE\n              }\n            })\n          }\n          onMembers={recall(onUserMembers, { id: user?.email, auth: user?.email })}\n        />\n\n        <Switch\n          defaultValue={currentPage}\n          options={profilePages.filter((page) =>\n            !hasResponsibleMember(user) ? page.value !== '/articles' : true\n          )}\n          onChange={(item) => setCurrentPage(item)}\n          stretch\n        />\n\n        <SearchBar\n          buttonCreateText={\n            isProjects ? 'Предложить проект' : isArticles ? 'Предложить статью' : ''\n          }\n          onCreate={\n            (isProjects && hasAccess(user, 'PURPOSE_PROJECT') && addProject) ||\n            (isArticles && hasAccess(user, 'PURPOSE_ARTICLE') && addArticle)\n          }\n          onChangeFilter={() => setVisibleFilter(!visibleFilter)}\n        />\n\n        <FilterBar\n          isOpen={visibleFilter}\n          filters={[\n            <DatePicker\n              key={'publishedAt'}\n              value={date}\n              placeholder={'Дата публикации'}\n              onChange={onChangeDate}\n              withNavigate\n            />,\n            <Select\n              key={'categories'}\n              options={[].map((category) => ({\n                value: category.id,\n                label: category.name\n              }))}\n              placeholder={'Раздел'}\n              selected={select}\n              onChange={(item) => onChangeSelect(item)}\n            />\n          ]}\n          options={templates.project.map((item, index) => ({\n            label: item.header,\n            value: index\n          }))}\n        />\n\n        {renderContentPage()}\n      </Column>\n    </DefaultLayout>\n  )\n}\n\nexport async function getServerSideProps() {\n  const client = initializeApollo()\n\n  let categories = []\n\n  try {\n    const response = await client.query({\n      query: queries.GET_CATEGORIES\n    })\n\n    if (response && response.data) {\n      categories = response.data.getCategories\n    }\n  } catch (err) {\n    console.log(err)\n  }\n\n  return {\n    props: {\n      categories\n    }\n  }\n}\n\nexport default Profile\n"]},"metadata":{},"sourceType":"module"}