{"ast":null,"code":"function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nimport React, { useEffect } from 'react';\nimport Head from 'next/head';\nimport { useRouter } from 'next/router';\nimport styled from 'styled-components';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useLazyQuery, useMutation } from '@apollo/react-hooks';\nimport Row from '../atomic-ui/components/Row';\nimport Column from '../atomic-ui/components/Column';\nimport Snacks from '../atomic-ui/components/Snacks';\nimport Difinition from '../atomic-ui/components/Difinition';\nimport Spinner from '../atomic-ui/components/Spinner';\nimport Drawer from '../atomic-ui/components/Drawer';\nimport Button from '../atomic-ui/components/Button';\nimport Icon from '../atomic-ui/components/Icon';\nimport Divider from '../atomic-ui/components/Divider';\nimport Modal from '../atomic-ui/components/Modal';\nimport Text from '../atomic-ui/components/Text';\nimport { FixedLoader } from '../components/Styled';\nimport { removeItem, clearItems } from '../store/actions/snacks';\nimport { setUser } from '../store/actions/user';\nimport { setDrawer } from '../store/actions/drawer';\nimport { setModal } from '../store/actions/modal';\nimport { setMutate } from '../store/actions/root';\nimport queries from '../graphql/queries';\nimport config from '../config';\nimport useEntityQuery from '../hooks/useEntityQuery';\nvar LIFETIME_OF_SNACK = 3000;\nvar Container = styled(Column).withConfig({\n  displayName: \"main__Container\",\n  componentId: \"r90a11-0\"\n})([\"height:100%;flex-grow:1;&.fade-enter{opacity:0;}&.fade-enter-active{opacity:1;transition:opacity 100ms,blur 100ms;}&.fade-exit{opacity:1;}&.fade-exit-active{opacity:0;transition:opacity 100ms,blur 100ms;}\"]);\nexport var BrandLogo = styled.img.withConfig({\n  displayName: \"main__BrandLogo\",\n  componentId: \"r90a11-1\"\n})([\"object-fit:contain;width:100%;height:100%;\"]);\nvar Header = styled(Row).withConfig({\n  displayName: \"main__Header\",\n  componentId: \"r90a11-2\"\n})([\"display:flex;grid-gap:var(--default-gap);\"]);\nvar GuideButton = styled(Button).withConfig({\n  displayName: \"main__GuideButton\",\n  componentId: \"r90a11-3\"\n})([\"display:flex;justify-content:center;align-items:center;color:var(--default-color-accent);\"]);\nvar BackButton = styled(Button).withConfig({\n  displayName: \"main__BackButton\",\n  componentId: \"r90a11-4\"\n})([\"display:none;@media only screen and (max-width:480px){display:flex;justify-content:center;align-items:center;}\"]);\n\nvar Welcome = function Welcome(_ref) {\n  var close = _ref.close;\n  var router = useRouter();\n  return /*#__PURE__*/React.createElement(Column, {\n    style: {\n      padding: '15px'\n    }\n  }, /*#__PURE__*/React.createElement(Text, null, \"Atomic - \\u0441\\u0432\\u043E\\u0435\\u043E\\u0431\\u0440\\u0430\\u0437\\u043D\\u0430\\u044F \\u043F\\u043B\\u043E\\u0449\\u0430\\u0434\\u043A\\u0430 \\u0434\\u043B\\u044F \\u043F\\u0435\\u0440\\u0435\\u0433\\u043E\\u0432\\u043E\\u0440\\u043E\\u0432 \\u043C\\u0435\\u0436\\u0434\\u0443 \\u043F\\u0440\\u0435\\u0434\\u0441\\u0442\\u0430\\u0432\\u0438\\u0442\\u0435\\u043B\\u044F\\u043C\\u0438 \\u0438\\u043D\\u0434\\u0443\\u0441\\u0442\\u0440\\u0438\\u0438. \\u0410\\u043D\\u0430\\u043B\\u043E\\u0433\\u0438\\u0447\\u043D\\u043E \\u0441\\u043E\\u0446\\u0438\\u0430\\u043B\\u044C\\u043D\\u043E\\u0439 \\u0441\\u0435\\u0442\\u0438 \\u043D\\u0430 \\u0441\\u0430\\u0439\\u0442\\u0435 \\u0435\\u0441\\u0442\\u044C \\u0432\\u043E\\u0437\\u043C\\u043E\\u0436\\u043D\\u043E\\u0441\\u0442\\u044C \\u0440\\u0435\\u0430\\u0433\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C \\u043D\\u0430 \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B, \\u043F\\u043E\\u0434\\u043F\\u0438\\u0441\\u044B\\u0432\\u0430\\u0442\\u044C\\u0441\\u044F \\u043D\\u0430 \\u0440\\u0430\\u0437\\u0440\\u0430\\u0431\\u043E\\u0442\\u0447\\u0438\\u043A\\u043E\\u0432 \\u0438 \\u0437\\u0430\\u043A\\u0430\\u0437\\u0447\\u0438\\u043A\\u043E\\u0432, \\u043E\\u0446\\u0435\\u043D\\u0438\\u0432\\u0430\\u0442\\u044C \\u0438\\u0445 \\u0430\\u043A\\u043A\\u0430\\u0443\\u043D\\u0442\\u044B \\u0438 \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B, \\u043E\\u0431\\u0449\\u0430\\u0442\\u044C\\u0441\\u044F \\u043C\\u0435\\u0436\\u0434\\u0443 \\u0441\\u043E\\u0431\\u043E\\u0439 \\u0438 \\u0434\\u0435\\u043B\\u0438\\u0442\\u044C\\u0441\\u044F \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0435\\u0439 \\u0440\\u0435\\u0441\\u0443\\u0440\\u0441\\u0430 \\u043D\\u0430 \\u043B\\u044E\\u0431\\u044B\\u0445 \\u0434\\u0440\\u0443\\u0433\\u0438\\u0445 \\u043F\\u043B\\u043E\\u0449\\u0430\\u0434\\u043A\\u0430\\u0445.\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: close\n  }, \"\\u0412\\u043F\\u0435\\u0440\\u0435\\u0434!\"), /*#__PURE__*/React.createElement(Divider, {\n    clear: true\n  }), /*#__PURE__*/React.createElement(GuideButton, {\n    onClick: function onClick() {\n      close();\n      return router.push('/guide');\n    },\n    appearance: 'clear'\n  }, \"\\u0418\\u043D\\u0441\\u0442\\u0440\\u0443\\u043A\\u0446\\u0438\\u044F\"));\n};\n\nvar Mutator = function Mutator(_ref2) {\n  var mutation = _ref2.mutation,\n      variables = _ref2.variables,\n      callback = _ref2.callback;\n\n  var _useMutation = useMutation(mutation),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      action = _useMutation2[0];\n\n  var dispatch = useDispatch();\n  useEffect(function () {\n    function mutate() {\n      return _mutate.apply(this, arguments);\n    }\n\n    function _mutate() {\n      _mutate = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        var response;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return action({\n                  variables: variables\n                });\n\n              case 2:\n                response = _context.sent;\n                dispatch(setMutate(null, null));\n\n                if (!callback) {\n                  _context.next = 7;\n                  break;\n                }\n\n                _context.next = 7;\n                return callback(response);\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return _mutate.apply(this, arguments);\n    }\n\n    mutate().then();\n  }, [action, dispatch, variables, callback]);\n  return null;\n};\n\nexport var MainLayout = function MainLayout(_ref3) {\n  var children = _ref3.children;\n  var router = useRouter();\n\n  var _useEntityQuery = useEntityQuery(),\n      useDetectQuery = _useEntityQuery.useDetectQuery;\n\n  var _useLazyQuery = useLazyQuery(queries.GET_USER),\n      _useLazyQuery2 = _slicedToArray(_useLazyQuery, 2),\n      getUser = _useLazyQuery2[0],\n      _useLazyQuery2$ = _useLazyQuery2[1],\n      data = _useLazyQuery2$.data,\n      loading = _useLazyQuery2$.loading;\n\n  var _useSelector = useSelector(function (state) {\n    return state;\n  }),\n      root = _useSelector.root,\n      user = _useSelector.user,\n      drawer = _useSelector.drawer,\n      snacks = _useSelector.snacks,\n      modal = _useSelector.modal;\n\n  var dispatch = useDispatch();\n\n  var onDrawerBack = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n      return regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return router.push({\n                pathname: router.pathname,\n                query: {}\n              }, undefined, {\n                shallow: true\n              });\n\n            case 2:\n              dispatch(setDrawer(null));\n\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function onDrawerBack() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var onModalHide = function onModalHide() {\n    dispatch(setModal(null));\n  };\n\n  useEffect(function () {\n    if ((snacks === null || snacks === void 0 ? void 0 : snacks.length) > 0) {\n      setTimeout(function () {\n        return dispatch(clearItems());\n      }, LIFETIME_OF_SNACK);\n    }\n  }, [snacks]);\n  useEffect(function () {\n    if (false) {\n      var token = localStorage.getItem(config.get('secret'));\n      if (token) getUser();\n    }\n  }, []);\n  useEffect(function () {\n    if (data && data.getUser) {\n      dispatch(setUser(data.getUser));\n    }\n  }, [data, dispatch]);\n  useEffect(function () {\n    if (user.authenticated && user.register) {\n      dispatch(setModal([{\n        path: '/',\n        title: 'Добро пожаловать!',\n        component: function component(_ref5) {\n          var close = _ref5.close;\n          return /*#__PURE__*/React.createElement(Welcome, {\n            close: close\n          });\n        }\n      }]));\n    }\n  }, [user, dispatch]);\n  useDetectQuery();\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Head, null, /*#__PURE__*/React.createElement(\"title\", null, \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\")), loading ? /*#__PURE__*/React.createElement(FixedLoader, null, /*#__PURE__*/React.createElement(Spinner, null)) : children, /*#__PURE__*/React.createElement(Drawer, {\n    key: drawer.history.length,\n    side: drawer.side,\n    half: drawer.half,\n    isOpen: drawer.open,\n    onBack: onDrawerBack\n  }, /*#__PURE__*/React.createElement(Container, null, /*#__PURE__*/React.createElement(Header, null, drawer.side === 'left' && drawer.half ? /*#__PURE__*/React.createElement(Button, {\n    appearance: 'clear',\n    onClick: function onClick() {\n      return router.push('/');\n    }\n  }, /*#__PURE__*/React.createElement(BrandLogo, {\n    src: '/images/logo.png',\n    alt: 'Logotype'\n  })) : /*#__PURE__*/React.createElement(BackButton, {\n    size: 's',\n    kind: 'icon',\n    onClick: onDrawerBack,\n    revert: true\n  }, /*#__PURE__*/React.createElement(Icon, {\n    icon: 'arrowLeft',\n    size: 's',\n    stroke: 'var(--default-color-accent)'\n  })), drawer.title && /*#__PURE__*/React.createElement(Difinition, {\n    color: drawer.color,\n    icon: drawer.icon,\n    text: drawer.title\n  })), drawer.title && /*#__PURE__*/React.createElement(Divider, {\n    clear: true\n  }), drawer.content)), /*#__PURE__*/React.createElement(Snacks, {\n    snacks: snacks,\n    onRemove: function onRemove(snack) {\n      return dispatch(removeItem(snack.id));\n    }\n  }), /*#__PURE__*/React.createElement(Modal, {\n    size: modal === null || modal === void 0 ? void 0 : modal.size,\n    routes: modal === null || modal === void 0 ? void 0 : modal.routes,\n    onHide: onModalHide\n  }), root.mutation && /*#__PURE__*/React.createElement(Mutator, {\n    mutation: root.mutation,\n    variables: root.variables,\n    callback: root.callback\n  }));\n};\nexport default MainLayout;","map":{"version":3,"sources":["C:/Users/dan82/Documents/workspace/FREELANCE/atomic/atomic-frontend/layouts/main.js"],"names":["React","useEffect","Head","useRouter","styled","useSelector","useDispatch","useLazyQuery","useMutation","Row","Column","Snacks","Difinition","Spinner","Drawer","Button","Icon","Divider","Modal","Text","FixedLoader","removeItem","clearItems","setUser","setDrawer","setModal","setMutate","queries","config","useEntityQuery","LIFETIME_OF_SNACK","Container","BrandLogo","img","Header","GuideButton","BackButton","Welcome","close","router","padding","push","Mutator","mutation","variables","callback","action","dispatch","mutate","response","then","MainLayout","children","useDetectQuery","GET_USER","getUser","data","loading","state","root","user","drawer","snacks","modal","onDrawerBack","pathname","query","undefined","shallow","onModalHide","length","setTimeout","token","localStorage","getItem","get","authenticated","register","path","title","component","history","side","half","open","color","icon","content","snack","id","size","routes"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react'\nimport Head from 'next/head'\nimport { useRouter } from 'next/router'\nimport styled from 'styled-components'\nimport { useSelector, useDispatch } from 'react-redux'\nimport { useLazyQuery, useMutation } from '@apollo/react-hooks'\n\nimport Row from '../atomic-ui/components/Row'\nimport Column from '../atomic-ui/components/Column'\nimport Snacks from '../atomic-ui/components/Snacks'\nimport Difinition from '../atomic-ui/components/Difinition'\nimport Spinner from '../atomic-ui/components/Spinner'\nimport Drawer from '../atomic-ui/components/Drawer'\nimport Button from '../atomic-ui/components/Button'\nimport Icon from '../atomic-ui/components/Icon'\nimport Divider from '../atomic-ui/components/Divider'\nimport Modal from '../atomic-ui/components/Modal'\nimport Text from '../atomic-ui/components/Text'\n\nimport { FixedLoader } from '../components/Styled'\nimport { removeItem, clearItems } from '../store/actions/snacks'\nimport { setUser } from '../store/actions/user'\nimport { setDrawer } from '../store/actions/drawer'\nimport { setModal } from '../store/actions/modal'\nimport { setMutate } from '../store/actions/root'\nimport queries from '../graphql/queries'\nimport config from '../config'\nimport useEntityQuery from '../hooks/useEntityQuery'\n\nconst LIFETIME_OF_SNACK = 3000\n\nconst Container = styled(Column)`\n  height: 100%;\n  flex-grow: 1;\n\n  &.fade-enter {\n    opacity: 0;\n  }\n\n  &.fade-enter-active {\n    opacity: 1;\n    transition: opacity 100ms, blur 100ms;\n  }\n\n  &.fade-exit {\n    opacity: 1;\n  }\n\n  &.fade-exit-active {\n    opacity: 0;\n    transition: opacity 100ms, blur 100ms;\n  }\n`\n\nexport const BrandLogo = styled.img`\n  object-fit: contain;\n  width: 100%;\n  height: 100%;\n`\n\nconst Header = styled(Row)`\n  display: flex;\n  grid-gap: var(--default-gap);\n`\n\nconst GuideButton = styled(Button)`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: var(--default-color-accent);\n`\n\nconst BackButton = styled(Button)`\n  display: none;\n\n  @media only screen and (max-width: 480px) {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n`\n\nconst Welcome = ({ close }) => {\n  const router = useRouter()\n\n  return (\n    <Column style={{ padding: '15px' }}>\n      <Text>\n        Atomic - своеобразная площадка для переговоров между представителями индустрии. Аналогично\n        социальной сети на сайте есть возможность реагировать на проекты, подписываться на\n        разработчиков и заказчиков, оценивать их аккаунты и проекты, общаться между собой и делиться\n        информацией ресурса на любых других площадках.\n      </Text>\n      <Button onClick={close}>Вперед!</Button>\n      <Divider clear />\n      <GuideButton\n        onClick={() => {\n          close()\n          return router.push('/guide')\n        }}\n        appearance={'clear'}>\n        Инструкция\n      </GuideButton>\n    </Column>\n  )\n}\n\nconst Mutator = ({ mutation, variables, callback }) => {\n  const [action] = useMutation(mutation)\n  const dispatch = useDispatch()\n\n  useEffect(() => {\n    async function mutate() {\n      const response = await action({ variables })\n      dispatch(setMutate(null, null))\n      if (callback) await callback(response)\n    }\n    mutate().then()\n  }, [action, dispatch, variables, callback])\n\n  return null\n}\n\nexport const MainLayout = ({ children }) => {\n  const router = useRouter()\n  const { useDetectQuery } = useEntityQuery()\n  const [getUser, { data, loading }] = useLazyQuery(queries.GET_USER)\n  const { root, user, drawer, snacks, modal } = useSelector((state) => state)\n  const dispatch = useDispatch()\n\n  const onDrawerBack = async () => {\n    await router.push(\n      {\n        pathname: router.pathname,\n        query: {}\n      },\n      undefined,\n      { shallow: true }\n    )\n    dispatch(setDrawer(null))\n  }\n\n  const onModalHide = () => {\n    dispatch(setModal(null))\n  }\n\n  useEffect(() => {\n    if (snacks?.length > 0) {\n      setTimeout(() => dispatch(clearItems()), LIFETIME_OF_SNACK)\n    }\n  }, [snacks])\n\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const token = localStorage.getItem(config.get('secret'))\n      if (token) getUser()\n    }\n  }, [])\n\n  useEffect(() => {\n    if (data && data.getUser) {\n      dispatch(setUser(data.getUser))\n    }\n  }, [data, dispatch])\n\n  useEffect(() => {\n    if (user.authenticated && user.register) {\n      dispatch(\n        setModal([\n          {\n            path: '/',\n            title: 'Добро пожаловать!',\n            component: ({ close }) => <Welcome close={close} />\n          }\n        ])\n      )\n    }\n  }, [user, dispatch])\n\n  useDetectQuery()\n\n  return (\n    <React.Fragment>\n      <Head>\n        <title>Загрузка...</title>\n      </Head>\n\n      {loading ? (\n        <FixedLoader>\n          <Spinner />\n        </FixedLoader>\n      ) : (\n        children\n      )}\n\n      <Drawer\n        key={drawer.history.length}\n        side={drawer.side}\n        half={drawer.half}\n        isOpen={drawer.open}\n        onBack={onDrawerBack}>\n        <Container>\n          <Header>\n            {drawer.side === 'left' && drawer.half ? (\n              <Button appearance={'clear'} onClick={() => router.push('/')}>\n                <BrandLogo src={'/images/logo.png'} alt={'Logotype'} />\n              </Button>\n            ) : (\n              <BackButton size={'s'} kind={'icon'} onClick={onDrawerBack} revert>\n                <Icon icon={'arrowLeft'} size={'s'} stroke={'var(--default-color-accent)'} />\n              </BackButton>\n            )}\n\n            {drawer.title && (\n              <Difinition color={drawer.color} icon={drawer.icon} text={drawer.title} />\n            )}\n          </Header>\n          {drawer.title && <Divider clear />}\n\n          {drawer.content}\n        </Container>\n      </Drawer>\n\n      <Snacks snacks={snacks} onRemove={(snack) => dispatch(removeItem(snack.id))} />\n      <Modal size={modal?.size} routes={modal?.routes} onHide={onModalHide} />\n\n      {root.mutation && (\n        <Mutator mutation={root.mutation} variables={root.variables} callback={root.callback} />\n      )}\n    </React.Fragment>\n  )\n}\n\nexport default MainLayout\n"]},"metadata":{},"sourceType":"module"}