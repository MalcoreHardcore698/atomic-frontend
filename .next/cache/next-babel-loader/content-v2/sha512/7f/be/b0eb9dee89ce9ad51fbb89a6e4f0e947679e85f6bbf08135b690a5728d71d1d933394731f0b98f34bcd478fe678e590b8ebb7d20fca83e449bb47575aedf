{"ast":null,"code":"var _s2 = $RefreshSig$();\n\nimport { useEffect } from 'react';\nimport { useRouter } from 'next/router';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { b64DecodeUnicode, b64EncodeUnicode } from '../atomic-ui/utils/functions';\nimport { useHelper } from './useHelper';\nimport { useMutate } from './useMutate';\nimport { onArticleLink } from '../store/helpers/article';\nimport { onCategoryLink } from '../store/helpers/category';\nimport { onProjectAdd, onProjectLink } from '../store/helpers/project';\nimport { onRoleLink } from '../store/helpers/role';\nimport { onUserLink } from '../store/helpers/user';\nimport { onTicketLink } from '../store/helpers/ticket';\nimport { updateUser } from '../store/actions/user';\nimport { setIgnoreFetch } from '../store/actions/root';\nimport { setItem } from '../store/actions/snacks';\nimport queries from '../graphql/queries';\nexport const getProjectLinkProps = (id, user, owned, dispatch, mutate, recall, callback) => ({\n  id,\n  auth: user === null || user === void 0 ? void 0 : user.email,\n  liked: !!((user === null || user === void 0 ? void 0 : user.likedProjects) || []).find(item => item.id === id),\n  onLike: user.email && mutate(queries.LIKE_PROJECT, {\n    id\n  }, response => dispatch(updateUser(response.data.likeProject))),\n  onAdd: user.email && recall(onProjectAdd, {\n    id,\n    folders: user === null || user === void 0 ? void 0 : user.folders,\n    mutations: {\n      addProject: queries.ADD_USER_PROJECT,\n      createFolder: queries.ADD_USER_FOLDER\n    },\n    callback\n  }),\n  owned\n});\nexport const getUserLinkProps = (id, user, owned) => ({\n  id,\n  auth: user === null || user === void 0 ? void 0 : user.email,\n  owned,\n  queries: {\n    userChats: queries.GET_USER_CHATS,\n    chat: queries.GET_CHAT\n  },\n  mutations: {\n    addUserChat: queries.ADD_USER_CHAT,\n    sendMessage: queries.SEND_MESSAGE\n  }\n});\nexport const invokeRecall = (recall, mutate, user, dispatch, query) => {\n  const getPerfectID = parameter => {\n    try {\n      if (parameter) {\n        return b64DecodeUnicode(parameter);\n      }\n    } catch (_unused) {\n      dispatch(setItem({\n        type: 'error',\n        message: 'Неправильный URL'\n      }));\n    }\n\n    return null;\n  };\n\n  dispatch(setIgnoreFetch(true));\n\n  if (query.article) {\n    const id = getPerfectID(query.article);\n    if (id) recall(onArticleLink, {\n      id\n    })();\n  }\n\n  if (query.category) {\n    const id = getPerfectID(query.category);\n    if (id) recall(onCategoryLink, {\n      id\n    })();\n  }\n\n  if (query.project) {\n    const id = getPerfectID(query.project);\n\n    if (id) {\n      var _user$projects;\n\n      const owned = user === null || user === void 0 ? void 0 : (_user$projects = user.projects) === null || _user$projects === void 0 ? void 0 : _user$projects.find(candidate => candidate.id === id);\n      recall(onProjectLink, getProjectLinkProps(id, user, owned, dispatch, mutate, recall))();\n    }\n  }\n\n  if (query.role) {\n    const id = getPerfectID(query.role);\n    if (id) recall(onRoleLink, {\n      id\n    })();\n  }\n\n  if (query.user) {\n    const id = getPerfectID(query.user);\n\n    if (id) {\n      const owned = id === (user === null || user === void 0 ? void 0 : user.name);\n      recall(onUserLink, getUserLinkProps(id, user, owned))();\n    }\n  }\n\n  if (query.ticket) {\n    const id = getPerfectID(query.ticket);\n    if (id) recall(onTicketLink, {\n      id,\n      auth: user === null || user === void 0 ? void 0 : user.email\n    })();\n  }\n};\nexport const useEntityQuery = () => {\n  _s2();\n\n  var _s = $RefreshSig$();\n\n  const recall = useHelper();\n  const mutate = useMutate();\n  const router = useRouter();\n  const user = useSelector(state => state.user);\n  const dispatch = useDispatch();\n\n  const setQuery = async (str, entity, callback) => {\n    dispatch(setIgnoreFetch(true));\n    await router.replace({\n      pathname: router.pathname,\n      query: {\n        [entity]: b64EncodeUnicode(str)\n      }\n    }, undefined, {\n      shallow: true\n    });\n    if (callback) callback(str);\n  };\n\n  const useDetectQuery = () => {\n    _s();\n\n    useEffect(() => {\n      const query = router.query;\n\n      if (Object.entries(query).length === 1) {\n        invokeRecall(recall, mutate, user, dispatch, query);\n      } // IMPORTANT: In dependencies should be only router\n\n    }, [router]);\n  };\n\n  _s(useDetectQuery, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n\n  return {\n    setQuery,\n    useDetectQuery\n  };\n};\n\n_s2(useEntityQuery, \"xvJUp8/UH0J7Qj1gc/rGlRh9RFY=\", false, function () {\n  return [useHelper, useMutate, useRouter, useSelector, useDispatch];\n});\n\nexport default useEntityQuery;","map":{"version":3,"sources":["/Users/malcore/Documents/workspace/freelance/atomic/atomic-frontend/hooks/useEntityQuery.js"],"names":["useEffect","useRouter","useDispatch","useSelector","b64DecodeUnicode","b64EncodeUnicode","useHelper","useMutate","onArticleLink","onCategoryLink","onProjectAdd","onProjectLink","onRoleLink","onUserLink","onTicketLink","updateUser","setIgnoreFetch","setItem","queries","getProjectLinkProps","id","user","owned","dispatch","mutate","recall","callback","auth","email","liked","likedProjects","find","item","onLike","LIKE_PROJECT","response","data","likeProject","onAdd","folders","mutations","addProject","ADD_USER_PROJECT","createFolder","ADD_USER_FOLDER","getUserLinkProps","userChats","GET_USER_CHATS","chat","GET_CHAT","addUserChat","ADD_USER_CHAT","sendMessage","SEND_MESSAGE","invokeRecall","query","getPerfectID","parameter","type","message","article","category","project","projects","candidate","role","name","ticket","useEntityQuery","router","state","setQuery","str","entity","replace","pathname","undefined","shallow","useDetectQuery","Object","entries","length"],"mappings":";;AAAA,SAASA,SAAT,QAA0B,OAA1B;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,SAASC,WAAT,EAAsBC,WAAtB,QAAyC,aAAzC;AAEA,SAASC,gBAAT,EAA2BC,gBAA3B,QAAmD,8BAAnD;AAEA,SAASC,SAAT,QAA0B,aAA1B;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,SAASC,aAAT,QAA8B,0BAA9B;AACA,SAASC,cAAT,QAA+B,2BAA/B;AACA,SAASC,YAAT,EAAuBC,aAAvB,QAA4C,0BAA5C;AACA,SAASC,UAAT,QAA2B,uBAA3B;AACA,SAASC,UAAT,QAA2B,uBAA3B;AACA,SAASC,YAAT,QAA6B,yBAA7B;AACA,SAASC,UAAT,QAA2B,uBAA3B;AACA,SAASC,cAAT,QAA+B,uBAA/B;AACA,SAASC,OAAT,QAAwB,yBAAxB;AACA,OAAOC,OAAP,MAAoB,oBAApB;AAEA,OAAO,MAAMC,mBAAmB,GAAG,CAACC,EAAD,EAAKC,IAAL,EAAWC,KAAX,EAAkBC,QAAlB,EAA4BC,MAA5B,EAAoCC,MAApC,EAA4CC,QAA5C,MAA0D;AAC3FN,EAAAA,EAD2F;AAE3FO,EAAAA,IAAI,EAAEN,IAAF,aAAEA,IAAF,uBAAEA,IAAI,CAAEO,KAF+E;AAG3FC,EAAAA,KAAK,EAAE,CAAC,CAAC,CAAC,CAAAR,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAES,aAAN,KAAuB,EAAxB,EAA4BC,IAA5B,CAAkCC,IAAD,IAAUA,IAAI,CAACZ,EAAL,KAAYA,EAAvD,CAHkF;AAI3Fa,EAAAA,MAAM,EACJZ,IAAI,CAACO,KAAL,IACAJ,MAAM,CAACN,OAAO,CAACgB,YAAT,EAAuB;AAAEd,IAAAA;AAAF,GAAvB,EAAgCe,QAAD,IACnCZ,QAAQ,CAACR,UAAU,CAACoB,QAAQ,CAACC,IAAT,CAAcC,WAAf,CAAX,CADJ,CANmF;AAS3FC,EAAAA,KAAK,EACHjB,IAAI,CAACO,KAAL,IACAH,MAAM,CAACf,YAAD,EAAe;AACnBU,IAAAA,EADmB;AAEnBmB,IAAAA,OAAO,EAAElB,IAAF,aAAEA,IAAF,uBAAEA,IAAI,CAAEkB,OAFI;AAGnBC,IAAAA,SAAS,EAAE;AACTC,MAAAA,UAAU,EAAEvB,OAAO,CAACwB,gBADX;AAETC,MAAAA,YAAY,EAAEzB,OAAO,CAAC0B;AAFb,KAHQ;AAOnBlB,IAAAA;AAPmB,GAAf,CAXmF;AAoB3FJ,EAAAA;AApB2F,CAA1D,CAA5B;AAuBP,OAAO,MAAMuB,gBAAgB,GAAG,CAACzB,EAAD,EAAKC,IAAL,EAAWC,KAAX,MAAsB;AACpDF,EAAAA,EADoD;AAEpDO,EAAAA,IAAI,EAAEN,IAAF,aAAEA,IAAF,uBAAEA,IAAI,CAAEO,KAFwC;AAGpDN,EAAAA,KAHoD;AAIpDJ,EAAAA,OAAO,EAAE;AACP4B,IAAAA,SAAS,EAAE5B,OAAO,CAAC6B,cADZ;AAEPC,IAAAA,IAAI,EAAE9B,OAAO,CAAC+B;AAFP,GAJ2C;AAQpDT,EAAAA,SAAS,EAAE;AACTU,IAAAA,WAAW,EAAEhC,OAAO,CAACiC,aADZ;AAETC,IAAAA,WAAW,EAAElC,OAAO,CAACmC;AAFZ;AARyC,CAAtB,CAAzB;AAcP,OAAO,MAAMC,YAAY,GAAG,CAAC7B,MAAD,EAASD,MAAT,EAAiBH,IAAjB,EAAuBE,QAAvB,EAAiCgC,KAAjC,KAA2C;AACrE,QAAMC,YAAY,GAAIC,SAAD,IAAe;AAClC,QAAI;AACF,UAAIA,SAAJ,EAAe;AACb,eAAOrD,gBAAgB,CAACqD,SAAD,CAAvB;AACD;AACF,KAJD,CAIE,gBAAM;AACNlC,MAAAA,QAAQ,CACNN,OAAO,CAAC;AACNyC,QAAAA,IAAI,EAAE,OADA;AAENC,QAAAA,OAAO,EAAE;AAFH,OAAD,CADD,CAAR;AAMD;;AACD,WAAO,IAAP;AACD,GAdD;;AAgBApC,EAAAA,QAAQ,CAACP,cAAc,CAAC,IAAD,CAAf,CAAR;;AAEA,MAAIuC,KAAK,CAACK,OAAV,EAAmB;AACjB,UAAMxC,EAAE,GAAGoC,YAAY,CAACD,KAAK,CAACK,OAAP,CAAvB;AACA,QAAIxC,EAAJ,EAAQK,MAAM,CAACjB,aAAD,EAAgB;AAAEY,MAAAA;AAAF,KAAhB,CAAN;AACT;;AAED,MAAImC,KAAK,CAACM,QAAV,EAAoB;AAClB,UAAMzC,EAAE,GAAGoC,YAAY,CAACD,KAAK,CAACM,QAAP,CAAvB;AACA,QAAIzC,EAAJ,EAAQK,MAAM,CAAChB,cAAD,EAAiB;AAAEW,MAAAA;AAAF,KAAjB,CAAN;AACT;;AAED,MAAImC,KAAK,CAACO,OAAV,EAAmB;AACjB,UAAM1C,EAAE,GAAGoC,YAAY,CAACD,KAAK,CAACO,OAAP,CAAvB;;AACA,QAAI1C,EAAJ,EAAQ;AAAA;;AACN,YAAME,KAAK,GAAGD,IAAH,aAAGA,IAAH,yCAAGA,IAAI,CAAE0C,QAAT,mDAAG,eAAgBhC,IAAhB,CAAsBiC,SAAD,IAAeA,SAAS,CAAC5C,EAAV,KAAiBA,EAArD,CAAd;AACAK,MAAAA,MAAM,CAACd,aAAD,EAAgBQ,mBAAmB,CAACC,EAAD,EAAKC,IAAL,EAAWC,KAAX,EAAkBC,QAAlB,EAA4BC,MAA5B,EAAoCC,MAApC,CAAnC,CAAN;AACD;AACF;;AAED,MAAI8B,KAAK,CAACU,IAAV,EAAgB;AACd,UAAM7C,EAAE,GAAGoC,YAAY,CAACD,KAAK,CAACU,IAAP,CAAvB;AACA,QAAI7C,EAAJ,EAAQK,MAAM,CAACb,UAAD,EAAa;AAAEQ,MAAAA;AAAF,KAAb,CAAN;AACT;;AAED,MAAImC,KAAK,CAAClC,IAAV,EAAgB;AACd,UAAMD,EAAE,GAAGoC,YAAY,CAACD,KAAK,CAAClC,IAAP,CAAvB;;AACA,QAAID,EAAJ,EAAQ;AACN,YAAME,KAAK,GAAGF,EAAE,MAAKC,IAAL,aAAKA,IAAL,uBAAKA,IAAI,CAAE6C,IAAX,CAAhB;AACAzC,MAAAA,MAAM,CAACZ,UAAD,EAAagC,gBAAgB,CAACzB,EAAD,EAAKC,IAAL,EAAWC,KAAX,CAA7B,CAAN;AACD;AACF;;AAED,MAAIiC,KAAK,CAACY,MAAV,EAAkB;AAChB,UAAM/C,EAAE,GAAGoC,YAAY,CAACD,KAAK,CAACY,MAAP,CAAvB;AACA,QAAI/C,EAAJ,EAAQK,MAAM,CAACX,YAAD,EAAe;AAAEM,MAAAA,EAAF;AAAMO,MAAAA,IAAI,EAAEN,IAAF,aAAEA,IAAF,uBAAEA,IAAI,CAAEO;AAAlB,KAAf,CAAN;AACT;AACF,CAtDM;AAwDP,OAAO,MAAMwC,cAAc,GAAG,MAAM;AAAA;;AAAA;;AAClC,QAAM3C,MAAM,GAAGnB,SAAS,EAAxB;AACA,QAAMkB,MAAM,GAAGjB,SAAS,EAAxB;AACA,QAAM8D,MAAM,GAAGpE,SAAS,EAAxB;AAEA,QAAMoB,IAAI,GAAGlB,WAAW,CAAEmE,KAAD,IAAWA,KAAK,CAACjD,IAAlB,CAAxB;AACA,QAAME,QAAQ,GAAGrB,WAAW,EAA5B;;AAEA,QAAMqE,QAAQ,GAAG,OAAOC,GAAP,EAAYC,MAAZ,EAAoB/C,QAApB,KAAiC;AAChDH,IAAAA,QAAQ,CAACP,cAAc,CAAC,IAAD,CAAf,CAAR;AAEA,UAAMqD,MAAM,CAACK,OAAP,CACJ;AACEC,MAAAA,QAAQ,EAAEN,MAAM,CAACM,QADnB;AAEEpB,MAAAA,KAAK,EAAE;AACL,SAACkB,MAAD,GAAUpE,gBAAgB,CAACmE,GAAD;AADrB;AAFT,KADI,EAOJI,SAPI,EAQJ;AAAEC,MAAAA,OAAO,EAAE;AAAX,KARI,CAAN;AAUA,QAAInD,QAAJ,EAAcA,QAAQ,CAAC8C,GAAD,CAAR;AACf,GAdD;;AAgBA,QAAMM,cAAc,GAAG,MAAM;AAAA;;AAC3B9E,IAAAA,SAAS,CAAC,MAAM;AACd,YAAMuD,KAAK,GAAGc,MAAM,CAACd,KAArB;;AACA,UAAIwB,MAAM,CAACC,OAAP,CAAezB,KAAf,EAAsB0B,MAAtB,KAAiC,CAArC,EAAwC;AACtC3B,QAAAA,YAAY,CAAC7B,MAAD,EAASD,MAAT,EAAiBH,IAAjB,EAAuBE,QAAvB,EAAiCgC,KAAjC,CAAZ;AACD,OAJa,CAKd;;AACD,KANQ,EAMN,CAACc,MAAD,CANM,CAAT;AAOD,GARD;;AAxBkC,KAwB5BS,cAxB4B;;AAkClC,SAAO;AAAEP,IAAAA,QAAF;AAAYO,IAAAA;AAAZ,GAAP;AACD,CAnCM;;IAAMV,c;UACI9D,S,EACAC,S,EACAN,S,EAEFE,W,EACID,W;;;AA+BnB,eAAekE,cAAf","sourcesContent":["import { useEffect } from 'react'\nimport { useRouter } from 'next/router'\nimport { useDispatch, useSelector } from 'react-redux'\n\nimport { b64DecodeUnicode, b64EncodeUnicode } from '../atomic-ui/utils/functions'\n\nimport { useHelper } from './useHelper'\nimport { useMutate } from './useMutate'\nimport { onArticleLink } from '../store/helpers/article'\nimport { onCategoryLink } from '../store/helpers/category'\nimport { onProjectAdd, onProjectLink } from '../store/helpers/project'\nimport { onRoleLink } from '../store/helpers/role'\nimport { onUserLink } from '../store/helpers/user'\nimport { onTicketLink } from '../store/helpers/ticket'\nimport { updateUser } from '../store/actions/user'\nimport { setIgnoreFetch } from '../store/actions/root'\nimport { setItem } from '../store/actions/snacks'\nimport queries from '../graphql/queries'\n\nexport const getProjectLinkProps = (id, user, owned, dispatch, mutate, recall, callback) => ({\n  id,\n  auth: user?.email,\n  liked: !!(user?.likedProjects || []).find((item) => item.id === id),\n  onLike:\n    user.email &&\n    mutate(queries.LIKE_PROJECT, { id }, (response) =>\n      dispatch(updateUser(response.data.likeProject))\n    ),\n  onAdd:\n    user.email &&\n    recall(onProjectAdd, {\n      id,\n      folders: user?.folders,\n      mutations: {\n        addProject: queries.ADD_USER_PROJECT,\n        createFolder: queries.ADD_USER_FOLDER\n      },\n      callback\n    }),\n  owned\n})\n\nexport const getUserLinkProps = (id, user, owned) => ({\n  id,\n  auth: user?.email,\n  owned,\n  queries: {\n    userChats: queries.GET_USER_CHATS,\n    chat: queries.GET_CHAT\n  },\n  mutations: {\n    addUserChat: queries.ADD_USER_CHAT,\n    sendMessage: queries.SEND_MESSAGE\n  }\n})\n\nexport const invokeRecall = (recall, mutate, user, dispatch, query) => {\n  const getPerfectID = (parameter) => {\n    try {\n      if (parameter) {\n        return b64DecodeUnicode(parameter)\n      }\n    } catch {\n      dispatch(\n        setItem({\n          type: 'error',\n          message: 'Неправильный URL'\n        })\n      )\n    }\n    return null\n  }\n\n  dispatch(setIgnoreFetch(true))\n\n  if (query.article) {\n    const id = getPerfectID(query.article)\n    if (id) recall(onArticleLink, { id })()\n  }\n\n  if (query.category) {\n    const id = getPerfectID(query.category)\n    if (id) recall(onCategoryLink, { id })()\n  }\n\n  if (query.project) {\n    const id = getPerfectID(query.project)\n    if (id) {\n      const owned = user?.projects?.find((candidate) => candidate.id === id)\n      recall(onProjectLink, getProjectLinkProps(id, user, owned, dispatch, mutate, recall))()\n    }\n  }\n\n  if (query.role) {\n    const id = getPerfectID(query.role)\n    if (id) recall(onRoleLink, { id })()\n  }\n\n  if (query.user) {\n    const id = getPerfectID(query.user)\n    if (id) {\n      const owned = id === user?.name\n      recall(onUserLink, getUserLinkProps(id, user, owned))()\n    }\n  }\n\n  if (query.ticket) {\n    const id = getPerfectID(query.ticket)\n    if (id) recall(onTicketLink, { id, auth: user?.email })()\n  }\n}\n\nexport const useEntityQuery = () => {\n  const recall = useHelper()\n  const mutate = useMutate()\n  const router = useRouter()\n\n  const user = useSelector((state) => state.user)\n  const dispatch = useDispatch()\n\n  const setQuery = async (str, entity, callback) => {\n    dispatch(setIgnoreFetch(true))\n\n    await router.replace(\n      {\n        pathname: router.pathname,\n        query: {\n          [entity]: b64EncodeUnicode(str)\n        }\n      },\n      undefined,\n      { shallow: true }\n    )\n    if (callback) callback(str)\n  }\n\n  const useDetectQuery = () => {\n    useEffect(() => {\n      const query = router.query\n      if (Object.entries(query).length === 1) {\n        invokeRecall(recall, mutate, user, dispatch, query)\n      }\n      // IMPORTANT: In dependencies should be only router\n    }, [router])\n  }\n\n  return { setQuery, useDetectQuery }\n}\n\nexport default useEntityQuery\n"]},"metadata":{},"sourceType":"module"}