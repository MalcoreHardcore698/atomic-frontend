{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport React, { useState, useRef } from 'react';\nimport { useRouter } from 'next/router';\nimport { useSelector, useDispatch } from 'react-redux';\nimport styled from 'styled-components';\nimport html2canvas from 'html2canvas';\nimport jsPDF from 'jspdf';\nimport Row from '../../atomic-ui/components/Row';\nimport Difinition from '../../atomic-ui/components/Difinition';\nimport DrawerBase from '../../atomic-ui/components/Drawer';\nimport Divider from '../../atomic-ui/components/Divider';\nimport Tooltip from '../../atomic-ui/components/Tooltip';\nimport Button from '../../atomic-ui/components/Button';\nimport Icon from '../../atomic-ui/components/Icon';\nimport Column from '../../atomic-ui/components/Column';\nimport { setDrawer } from '../../store/actions/drawer';\nconst Wrap = styled(DrawerBase).withConfig({\n  displayName: \"Drawer__Wrap\",\n  componentId: \"sc-15dabmr-0\"\n})([\"\"]);\n_c = Wrap;\nconst BrandLogo = styled.img.withConfig({\n  displayName: \"Drawer__BrandLogo\",\n  componentId: \"sc-15dabmr-1\"\n})([\"object-fit:contain;width:100%;height:100%;\"]);\n_c2 = BrandLogo;\nconst Container = styled(Column).withConfig({\n  displayName: \"Drawer__Container\",\n  componentId: \"sc-15dabmr-2\"\n})([\"height:100%;flex-grow:1;&.fade-enter{opacity:0;}&.fade-enter-active{opacity:1;transition:opacity 100ms,blur 100ms;}&.fade-exit{opacity:1;}&.fade-exit-active{opacity:0;transition:opacity 100ms,blur 100ms;}\"]);\n_c3 = Container;\nconst Header = styled(Row).withConfig({\n  displayName: \"Drawer__Header\",\n  componentId: \"sc-15dabmr-3\"\n})([\"display:flex;justify-content:space-between;grid-gap:var(--default-gap);\"]);\n_c4 = Header;\nconst Content = styled.div.withConfig({\n  displayName: \"Drawer__Content\",\n  componentId: \"sc-15dabmr-4\"\n})([\"display:flex;flex-direction:column;flex-grow:1;\"]);\n_c5 = Content;\nconst BackButton = styled(Button).withConfig({\n  displayName: \"Drawer__BackButton\",\n  componentId: \"sc-15dabmr-5\"\n})([\"display:none;@media only screen and (max-width:480px){display:flex;justify-content:center;align-items:center;}\"]);\n_c6 = BackButton;\nexport const Drawer = () => {\n  _s();\n\n  var _root$settings$genera;\n\n  const router = useRouter();\n  const {\n    root,\n    drawer\n  } = useSelector(state => state);\n  const dispatch = useDispatch();\n  const [loadingExportToPDF, setLoadingExportToPDF] = useState(false);\n  const containerForExportToPDF = useRef(null);\n\n  const onDrawerBack = async () => {\n    await router.push({\n      pathname: router.pathname,\n      query: {}\n    }, undefined, {\n      shallow: true\n    });\n    dispatch(setDrawer(null));\n  };\n\n  const onExportToPDF = () => {\n    setLoadingExportToPDF(true);\n    html2canvas(containerForExportToPDF.current).then(canvas => {\n      const [margin, position] = [6, 6];\n      const imgData = canvas.toDataURL('image/png', 1.0);\n      const pdf = new jsPDF('p', 'px', 'a4');\n      const width = pdf.internal.pageSize.getWidth();\n      const height = pdf.internal.pageSize.getHeight();\n      const widthRatio = width / canvas.width;\n      const heightRatio = height / canvas.height;\n      const ratio = widthRatio > heightRatio ? heightRatio : widthRatio;\n      pdf.addImage(imgData, 'PNG', margin, position, canvas.width * ratio - margin * 2, canvas.height * ratio - margin * 2);\n      pdf.save(`${drawer.pdfName}.pdf`);\n      setLoadingExportToPDF(false);\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(Wrap, {\n    key: drawer.history.length,\n    side: drawer.side,\n    half: drawer.half,\n    isOpen: drawer.open,\n    onBack: onDrawerBack\n  }, /*#__PURE__*/React.createElement(Container, null, /*#__PURE__*/React.createElement(Header, null, /*#__PURE__*/React.createElement(Row, null, drawer.side === 'left' && drawer.half ? /*#__PURE__*/React.createElement(Button, {\n    appearance: 'clear',\n    onClick: () => router.push('/')\n  }, /*#__PURE__*/React.createElement(BrandLogo, {\n    src: (_root$settings$genera = root.settings.general.logotype) === null || _root$settings$genera === void 0 ? void 0 : _root$settings$genera.path,\n    alt: 'Logotype'\n  })) : /*#__PURE__*/React.createElement(BackButton, {\n    size: 's',\n    kind: 'icon',\n    onClick: onDrawerBack,\n    revert: true\n  }, /*#__PURE__*/React.createElement(Icon, {\n    icon: 'arrowLeft',\n    size: 's',\n    stroke: 'var(--default-color-accent)'\n  })), drawer.title && /*#__PURE__*/React.createElement(Difinition, {\n    color: drawer.color,\n    icon: drawer.icon,\n    text: drawer.title\n  })), drawer.pdfName && /*#__PURE__*/React.createElement(Row, null, /*#__PURE__*/React.createElement(Tooltip, {\n    text: 'Экспорт проекта в PDF'\n  }, /*#__PURE__*/React.createElement(Button, {\n    size: 's',\n    kind: 'icon',\n    appearance: 'clear',\n    disabled: loadingExportToPDF,\n    onClick: onExportToPDF\n  }, /*#__PURE__*/React.createElement(Icon, {\n    icon: 'scan',\n    size: 's',\n    stroke: 'var(--ghost-color-text)'\n  }))))), drawer.title && /*#__PURE__*/React.createElement(Divider, {\n    clear: true\n  }), /*#__PURE__*/React.createElement(Content, {\n    ref: containerForExportToPDF\n  }, drawer.content)));\n};\n\n_s(Drawer, \"1JDLJcEXrY8klBLtcUtszOTuIhU=\", false, function () {\n  return [useRouter, useSelector, useDispatch];\n});\n\n_c7 = Drawer;\nexport default Drawer;\n\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7;\n\n$RefreshReg$(_c, \"Wrap\");\n$RefreshReg$(_c2, \"BrandLogo\");\n$RefreshReg$(_c3, \"Container\");\n$RefreshReg$(_c4, \"Header\");\n$RefreshReg$(_c5, \"Content\");\n$RefreshReg$(_c6, \"BackButton\");\n$RefreshReg$(_c7, \"Drawer\");","map":{"version":3,"sources":["C:/Users/dan82/Documents/workspace/FREELANCE/atomic/atomic-frontend/components/Drawer/index.js"],"names":["React","useState","useRef","useRouter","useSelector","useDispatch","styled","html2canvas","jsPDF","Row","Difinition","DrawerBase","Divider","Tooltip","Button","Icon","Column","setDrawer","Wrap","BrandLogo","img","Container","Header","Content","div","BackButton","Drawer","router","root","drawer","state","dispatch","loadingExportToPDF","setLoadingExportToPDF","containerForExportToPDF","onDrawerBack","push","pathname","query","undefined","shallow","onExportToPDF","current","then","canvas","margin","position","imgData","toDataURL","pdf","width","internal","pageSize","getWidth","height","getHeight","widthRatio","heightRatio","ratio","addImage","save","pdfName","history","length","side","half","open","settings","general","logotype","path","title","color","icon","content"],"mappings":"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","sourcesContent":["import React, { useState, useRef } from 'react'\nimport { useRouter } from 'next/router'\nimport { useSelector, useDispatch } from 'react-redux'\nimport styled from 'styled-components'\nimport html2canvas from 'html2canvas'\nimport jsPDF from 'jspdf'\n\nimport Row from '../../atomic-ui/components/Row'\nimport Difinition from '../../atomic-ui/components/Difinition'\nimport DrawerBase from '../../atomic-ui/components/Drawer'\nimport Divider from '../../atomic-ui/components/Divider'\nimport Tooltip from '../../atomic-ui/components/Tooltip'\nimport Button from '../../atomic-ui/components/Button'\nimport Icon from '../../atomic-ui/components/Icon'\nimport Column from '../../atomic-ui/components/Column'\n\nimport { setDrawer } from '../../store/actions/drawer'\n\nconst Wrap = styled(DrawerBase)``\n\nconst BrandLogo = styled.img`\n  object-fit: contain;\n  width: 100%;\n  height: 100%;\n`\n\nconst Container = styled(Column)`\n  height: 100%;\n  flex-grow: 1;\n\n  &.fade-enter {\n    opacity: 0;\n  }\n\n  &.fade-enter-active {\n    opacity: 1;\n    transition: opacity 100ms, blur 100ms;\n  }\n\n  &.fade-exit {\n    opacity: 1;\n  }\n\n  &.fade-exit-active {\n    opacity: 0;\n    transition: opacity 100ms, blur 100ms;\n  }\n`\n\nconst Header = styled(Row)`\n  display: flex;\n  justify-content: space-between;\n  grid-gap: var(--default-gap);\n`\n\nconst Content = styled.div`\n  display: flex;\n  flex-direction: column;\n  flex-grow: 1;\n`\n\nconst BackButton = styled(Button)`\n  display: none;\n\n  @media only screen and (max-width: 480px) {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n`\n\nexport const Drawer = () => {\n  const router = useRouter()\n  const { root, drawer } = useSelector((state) => state)\n  const dispatch = useDispatch()\n\n  const [loadingExportToPDF, setLoadingExportToPDF] = useState(false)\n  const containerForExportToPDF = useRef(null)\n\n  const onDrawerBack = async () => {\n    await router.push(\n      {\n        pathname: router.pathname,\n        query: {}\n      },\n      undefined,\n      { shallow: true }\n    )\n    dispatch(setDrawer(null))\n  }\n\n  const onExportToPDF = () => {\n    setLoadingExportToPDF(true)\n\n    html2canvas(containerForExportToPDF.current).then((canvas) => {\n      const [margin, position] = [6, 6]\n      const imgData = canvas.toDataURL('image/png', 1.0)\n\n      const pdf = new jsPDF('p', 'px', 'a4')\n\n      const width = pdf.internal.pageSize.getWidth()\n      const height = pdf.internal.pageSize.getHeight()\n\n      const widthRatio = width / canvas.width\n      const heightRatio = height / canvas.height\n\n      const ratio = widthRatio > heightRatio ? heightRatio : widthRatio\n\n      pdf.addImage(\n        imgData,\n        'PNG',\n        margin,\n        position,\n        canvas.width * ratio - margin * 2,\n        canvas.height * ratio - margin * 2\n      )\n      pdf.save(`${drawer.pdfName}.pdf`)\n\n      setLoadingExportToPDF(false)\n    })\n  }\n\n  return (\n    <Wrap\n      key={drawer.history.length}\n      side={drawer.side}\n      half={drawer.half}\n      isOpen={drawer.open}\n      onBack={onDrawerBack}>\n      <Container>\n        <Header>\n          <Row>\n            {drawer.side === 'left' && drawer.half ? (\n              <Button appearance={'clear'} onClick={() => router.push('/')}>\n                <BrandLogo src={root.settings.general.logotype?.path} alt={'Logotype'} />\n              </Button>\n            ) : (\n              <BackButton size={'s'} kind={'icon'} onClick={onDrawerBack} revert>\n                <Icon icon={'arrowLeft'} size={'s'} stroke={'var(--default-color-accent)'} />\n              </BackButton>\n            )}\n\n            {drawer.title && (\n              <Difinition color={drawer.color} icon={drawer.icon} text={drawer.title} />\n            )}\n          </Row>\n\n          {drawer.pdfName && (\n            <Row>\n              <Tooltip text={'Экспорт проекта в PDF'}>\n                <Button\n                  size={'s'}\n                  kind={'icon'}\n                  appearance={'clear'}\n                  disabled={loadingExportToPDF}\n                  onClick={onExportToPDF}>\n                  <Icon icon={'scan'} size={'s'} stroke={'var(--ghost-color-text)'} />\n                </Button>\n              </Tooltip>\n            </Row>\n          )}\n        </Header>\n        {drawer.title && <Divider clear />}\n\n        <Content ref={containerForExportToPDF}>{drawer.content}</Content>\n      </Container>\n    </Wrap>\n  )\n}\n\nexport default Drawer\n"]},"metadata":{},"sourceType":"module"}