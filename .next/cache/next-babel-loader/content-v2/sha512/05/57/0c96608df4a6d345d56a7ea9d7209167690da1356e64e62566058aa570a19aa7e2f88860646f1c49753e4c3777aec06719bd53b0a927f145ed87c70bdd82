{"ast":null,"code":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React, { useState, useCallback } from 'react';\nimport AvatarEditor from 'react-avatar-editor';\nimport styled, { css } from 'styled-components';\nimport imageCompression from 'browser-image-compression';\nimport { useDropzone } from 'react-dropzone';\nimport { v4 } from 'uuid';\nimport Image from '../Image';\nimport Text from '../Text';\nimport Button from '../Button';\nimport Grid from '../Grid';\nimport Tooltip from '../Tooltip';\nimport Icon from '../Icon';\nexport const Wrap = styled.div.withConfig({\n  displayName: \"Dropzone__Wrap\",\n  componentId: \"zqj6am-0\"\n})([\"position:relative;display:flex;flex-direction:column;grid-gap:10px;width:100%;height:256px;min-height:256px;\"]);\nexport const InfoTooltip = styled(Tooltip).withConfig({\n  displayName: \"Dropzone__InfoTooltip\",\n  componentId: \"zqj6am-1\"\n})([\"position:absolute;right:var(--default-gap);bottom:var(--default-gap);z-index:var(--z-15);\"]);\nexport const InfoIcon = styled(Icon).withConfig({\n  displayName: \"Dropzone__InfoIcon\",\n  componentId: \"zqj6am-2\"\n})([\"cursor:pointer;transition:opacity 450ms ease;&:hover{opacity:0.65;}\"]);\nexport const Container = styled.div.withConfig({\n  displayName: \"Dropzone__Container\",\n  componentId: \"zqj6am-3\"\n})([\"display:flex;justify-content:center;align-items:center;position:relative;z-index:var(--z-12);font-weight:var(--font-weight-medium);font-size:var(--font-size-s);font-family:var(--font-family);color:var(--input-placeholder-color);width:100%;height:100%;border-radius:var(--surface-border-radius);border:2px dashed var(--input-placeholder-color);outline:none;overflow:hidden;flex-grow:1;cursor:pointer;transition:all 150ms ease;\", \" &:hover{color:var(--default-color-accent);border:2px dashed var(--default-color-accent);\", \"}\"], ({\n  error\n}) => error && css([\"color:var(--default-color-red);border:2px dashed var(--default-color-red);\"]), ({\n  error\n}) => error && css([\"color:var(--default-color-red);border:2px dashed var(--default-color-red);\"]));\nexport const Area = styled.div.withConfig({\n  displayName: \"Dropzone__Area\",\n  componentId: \"zqj6am-4\"\n})([\"display:flex;justify-content:center;align-items:center;width:100%;height:100%;& > span{height:100%;}\"]);\nconst Overlay = styled.div.withConfig({\n  displayName: \"Dropzone__Overlay\",\n  componentId: \"zqj6am-5\"\n})([\"position:absolute;top:0;left:0;z-index:999;padding:1rem;background:#fff;width:fit-content;border:1px solid rgba(0,0,0,15%);\"]);\nconst MiddleOriented = styled.div.withConfig({\n  displayName: \"Dropzone__MiddleOriented\",\n  componentId: \"zqj6am-6\"\n})([\"margin:0 auto;text-align:center;\"]);\nconst ActionsLayout = styled.div.withConfig({\n  displayName: \"Dropzone__ActionsLayout\",\n  componentId: \"zqj6am-7\"\n})([\"input{width:100%;}\"]);\nconst ButtonsLayout = styled.div.withConfig({\n  displayName: \"Dropzone__ButtonsLayout\",\n  componentId: \"zqj6am-8\"\n})([\"display:flex;justify-content:space-between;margin-top:0.5rem;\"]);\nexport const PreviewList = styled(Grid).withConfig({\n  displayName: \"Dropzone__PreviewList\",\n  componentId: \"zqj6am-9\"\n})([\"img{height:128px;}\"]);\nexport const Preview = styled(Image).withConfig({\n  displayName: \"Dropzone__Preview\",\n  componentId: \"zqj6am-10\"\n})([\"width:100%;height:100%;object-fit:cover;border-radius:var(--surface-border-radius);\"]);\nexport const Placeholder = styled(Text).withConfig({\n  displayName: \"Dropzone__Placeholder\",\n  componentId: \"zqj6am-11\"\n})([\"color:inherit;padding:var(--default-gap);text-align:center;\"]);\nexport function getFile(file) {\n  var _file$type;\n\n  return {\n    file,\n    id: v4(),\n    blob: ((_file$type = file.type) === null || _file$type === void 0 ? void 0 : _file$type.includes('image')) && URL.createObjectURL(file)\n  };\n}\nexport async function compressedUpload(file, maxWidthOrHeight = 1366) {\n  try {\n    return await imageCompression(file, {\n      maxSizeMB: 1,\n      maxWidthOrHeight,\n      useWebWorker: true\n    });\n  } catch (error) {\n    console.log(error);\n  }\n}\nexport const Dropzone = ({\n  style,\n  accept,\n  avatar,\n  className,\n  defaultValue,\n  placeholder,\n  tooltip,\n  multiple,\n  maxFiles,\n  onChange\n}) => {\n  const [error, setError] = useState(false);\n  const [images, setImages] = useState([]);\n  const [initScale, setScale] = useState([0.8]);\n  const [avatarState, setAvatar] = useState(false);\n  const [avatarHistory, setHistory] = useState([]);\n  const onDrop = useCallback(async droppedFiles => {\n    setError(false);\n\n    if (avatar) {\n      setAvatar(true);\n    }\n\n    if (droppedFiles.length > maxFiles || droppedFiles.length === 0) {\n      setError(true);\n      return false;\n    }\n\n    const candidate = multiple ? [] : await compressedUpload(droppedFiles[0]);\n\n    if (multiple) {\n      for (let file of droppedFiles) {\n        var _file$type2;\n\n        let compressedFile;\n        let miniature;\n\n        if ((_file$type2 = file.type) !== null && _file$type2 !== void 0 && _file$type2.includes('image')) {\n          compressedFile = await compressedUpload(file);\n          miniature = await compressedUpload(file, 185);\n        } else {\n          compressedFile = file;\n        }\n\n        if (compressedFile) {\n          candidate.push({ ...getFile(compressedFile),\n            size: compressedFile.size,\n            miniature: { ...getFile(miniature),\n              size: miniature.size\n            }\n          });\n        }\n      }\n    }\n\n    const result = candidate.length > 0 ? candidate : { ...getFile(candidate),\n      size: droppedFiles[0].size\n    };\n    setImages(result);\n\n    if (onChange) {\n      onChange(result);\n    }\n  }, [setImages]);\n  let imageScaled = null;\n\n  const handleScale = e => {\n    const scale = parseFloat(e.target.value);\n    setScale(scale);\n  };\n\n  const clearImages = () => {\n    setAvatar(false);\n\n    if (!avatarHistory) {\n      setImages('');\n    } else {\n      setImages(avatarHistory);\n    }\n  };\n\n  const onClickSave = () => {\n    if (imageScaled) {\n      const canvasScaled = imageScaled.getImageScaledToCanvas();\n      images.blob = canvasScaled.toDataURL('image/png');\n      setImages(images);\n      setAvatar(false);\n      setHistory(images);\n    }\n  };\n\n  const setEditorRef = editor => imageScaled = editor;\n\n  const {\n    getRootProps,\n    getInputProps,\n    isDragActive\n  } = useDropzone({\n    onDrop,\n    multiple,\n    avatar,\n    accept,\n    initScale,\n    handleScale,\n    clearImages,\n    onClickSave,\n    setEditorRef\n  });\n  return /*#__PURE__*/React.createElement(Wrap, {\n    className: className,\n    style: style\n  }, tooltip && /*#__PURE__*/React.createElement(InfoTooltip, {\n    text: tooltip,\n    maxWidth: 215\n  }, /*#__PURE__*/React.createElement(InfoIcon, {\n    size: 's',\n    icon: 'infoCircle',\n    stroke: (defaultValue === null || defaultValue === void 0 ? void 0 : defaultValue.length) > 0 ? 'white' : 'var(--default-color-accent)'\n  })), avatarState && images.blob && /*#__PURE__*/React.createElement(Overlay, null, /*#__PURE__*/React.createElement(MiddleOriented, null, /*#__PURE__*/React.createElement(AvatarEditor, {\n    image: images.blob || (defaultValue === null || defaultValue === void 0 ? void 0 : defaultValue.path) || (defaultValue === null || defaultValue === void 0 ? void 0 : defaultValue.blob),\n    width: 220,\n    height: 256,\n    border: 10,\n    color: [255, 255, 255, 0.6],\n    scale: parseFloat(initScale),\n    rotate: 0,\n    ref: setEditorRef\n  })), /*#__PURE__*/React.createElement(ActionsLayout, null, /*#__PURE__*/React.createElement(\"input\", {\n    name: \"scale\",\n    type: \"range\",\n    onChange: handleScale,\n    min: \"0.8\",\n    max: \"2\",\n    step: \"0.01\",\n    defaultValue: \"0.8\"\n  }), /*#__PURE__*/React.createElement(ButtonsLayout, null, /*#__PURE__*/React.createElement(Button, {\n    appearance: 'default',\n    onClick: onClickSave\n  }, \"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\"), /*#__PURE__*/React.createElement(Button, {\n    appearance: 'outlined',\n    onClick: clearImages\n  }, \"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0430\")))), /*#__PURE__*/React.createElement(Container, _extends({\n    className: 'dropzone-container'\n  }, getRootProps(), {\n    error: error\n  }), /*#__PURE__*/React.createElement(\"input\", _extends({\n    accept: accept\n  }, getInputProps(), {\n    hidden: true\n  })), /*#__PURE__*/React.createElement(Area, {\n    className: 'dropzone-area',\n    active: isDragActive\n  }, !defaultValue && images.length === 0 && /*#__PURE__*/React.createElement(Placeholder, null, error ? `Файлов не может быть больше ${maxFiles} или равно нулю` : placeholder), multiple && (Array.isArray(images) && images.length > 1 || Array.isArray(defaultValue) && (defaultValue === null || defaultValue === void 0 ? void 0 : defaultValue.length) > 1) && /*#__PURE__*/React.createElement(PreviewList, {\n    percentage: 'minmax(196px, 1fr)'\n  }, (defaultValue || images).map(file => /*#__PURE__*/React.createElement(Preview, {\n    key: v4(),\n    src: (file === null || file === void 0 ? void 0 : file.blob) || file,\n    alt: file.id\n  }))), !multiple && (!Array.isArray(images) || defaultValue) && /*#__PURE__*/React.createElement(Preview, {\n    src: images.blob || (defaultValue === null || defaultValue === void 0 ? void 0 : defaultValue.path) || (defaultValue === null || defaultValue === void 0 ? void 0 : defaultValue.blob),\n    alt: defaultValue === null || defaultValue === void 0 ? void 0 : defaultValue.name\n  }))));\n};\nDropzone.defaultProps = {\n  maxFiles: 1,\n  multiple: false\n};\nexport default Dropzone;","map":{"version":3,"sources":["/Users/malcore/Documents/workspace/freelance/atomic/atomic-frontend/atomic-ui/components/Dropzone/index.js"],"names":["React","useState","useCallback","AvatarEditor","styled","css","imageCompression","useDropzone","v4","Image","Text","Button","Grid","Tooltip","Icon","Wrap","div","InfoTooltip","InfoIcon","Container","error","Area","Overlay","MiddleOriented","ActionsLayout","ButtonsLayout","PreviewList","Preview","Placeholder","getFile","file","id","blob","type","includes","URL","createObjectURL","compressedUpload","maxWidthOrHeight","maxSizeMB","useWebWorker","console","log","Dropzone","style","accept","avatar","className","defaultValue","placeholder","tooltip","multiple","maxFiles","onChange","setError","images","setImages","initScale","setScale","avatarState","setAvatar","avatarHistory","setHistory","onDrop","droppedFiles","length","candidate","compressedFile","miniature","push","size","result","imageScaled","handleScale","e","scale","parseFloat","target","value","clearImages","onClickSave","canvasScaled","getImageScaledToCanvas","toDataURL","setEditorRef","editor","getRootProps","getInputProps","isDragActive","path","Array","isArray","map","name","defaultProps"],"mappings":"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","sourcesContent":["import React, { useState, useCallback } from 'react'\nimport AvatarEditor from 'react-avatar-editor'\nimport styled, { css } from 'styled-components'\nimport imageCompression from 'browser-image-compression'\nimport { useDropzone } from 'react-dropzone'\nimport { v4 } from 'uuid'\n\nimport Image from '../Image'\nimport Text from '../Text'\nimport Button from '../Button'\nimport Grid from '../Grid'\nimport Tooltip from '../Tooltip'\nimport Icon from '../Icon'\n\nexport const Wrap = styled.div`\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  grid-gap: 10px;\n\n  width: 100%;\n  height: 256px;\n  min-height: 256px;\n`\n\nexport const InfoTooltip = styled(Tooltip)`\n  position: absolute;\n  right: var(--default-gap);\n  bottom: var(--default-gap);\n  z-index: var(--z-15);\n`\n\nexport const InfoIcon = styled(Icon)`\n  cursor: pointer;\n  transition: opacity 450ms ease;\n\n  &:hover {\n    opacity: 0.65;\n  }\n`\n\nexport const Container = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n\n  position: relative;\n  z-index: var(--z-12);\n\n  font-weight: var(--font-weight-medium);\n  font-size: var(--font-size-s);\n  font-family: var(--font-family);\n  color: var(--input-placeholder-color);\n\n  width: 100%;\n  height: 100%;\n  border-radius: var(--surface-border-radius);\n  border: 2px dashed var(--input-placeholder-color);\n  outline: none;\n  overflow: hidden;\n  flex-grow: 1;\n\n  cursor: pointer;\n  transition: all 150ms ease;\n\n  ${({ error }) =>\n    error &&\n    css`\n      color: var(--default-color-red);\n      border: 2px dashed var(--default-color-red);\n    `}\n\n  &:hover {\n    color: var(--default-color-accent);\n    border: 2px dashed var(--default-color-accent);\n\n    ${({ error }) =>\n      error &&\n      css`\n        color: var(--default-color-red);\n        border: 2px dashed var(--default-color-red);\n      `}\n  }\n`\n\nexport const Area = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  height: 100%;\n\n  & > span {\n    height: 100%;\n  }\n`\n\nconst Overlay = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 999;\n  padding: 1rem;\n  background: #fff;\n  width: fit-content;\n  border: 1px solid rgba(0, 0, 0, 15%);\n`\n\nconst MiddleOriented = styled.div`\n  margin: 0 auto;\n  text-align: center;\n`\n\nconst ActionsLayout = styled.div`\n  input {\n    width: 100%;\n  }\n`\n\nconst ButtonsLayout = styled.div`\n  display: flex;\n  justify-content: space-between;\n  margin-top: 0.5rem;\n`\n\nexport const PreviewList = styled(Grid)`\n  img {\n    height: 128px;\n  }\n`\n\nexport const Preview = styled(Image)`\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  border-radius: var(--surface-border-radius);\n`\n\nexport const Placeholder = styled(Text)`\n  color: inherit;\n  padding: var(--default-gap);\n  text-align: center;\n`\n\nexport function getFile(file) {\n  return { file, id: v4(), blob: file.type?.includes('image') && URL.createObjectURL(file) }\n}\n\nexport async function compressedUpload(file, maxWidthOrHeight = 1366) {\n  try {\n    return await imageCompression(file, {\n      maxSizeMB: 1,\n      maxWidthOrHeight,\n      useWebWorker: true\n    })\n  } catch (error) {\n    console.log(error)\n  }\n}\n\nexport const Dropzone = ({\n  style,\n  accept,\n  avatar,\n  className,\n  defaultValue,\n  placeholder,\n  tooltip,\n  multiple,\n  maxFiles,\n  onChange\n}) => {\n  const [error, setError] = useState(false)\n  const [images, setImages] = useState([])\n  const [initScale, setScale] = useState([0.8])\n  const [avatarState, setAvatar] = useState(false)\n  const [avatarHistory, setHistory] = useState([])\n\n  const onDrop = useCallback(\n    async (droppedFiles) => {\n      setError(false)\n\n      if (avatar) {\n        setAvatar(true)\n      }\n\n      if (droppedFiles.length > maxFiles || droppedFiles.length === 0) {\n        setError(true)\n        return false\n      }\n\n      const candidate = multiple ? [] : await compressedUpload(droppedFiles[0])\n\n      if (multiple) {\n        for (let file of droppedFiles) {\n          let compressedFile\n          let miniature\n\n          if (file.type?.includes('image')) {\n            compressedFile = await compressedUpload(file)\n            miniature = await compressedUpload(file, 185)\n          } else {\n            compressedFile = file\n          }\n\n          if (compressedFile) {\n            candidate.push({\n              ...getFile(compressedFile),\n              size: compressedFile.size,\n              miniature: {\n                ...getFile(miniature),\n                size: miniature.size\n              }\n            })\n          }\n        }\n      }\n\n      const result =\n        candidate.length > 0\n          ? candidate\n          : {\n              ...getFile(candidate),\n              size: droppedFiles[0].size\n            }\n\n      setImages(result)\n      if (onChange) {\n        onChange(result)\n      }\n    },\n    [setImages]\n  )\n\n  let imageScaled = null\n  const handleScale = (e) => {\n    const scale = parseFloat(e.target.value)\n    setScale(scale)\n  }\n\n  const clearImages = () => {\n    setAvatar(false)\n    if (!avatarHistory) {\n      setImages('')\n    } else {\n      setImages(avatarHistory)\n    }\n  }\n\n  const onClickSave = () => {\n    if (imageScaled) {\n      const canvasScaled = imageScaled.getImageScaledToCanvas()\n      images.blob = canvasScaled.toDataURL('image/png')\n      setImages(images)\n      setAvatar(false)\n      setHistory(images)\n    }\n  }\n\n  const setEditorRef = (editor) => (imageScaled = editor)\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    multiple,\n    avatar,\n    accept,\n    initScale,\n    handleScale,\n    clearImages,\n    onClickSave,\n    setEditorRef\n  })\n\n  return (\n    <Wrap className={className} style={style}>\n      {tooltip && (\n        <InfoTooltip text={tooltip} maxWidth={215}>\n          <InfoIcon\n            size={'s'}\n            icon={'infoCircle'}\n            stroke={defaultValue?.length > 0 ? 'white' : 'var(--default-color-accent)'}\n          />\n        </InfoTooltip>\n      )}\n\n      {avatarState && images.blob && (\n        <Overlay>\n          <MiddleOriented>\n            <AvatarEditor\n              image={images.blob || defaultValue?.path || defaultValue?.blob}\n              width={220}\n              height={256}\n              border={10}\n              color={[255, 255, 255, 0.6]}\n              scale={parseFloat(initScale)}\n              rotate={0}\n              ref={setEditorRef}\n            />\n          </MiddleOriented>\n          <ActionsLayout>\n            <input\n              name=\"scale\"\n              type=\"range\"\n              onChange={handleScale}\n              min=\"0.8\"\n              max=\"2\"\n              step=\"0.01\"\n              defaultValue=\"0.8\"\n            />\n            <ButtonsLayout>\n              <Button appearance={'default'} onClick={onClickSave}>\n                Сохранить\n              </Button>\n              <Button appearance={'outlined'} onClick={clearImages}>\n                Отмена\n              </Button>\n            </ButtonsLayout>\n          </ActionsLayout>\n        </Overlay>\n      )}\n\n      <Container className={'dropzone-container'} {...getRootProps()} error={error}>\n        <input accept={accept} {...getInputProps()} hidden />\n        <Area className={'dropzone-area'} active={isDragActive}>\n          {!defaultValue && images.length === 0 && (\n            <Placeholder>\n              {error ? `Файлов не может быть больше ${maxFiles} или равно нулю` : placeholder}\n            </Placeholder>\n          )}\n\n          {multiple &&\n            ((Array.isArray(images) && images.length > 1) ||\n              (Array.isArray(defaultValue) && defaultValue?.length > 1)) && (\n              <PreviewList percentage={'minmax(196px, 1fr)'}>\n                {(defaultValue || images).map((file) => (\n                  <Preview key={v4()} src={file?.blob || file} alt={file.id} />\n                ))}\n              </PreviewList>\n            )}\n\n          {!multiple && (!Array.isArray(images) || defaultValue) && (\n            <Preview\n              src={images.blob || defaultValue?.path || defaultValue?.blob}\n              alt={defaultValue?.name}\n            />\n          )}\n        </Area>\n      </Container>\n    </Wrap>\n  )\n}\n\nDropzone.defaultProps = {\n  maxFiles: 1,\n  multiple: false\n}\n\nexport default Dropzone\n"]},"metadata":{},"sourceType":"module"}