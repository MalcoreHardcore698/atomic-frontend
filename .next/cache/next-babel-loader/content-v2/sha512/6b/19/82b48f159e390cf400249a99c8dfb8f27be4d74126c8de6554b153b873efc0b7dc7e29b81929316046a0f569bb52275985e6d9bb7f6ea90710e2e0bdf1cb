{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useRouter } from 'next/router';\nimport Column from '../atomic-ui/components/Column';\nimport Switch from '../atomic-ui/components/Switch';\nimport Spinner from '../atomic-ui/components/Spinner';\nimport { hasAccess } from '../atomic-ui/utils/functions';\nimport DefaultLayout from '../layouts/default';\nimport UserBar from '../components/UserBar';\nimport FilterBar from '../components/FilterBar';\nimport SearchBar from '../components/SearchBar';\nimport PageRouter from '../components/Profile/PageRouter';\nimport { hasResponsibleMember } from '../components/Members';\nimport { Loader } from '../components/Styled';\nimport { setSearch } from '../store/actions/root';\nimport { useProfile } from '../hooks/useProfile';\nimport { profilePages } from '../__mock__';\nconst TITLE = 'Профиль';\nconst DISABLED_FILTERS = true;\n\nconst Profile = () => {\n  _s();\n\n  const router = useRouter();\n  const {\n    onAddProject,\n    onAddArticle,\n    ...methods\n  } = useProfile();\n  const {\n    user,\n    search\n  } = useSelector(state => ({\n    user: state.user,\n    search: state.root.search\n  }));\n  const dispatch = useDispatch();\n  const [currentPage, setCurrentPage] = useState(profilePages[0]);\n  const [visibleFilter, setVisibleFilter] = useState(false);\n  const isProjects = useMemo(() => currentPage.value === '/projects', [currentPage]);\n  const isArticles = useMemo(() => currentPage.value === '/articles', [currentPage]);\n  const buttonCreateText = useMemo(() => isProjects ? 'Предложить проект' : isArticles ? 'Предложить статью' : '', [isProjects, isArticles]);\n  const pages = useMemo(() => profilePages.filter(page => !hasResponsibleMember(user) ? page.value !== '/articles' : true), [user, profilePages]);\n\n  const onSearch = value => {\n    if (value) dispatch(setSearch(value));else dispatch(setSearch(null));\n  };\n\n  const getOnCreate = useCallback(() => {\n    if (isProjects && hasAccess(user, 'PURPOSE_PROJECT')) return onAddProject;\n    if (isArticles && hasAccess(user, 'PURPOSE_ARTICLE')) return onAddArticle;\n  }, [user, isProjects, isArticles, onAddProject, onAddArticle]);\n  useEffect(() => {\n    if (!user.authenticated) {\n      router.push('/auth');\n    }\n  }, [user]);\n\n  if (!user.authenticated) {\n    return /*#__PURE__*/React.createElement(Loader, null, /*#__PURE__*/React.createElement(Spinner, null));\n  }\n\n  return /*#__PURE__*/React.createElement(DefaultLayout, {\n    title: user.authenticated ? user.name || TITLE : 'Авторизация'\n  }, /*#__PURE__*/React.createElement(Column, null, /*#__PURE__*/React.createElement(UserBar, methods), /*#__PURE__*/React.createElement(Switch, {\n    options: pages,\n    defaultValue: currentPage,\n    onChange: setCurrentPage,\n    stretch: true\n  }), /*#__PURE__*/React.createElement(SearchBar, {\n    defaultValue: search,\n    buttonCreateText: buttonCreateText,\n    onChangeFilter: !DISABLED_FILTERS && (() => setVisibleFilter(!visibleFilter)),\n    onCreate: getOnCreate(),\n    onSubmit: onSearch\n  }), /*#__PURE__*/React.createElement(FilterBar, {\n    isOpen: visibleFilter,\n    filters: [],\n    options: []\n  }), /*#__PURE__*/React.createElement(PageRouter, {\n    page: currentPage.value\n  })));\n};\n\n_s(Profile, \"QLIKamBhW+wQ0jsfd/0130wnkj0=\", false, function () {\n  return [useRouter, useProfile, useSelector, useDispatch];\n});\n\n_c = Profile;\nexport default Profile;\n\nvar _c;\n\n$RefreshReg$(_c, \"Profile\");","map":{"version":3,"sources":["C:/Users/dan82/Documents/workspace/FREELANCE/atomic/atomic-frontend/pages/profile.js"],"names":["React","useState","useEffect","useMemo","useCallback","useSelector","useDispatch","useRouter","Column","Switch","Spinner","hasAccess","DefaultLayout","UserBar","FilterBar","SearchBar","PageRouter","hasResponsibleMember","Loader","setSearch","useProfile","profilePages","TITLE","DISABLED_FILTERS","Profile","router","onAddProject","onAddArticle","methods","user","search","state","root","dispatch","currentPage","setCurrentPage","visibleFilter","setVisibleFilter","isProjects","value","isArticles","buttonCreateText","pages","filter","page","onSearch","getOnCreate","authenticated","push","name"],"mappings":";;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,OAArC,EAA8CC,WAA9C,QAAiE,OAAjE;AACA,SAASC,WAAT,EAAsBC,WAAtB,QAAyC,aAAzC;AACA,SAASC,SAAT,QAA0B,aAA1B;AAEA,OAAOC,MAAP,MAAmB,gCAAnB;AACA,OAAOC,MAAP,MAAmB,gCAAnB;AACA,OAAOC,OAAP,MAAoB,iCAApB;AACA,SAASC,SAAT,QAA0B,8BAA1B;AAEA,OAAOC,aAAP,MAA0B,oBAA1B;AACA,OAAOC,OAAP,MAAoB,uBAApB;AACA,OAAOC,SAAP,MAAsB,yBAAtB;AACA,OAAOC,SAAP,MAAsB,yBAAtB;AACA,OAAOC,UAAP,MAAuB,kCAAvB;AACA,SAASC,oBAAT,QAAqC,uBAArC;AACA,SAASC,MAAT,QAAuB,sBAAvB;AACA,SAASC,SAAT,QAA0B,uBAA1B;AACA,SAASC,UAAT,QAA2B,qBAA3B;AACA,SAASC,YAAT,QAA6B,aAA7B;AAEA,MAAMC,KAAK,GAAG,SAAd;AAEA,MAAMC,gBAAgB,GAAG,IAAzB;;AAEA,MAAMC,OAAO,GAAG,MAAM;AAAA;;AACpB,QAAMC,MAAM,GAAGlB,SAAS,EAAxB;AACA,QAAM;AAAEmB,IAAAA,YAAF;AAAgBC,IAAAA,YAAhB;AAA8B,OAAGC;AAAjC,MAA6CR,UAAU,EAA7D;AACA,QAAM;AAAES,IAAAA,IAAF;AAAQC,IAAAA;AAAR,MAAmBzB,WAAW,CAAE0B,KAAD,KAAY;AAC/CF,IAAAA,IAAI,EAAEE,KAAK,CAACF,IADmC;AAE/CC,IAAAA,MAAM,EAAEC,KAAK,CAACC,IAAN,CAAWF;AAF4B,GAAZ,CAAD,CAApC;AAIA,QAAMG,QAAQ,GAAG3B,WAAW,EAA5B;AACA,QAAM,CAAC4B,WAAD,EAAcC,cAAd,IAAgClC,QAAQ,CAACoB,YAAY,CAAC,CAAD,CAAb,CAA9C;AACA,QAAM,CAACe,aAAD,EAAgBC,gBAAhB,IAAoCpC,QAAQ,CAAC,KAAD,CAAlD;AAEA,QAAMqC,UAAU,GAAGnC,OAAO,CAAC,MAAM+B,WAAW,CAACK,KAAZ,KAAsB,WAA7B,EAA0C,CAACL,WAAD,CAA1C,CAA1B;AACA,QAAMM,UAAU,GAAGrC,OAAO,CAAC,MAAM+B,WAAW,CAACK,KAAZ,KAAsB,WAA7B,EAA0C,CAACL,WAAD,CAA1C,CAA1B;AAEA,QAAMO,gBAAgB,GAAGtC,OAAO,CAC9B,MAAOmC,UAAU,GAAG,mBAAH,GAAyBE,UAAU,GAAG,mBAAH,GAAyB,EAD/C,EAE9B,CAACF,UAAD,EAAaE,UAAb,CAF8B,CAAhC;AAKA,QAAME,KAAK,GAAGvC,OAAO,CACnB,MACEkB,YAAY,CAACsB,MAAb,CAAqBC,IAAD,IAClB,CAAC3B,oBAAoB,CAACY,IAAD,CAArB,GAA8Be,IAAI,CAACL,KAAL,KAAe,WAA7C,GAA2D,IAD7D,CAFiB,EAKnB,CAACV,IAAD,EAAOR,YAAP,CALmB,CAArB;;AAQA,QAAMwB,QAAQ,GAAIN,KAAD,IAAW;AAC1B,QAAIA,KAAJ,EAAWN,QAAQ,CAACd,SAAS,CAACoB,KAAD,CAAV,CAAR,CAAX,KACKN,QAAQ,CAACd,SAAS,CAAC,IAAD,CAAV,CAAR;AACN,GAHD;;AAKA,QAAM2B,WAAW,GAAG1C,WAAW,CAAC,MAAM;AACpC,QAAIkC,UAAU,IAAI3B,SAAS,CAACkB,IAAD,EAAO,iBAAP,CAA3B,EAAsD,OAAOH,YAAP;AACtD,QAAIc,UAAU,IAAI7B,SAAS,CAACkB,IAAD,EAAO,iBAAP,CAA3B,EAAsD,OAAOF,YAAP;AACvD,GAH8B,EAG5B,CAACE,IAAD,EAAOS,UAAP,EAAmBE,UAAnB,EAA+Bd,YAA/B,EAA6CC,YAA7C,CAH4B,CAA/B;AAKAzB,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI,CAAC2B,IAAI,CAACkB,aAAV,EAAyB;AACvBtB,MAAAA,MAAM,CAACuB,IAAP,CAAY,OAAZ;AACD;AACF,GAJQ,EAIN,CAACnB,IAAD,CAJM,CAAT;;AAMA,MAAI,CAACA,IAAI,CAACkB,aAAV,EAAyB;AACvB,wBACE,oBAAC,MAAD,qBACE,oBAAC,OAAD,OADF,CADF;AAKD;;AAED,sBACE,oBAAC,aAAD;AAAe,IAAA,KAAK,EAAElB,IAAI,CAACkB,aAAL,GAAqBlB,IAAI,CAACoB,IAAL,IAAa3B,KAAlC,GAA0C;AAAhE,kBACE,oBAAC,MAAD,qBACE,oBAAC,OAAD,EAAaM,OAAb,CADF,eAGE,oBAAC,MAAD;AAAQ,IAAA,OAAO,EAAEc,KAAjB;AAAwB,IAAA,YAAY,EAAER,WAAtC;AAAmD,IAAA,QAAQ,EAAEC,cAA7D;AAA6E,IAAA,OAAO;AAApF,IAHF,eAKE,oBAAC,SAAD;AACE,IAAA,YAAY,EAAEL,MADhB;AAEE,IAAA,gBAAgB,EAAEW,gBAFpB;AAGE,IAAA,cAAc,EAAE,CAAClB,gBAAD,KAAsB,MAAMc,gBAAgB,CAAC,CAACD,aAAF,CAA5C,CAHlB;AAIE,IAAA,QAAQ,EAAEU,WAAW,EAJvB;AAKE,IAAA,QAAQ,EAAED;AALZ,IALF,eAaE,oBAAC,SAAD;AAAW,IAAA,MAAM,EAAET,aAAnB;AAAkC,IAAA,OAAO,EAAE,EAA3C;AAA+C,IAAA,OAAO,EAAE;AAAxD,IAbF,eAeE,oBAAC,UAAD;AAAY,IAAA,IAAI,EAAEF,WAAW,CAACK;AAA9B,IAfF,CADF,CADF;AAqBD,CAxED;;GAAMf,O;UACWjB,S,EACoCa,U,EAC1Bf,W,EAIRC,W;;;KAPbkB,O;AA0EN,eAAeA,OAAf","sourcesContent":["import React, { useState, useEffect, useMemo, useCallback } from 'react'\nimport { useSelector, useDispatch } from 'react-redux'\nimport { useRouter } from 'next/router'\n\nimport Column from '../atomic-ui/components/Column'\nimport Switch from '../atomic-ui/components/Switch'\nimport Spinner from '../atomic-ui/components/Spinner'\nimport { hasAccess } from '../atomic-ui/utils/functions'\n\nimport DefaultLayout from '../layouts/default'\nimport UserBar from '../components/UserBar'\nimport FilterBar from '../components/FilterBar'\nimport SearchBar from '../components/SearchBar'\nimport PageRouter from '../components/Profile/PageRouter'\nimport { hasResponsibleMember } from '../components/Members'\nimport { Loader } from '../components/Styled'\nimport { setSearch } from '../store/actions/root'\nimport { useProfile } from '../hooks/useProfile'\nimport { profilePages } from '../__mock__'\n\nconst TITLE = 'Профиль'\n\nconst DISABLED_FILTERS = true\n\nconst Profile = () => {\n  const router = useRouter()\n  const { onAddProject, onAddArticle, ...methods } = useProfile()\n  const { user, search } = useSelector((state) => ({\n    user: state.user,\n    search: state.root.search\n  }))\n  const dispatch = useDispatch()\n  const [currentPage, setCurrentPage] = useState(profilePages[0])\n  const [visibleFilter, setVisibleFilter] = useState(false)\n\n  const isProjects = useMemo(() => currentPage.value === '/projects', [currentPage])\n  const isArticles = useMemo(() => currentPage.value === '/articles', [currentPage])\n\n  const buttonCreateText = useMemo(\n    () => (isProjects ? 'Предложить проект' : isArticles ? 'Предложить статью' : ''),\n    [isProjects, isArticles]\n  )\n\n  const pages = useMemo(\n    () =>\n      profilePages.filter((page) =>\n        !hasResponsibleMember(user) ? page.value !== '/articles' : true\n      ),\n    [user, profilePages]\n  )\n\n  const onSearch = (value) => {\n    if (value) dispatch(setSearch(value))\n    else dispatch(setSearch(null))\n  }\n\n  const getOnCreate = useCallback(() => {\n    if (isProjects && hasAccess(user, 'PURPOSE_PROJECT')) return onAddProject\n    if (isArticles && hasAccess(user, 'PURPOSE_ARTICLE')) return onAddArticle\n  }, [user, isProjects, isArticles, onAddProject, onAddArticle])\n\n  useEffect(() => {\n    if (!user.authenticated) {\n      router.push('/auth')\n    }\n  }, [user])\n\n  if (!user.authenticated) {\n    return (\n      <Loader>\n        <Spinner />\n      </Loader>\n    )\n  }\n\n  return (\n    <DefaultLayout title={user.authenticated ? user.name || TITLE : 'Авторизация'}>\n      <Column>\n        <UserBar {...methods} />\n\n        <Switch options={pages} defaultValue={currentPage} onChange={setCurrentPage} stretch />\n\n        <SearchBar\n          defaultValue={search}\n          buttonCreateText={buttonCreateText}\n          onChangeFilter={!DISABLED_FILTERS && (() => setVisibleFilter(!visibleFilter))}\n          onCreate={getOnCreate()}\n          onSubmit={onSearch}\n        />\n\n        <FilterBar isOpen={visibleFilter} filters={[]} options={[]} />\n\n        <PageRouter page={currentPage.value} />\n      </Column>\n    </DefaultLayout>\n  )\n}\n\nexport default Profile\n"]},"metadata":{},"sourceType":"module"}