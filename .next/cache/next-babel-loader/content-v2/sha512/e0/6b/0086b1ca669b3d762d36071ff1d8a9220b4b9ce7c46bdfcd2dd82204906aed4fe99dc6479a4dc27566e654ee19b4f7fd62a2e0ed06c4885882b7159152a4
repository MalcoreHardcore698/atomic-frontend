{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport React from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { getLabelCategory } from '../atomic-ui/utils/functions';\nimport { useHelper } from '../hooks/useHelper';\nimport { useMutate } from '../hooks/useMutate';\nimport ProjectCard from '../components/ProjectCard';\nimport { GridAside as Container } from '../components/Styled';\nimport LazyLoad from '../components/LazyLoad';\nimport FadeLoad from '../components/FadeLoad';\nimport { updateUser } from '../store/actions/user';\nimport { onProjectLink, onProjectAdd, onProjectScreenshot } from '../store/helpers/project';\nimport { onUserAboutMore, onUserLink } from '../store/helpers/user';\nimport queries from '../graphql/queries';\nimport ContentLayout from '../layouts/content';\nimport { useRouter } from 'next/router';\nconst TITLE = 'Проекты';\n\nconst Projects = ({\n  store\n}) => {\n  _s();\n\n  const recall = useHelper();\n  const mutate = useMutate();\n  const router = useRouter();\n  const user = useSelector(state => state.user);\n  const dispatch = useDispatch();\n  return /*#__PURE__*/React.createElement(ContentLayout, {\n    title: TITLE,\n    filters: [{\n      type: 'DATEPICKER'\n    }, {\n      type: 'SELECT',\n      options: store === null || store === void 0 ? void 0 : store.categories.map(category => ({\n        value: category.id,\n        label: getLabelCategory(category.name)\n      }))\n    }],\n    options: [{\n      label: 'Компания',\n      value: 'company'\n    }, {\n      label: 'Участники',\n      value: 'members'\n    }, {\n      label: 'Дата публикации',\n      value: 'createdAt'\n    }],\n    query: queries.GET_PROJECTS,\n    variables: {\n      category: router.query.category,\n      status: 'PUBLISHED'\n    },\n    store: {\n      documents: store === null || store === void 0 ? void 0 : store.projects\n    }\n  }, ({\n    documents\n  }) => /*#__PURE__*/React.createElement(Container, null, documents.map(project => {\n    var _user$projects, _project$company;\n\n    const owned = user === null || user === void 0 ? void 0 : (_user$projects = user.projects) === null || _user$projects === void 0 ? void 0 : _user$projects.find(candidate => candidate.id === project.id);\n    return /*#__PURE__*/React.createElement(FadeLoad, {\n      key: project.id\n    }, /*#__PURE__*/React.createElement(LazyLoad, {\n      key: project.id\n    }, /*#__PURE__*/React.createElement(ProjectCard, {\n      project: project,\n      owned: owned,\n      liked: !!((user === null || user === void 0 ? void 0 : user.likedProjects) || []).find(item => item.id === project.id),\n      onLink: recall(onProjectLink, {\n        id: project.id,\n        auth: user,\n        owned\n      }),\n      onLike: (user === null || user === void 0 ? void 0 : user.email) && mutate(queries.LIKE_PROJECT, {\n        id: project.id\n      }, response => dispatch(updateUser(response.data.likeProject))),\n      onAdd: (user === null || user === void 0 ? void 0 : user.email) && recall(onProjectAdd, {\n        id: project.id\n      }),\n      onAboutMore: recall(onUserAboutMore, {\n        user: project\n      }),\n      onCompanyLink: recall(onUserLink, {\n        id: (_project$company = project.company) === null || _project$company === void 0 ? void 0 : _project$company.email,\n        auth: user === null || user === void 0 ? void 0 : user.email,\n        recipient: project.author,\n        query: queries.GET_USER_CHATS,\n        mutation: queries.SEND_MESSAGE\n      }),\n      onScreenshotClick: (_, key) => recall(onProjectScreenshot, {\n        screenshots: [project.preview, ...project.screenshots],\n        key\n      })()\n    })));\n  })));\n};\n\n_s(Projects, \"xvJUp8/UH0J7Qj1gc/rGlRh9RFY=\", false, function () {\n  return [useHelper, useMutate, useRouter, useSelector, useDispatch];\n});\n\n_c = Projects;\nexport var __N_SSP = true;\nexport default Projects;\n\nvar _c;\n\n$RefreshReg$(_c, \"Projects\");","map":{"version":3,"sources":["C:/Users/dan82/Documents/workspace/FREELANCE/atomic/atomic-frontend/pages/projects.js"],"names":["React","useSelector","useDispatch","getLabelCategory","useHelper","useMutate","ProjectCard","GridAside","Container","LazyLoad","FadeLoad","updateUser","onProjectLink","onProjectAdd","onProjectScreenshot","onUserAboutMore","onUserLink","queries","ContentLayout","useRouter","TITLE","Projects","store","recall","mutate","router","user","state","dispatch","type","options","categories","map","category","value","id","label","name","GET_PROJECTS","query","status","documents","projects","project","owned","find","candidate","likedProjects","item","auth","email","LIKE_PROJECT","response","data","likeProject","company","recipient","author","GET_USER_CHATS","mutation","SEND_MESSAGE","_","key","screenshots","preview"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { useSelector, useDispatch } from 'react-redux'\n\nimport { getLabelCategory } from '../atomic-ui/utils/functions'\n\nimport { initializeApollo } from '../apollo'\nimport { useHelper } from '../hooks/useHelper'\nimport { useMutate } from '../hooks/useMutate'\nimport ProjectCard from '../components/ProjectCard'\nimport { GridAside as Container } from '../components/Styled'\nimport LazyLoad from '../components/LazyLoad'\nimport FadeLoad from '../components/FadeLoad'\nimport { updateUser } from '../store/actions/user'\nimport { onProjectLink, onProjectAdd, onProjectScreenshot } from '../store/helpers/project'\nimport { onUserAboutMore, onUserLink } from '../store/helpers/user'\nimport queries from '../graphql/queries'\nimport ContentLayout from '../layouts/content'\nimport { useRouter } from 'next/router'\n\nconst TITLE = 'Проекты'\nconst START_OFFSET = 6\n\nconst Projects = ({ store }) => {\n  const recall = useHelper()\n  const mutate = useMutate()\n  const router = useRouter()\n  const user = useSelector((state) => state.user)\n  const dispatch = useDispatch()\n\n  return (\n    <ContentLayout\n      title={TITLE}\n      filters={[\n        { type: 'DATEPICKER' },\n        {\n          type: 'SELECT',\n          options: store?.categories.map((category) => ({\n            value: category.id,\n            label: getLabelCategory(category.name)\n          }))\n        }\n      ]}\n      options={[\n        { label: 'Компания', value: 'company' },\n        { label: 'Участники', value: 'members' },\n        { label: 'Дата публикации', value: 'createdAt' }\n      ]}\n      query={queries.GET_PROJECTS}\n      variables={{ category: router.query.category, status: 'PUBLISHED' }}\n      store={{ documents: store?.projects }}>\n      {({ documents }) => (\n        <Container>\n          {documents.map((project) => {\n            const owned = user?.projects?.find((candidate) => candidate.id === project.id)\n\n            return (\n              <FadeLoad key={project.id}>\n                <LazyLoad key={project.id}>\n                  <ProjectCard\n                    project={project}\n                    owned={owned}\n                    liked={!!(user?.likedProjects || []).find((item) => item.id === project.id)}\n                    onLink={recall(onProjectLink, { id: project.id, auth: user, owned })}\n                    onLike={\n                      user?.email &&\n                      mutate(queries.LIKE_PROJECT, { id: project.id }, (response) =>\n                        dispatch(updateUser(response.data.likeProject))\n                      )\n                    }\n                    onAdd={user?.email && recall(onProjectAdd, { id: project.id })}\n                    onAboutMore={recall(onUserAboutMore, { user: project })}\n                    onCompanyLink={recall(onUserLink, {\n                      id: project.company?.email,\n                      auth: user?.email,\n                      recipient: project.author,\n                      query: queries.GET_USER_CHATS,\n                      mutation: queries.SEND_MESSAGE\n                    })}\n                    onScreenshotClick={(_, key) =>\n                      recall(onProjectScreenshot, {\n                        screenshots: [project.preview, ...project.screenshots],\n                        key\n                      })()\n                    }\n                  />\n                </LazyLoad>\n              </FadeLoad>\n            )\n          })}\n        </Container>\n      )}\n    </ContentLayout>\n  )\n}\n\nexport async function getServerSideProps({ query }) {\n  const client = initializeApollo()\n\n  let projects = []\n  let categories = []\n\n  try {\n    const response = await client.query({\n      query: queries.GET_META_PROJECTS,\n      variables: {\n        offset: 0,\n        limit: START_OFFSET,\n        status: 'PUBLISHED',\n        category: query.category\n      }\n    })\n\n    if (response && response.data) {\n      projects = response.data.getProjects\n      categories = response.data.getCategories\n    }\n  } catch (err) {\n    console.log(err)\n  }\n\n  return {\n    props: {\n      store: {\n        projects,\n        categories\n      }\n    }\n  }\n}\n\nexport default Projects\n"]},"metadata":{},"sourceType":"module"}