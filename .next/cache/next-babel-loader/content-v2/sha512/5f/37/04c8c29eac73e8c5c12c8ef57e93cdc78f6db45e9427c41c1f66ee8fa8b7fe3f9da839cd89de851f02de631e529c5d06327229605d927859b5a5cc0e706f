{"ast":null,"code":"import React, { useState, useEffect, useCallback, useRef } from 'react';\nimport Head from 'next/head';\nimport { useRouter } from 'next/router';\nimport { useQuery, useLazyQuery, useMutation } from '@apollo/react-hooks';\nimport { useSelector, useDispatch } from 'react-redux';\nimport styled from 'styled-components';\nimport html2canvas from 'html2canvas';\nimport jsPDF from 'jspdf';\nimport Row from '../atomic-ui/components/Row';\nimport Column from '../atomic-ui/components/Column';\nimport Snacks from '../atomic-ui/components/Snacks';\nimport Difinition from '../atomic-ui/components/Difinition';\nimport Spinner from '../atomic-ui/components/Spinner';\nimport Drawer from '../atomic-ui/components/Drawer';\nimport Button from '../atomic-ui/components/Button';\nimport Icon from '../atomic-ui/components/Icon';\nimport Divider from '../atomic-ui/components/Divider';\nimport Modal from '../atomic-ui/components/Modal';\nimport Text from '../atomic-ui/components/Text';\nimport useEntityQuery from '../hooks/useEntityQuery';\nimport { FixedLoader } from '../components/Styled';\nimport { removeItem, clearItems } from '../store/actions/snacks';\nimport { setUser } from '../store/actions/user';\nimport { setDrawer } from '../store/actions/drawer';\nimport { setModal } from '../store/actions/modal';\nimport { setMutate, setSearch, setSettings } from '../store/actions/root';\nimport queries from '../graphql/queries';\nimport config from '../config';\nconst LIFETIME_OF_SNACK = 3000;\nconst Container = styled(Column).withConfig({\n  displayName: \"main__Container\",\n  componentId: \"r90a11-0\"\n})([\"height:100%;flex-grow:1;&.fade-enter{opacity:0;}&.fade-enter-active{opacity:1;transition:opacity 100ms,blur 100ms;}&.fade-exit{opacity:1;}&.fade-exit-active{opacity:0;transition:opacity 100ms,blur 100ms;}\"]);\nexport const BrandLogo = styled.img.withConfig({\n  displayName: \"main__BrandLogo\",\n  componentId: \"r90a11-1\"\n})([\"object-fit:contain;width:100%;height:100%;\"]);\nconst Header = styled(Row).withConfig({\n  displayName: \"main__Header\",\n  componentId: \"r90a11-2\"\n})([\"display:flex;justify-content:space-between;grid-gap:var(--default-gap);\"]);\nconst GuideButton = styled(Button).withConfig({\n  displayName: \"main__GuideButton\",\n  componentId: \"r90a11-3\"\n})([\"display:flex;justify-content:center;align-items:center;color:var(--default-color-accent);\"]);\nconst BackButton = styled(Button).withConfig({\n  displayName: \"main__BackButton\",\n  componentId: \"r90a11-4\"\n})([\"display:none;@media only screen and (max-width:480px){display:flex;justify-content:center;align-items:center;}\"]);\n\nconst Welcome = ({\n  close\n}) => {\n  const router = useRouter();\n  return /*#__PURE__*/React.createElement(Column, {\n    style: {\n      padding: '15px'\n    }\n  }, /*#__PURE__*/React.createElement(Text, null, \"Atomic - \\u0441\\u0432\\u043E\\u0435\\u043E\\u0431\\u0440\\u0430\\u0437\\u043D\\u0430\\u044F \\u043F\\u043B\\u043E\\u0449\\u0430\\u0434\\u043A\\u0430 \\u0434\\u043B\\u044F \\u043F\\u0435\\u0440\\u0435\\u0433\\u043E\\u0432\\u043E\\u0440\\u043E\\u0432 \\u043C\\u0435\\u0436\\u0434\\u0443 \\u043F\\u0440\\u0435\\u0434\\u0441\\u0442\\u0430\\u0432\\u0438\\u0442\\u0435\\u043B\\u044F\\u043C\\u0438 \\u0438\\u043D\\u0434\\u0443\\u0441\\u0442\\u0440\\u0438\\u0438. \\u0410\\u043D\\u0430\\u043B\\u043E\\u0433\\u0438\\u0447\\u043D\\u043E \\u0441\\u043E\\u0446\\u0438\\u0430\\u043B\\u044C\\u043D\\u043E\\u0439 \\u0441\\u0435\\u0442\\u0438 \\u043D\\u0430 \\u0441\\u0430\\u0439\\u0442\\u0435 \\u0435\\u0441\\u0442\\u044C \\u0432\\u043E\\u0437\\u043C\\u043E\\u0436\\u043D\\u043E\\u0441\\u0442\\u044C \\u0440\\u0435\\u0430\\u0433\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C \\u043D\\u0430 \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B, \\u043F\\u043E\\u0434\\u043F\\u0438\\u0441\\u044B\\u0432\\u0430\\u0442\\u044C\\u0441\\u044F \\u043D\\u0430 \\u0440\\u0430\\u0437\\u0440\\u0430\\u0431\\u043E\\u0442\\u0447\\u0438\\u043A\\u043E\\u0432 \\u0438 \\u0437\\u0430\\u043A\\u0430\\u0437\\u0447\\u0438\\u043A\\u043E\\u0432, \\u043E\\u0446\\u0435\\u043D\\u0438\\u0432\\u0430\\u0442\\u044C \\u0438\\u0445 \\u0430\\u043A\\u043A\\u0430\\u0443\\u043D\\u0442\\u044B \\u0438 \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B, \\u043E\\u0431\\u0449\\u0430\\u0442\\u044C\\u0441\\u044F \\u043C\\u0435\\u0436\\u0434\\u0443 \\u0441\\u043E\\u0431\\u043E\\u0439 \\u0438 \\u0434\\u0435\\u043B\\u0438\\u0442\\u044C\\u0441\\u044F \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0435\\u0439 \\u0440\\u0435\\u0441\\u0443\\u0440\\u0441\\u0430 \\u043D\\u0430 \\u043B\\u044E\\u0431\\u044B\\u0445 \\u0434\\u0440\\u0443\\u0433\\u0438\\u0445 \\u043F\\u043B\\u043E\\u0449\\u0430\\u0434\\u043A\\u0430\\u0445.\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: close\n  }, \"\\u0412\\u043F\\u0435\\u0440\\u0435\\u0434!\"), /*#__PURE__*/React.createElement(Divider, {\n    clear: true\n  }), /*#__PURE__*/React.createElement(GuideButton, {\n    onClick: () => {\n      close();\n      return router.push('/guide');\n    },\n    appearance: 'clear'\n  }, \"\\u0418\\u043D\\u0441\\u0442\\u0440\\u0443\\u043A\\u0446\\u0438\\u044F\"));\n};\n\nconst Mutator = ({\n  mutation,\n  variables,\n  callback\n}) => {\n  const [action] = useMutation(mutation);\n  const dispatch = useDispatch();\n  useEffect(() => {\n    async function mutate() {\n      const response = await action({\n        variables\n      });\n      dispatch(setMutate(null, null));\n      if (callback) await callback(response);\n    }\n\n    mutate().then();\n  }, [action, dispatch, variables, callback]);\n  return null;\n};\n\nexport const MainLayout = ({\n  children\n}) => {\n  var _root$settings$genera;\n\n  const router = useRouter();\n  const {\n    useDetectQuery\n  } = useEntityQuery();\n  const [getUser, {\n    data,\n    loading\n  }] = useLazyQuery(queries.GET_USER);\n  const {\n    data: dataMeta,\n    loading: loadingMeta\n  } = useQuery(queries.GET_META);\n  const {\n    root,\n    user,\n    drawer,\n    snacks,\n    modal\n  } = useSelector(state => state);\n  const dispatch = useDispatch();\n  const [loadingExportToPDF, setLoadingExportToPDF] = useState(false);\n  const containerForExportToPDF = useRef(null);\n\n  const onDrawerBack = async () => {\n    await router.push({\n      pathname: router.pathname,\n      query: {}\n    }, undefined, {\n      shallow: true\n    });\n    dispatch(setDrawer(null));\n  };\n\n  const onModalHide = () => {\n    dispatch(setModal(null));\n  };\n\n  const onExportToPDF = useCallback(() => {\n    setLoadingExportToPDF(true);\n    html2canvas(containerForExportToPDF.current).then(canvas => {\n      const [margin, position] = [5, 0];\n      const imgData = canvas.toDataURL('image/png');\n      const pdf = new jsPDF('p', 'mm', 'a4');\n      const width = pdf.internal.pageSize.getWidth();\n      const height = pdf.internal.pageSize.getHeight();\n      pdf.addImage(imgData, 'PNG', margin, position, width, height);\n      pdf.save(`${drawer.pdfName}.pdf`);\n      setLoadingExportToPDF(false);\n    });\n  }, [drawer, containerForExportToPDF, setLoadingExportToPDF]);\n  useEffect(() => {\n    if (!loadingMeta && dataMeta !== null && dataMeta !== void 0 && dataMeta.getDashboardSettings) {\n      dispatch(setSettings(dataMeta === null || dataMeta === void 0 ? void 0 : dataMeta.getDashboardSettings));\n    }\n  }, [dataMeta, loadingMeta]);\n  useEffect(() => {\n    if ((snacks === null || snacks === void 0 ? void 0 : snacks.length) > 0) {\n      setTimeout(() => dispatch(clearItems()), LIFETIME_OF_SNACK);\n    }\n  }, [snacks]);\n  useEffect(() => {\n    if (false) {\n      const token = localStorage.getItem(config.get('secret'));\n      if (token) getUser();\n    }\n  }, []);\n  useEffect(() => {\n    if (data && data.getUser) {\n      dispatch(setUser(data.getUser));\n    }\n  }, [data, dispatch]);\n  useEffect(() => {\n    if (user.authenticated && user.register) {\n      dispatch(setModal([{\n        path: '/',\n        title: 'Добро пожаловать!',\n        component: ({\n          close\n        }) => /*#__PURE__*/React.createElement(Welcome, {\n          close: close\n        })\n      }]));\n    }\n  }, [user, dispatch]);\n  useEffect(() => {\n    dispatch(setSearch(router.query.search));\n  }, [router, dispatch]);\n  useDetectQuery();\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Head, null, /*#__PURE__*/React.createElement(\"title\", null, root.settings.meta.title), /*#__PURE__*/React.createElement(\"meta\", {\n    name: 'description',\n    content: root.settings.meta.description\n  })), loading ? /*#__PURE__*/React.createElement(FixedLoader, null, /*#__PURE__*/React.createElement(Spinner, null)) : children, /*#__PURE__*/React.createElement(Drawer, {\n    key: drawer.history.length,\n    side: drawer.side,\n    half: drawer.half,\n    isOpen: drawer.open,\n    onBack: onDrawerBack\n  }, /*#__PURE__*/React.createElement(Container, null, /*#__PURE__*/React.createElement(Header, null, /*#__PURE__*/React.createElement(Row, null, drawer.side === 'left' && drawer.half ? /*#__PURE__*/React.createElement(Button, {\n    appearance: 'clear',\n    onClick: () => router.push('/')\n  }, /*#__PURE__*/React.createElement(BrandLogo, {\n    src: (_root$settings$genera = root.settings.general.logotype) === null || _root$settings$genera === void 0 ? void 0 : _root$settings$genera.path,\n    alt: 'Logotype'\n  })) : /*#__PURE__*/React.createElement(BackButton, {\n    size: 's',\n    kind: 'icon',\n    onClick: onDrawerBack,\n    revert: true\n  }, /*#__PURE__*/React.createElement(Icon, {\n    icon: 'arrowLeft',\n    size: 's',\n    stroke: 'var(--default-color-accent)'\n  })), drawer.title && /*#__PURE__*/React.createElement(Difinition, {\n    color: drawer.color,\n    icon: drawer.icon,\n    text: drawer.title\n  })), /*#__PURE__*/React.createElement(Row, null, /*#__PURE__*/React.createElement(Button, {\n    size: 's',\n    kind: 'icon',\n    appearance: 'clear',\n    disabled: loadingExportToPDF,\n    onClick: onExportToPDF\n  }, /*#__PURE__*/React.createElement(Icon, {\n    icon: 'paperDownload',\n    size: 's',\n    stroke: 'var(--ghost-color-text)'\n  })))), drawer.title && /*#__PURE__*/React.createElement(Divider, {\n    clear: true\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    ref: containerForExportToPDF\n  }, drawer.content))), /*#__PURE__*/React.createElement(Snacks, {\n    snacks: snacks,\n    onRemove: snack => dispatch(removeItem(snack.id))\n  }), /*#__PURE__*/React.createElement(Modal, {\n    size: modal === null || modal === void 0 ? void 0 : modal.size,\n    routes: modal === null || modal === void 0 ? void 0 : modal.routes,\n    onHide: onModalHide\n  }), root.mutation && /*#__PURE__*/React.createElement(Mutator, {\n    mutation: root.mutation,\n    variables: root.variables,\n    callback: root.callback\n  }));\n};\nexport default MainLayout;","map":{"version":3,"sources":["C:/Users/dan82/Documents/workspace/FREELANCE/atomic/atomic-frontend/layouts/main.js"],"names":["React","useState","useEffect","useCallback","useRef","Head","useRouter","useQuery","useLazyQuery","useMutation","useSelector","useDispatch","styled","html2canvas","jsPDF","Row","Column","Snacks","Difinition","Spinner","Drawer","Button","Icon","Divider","Modal","Text","useEntityQuery","FixedLoader","removeItem","clearItems","setUser","setDrawer","setModal","setMutate","setSearch","setSettings","queries","config","LIFETIME_OF_SNACK","Container","BrandLogo","img","Header","GuideButton","BackButton","Welcome","close","router","padding","push","Mutator","mutation","variables","callback","action","dispatch","mutate","response","then","MainLayout","children","useDetectQuery","getUser","data","loading","GET_USER","dataMeta","loadingMeta","GET_META","root","user","drawer","snacks","modal","state","loadingExportToPDF","setLoadingExportToPDF","containerForExportToPDF","onDrawerBack","pathname","query","undefined","shallow","onModalHide","onExportToPDF","current","canvas","margin","position","imgData","toDataURL","pdf","width","internal","pageSize","getWidth","height","getHeight","addImage","save","pdfName","getDashboardSettings","length","setTimeout","token","localStorage","getItem","get","authenticated","register","path","title","component","search","settings","meta","description","history","side","half","open","general","logotype","color","icon","content","snack","id","size","routes"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback, useRef } from 'react'\nimport Head from 'next/head'\nimport { useRouter } from 'next/router'\nimport { useQuery, useLazyQuery, useMutation } from '@apollo/react-hooks'\nimport { useSelector, useDispatch } from 'react-redux'\nimport styled from 'styled-components'\nimport html2canvas from 'html2canvas'\nimport jsPDF from 'jspdf'\n\nimport Row from '../atomic-ui/components/Row'\nimport Column from '../atomic-ui/components/Column'\nimport Snacks from '../atomic-ui/components/Snacks'\nimport Difinition from '../atomic-ui/components/Difinition'\nimport Spinner from '../atomic-ui/components/Spinner'\nimport Drawer from '../atomic-ui/components/Drawer'\nimport Button from '../atomic-ui/components/Button'\nimport Icon from '../atomic-ui/components/Icon'\nimport Divider from '../atomic-ui/components/Divider'\nimport Modal from '../atomic-ui/components/Modal'\nimport Text from '../atomic-ui/components/Text'\n\nimport useEntityQuery from '../hooks/useEntityQuery'\nimport { FixedLoader } from '../components/Styled'\nimport { removeItem, clearItems } from '../store/actions/snacks'\nimport { setUser } from '../store/actions/user'\nimport { setDrawer } from '../store/actions/drawer'\nimport { setModal } from '../store/actions/modal'\nimport { setMutate, setSearch, setSettings } from '../store/actions/root'\nimport queries from '../graphql/queries'\nimport config from '../config'\n\nconst LIFETIME_OF_SNACK = 3000\n\nconst Container = styled(Column)`\n  height: 100%;\n  flex-grow: 1;\n\n  &.fade-enter {\n    opacity: 0;\n  }\n\n  &.fade-enter-active {\n    opacity: 1;\n    transition: opacity 100ms, blur 100ms;\n  }\n\n  &.fade-exit {\n    opacity: 1;\n  }\n\n  &.fade-exit-active {\n    opacity: 0;\n    transition: opacity 100ms, blur 100ms;\n  }\n`\n\nexport const BrandLogo = styled.img`\n  object-fit: contain;\n  width: 100%;\n  height: 100%;\n`\n\nconst Header = styled(Row)`\n  display: flex;\n  justify-content: space-between;\n  grid-gap: var(--default-gap);\n`\n\nconst GuideButton = styled(Button)`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: var(--default-color-accent);\n`\n\nconst BackButton = styled(Button)`\n  display: none;\n\n  @media only screen and (max-width: 480px) {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n`\n\nconst Welcome = ({ close }) => {\n  const router = useRouter()\n\n  return (\n    <Column style={{ padding: '15px' }}>\n      <Text>\n        Atomic - своеобразная площадка для переговоров между представителями индустрии. Аналогично\n        социальной сети на сайте есть возможность реагировать на проекты, подписываться на\n        разработчиков и заказчиков, оценивать их аккаунты и проекты, общаться между собой и делиться\n        информацией ресурса на любых других площадках.\n      </Text>\n      <Button onClick={close}>Вперед!</Button>\n      <Divider clear />\n      <GuideButton\n        onClick={() => {\n          close()\n          return router.push('/guide')\n        }}\n        appearance={'clear'}>\n        Инструкция\n      </GuideButton>\n    </Column>\n  )\n}\n\nconst Mutator = ({ mutation, variables, callback }) => {\n  const [action] = useMutation(mutation)\n  const dispatch = useDispatch()\n\n  useEffect(() => {\n    async function mutate() {\n      const response = await action({ variables })\n      dispatch(setMutate(null, null))\n      if (callback) await callback(response)\n    }\n    mutate().then()\n  }, [action, dispatch, variables, callback])\n\n  return null\n}\n\nexport const MainLayout = ({ children }) => {\n  const router = useRouter()\n  const { useDetectQuery } = useEntityQuery()\n  const [getUser, { data, loading }] = useLazyQuery(queries.GET_USER)\n  const { data: dataMeta, loading: loadingMeta } = useQuery(queries.GET_META)\n  const { root, user, drawer, snacks, modal } = useSelector((state) => state)\n  const dispatch = useDispatch()\n\n  const [loadingExportToPDF, setLoadingExportToPDF] = useState(false)\n  const containerForExportToPDF = useRef(null)\n\n  const onDrawerBack = async () => {\n    await router.push(\n      {\n        pathname: router.pathname,\n        query: {}\n      },\n      undefined,\n      { shallow: true }\n    )\n    dispatch(setDrawer(null))\n  }\n\n  const onModalHide = () => {\n    dispatch(setModal(null))\n  }\n\n  const onExportToPDF = useCallback(() => {\n    setLoadingExportToPDF(true)\n\n    html2canvas(containerForExportToPDF.current).then((canvas) => {\n      const [margin, position] = [5, 0]\n      const imgData = canvas.toDataURL('image/png')\n\n      const pdf = new jsPDF('p', 'mm', 'a4')\n      const width = pdf.internal.pageSize.getWidth()\n      const height = pdf.internal.pageSize.getHeight()\n\n      pdf.addImage(imgData, 'PNG', margin, position, width, height)\n      pdf.save(`${drawer.pdfName}.pdf`)\n\n      setLoadingExportToPDF(false)\n    })\n  }, [drawer, containerForExportToPDF, setLoadingExportToPDF])\n\n  useEffect(() => {\n    if (!loadingMeta && dataMeta?.getDashboardSettings) {\n      dispatch(setSettings(dataMeta?.getDashboardSettings))\n    }\n  }, [dataMeta, loadingMeta])\n\n  useEffect(() => {\n    if (snacks?.length > 0) {\n      setTimeout(() => dispatch(clearItems()), LIFETIME_OF_SNACK)\n    }\n  }, [snacks])\n\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const token = localStorage.getItem(config.get('secret'))\n      if (token) getUser()\n    }\n  }, [])\n\n  useEffect(() => {\n    if (data && data.getUser) {\n      dispatch(setUser(data.getUser))\n    }\n  }, [data, dispatch])\n\n  useEffect(() => {\n    if (user.authenticated && user.register) {\n      dispatch(\n        setModal([\n          {\n            path: '/',\n            title: 'Добро пожаловать!',\n            component: ({ close }) => <Welcome close={close} />\n          }\n        ])\n      )\n    }\n  }, [user, dispatch])\n\n  useEffect(() => {\n    dispatch(setSearch(router.query.search))\n  }, [router, dispatch])\n\n  useDetectQuery()\n\n  return (\n    <React.Fragment>\n      <Head>\n        <title>{root.settings.meta.title}</title>\n        <meta name={'description'} content={root.settings.meta.description} />\n      </Head>\n\n      {loading ? (\n        <FixedLoader>\n          <Spinner />\n        </FixedLoader>\n      ) : (\n        children\n      )}\n\n      <Drawer\n        key={drawer.history.length}\n        side={drawer.side}\n        half={drawer.half}\n        isOpen={drawer.open}\n        onBack={onDrawerBack}>\n        <Container>\n          <Header>\n            <Row>\n              {drawer.side === 'left' && drawer.half ? (\n                <Button appearance={'clear'} onClick={() => router.push('/')}>\n                  <BrandLogo src={root.settings.general.logotype?.path} alt={'Logotype'} />\n                </Button>\n              ) : (\n                <BackButton size={'s'} kind={'icon'} onClick={onDrawerBack} revert>\n                  <Icon icon={'arrowLeft'} size={'s'} stroke={'var(--default-color-accent)'} />\n                </BackButton>\n              )}\n\n              {drawer.title && (\n                <Difinition color={drawer.color} icon={drawer.icon} text={drawer.title} />\n              )}\n            </Row>\n\n            <Row>\n              <Button\n                size={'s'}\n                kind={'icon'}\n                appearance={'clear'}\n                disabled={loadingExportToPDF}\n                onClick={onExportToPDF}>\n                <Icon icon={'paperDownload'} size={'s'} stroke={'var(--ghost-color-text)'} />\n              </Button>\n            </Row>\n          </Header>\n          {drawer.title && <Divider clear />}\n\n          <div ref={containerForExportToPDF}>{drawer.content}</div>\n        </Container>\n      </Drawer>\n\n      <Snacks snacks={snacks} onRemove={(snack) => dispatch(removeItem(snack.id))} />\n      <Modal size={modal?.size} routes={modal?.routes} onHide={onModalHide} />\n\n      {root.mutation && (\n        <Mutator mutation={root.mutation} variables={root.variables} callback={root.callback} />\n      )}\n    </React.Fragment>\n  )\n}\n\nexport default MainLayout\n"]},"metadata":{},"sourceType":"module"}