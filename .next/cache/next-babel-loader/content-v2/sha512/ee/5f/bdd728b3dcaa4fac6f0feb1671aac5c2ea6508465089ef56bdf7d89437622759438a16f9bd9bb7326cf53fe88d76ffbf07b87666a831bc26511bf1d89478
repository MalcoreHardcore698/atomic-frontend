{"ast":null,"code":"import React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { v4 } from 'uuid';\nimport Column from '../../atomic-ui/components/Column';\nimport Grid from '../../atomic-ui/components/Grid';\nimport DashboardLayout from '../dashboard';\nimport List from '../../components/List';\nimport FilterBar from '../../components/FilterBar';\nimport HandleBar from '../../components/HandleBar';\nimport DeleteForm from '../../components/FormDelete';\nimport { setDisplayMethod, setVisibleFilters } from '../../store/actions/root';\nimport { setDrawer } from '../../store/actions/drawer';\nimport { setItem } from '../../store/actions/snacks';\nimport { useAccess } from '../../hooks/useAccess';\n\nconst getIsAdmin = document => {\n  var _document$name;\n\n  return (document === null || document === void 0 ? void 0 : (_document$name = document.name) === null || _document$name === void 0 ? void 0 : _document$name.toUpperCase()) !== 'ADMIN';\n};\n\nconst Delete = ({\n  item,\n  query,\n  component,\n  entityMultiText,\n  entitySingleText,\n  onSubmit\n}) => {\n  const isArray = useMemo(() => Array.isArray(item), [item]);\n  const dispatch = useDispatch();\n  const Component = component;\n  return /*#__PURE__*/React.createElement(DeleteForm, {\n    mutation: query,\n    appearance: 'clear',\n    onCancel: () => dispatch(setDrawer(null)),\n    onSubmit: async (_, action) => {\n      try {\n        await action({\n          variables: {\n            id: isArray ? item.map(doc => doc.id) : [item.id]\n          }\n        });\n        dispatch(setItem({\n          type: 'success',\n          message: isArray ? `${entityMultiText} успешно удалены` : `${entitySingleText} успешно удален`\n        }));\n      } catch (err) {\n        if (err) {\n          dispatch(setItem({\n            type: 'error',\n            message: 'Что-то пошло не так'\n          }));\n        }\n      } finally {\n        dispatch(setDrawer(null));\n        if (onSubmit) onSubmit();\n      }\n    }\n  }, isArray ? /*#__PURE__*/React.createElement(Grid, {\n    length: 'auto-fit'\n  }, item.map(document => /*#__PURE__*/React.createElement(Component, {\n    key: document.id,\n    item: document\n  }))) : /*#__PURE__*/React.createElement(Component, {\n    item: item\n  }));\n};\n\nexport const Card = ({\n  item,\n  checked,\n  appearance,\n  component,\n  withoutActions,\n  withoutChecked,\n  onChecked,\n  onLink,\n  onEdit,\n  onDelete\n}) => React.cloneElement(component, {\n  checked,\n  appearance,\n  onChecked: !withoutChecked && (checked => onChecked({ ...item,\n    checked\n  })),\n  onLink: onLink && (() => onLink(item)),\n  onEdit: !withoutActions && onEdit && (() => onEdit(item)),\n  onDelete: !withoutActions && onDelete && (() => onDelete(item))\n});\n\nconst ContentLayout = ({\n  render,\n  title,\n  icon,\n  field,\n  filters,\n  options,\n  template,\n  limit = 6,\n  startOffset = 6,\n  buttonCreateText,\n  getType,\n  getQuery,\n  entityType,\n  deleteQuery,\n  deleteEntityMultiText,\n  deleteEntitySingleText,\n  onLink,\n  onEdit,\n  onCreate,\n  emptyMessage,\n  withoutChecked\n}) => {\n  const {\n    displayMethod,\n    visibleFilters\n  } = useSelector(state => ({\n    displayMethod: state.root.displayMethod,\n    visibleFilters: state.root.visibleFilters\n  }));\n  const {\n    isAccessibleForView,\n    isAccessibleForAdd,\n    isAccessibleForEdit,\n    isAccessibleForDelete\n  } = useAccess(entityType);\n  const dispatch = useDispatch();\n  console.log(isAccessibleForView, isAccessibleForAdd, isAccessibleForEdit, isAccessibleForDelete);\n  const [isAllChecked, setIsAllChecked] = useState(false);\n  const [checkedList, setCheckedList] = useState([]);\n  const [updated, setUpdated] = useState('list');\n  const getIsAnyChecked = useCallback(item => {\n    var _checkedList$find;\n\n    return (_checkedList$find = checkedList.find(document => document[field] === item[field])) === null || _checkedList$find === void 0 ? void 0 : _checkedList$find.checked;\n  }, [checkedList]);\n\n  const onAfter = () => setUpdated(v4());\n\n  const onChecked = document => {\n    setCheckedList(prev => {\n      const isExists = item => item[field] === document[field];\n\n      const candidate = prev.find(isExists);\n\n      if (candidate) {\n        return prev.map(item => isExists(item) ? { ...document,\n          checked: !item.checked\n        } : { ...item,\n          checked: isAllChecked || item.checked\n        });\n      } else {\n        return [...prev, { ...document,\n          checked: true\n        }];\n      }\n    });\n    setIsAllChecked(false);\n  };\n\n  const onAllChecked = () => {\n    const value = !isAllChecked;\n    setCheckedList(prev => prev.map(item => ({ ...item,\n      checked: getIsAdmin(item) ? value : false\n    })));\n    setIsAllChecked(value);\n  };\n\n  const onDelete = item => dispatch(setDrawer({\n    icon: 'delete',\n    color: 'red',\n    title: 'Удаление',\n    content: /*#__PURE__*/React.createElement(Delete, {\n      item: item,\n      query: deleteQuery,\n      component: props => React.cloneElement(render(props.item), {\n        appearance: 'clear',\n        onEdit: null,\n        onDelete: null\n      }),\n      entityMultiText: deleteEntityMultiText,\n      entitySingleText: deleteEntitySingleText,\n      onSubmit: () => setUpdated(v4())\n    })\n  }));\n\n  const onDeleteAll = () => onDelete(checkedList.filter(document => document.checked));\n\n  useEffect(() => {\n    const countChecked = checkedList.reduce((acc, curr) => acc + (curr.checked ? 1 : 0), 0);\n\n    if (checkedList.length > 0 && countChecked === checkedList.length) {\n      setIsAllChecked(true);\n    }\n  }, [checkedList]);\n  return /*#__PURE__*/React.createElement(DashboardLayout, {\n    title: title\n  }, /*#__PURE__*/React.createElement(Column, null, /*#__PURE__*/React.createElement(HandleBar, {\n    title: title,\n    icon: icon,\n    checked: isAllChecked,\n    defaultDisplayMethod: displayMethod,\n    defaultVisibleFilters: visibleFilters,\n    buttonDeleteDisabled: !checkedList.find(item => item.checked),\n    buttonCreateText: buttonCreateText,\n    onCreate: isAccessibleForAdd && (() => onCreate && onCreate(onAfter)),\n    onChecked: isAccessibleForEdit && (() => displayMethod === 'grid' && onAllChecked && onAllChecked()),\n    onChangeVisibleFilter: () => dispatch(setVisibleFilters(!visibleFilters)),\n    onChangeDisplayMethod: item => dispatch(setDisplayMethod(item.value)),\n    onDeleteAll: isAccessibleForDelete && onDeleteAll,\n    withoutFooter: !isAccessibleForDelete || displayMethod === 'list',\n    withFilters: filters && options\n  }), (filters || options) && /*#__PURE__*/React.createElement(FilterBar, {\n    isOpen: visibleFilters,\n    filters: filters,\n    options: options\n  }), /*#__PURE__*/React.createElement(List, {\n    key: updated,\n    limit: limit,\n    type: getType,\n    query: getQuery,\n    template: template,\n    startOffset: startOffset,\n    emptyMessage: emptyMessage,\n    setCheckedList: setCheckedList,\n    component: item => /*#__PURE__*/React.createElement(Card, {\n      item: item,\n      component: render(item),\n      withoutChecked: withoutChecked,\n      checked: getIsAdmin(item) && (isAllChecked || getIsAnyChecked(item)),\n      onLink: onLink && isAccessibleForView && (item => onLink(item)),\n      onEdit: onEdit && isAccessibleForEdit && (item => onEdit(item, onAfter)),\n      onChecked: isAccessibleForEdit && onChecked,\n      onDelete: isAccessibleForDelete && onDelete\n    }),\n    onChecked: isAccessibleForEdit && onChecked,\n    onClick: onLink && isAccessibleForView && (item => onLink(item)),\n    onEdit: onEdit && isAccessibleForEdit && (item => onEdit(item, onAfter)),\n    onDelete: isAccessibleForDelete && onDelete\n  })));\n};\n\nContentLayout.defaultProps = {\n  field: 'id'\n};\nexport default ContentLayout;","map":{"version":3,"sources":["C:/Users/dan82/Documents/workspace/FREELANCE/atomic/atomic-frontend/layouts/dashboard/content.js"],"names":["React","useState","useEffect","useCallback","useMemo","useDispatch","useSelector","v4","Column","Grid","DashboardLayout","List","FilterBar","HandleBar","DeleteForm","setDisplayMethod","setVisibleFilters","setDrawer","setItem","useAccess","getIsAdmin","document","name","toUpperCase","Delete","item","query","component","entityMultiText","entitySingleText","onSubmit","isArray","Array","dispatch","Component","_","action","variables","id","map","doc","type","message","err","Card","checked","appearance","withoutActions","withoutChecked","onChecked","onLink","onEdit","onDelete","cloneElement","ContentLayout","render","title","icon","field","filters","options","template","limit","startOffset","buttonCreateText","getType","getQuery","entityType","deleteQuery","deleteEntityMultiText","deleteEntitySingleText","onCreate","emptyMessage","displayMethod","visibleFilters","state","root","isAccessibleForView","isAccessibleForAdd","isAccessibleForEdit","isAccessibleForDelete","console","log","isAllChecked","setIsAllChecked","checkedList","setCheckedList","updated","setUpdated","getIsAnyChecked","find","onAfter","prev","isExists","candidate","onAllChecked","value","color","content","props","onDeleteAll","filter","countChecked","reduce","acc","curr","length","defaultProps"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback, useMemo } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { v4 } from 'uuid'\n\nimport Column from '../../atomic-ui/components/Column'\nimport Grid from '../../atomic-ui/components/Grid'\n\nimport DashboardLayout from '../dashboard'\nimport List from '../../components/List'\nimport FilterBar from '../../components/FilterBar'\nimport HandleBar from '../../components/HandleBar'\nimport DeleteForm from '../../components/FormDelete'\nimport { setDisplayMethod, setVisibleFilters } from '../../store/actions/root'\nimport { setDrawer } from '../../store/actions/drawer'\nimport { setItem } from '../../store/actions/snacks'\nimport { useAccess } from '../../hooks/useAccess'\n\nconst getIsAdmin = (document) => document?.name?.toUpperCase() !== 'ADMIN'\n\nconst Delete = ({ item, query, component, entityMultiText, entitySingleText, onSubmit }) => {\n  const isArray = useMemo(() => Array.isArray(item), [item])\n  const dispatch = useDispatch()\n  const Component = component\n\n  return (\n    <DeleteForm\n      mutation={query}\n      appearance={'clear'}\n      onCancel={() => dispatch(setDrawer(null))}\n      onSubmit={async (_, action) => {\n        try {\n          await action({\n            variables: {\n              id: isArray ? item.map((doc) => doc.id) : [item.id]\n            }\n          })\n          dispatch(\n            setItem({\n              type: 'success',\n              message: isArray\n                ? `${entityMultiText} успешно удалены`\n                : `${entitySingleText} успешно удален`\n            })\n          )\n        } catch (err) {\n          if (err) {\n            dispatch(\n              setItem({\n                type: 'error',\n                message: 'Что-то пошло не так'\n              })\n            )\n          }\n        } finally {\n          dispatch(setDrawer(null))\n          if (onSubmit) onSubmit()\n        }\n      }}>\n      {isArray ? (\n        <Grid length={'auto-fit'}>\n          {item.map((document) => (\n            <Component key={document.id} item={document} />\n          ))}\n        </Grid>\n      ) : (\n        <Component item={item} />\n      )}\n    </DeleteForm>\n  )\n}\n\nexport const Card = ({\n  item,\n  checked,\n  appearance,\n  component,\n  withoutActions,\n  withoutChecked,\n  onChecked,\n  onLink,\n  onEdit,\n  onDelete\n}) =>\n  React.cloneElement(component, {\n    checked,\n    appearance,\n    onChecked: !withoutChecked && ((checked) => onChecked({ ...item, checked })),\n    onLink: onLink && (() => onLink(item)),\n    onEdit: !withoutActions && onEdit && (() => onEdit(item)),\n    onDelete: !withoutActions && onDelete && (() => onDelete(item))\n  })\n\nconst ContentLayout = ({\n  render,\n  title,\n  icon,\n  field,\n  filters,\n  options,\n  template,\n  limit = 6,\n  startOffset = 6,\n  buttonCreateText,\n  getType,\n  getQuery,\n  entityType,\n  deleteQuery,\n  deleteEntityMultiText,\n  deleteEntitySingleText,\n  onLink,\n  onEdit,\n  onCreate,\n  emptyMessage,\n  withoutChecked\n}) => {\n  const { displayMethod, visibleFilters } = useSelector((state) => ({\n    displayMethod: state.root.displayMethod,\n    visibleFilters: state.root.visibleFilters\n  }))\n  const {\n    isAccessibleForView,\n    isAccessibleForAdd,\n    isAccessibleForEdit,\n    isAccessibleForDelete\n  } = useAccess(entityType)\n  const dispatch = useDispatch()\n\n  console.log(isAccessibleForView, isAccessibleForAdd, isAccessibleForEdit, isAccessibleForDelete)\n\n  const [isAllChecked, setIsAllChecked] = useState(false)\n  const [checkedList, setCheckedList] = useState([])\n  const [updated, setUpdated] = useState('list')\n\n  const getIsAnyChecked = useCallback(\n    (item) => checkedList.find((document) => document[field] === item[field])?.checked,\n    [checkedList]\n  )\n\n  const onAfter = () => setUpdated(v4())\n\n  const onChecked = (document) => {\n    setCheckedList((prev) => {\n      const isExists = (item) => item[field] === document[field]\n      const candidate = prev.find(isExists)\n      if (candidate) {\n        return prev.map((item) =>\n          isExists(item)\n            ? {\n                ...document,\n                checked: !item.checked\n              }\n            : {\n                ...item,\n                checked: isAllChecked || item.checked\n              }\n        )\n      } else {\n        return [...prev, { ...document, checked: true }]\n      }\n    })\n    setIsAllChecked(false)\n  }\n\n  const onAllChecked = () => {\n    const value = !isAllChecked\n    setCheckedList((prev) =>\n      prev.map((item) => ({\n        ...item,\n        checked: getIsAdmin(item) ? value : false\n      }))\n    )\n    setIsAllChecked(value)\n  }\n\n  const onDelete = (item) =>\n    dispatch(\n      setDrawer({\n        icon: 'delete',\n        color: 'red',\n        title: 'Удаление',\n        content: (\n          <Delete\n            item={item}\n            query={deleteQuery}\n            component={(props) =>\n              React.cloneElement(render(props.item), {\n                appearance: 'clear',\n                onEdit: null,\n                onDelete: null\n              })\n            }\n            entityMultiText={deleteEntityMultiText}\n            entitySingleText={deleteEntitySingleText}\n            onSubmit={() => setUpdated(v4())}\n          />\n        )\n      })\n    )\n\n  const onDeleteAll = () => onDelete(checkedList.filter((document) => document.checked))\n\n  useEffect(() => {\n    const countChecked = checkedList.reduce((acc, curr) => acc + (curr.checked ? 1 : 0), 0)\n    if (checkedList.length > 0 && countChecked === checkedList.length) {\n      setIsAllChecked(true)\n    }\n  }, [checkedList])\n\n  return (\n    <DashboardLayout title={title}>\n      <Column>\n        <HandleBar\n          title={title}\n          icon={icon}\n          checked={isAllChecked}\n          defaultDisplayMethod={displayMethod}\n          defaultVisibleFilters={visibleFilters}\n          buttonDeleteDisabled={!checkedList.find((item) => item.checked)}\n          buttonCreateText={buttonCreateText}\n          onCreate={isAccessibleForAdd && (() => onCreate && onCreate(onAfter))}\n          onChecked={\n            isAccessibleForEdit &&\n            (() => displayMethod === 'grid' && onAllChecked && onAllChecked())\n          }\n          onChangeVisibleFilter={() => dispatch(setVisibleFilters(!visibleFilters))}\n          onChangeDisplayMethod={(item) => dispatch(setDisplayMethod(item.value))}\n          onDeleteAll={isAccessibleForDelete && onDeleteAll}\n          withoutFooter={!isAccessibleForDelete || displayMethod === 'list'}\n          withFilters={filters && options}\n        />\n\n        {(filters || options) && (\n          <FilterBar isOpen={visibleFilters} filters={filters} options={options} />\n        )}\n\n        <List\n          key={updated}\n          limit={limit}\n          type={getType}\n          query={getQuery}\n          template={template}\n          startOffset={startOffset}\n          emptyMessage={emptyMessage}\n          setCheckedList={setCheckedList}\n          component={(item) => (\n            <Card\n              item={item}\n              component={render(item)}\n              withoutChecked={withoutChecked}\n              checked={getIsAdmin(item) && (isAllChecked || getIsAnyChecked(item))}\n              onLink={onLink && isAccessibleForView && ((item) => onLink(item))}\n              onEdit={onEdit && isAccessibleForEdit && ((item) => onEdit(item, onAfter))}\n              onChecked={isAccessibleForEdit && onChecked}\n              onDelete={isAccessibleForDelete && onDelete}\n            />\n          )}\n          onChecked={isAccessibleForEdit && onChecked}\n          onClick={onLink && isAccessibleForView && ((item) => onLink(item))}\n          onEdit={onEdit && isAccessibleForEdit && ((item) => onEdit(item, onAfter))}\n          onDelete={isAccessibleForDelete && onDelete}\n        />\n      </Column>\n    </DashboardLayout>\n  )\n}\n\nContentLayout.defaultProps = {\n  field: 'id'\n}\n\nexport default ContentLayout\n"]},"metadata":{},"sourceType":"module"}