{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport { Controller } from 'react-hook-form';\nimport { useQuery } from '@apollo/react-hooks';\nimport Row from '../../atomic-ui/components/Row';\nimport Column from '../../atomic-ui/components/Column';\nimport Input from '../../atomic-ui/components/Input';\nimport Button from '../../atomic-ui/components/Button';\nimport Title from '../../atomic-ui/components/Title';\nimport Alert from '../../atomic-ui/components/Alert';\nimport Select from '../../atomic-ui/components/Select';\nimport Divider from '../../atomic-ui/components/Divider';\nimport Spinner from '../../atomic-ui/components/Spinner';\nimport { getLabelCategory } from '../../utils/functions';\nimport { Loader } from '../Styled';\nimport Form from '../Form';\nimport queries from '../../graphql/queries';\nimport TextArea from '../../atomic-ui/components/TextArea';\nimport Message from '../../../atomic-ui/components/Message';\nexport const LIMIT_USERS = 15;\nexport const Ticket = ({\n  ticket,\n  appearance,\n  mutation,\n  className,\n  onSubmit\n}) => {\n  _s();\n\n  const [offsetUsers, setOffsetUsers] = useState(0); // const [usersSelectInput, setUsersSelectInput] = useState('')\n\n  const [users, setUsers] = useState([]);\n  const {\n    data,\n    loading: loadingTicket,\n    error: errorTicket\n  } = ticket ? useQuery(queries.GET_TICKET, {\n    variables: {\n      id: ticket\n    },\n    fetchPolicy: 'no-cache'\n  }) : {\n    data: {\n      getTicket: {}\n    },\n    loading: false,\n    error: false\n  };\n  const {\n    data: dataUsers,\n    loading: loadingUsers,\n    // refetch: searchUsers,\n    fetchMore: updateUsers\n  } = useQuery(queries.GET_USERS_FOR_TICKET, {\n    variables: {\n      offset: offsetUsers,\n      limit: LIMIT_USERS\n    }\n  });\n  const {\n    data: dataCategories,\n    loading: loadingCategories\n  } = useQuery(queries.GET_CATEGORIES, {\n    variables: {\n      type: 'TICKET'\n    }\n  });\n  useEffect(() => {\n    if (!loadingUsers && dataUsers) {\n      setUsers(prev => [...prev, ...dataUsers.getUsers]);\n    }\n  }, [dataUsers, loadingUsers]);\n  return /*#__PURE__*/React.createElement(Form, {\n    className: className,\n    appearance: appearance,\n    mutation: mutation,\n    onSubmit: onSubmit\n  }, ({\n    register,\n    loading,\n    errors,\n    control,\n    getValues\n  }) => {\n    var _data$getTicket, _data$getTicket2, _data$getTicket2$mess, _data$getTicket3, _data$getTicket4, _data$getTicket5, _data$getTicket6, _data$getTicket6$mess, _data$getTicket7;\n\n    return !loadingTicket && data ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Column, null, /*#__PURE__*/React.createElement(Title, {\n      tag: 'h4'\n    }, \"\\u041E\\u0441\\u043D\\u043E\\u0432\\u043D\\u043E\\u0435\"), errors && errors.title && /*#__PURE__*/React.createElement(Alert, {\n      style: {\n        width: '100%'\n      },\n      appearance: 'error'\n    }, \"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u043D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u043E\\u0431\\u0440\\u0430\\u0449\\u0435\\u043D\\u0438\\u0435\"), /*#__PURE__*/React.createElement(Input, {\n      type: 'text',\n      name: 'title',\n      ref: register({\n        required: true\n      }),\n      defaultValue: getValues('title') || ((_data$getTicket = data.getTicket) === null || _data$getTicket === void 0 ? void 0 : _data$getTicket.title),\n      placeholder: 'Название',\n      appearance: 'ghost',\n      disabled: loading\n    }), (!ticket || ((_data$getTicket2 = data.getTicket) === null || _data$getTicket2 === void 0 ? void 0 : (_data$getTicket2$mess = _data$getTicket2.messages) === null || _data$getTicket2$mess === void 0 ? void 0 : _data$getTicket2$mess.length) === 0) && /*#__PURE__*/React.createElement(TextArea, {\n      type: 'text',\n      name: 'message',\n      ref: register(),\n      defaultValue: getValues('message') || '',\n      placeholder: 'Описание обращения',\n      disabled: loading,\n      appearance: 'ghost'\n    }), /*#__PURE__*/React.createElement(Controller, {\n      name: 'author',\n      control: control,\n      defaultValue: (_data$getTicket3 = data.getTicket) !== null && _data$getTicket3 !== void 0 && _data$getTicket3.author ? {\n        value: data.getTicket.author.id,\n        label: data.getTicket.author.name\n      } : null,\n      render: ({\n        value,\n        onChange\n      }) => /*#__PURE__*/React.createElement(Select, {\n        options: users.map(user => ({\n          value: user,\n          label: user.name\n        })),\n        appearance: 'ghost',\n        defaultValue: value // inputValue={usersSelectInput}\n        ,\n        placeholder: 'Выберите автора обращения',\n        onChange: onChange // onInputChange={(input) => setUsersSelectInput(input)}\n        // onKeyDown={(e) => {\n        //   // Pressed ENTER\n        //   if (e.keyCode === 13) {\n        //     searchUsers({\n        //       search: usersSelectInput\n        //     })\n        //   }\n        // }}\n        ,\n        onMenuScrollToBottom: async () => {\n          await updateUsers({\n            variables: {\n              offset: offsetUsers,\n              limit: LIMIT_USERS\n            },\n            updateQuery: (...props) => props\n          });\n          setOffsetUsers(prev => prev + LIMIT_USERS);\n        },\n        isLoading: loadingUsers // isSearchable\n\n      })\n    }), /*#__PURE__*/React.createElement(Controller, {\n      name: 'counsellor',\n      control: control,\n      defaultValue: (_data$getTicket4 = data.getTicket) !== null && _data$getTicket4 !== void 0 && _data$getTicket4.counsellor ? {\n        value: data.getTicket.counsellor.id,\n        label: data.getTicket.counsellor.name\n      } : null,\n      render: ({\n        value,\n        onChange\n      }) => /*#__PURE__*/React.createElement(Select, {\n        options: !loadingUsers && dataUsers ? dataUsers.getUsers.map(user => ({\n          value: user,\n          label: user.name\n        })) : [],\n        appearance: 'ghost',\n        defaultValue: value,\n        placeholder: 'Выберите советника',\n        onChange: onChange,\n        onMenuScrollToBottom: async () => {\n          await updateUsers({\n            variables: {\n              offset: offsetUsers,\n              limit: LIMIT_USERS\n            },\n            updateQuery: (...props) => props\n          });\n          setOffsetUsers(prev => prev + LIMIT_USERS);\n        },\n        isLoading: loadingUsers\n      })\n    }), /*#__PURE__*/React.createElement(Controller, {\n      name: 'category',\n      control: control,\n      defaultValue: (_data$getTicket5 = data.getTicket) !== null && _data$getTicket5 !== void 0 && _data$getTicket5.category ? {\n        value: data.getTicket.category.id,\n        label: getLabelCategory(data.getTicket.category.name)\n      } : null,\n      render: ({\n        value,\n        onChange\n      }) => /*#__PURE__*/React.createElement(Select, {\n        appearance: 'ghost',\n        placeholder: 'Выберите раздел',\n        options: !loadingCategories && dataCategories ? dataCategories.getCategories.filter(item => item.type === 'TICKET').map(item => ({\n          value: item.id,\n          label: getLabelCategory(item.name)\n        })) : [],\n        onChange: onChange,\n        defaultValue: value,\n        isLoading: loadingCategories,\n        isClearable: true\n      })\n    })), ticket && ((_data$getTicket6 = data.getTicket) === null || _data$getTicket6 === void 0 ? void 0 : (_data$getTicket6$mess = _data$getTicket6.messages) === null || _data$getTicket6$mess === void 0 ? void 0 : _data$getTicket6$mess.length) > 0 && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Divider, {\n      clear: true\n    }), (_data$getTicket7 = data.getTicket) === null || _data$getTicket7 === void 0 ? void 0 : _data$getTicket7.messages.map(message => /*#__PURE__*/React.createElement(Message, {\n      key: message.id,\n      avatar: message.user.avatar.path,\n      name: message.user.name,\n      text: message.text,\n      time: message.createdAt !== message.updatedAt ? message.updatedAt : message.createdAt,\n      isUpdated: message.createdAt !== message.updatedAt,\n      onEdit: () => {},\n      onDelete: () => {},\n      compact: true\n    }))), /*#__PURE__*/React.createElement(Divider, {\n      clear: true\n    }), /*#__PURE__*/React.createElement(Row, null, /*#__PURE__*/React.createElement(Button, {\n      style: {\n        flexGrow: 1\n      },\n      type: 'submit',\n      disabled: loading\n    }, \"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C\"))) : errorTicket ? /*#__PURE__*/React.createElement(Alert, {\n      appearance: 'error',\n      style: {\n        width: '100%',\n        textAlign: 'center'\n      }\n    }, \"\\u0423\\u043F\\u0441! \\u041D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u044E \\u043E\\u0431 \\u043E\\u0431\\u0440\\u0430\\u0449\\u0435\\u043D\\u0438\\u0438\") : /*#__PURE__*/React.createElement(Loader, null, /*#__PURE__*/React.createElement(Spinner, null));\n  });\n};\n\n_s(Ticket, \"Fn+nfTM8yCGtpN91y2TGRuMaEdc=\", false, function () {\n  return [useQuery, useQuery, useQuery];\n});\n\n_c = Ticket;\nexport default Ticket;\n\nvar _c;\n\n$RefreshReg$(_c, \"Ticket\");","map":{"version":3,"sources":["C:/Users/dan82/Documents/workspace/FREELANCE/atomic/atomic-frontend/components/FormTicket/index.js"],"names":["React","useState","useEffect","Controller","useQuery","Row","Column","Input","Button","Title","Alert","Select","Divider","Spinner","getLabelCategory","Loader","Form","queries","TextArea","Message","LIMIT_USERS","Ticket","ticket","appearance","mutation","className","onSubmit","offsetUsers","setOffsetUsers","users","setUsers","data","loading","loadingTicket","error","errorTicket","GET_TICKET","variables","id","fetchPolicy","getTicket","dataUsers","loadingUsers","fetchMore","updateUsers","GET_USERS_FOR_TICKET","offset","limit","dataCategories","loadingCategories","GET_CATEGORIES","type","prev","getUsers","register","errors","control","getValues","title","width","required","messages","length","author","value","label","name","onChange","map","user","updateQuery","props","counsellor","category","getCategories","filter","item","message","avatar","path","text","createdAt","updatedAt","flexGrow","textAlign"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { Controller } from 'react-hook-form'\nimport { useQuery } from '@apollo/react-hooks'\n\nimport Row from '../../atomic-ui/components/Row'\nimport Column from '../../atomic-ui/components/Column'\nimport Input from '../../atomic-ui/components/Input'\nimport Button from '../../atomic-ui/components/Button'\nimport Title from '../../atomic-ui/components/Title'\nimport Alert from '../../atomic-ui/components/Alert'\nimport Select from '../../atomic-ui/components/Select'\nimport Divider from '../../atomic-ui/components/Divider'\nimport Spinner from '../../atomic-ui/components/Spinner'\n\nimport { getLabelCategory } from '../../utils/functions'\nimport { Loader } from '../Styled'\nimport Form from '../Form'\nimport queries from '../../graphql/queries'\nimport TextArea from '../../atomic-ui/components/TextArea'\nimport Message from '../../../atomic-ui/components/Message'\n\nexport const LIMIT_USERS = 15\n\nexport const Ticket = ({ ticket, appearance, mutation, className, onSubmit }) => {\n  const [offsetUsers, setOffsetUsers] = useState(0)\n  // const [usersSelectInput, setUsersSelectInput] = useState('')\n  const [users, setUsers] = useState([])\n\n  const { data, loading: loadingTicket, error: errorTicket } = ticket\n    ? useQuery(queries.GET_TICKET, {\n        variables: {\n          id: ticket\n        },\n        fetchPolicy: 'no-cache'\n      })\n    : { data: { getTicket: {} }, loading: false, error: false }\n\n  const {\n    data: dataUsers,\n    loading: loadingUsers,\n    // refetch: searchUsers,\n    fetchMore: updateUsers\n  } = useQuery(queries.GET_USERS_FOR_TICKET, {\n    variables: {\n      offset: offsetUsers,\n      limit: LIMIT_USERS\n    }\n  })\n\n  const { data: dataCategories, loading: loadingCategories } = useQuery(queries.GET_CATEGORIES, {\n    variables: {\n      type: 'TICKET'\n    }\n  })\n\n  useEffect(() => {\n    if (!loadingUsers && dataUsers) {\n      setUsers((prev) => [...prev, ...dataUsers.getUsers])\n    }\n  }, [dataUsers, loadingUsers])\n\n  return (\n    <Form className={className} appearance={appearance} mutation={mutation} onSubmit={onSubmit}>\n      {({ register, loading, errors, control, getValues }) =>\n        !loadingTicket && data ? (\n          <React.Fragment>\n            <Column>\n              <Title tag={'h4'}>Основное</Title>\n\n              {errors && errors.title && (\n                <Alert style={{ width: '100%' }} appearance={'error'}>\n                  Введите название обращение\n                </Alert>\n              )}\n              <Input\n                type={'text'}\n                name={'title'}\n                ref={register({ required: true })}\n                defaultValue={getValues('title') || data.getTicket?.title}\n                placeholder={'Название'}\n                appearance={'ghost'}\n                disabled={loading}\n              />\n              {(!ticket || data.getTicket?.messages?.length === 0) && (\n                <TextArea\n                  type={'text'}\n                  name={'message'}\n                  ref={register()}\n                  defaultValue={getValues('message') || ''}\n                  placeholder={'Описание обращения'}\n                  disabled={loading}\n                  appearance={'ghost'}\n                />\n              )}\n\n              <Controller\n                name={'author'}\n                control={control}\n                defaultValue={\n                  data.getTicket?.author\n                    ? {\n                        value: data.getTicket.author.id,\n                        label: data.getTicket.author.name\n                      }\n                    : null\n                }\n                render={({ value, onChange }) => (\n                  <Select\n                    options={users.map((user) => ({\n                      value: user,\n                      label: user.name\n                    }))}\n                    appearance={'ghost'}\n                    defaultValue={value}\n                    // inputValue={usersSelectInput}\n                    placeholder={'Выберите автора обращения'}\n                    onChange={onChange}\n                    // onInputChange={(input) => setUsersSelectInput(input)}\n                    // onKeyDown={(e) => {\n                    //   // Pressed ENTER\n                    //   if (e.keyCode === 13) {\n                    //     searchUsers({\n                    //       search: usersSelectInput\n                    //     })\n                    //   }\n                    // }}\n                    onMenuScrollToBottom={async () => {\n                      await updateUsers({\n                        variables: {\n                          offset: offsetUsers,\n                          limit: LIMIT_USERS\n                        },\n                        updateQuery: (...props) => props\n                      })\n                      setOffsetUsers((prev) => prev + LIMIT_USERS)\n                    }}\n                    isLoading={loadingUsers}\n                    // isSearchable\n                  />\n                )}\n              />\n\n              <Controller\n                name={'counsellor'}\n                control={control}\n                defaultValue={\n                  data.getTicket?.counsellor\n                    ? {\n                        value: data.getTicket.counsellor.id,\n                        label: data.getTicket.counsellor.name\n                      }\n                    : null\n                }\n                render={({ value, onChange }) => (\n                  <Select\n                    options={\n                      !loadingUsers && dataUsers\n                        ? dataUsers.getUsers.map((user) => ({\n                            value: user,\n                            label: user.name\n                          }))\n                        : []\n                    }\n                    appearance={'ghost'}\n                    defaultValue={value}\n                    placeholder={'Выберите советника'}\n                    onChange={onChange}\n                    onMenuScrollToBottom={async () => {\n                      await updateUsers({\n                        variables: {\n                          offset: offsetUsers,\n                          limit: LIMIT_USERS\n                        },\n                        updateQuery: (...props) => props\n                      })\n                      setOffsetUsers((prev) => prev + LIMIT_USERS)\n                    }}\n                    isLoading={loadingUsers}\n                  />\n                )}\n              />\n\n              <Controller\n                name={'category'}\n                control={control}\n                defaultValue={\n                  data.getTicket?.category\n                    ? {\n                        value: data.getTicket.category.id,\n                        label: getLabelCategory(data.getTicket.category.name)\n                      }\n                    : null\n                }\n                render={({ value, onChange }) => (\n                  <Select\n                    appearance={'ghost'}\n                    placeholder={'Выберите раздел'}\n                    options={\n                      !loadingCategories && dataCategories\n                        ? dataCategories.getCategories\n                            .filter((item) => item.type === 'TICKET')\n                            .map((item) => ({\n                              value: item.id,\n                              label: getLabelCategory(item.name)\n                            }))\n                        : []\n                    }\n                    onChange={onChange}\n                    defaultValue={value}\n                    isLoading={loadingCategories}\n                    isClearable\n                  />\n                )}\n              />\n            </Column>\n\n            {ticket && data.getTicket?.messages?.length > 0 && (\n              <React.Fragment>\n                <Divider clear />\n\n                {data.getTicket?.messages.map((message) => (\n                  <Message\n                    key={message.id}\n                    avatar={message.user.avatar.path}\n                    name={message.user.name}\n                    text={message.text}\n                    time={\n                      message.createdAt !== message.updatedAt\n                        ? message.updatedAt\n                        : message.createdAt\n                    }\n                    isUpdated={message.createdAt !== message.updatedAt}\n                    onEdit={() => {}}\n                    onDelete={() => {}}\n                    compact\n                  />\n                ))}\n              </React.Fragment>\n            )}\n\n            <Divider clear />\n\n            <Row>\n              <Button style={{ flexGrow: 1 }} type={'submit'} disabled={loading}>\n                Создать\n              </Button>\n            </Row>\n          </React.Fragment>\n        ) : errorTicket ? (\n          <Alert appearance={'error'} style={{ width: '100%', textAlign: 'center' }}>\n            Упс! Не удалось загрузить информацию об обращении\n          </Alert>\n        ) : (\n          <Loader>\n            <Spinner />\n          </Loader>\n        )\n      }\n    </Form>\n  )\n}\n\nexport default Ticket\n"]},"metadata":{},"sourceType":"module"}