{"ast":null,"code":"var _s = $RefreshSig$();\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React, { useState, useEffect } from 'react';\nimport { useMutation, useQuery } from '@apollo/react-hooks';\nimport styled from 'styled-components';\nimport Column from '../../atomic-ui/components/Column';\nimport Alert from '../../atomic-ui/components/Alert';\nimport Notice from '../../atomic-ui/components/Notice';\nimport Spinner from '../../atomic-ui/components/Spinner';\nimport { Loader } from '../Styled';\nimport { useMutationEffect } from '../../hooks/useMutationEffect';\nimport { useUpdateEffect } from '../../hooks/useUpdateEffect';\nimport queries from '../../graphql/queries';\nexport const Wrap = styled(Column).withConfig({\n  displayName: \"Notifications__Wrap\",\n  componentId: \"sc-1luuv3g-0\"\n})([\"\"]);\n_c = Wrap;\nexport const Notifications = ({\n  user,\n  appearance\n}) => {\n  _s();\n\n  const [notifications, setNotifications] = useState([]);\n  const {\n    data,\n    loading,\n    error\n  } = useQuery(queries.GET_NOTIFICATIONS, {\n    variables: {\n      author: user\n    }\n  });\n  const [apply, {\n    loading: loadingApply,\n    error: errorApply\n  }] = useMutationEffect(queries.APPLY_INVITE_USER_MEMBER, 'applyInviteUserMember', setNotifications);\n  const [reject, {\n    loading: loadingReject,\n    error: errorReject\n  }] = useMutationEffect(queries.REJECT_INVITE_USER_MEMBER, 'rejectInviteUserMember', setNotifications);\n  const [readNotifications, {\n    loading: loadingReadNotifications\n  }] = useMutation(queries.READ_NOTIFICATIONS);\n\n  const onApply = notice => {\n    var _notice$company;\n\n    return apply({\n      variables: {\n        id: notice.id,\n        email: (_notice$company = notice.company) === null || _notice$company === void 0 ? void 0 : _notice$company.email\n      }\n    });\n  };\n\n  const onReject = notice => {\n    var _notice$company2;\n\n    return reject({\n      variables: {\n        id: notice.id,\n        email: (_notice$company2 = notice.company) === null || _notice$company2 === void 0 ? void 0 : _notice$company2.email\n      }\n    });\n  };\n\n  useUpdateEffect(data, loading, 'getNotifications', setNotifications);\n  useEffect(() => {\n    readNotifications();\n  }, [readNotifications]);\n  return /*#__PURE__*/React.createElement(Wrap, null, notifications && !loading && !loadingApply && !loadingReject && !loadingReadNotifications && notifications.length > 0 ? notifications.map(notice => {\n    var _notice$author, _notice$author$avatar;\n\n    return /*#__PURE__*/React.createElement(Notice, _extends({\n      key: notice.id\n    }, notice.author ? {\n      img: ((_notice$author = notice.author) === null || _notice$author === void 0 ? void 0 : (_notice$author$avatar = _notice$author.avatar) === null || _notice$author$avatar === void 0 ? void 0 : _notice$author$avatar.path) || '/images/avatar-default.png'\n    } : {\n      icon: 'infoCircle'\n    }, {\n      title: notice.title,\n      message: notice.message,\n      date: notice.createdAt,\n      appearance: appearance,\n      onApply: notice.type === 'INVITE' && (() => onApply(notice)),\n      onReject: notice.type === 'INVITE' && (() => onReject(notice))\n    }));\n  }) : loading || loadingApply || loadingReject || loadingReadNotifications ? /*#__PURE__*/React.createElement(Loader, null, /*#__PURE__*/React.createElement(Spinner, null)) : error || errorApply || errorReject ? /*#__PURE__*/React.createElement(Alert, {\n    appearance: 'error',\n    style: {\n      width: '100%',\n      textAlign: 'center'\n    }\n  }, \"\\u0423\\u043F\\u0441! \\u041D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u044E \\u043E \\u0443\\u0447\\u0430\\u0441\\u0442\\u043D\\u0438\\u043A\\u0430\\u0445\") : /*#__PURE__*/React.createElement(Alert, {\n    style: {\n      textAlign: 'center'\n    },\n    width: '100%'\n  }, \"\\u0423\\u0432\\u0435\\u0434\\u043E\\u043C\\u043B\\u0435\\u043D\\u0438\\u0439 \\u043D\\u0435\\u0442\"));\n};\n\n_s(Notifications, \"+W1NYyRUmkHFBXyj+rFqiYlIvF8=\", false, function () {\n  return [useQuery, useMutationEffect, useMutationEffect, useMutation, useUpdateEffect];\n});\n\n_c2 = Notifications;\nNotifications.defaultProps = {\n  appearance: 'default'\n};\nexport default Notifications;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Wrap\");\n$RefreshReg$(_c2, \"Notifications\");","map":{"version":3,"sources":["/Users/malcore/Documents/workspace/freelance/atomic/atomic-frontend/components/Notifications/index.js"],"names":["React","useState","useEffect","useMutation","useQuery","styled","Column","Alert","Notice","Spinner","Loader","useMutationEffect","useUpdateEffect","queries","Wrap","Notifications","user","appearance","notifications","setNotifications","data","loading","error","GET_NOTIFICATIONS","variables","author","apply","loadingApply","errorApply","APPLY_INVITE_USER_MEMBER","reject","loadingReject","errorReject","REJECT_INVITE_USER_MEMBER","readNotifications","loadingReadNotifications","READ_NOTIFICATIONS","onApply","notice","id","email","company","onReject","length","map","img","avatar","path","icon","title","message","createdAt","type","width","textAlign","defaultProps"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { useMutation, useQuery } from '@apollo/react-hooks'\nimport styled from 'styled-components'\n\nimport Column from '../../atomic-ui/components/Column'\nimport Alert from '../../atomic-ui/components/Alert'\nimport Notice from '../../atomic-ui/components/Notice'\nimport Spinner from '../../atomic-ui/components/Spinner'\n\nimport { Loader } from '../Styled'\nimport { useMutationEffect } from '../../hooks/useMutationEffect'\nimport { useUpdateEffect } from '../../hooks/useUpdateEffect'\nimport queries from '../../graphql/queries'\n\nexport const Wrap = styled(Column)``\n\nexport const Notifications = ({ user, appearance }) => {\n  const [notifications, setNotifications] = useState([])\n\n  const { data, loading, error } = useQuery(queries.GET_NOTIFICATIONS, {\n    variables: {\n      author: user\n    }\n  })\n\n  const [apply, { loading: loadingApply, error: errorApply }] = useMutationEffect(\n    queries.APPLY_INVITE_USER_MEMBER,\n    'applyInviteUserMember',\n    setNotifications\n  )\n\n  const [reject, { loading: loadingReject, error: errorReject }] = useMutationEffect(\n    queries.REJECT_INVITE_USER_MEMBER,\n    'rejectInviteUserMember',\n    setNotifications\n  )\n\n  const [readNotifications, { loading: loadingReadNotifications }] = useMutation(\n    queries.READ_NOTIFICATIONS\n  )\n\n  const onApply = (notice) => apply({ variables: { id: notice.id, email: notice.company?.email } })\n\n  const onReject = (notice) =>\n    reject({ variables: { id: notice.id, email: notice.company?.email } })\n\n  useUpdateEffect(data, loading, 'getNotifications', setNotifications)\n\n  useEffect(() => {\n    readNotifications()\n  }, [readNotifications])\n\n  return (\n    <Wrap>\n      {notifications &&\n      !loading &&\n      !loadingApply &&\n      !loadingReject &&\n      !loadingReadNotifications &&\n      notifications.length > 0 ? (\n        notifications.map((notice) => (\n          <Notice\n            key={notice.id}\n            {...(notice.author\n              ? {\n                  img: notice.author?.avatar?.path || '/images/avatar-default.png'\n                }\n              : {\n                  icon: 'infoCircle'\n                })}\n            title={notice.title}\n            message={notice.message}\n            date={notice.createdAt}\n            appearance={appearance}\n            onApply={notice.type === 'INVITE' && (() => onApply(notice))}\n            onReject={notice.type === 'INVITE' && (() => onReject(notice))}\n          />\n        ))\n      ) : loading || loadingApply || loadingReject || loadingReadNotifications ? (\n        <Loader>\n          <Spinner />\n        </Loader>\n      ) : error || errorApply || errorReject ? (\n        <Alert appearance={'error'} style={{ width: '100%', textAlign: 'center' }}>\n          Упс! Не удалось загрузить информацию о участниках\n        </Alert>\n      ) : (\n        <Alert style={{ textAlign: 'center' }} width={'100%'}>\n          Уведомлений нет\n        </Alert>\n      )}\n    </Wrap>\n  )\n}\n\nNotifications.defaultProps = {\n  appearance: 'default'\n}\n\nexport default Notifications\n"]},"metadata":{},"sourceType":"module"}