{"ast":null,"code":"var _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nimport React, { useEffect } from 'react';\nimport Head from 'next/head';\nimport { useRouter } from 'next/router';\nimport styled from 'styled-components';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useLazyQuery, useMutation } from '@apollo/react-hooks';\nimport Row from '../atomic-ui/components/Row';\nimport Column from '../atomic-ui/components/Column';\nimport Snacks from '../atomic-ui/components/Snacks';\nimport Difinition from '../atomic-ui/components/Difinition';\nimport Spinner from '../atomic-ui/components/Spinner';\nimport Drawer from '../atomic-ui/components/Drawer';\nimport Button from '../atomic-ui/components/Button';\nimport Icon from '../atomic-ui/components/Icon';\nimport Divider from '../atomic-ui/components/Divider';\nimport Modal from '../atomic-ui/components/Modal';\nimport Text from '../atomic-ui/components/Text';\nimport { b64DecodeUnicode } from '../../atomic-ui/utils/functions';\nimport { useHelper } from '../hooks/useHelper';\nimport { useMutate } from '../hooks/useMutate';\nimport { FixedLoader } from '../components/Styled';\nimport { onProjectAdd, onProjectLink } from '../store/helpers/project';\nimport { removeItem, clearItems } from '../store/actions/snacks';\nimport { setUser, updateUser } from '../store/actions/user';\nimport { setDrawer } from '../store/actions/drawer';\nimport { setModal } from '../store/actions/modal';\nimport { setMutate } from '../store/actions/root';\nimport { onUserLink } from '../store/helpers/user';\nimport { onTicketLink } from '../store/helpers/ticket';\nimport { onArticleLink } from '../store/helpers/article';\nimport { onCategoryLink } from '../store/helpers/category';\nimport { onRoleLink } from '../store/helpers/role';\nimport queries from '../graphql/queries';\nimport config from '../config';\nconst LIFETIME_OF_SNACK = 3000;\nconst Container = styled(Column).withConfig({\n  displayName: \"main__Container\",\n  componentId: \"r90a11-0\"\n})([\"height:100%;flex-grow:1;&.fade-enter{opacity:0;}&.fade-enter-active{opacity:1;transition:opacity 100ms,blur 100ms;}&.fade-exit{opacity:1;}&.fade-exit-active{opacity:0;transition:opacity 100ms,blur 100ms;}\"]);\n_c = Container;\nexport const BrandLogo = styled.img.withConfig({\n  displayName: \"main__BrandLogo\",\n  componentId: \"r90a11-1\"\n})([\"object-fit:contain;width:100%;height:100%;\"]);\n_c2 = BrandLogo;\nconst Header = styled(Row).withConfig({\n  displayName: \"main__Header\",\n  componentId: \"r90a11-2\"\n})([\"display:flex;grid-gap:var(--default-gap);\"]);\n_c3 = Header;\nconst GuideButton = styled(Button).withConfig({\n  displayName: \"main__GuideButton\",\n  componentId: \"r90a11-3\"\n})([\"display:flex;justify-content:center;align-items:center;color:var(--default-color-accent);\"]);\n_c4 = GuideButton;\nconst BackButton = styled(Button).withConfig({\n  displayName: \"main__BackButton\",\n  componentId: \"r90a11-4\"\n})([\"display:none;@media only screen and (max-width:480px){display:flex;justify-content:center;align-items:center;}\"]);\n_c5 = BackButton;\n\nconst getProjectLinkProps = (id, user, owned, dispatch, mutate, recall) => ({\n  id,\n  auth: user === null || user === void 0 ? void 0 : user.email,\n  liked: !!((user === null || user === void 0 ? void 0 : user.likedProjects) || []).find(item => item.id === id),\n  onLike: user.email && mutate(queries.LIKE_PROJECT, {\n    id\n  }, response => dispatch(updateUser(response.data.likeProject))),\n  onAdd: user.email && recall(onProjectAdd, {\n    id,\n    folders: user === null || user === void 0 ? void 0 : user.folders,\n    mutations: {\n      addProject: queries.ADD_USER_PROJECT,\n      createFolder: queries.ADD_USER_FOLDER\n    }\n  }),\n  owned\n});\n\nconst getUserLinkProps = (id, user, owned) => ({\n  id,\n  auth: user === null || user === void 0 ? void 0 : user.email,\n  owned,\n  queries: {\n    userChats: queries.GET_USER_CHATS,\n    chat: queries.GET_CHAT\n  },\n  mutations: {\n    addUserChat: queries.ADD_USER_CHAT,\n    sendMessage: queries.SEND_MESSAGE\n  }\n});\n\nconst Welcome = ({\n  close\n}) => {\n  _s();\n\n  const router = useRouter();\n  return /*#__PURE__*/React.createElement(Column, {\n    style: {\n      padding: '15px'\n    }\n  }, /*#__PURE__*/React.createElement(Text, null, \"Atomic - \\u0441\\u0432\\u043E\\u0435\\u043E\\u0431\\u0440\\u0430\\u0437\\u043D\\u0430\\u044F \\u043F\\u043B\\u043E\\u0449\\u0430\\u0434\\u043A\\u0430 \\u0434\\u043B\\u044F \\u043F\\u0435\\u0440\\u0435\\u0433\\u043E\\u0432\\u043E\\u0440\\u043E\\u0432 \\u043C\\u0435\\u0436\\u0434\\u0443 \\u043F\\u0440\\u0435\\u0434\\u0441\\u0442\\u0430\\u0432\\u0438\\u0442\\u0435\\u043B\\u044F\\u043C\\u0438 \\u0438\\u043D\\u0434\\u0443\\u0441\\u0442\\u0440\\u0438\\u0438. \\u0410\\u043D\\u0430\\u043B\\u043E\\u0433\\u0438\\u0447\\u043D\\u043E \\u0441\\u043E\\u0446\\u0438\\u0430\\u043B\\u044C\\u043D\\u043E\\u0439 \\u0441\\u0435\\u0442\\u0438 \\u043D\\u0430 \\u0441\\u0430\\u0439\\u0442\\u0435 \\u0435\\u0441\\u0442\\u044C \\u0432\\u043E\\u0437\\u043C\\u043E\\u0436\\u043D\\u043E\\u0441\\u0442\\u044C \\u0440\\u0435\\u0430\\u0433\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C \\u043D\\u0430 \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B, \\u043F\\u043E\\u0434\\u043F\\u0438\\u0441\\u044B\\u0432\\u0430\\u0442\\u044C\\u0441\\u044F \\u043D\\u0430 \\u0440\\u0430\\u0437\\u0440\\u0430\\u0431\\u043E\\u0442\\u0447\\u0438\\u043A\\u043E\\u0432 \\u0438 \\u0437\\u0430\\u043A\\u0430\\u0437\\u0447\\u0438\\u043A\\u043E\\u0432, \\u043E\\u0446\\u0435\\u043D\\u0438\\u0432\\u0430\\u0442\\u044C \\u0438\\u0445 \\u0430\\u043A\\u043A\\u0430\\u0443\\u043D\\u0442\\u044B \\u0438 \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B, \\u043E\\u0431\\u0449\\u0430\\u0442\\u044C\\u0441\\u044F \\u043C\\u0435\\u0436\\u0434\\u0443 \\u0441\\u043E\\u0431\\u043E\\u0439 \\u0438 \\u0434\\u0435\\u043B\\u0438\\u0442\\u044C\\u0441\\u044F \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0435\\u0439 \\u0440\\u0435\\u0441\\u0443\\u0440\\u0441\\u0430 \\u043D\\u0430 \\u043B\\u044E\\u0431\\u044B\\u0445 \\u0434\\u0440\\u0443\\u0433\\u0438\\u0445 \\u043F\\u043B\\u043E\\u0449\\u0430\\u0434\\u043A\\u0430\\u0445.\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: close\n  }, \"\\u0412\\u043F\\u0435\\u0440\\u0435\\u0434!\"), /*#__PURE__*/React.createElement(Divider, {\n    clear: true\n  }), /*#__PURE__*/React.createElement(GuideButton, {\n    onClick: () => {\n      close();\n      return router.push('/guide');\n    },\n    appearance: 'clear'\n  }, \"\\u0418\\u043D\\u0441\\u0442\\u0440\\u0443\\u043A\\u0446\\u0438\\u044F\"));\n};\n\n_s(Welcome, \"fN7XvhJ+p5oE6+Xlo0NJmXpxjC8=\", false, function () {\n  return [useRouter];\n});\n\n_c6 = Welcome;\n\nconst Mutator = ({\n  mutation,\n  variables,\n  callback\n}) => {\n  _s2();\n\n  const [action] = useMutation(mutation);\n  const dispatch = useDispatch();\n  useEffect(() => {\n    async function mutate() {\n      const response = await action({\n        variables\n      });\n      dispatch(setMutate(null, null));\n      if (callback) await callback(response);\n    }\n\n    mutate().then();\n  }, [action, dispatch, variables, callback]);\n  return null;\n};\n\n_s2(Mutator, \"rGjB3pDriqxpTrhehrYSxi1j93g=\", false, function () {\n  return [useMutation, useDispatch];\n});\n\n_c7 = Mutator;\nexport const MainLayout = ({\n  children\n}) => {\n  _s3();\n\n  const recall = useHelper();\n  const mutate = useMutate();\n  const router = useRouter();\n  const {\n    root,\n    user,\n    drawer,\n    snacks,\n    modal\n  } = useSelector(state => state);\n  const dispatch = useDispatch();\n  const [getUser, {\n    data,\n    loading\n  }] = useLazyQuery(queries.GET_USER);\n\n  const onDrawerBack = async () => {\n    await router.push({\n      pathname: router.pathname,\n      query: {}\n    }, undefined, {\n      shallow: true\n    });\n    dispatch(setDrawer(null));\n  };\n\n  const onModalHide = () => {\n    dispatch(setModal(null));\n  };\n\n  useEffect(() => {\n    if ((snacks === null || snacks === void 0 ? void 0 : snacks.length) > 0) {\n      setTimeout(() => dispatch(clearItems()), LIFETIME_OF_SNACK);\n    }\n  }, [snacks]);\n  useEffect(() => {\n    if (true) {\n      const token = localStorage.getItem(config.get('secret'));\n      if (token) getUser();\n    }\n  }, []);\n  useEffect(() => {\n    if (data && data.getUser) {\n      dispatch(setUser(data.getUser));\n    }\n  }, [data, dispatch]);\n  useEffect(() => {\n    if (user.authenticated && user.register) {\n      dispatch(setModal([{\n        path: '/',\n        title: 'Добро пожаловать!',\n        component: ({\n          close\n        }) => /*#__PURE__*/React.createElement(Welcome, {\n          close: close\n        })\n      }]));\n    }\n  }, [user, dispatch]);\n  useEffect(() => {\n    const query = router.query;\n\n    if (query.article) {\n      const id = b64DecodeUnicode(query.article);\n      recall(onArticleLink, {\n        id\n      })();\n    }\n\n    if (query.category) {\n      const id = b64DecodeUnicode(query.category);\n      recall(onCategoryLink, {\n        id\n      })();\n    }\n\n    if (query.project) {\n      var _user$projects;\n\n      const id = b64DecodeUnicode(query.project);\n      const owned = user === null || user === void 0 ? void 0 : (_user$projects = user.projects) === null || _user$projects === void 0 ? void 0 : _user$projects.find(candidate => candidate.id === id);\n      recall(onProjectLink, getProjectLinkProps(id, user, owned, dispatch, mutate, recall))();\n    }\n\n    if (query.role) {\n      const id = b64DecodeUnicode(query.role);\n      recall(onRoleLink, {\n        id\n      })();\n    }\n\n    if (query.user) {\n      const id = b64DecodeUnicode(query.user);\n      const owned = id === (user === null || user === void 0 ? void 0 : user.name);\n      recall(onUserLink, getUserLinkProps(id, user, owned))();\n    }\n\n    if (query.ticket) {\n      const id = b64DecodeUnicode(query.ticket);\n      recall(onTicketLink, {\n        id,\n        auth: user === null || user === void 0 ? void 0 : user.email\n      })();\n    }\n  }, [user, router]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Head, null, /*#__PURE__*/React.createElement(\"title\", null, \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\")), loading ? /*#__PURE__*/React.createElement(FixedLoader, null, /*#__PURE__*/React.createElement(Spinner, null)) : children, /*#__PURE__*/React.createElement(Drawer, {\n    key: drawer.history.length,\n    side: drawer.side,\n    half: drawer.half,\n    isOpen: drawer.open,\n    onBack: onDrawerBack\n  }, /*#__PURE__*/React.createElement(Container, null, /*#__PURE__*/React.createElement(Header, null, drawer.side === 'left' && drawer.half ? /*#__PURE__*/React.createElement(Button, {\n    appearance: 'clear',\n    onClick: () => router.push('/')\n  }, /*#__PURE__*/React.createElement(BrandLogo, {\n    src: '/images/logo.png',\n    alt: 'Logotype'\n  })) : /*#__PURE__*/React.createElement(BackButton, {\n    size: 's',\n    kind: 'icon',\n    onClick: onDrawerBack,\n    revert: true\n  }, /*#__PURE__*/React.createElement(Icon, {\n    icon: 'arrowLeft',\n    size: 's',\n    stroke: 'var(--default-color-accent)'\n  })), drawer.title && /*#__PURE__*/React.createElement(Difinition, {\n    color: drawer.color,\n    icon: drawer.icon,\n    text: drawer.title\n  })), drawer.title && /*#__PURE__*/React.createElement(Divider, {\n    clear: true\n  }), drawer.content)), /*#__PURE__*/React.createElement(Snacks, {\n    snacks: snacks,\n    onRemove: snack => dispatch(removeItem(snack.id))\n  }), /*#__PURE__*/React.createElement(Modal, {\n    size: modal === null || modal === void 0 ? void 0 : modal.size,\n    routes: modal === null || modal === void 0 ? void 0 : modal.routes,\n    onHide: onModalHide\n  }), root.mutation && /*#__PURE__*/React.createElement(Mutator, {\n    mutation: root.mutation,\n    variables: root.variables,\n    callback: root.callback\n  }));\n};\n\n_s3(MainLayout, \"1HwukkyLw7dZ1vZAcVT8G4QXahM=\", false, function () {\n  return [useHelper, useMutate, useRouter, useSelector, useDispatch, useLazyQuery];\n});\n\n_c8 = MainLayout;\nexport default MainLayout;\n\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8;\n\n$RefreshReg$(_c, \"Container\");\n$RefreshReg$(_c2, \"BrandLogo\");\n$RefreshReg$(_c3, \"Header\");\n$RefreshReg$(_c4, \"GuideButton\");\n$RefreshReg$(_c5, \"BackButton\");\n$RefreshReg$(_c6, \"Welcome\");\n$RefreshReg$(_c7, \"Mutator\");\n$RefreshReg$(_c8, \"MainLayout\");","map":{"version":3,"sources":["C:/Users/dan82/Documents/workspace/FREELANCE/atomic/atomic-frontend/layouts/main.js"],"names":["React","useEffect","Head","useRouter","styled","useSelector","useDispatch","useLazyQuery","useMutation","Row","Column","Snacks","Difinition","Spinner","Drawer","Button","Icon","Divider","Modal","Text","b64DecodeUnicode","useHelper","useMutate","FixedLoader","onProjectAdd","onProjectLink","removeItem","clearItems","setUser","updateUser","setDrawer","setModal","setMutate","onUserLink","onTicketLink","onArticleLink","onCategoryLink","onRoleLink","queries","config","LIFETIME_OF_SNACK","Container","BrandLogo","img","Header","GuideButton","BackButton","getProjectLinkProps","id","user","owned","dispatch","mutate","recall","auth","email","liked","likedProjects","find","item","onLike","LIKE_PROJECT","response","data","likeProject","onAdd","folders","mutations","addProject","ADD_USER_PROJECT","createFolder","ADD_USER_FOLDER","getUserLinkProps","userChats","GET_USER_CHATS","chat","GET_CHAT","addUserChat","ADD_USER_CHAT","sendMessage","SEND_MESSAGE","Welcome","close","router","padding","push","Mutator","mutation","variables","callback","action","then","MainLayout","children","root","drawer","snacks","modal","state","getUser","loading","GET_USER","onDrawerBack","pathname","query","undefined","shallow","onModalHide","length","setTimeout","token","localStorage","getItem","get","authenticated","register","path","title","component","article","category","project","projects","candidate","role","name","ticket","history","side","half","open","color","icon","content","snack","size","routes"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react'\nimport Head from 'next/head'\nimport { useRouter } from 'next/router'\nimport styled from 'styled-components'\nimport { useSelector, useDispatch } from 'react-redux'\nimport { useLazyQuery, useMutation } from '@apollo/react-hooks'\n\nimport Row from '../atomic-ui/components/Row'\nimport Column from '../atomic-ui/components/Column'\nimport Snacks from '../atomic-ui/components/Snacks'\nimport Difinition from '../atomic-ui/components/Difinition'\nimport Spinner from '../atomic-ui/components/Spinner'\nimport Drawer from '../atomic-ui/components/Drawer'\nimport Button from '../atomic-ui/components/Button'\nimport Icon from '../atomic-ui/components/Icon'\nimport Divider from '../atomic-ui/components/Divider'\nimport Modal from '../atomic-ui/components/Modal'\nimport Text from '../atomic-ui/components/Text'\nimport { b64DecodeUnicode } from '../../atomic-ui/utils/functions'\n\nimport { useHelper } from '../hooks/useHelper'\nimport { useMutate } from '../hooks/useMutate'\nimport { FixedLoader } from '../components/Styled'\nimport { onProjectAdd, onProjectLink } from '../store/helpers/project'\nimport { removeItem, clearItems } from '../store/actions/snacks'\nimport { setUser, updateUser } from '../store/actions/user'\nimport { setDrawer } from '../store/actions/drawer'\nimport { setModal } from '../store/actions/modal'\nimport { setMutate } from '../store/actions/root'\nimport { onUserLink } from '../store/helpers/user'\nimport { onTicketLink } from '../store/helpers/ticket'\nimport { onArticleLink } from '../store/helpers/article'\nimport { onCategoryLink } from '../store/helpers/category'\nimport { onRoleLink } from '../store/helpers/role'\nimport queries from '../graphql/queries'\nimport config from '../config'\n\nconst LIFETIME_OF_SNACK = 3000\n\nconst Container = styled(Column)`\n  height: 100%;\n  flex-grow: 1;\n\n  &.fade-enter {\n    opacity: 0;\n  }\n\n  &.fade-enter-active {\n    opacity: 1;\n    transition: opacity 100ms, blur 100ms;\n  }\n\n  &.fade-exit {\n    opacity: 1;\n  }\n\n  &.fade-exit-active {\n    opacity: 0;\n    transition: opacity 100ms, blur 100ms;\n  }\n`\n\nexport const BrandLogo = styled.img`\n  object-fit: contain;\n  width: 100%;\n  height: 100%;\n`\n\nconst Header = styled(Row)`\n  display: flex;\n  grid-gap: var(--default-gap);\n`\n\nconst GuideButton = styled(Button)`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: var(--default-color-accent);\n`\n\nconst BackButton = styled(Button)`\n  display: none;\n\n  @media only screen and (max-width: 480px) {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n`\n\nconst getProjectLinkProps = (id, user, owned, dispatch, mutate, recall) => ({\n  id,\n  auth: user?.email,\n  liked: !!(user?.likedProjects || []).find((item) => item.id === id),\n  onLike:\n    user.email &&\n    mutate(queries.LIKE_PROJECT, { id }, (response) =>\n      dispatch(updateUser(response.data.likeProject))\n    ),\n  onAdd:\n    user.email &&\n    recall(onProjectAdd, {\n      id,\n      folders: user?.folders,\n      mutations: {\n        addProject: queries.ADD_USER_PROJECT,\n        createFolder: queries.ADD_USER_FOLDER\n      }\n    }),\n  owned\n})\n\nconst getUserLinkProps = (id, user, owned) => ({\n  id,\n  auth: user?.email,\n  owned,\n  queries: {\n    userChats: queries.GET_USER_CHATS,\n    chat: queries.GET_CHAT\n  },\n  mutations: {\n    addUserChat: queries.ADD_USER_CHAT,\n    sendMessage: queries.SEND_MESSAGE\n  }\n})\n\nconst Welcome = ({ close }) => {\n  const router = useRouter()\n\n  return (\n    <Column style={{ padding: '15px' }}>\n      <Text>\n        Atomic - своеобразная площадка для переговоров между представителями индустрии. Аналогично\n        социальной сети на сайте есть возможность реагировать на проекты, подписываться на\n        разработчиков и заказчиков, оценивать их аккаунты и проекты, общаться между собой и делиться\n        информацией ресурса на любых других площадках.\n      </Text>\n      <Button onClick={close}>Вперед!</Button>\n      <Divider clear />\n      <GuideButton\n        onClick={() => {\n          close()\n          return router.push('/guide')\n        }}\n        appearance={'clear'}>\n        Инструкция\n      </GuideButton>\n    </Column>\n  )\n}\n\nconst Mutator = ({ mutation, variables, callback }) => {\n  const [action] = useMutation(mutation)\n  const dispatch = useDispatch()\n\n  useEffect(() => {\n    async function mutate() {\n      const response = await action({ variables })\n      dispatch(setMutate(null, null))\n      if (callback) await callback(response)\n    }\n    mutate().then()\n  }, [action, dispatch, variables, callback])\n\n  return null\n}\n\nexport const MainLayout = ({ children }) => {\n  const recall = useHelper()\n  const mutate = useMutate()\n  const router = useRouter()\n  const { root, user, drawer, snacks, modal } = useSelector((state) => state)\n  const dispatch = useDispatch()\n  const [getUser, { data, loading }] = useLazyQuery(queries.GET_USER)\n\n  const onDrawerBack = async () => {\n    await router.push(\n      {\n        pathname: router.pathname,\n        query: {}\n      },\n      undefined,\n      { shallow: true }\n    )\n    dispatch(setDrawer(null))\n  }\n\n  const onModalHide = () => {\n    dispatch(setModal(null))\n  }\n\n  useEffect(() => {\n    if (snacks?.length > 0) {\n      setTimeout(() => dispatch(clearItems()), LIFETIME_OF_SNACK)\n    }\n  }, [snacks])\n\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const token = localStorage.getItem(config.get('secret'))\n      if (token) getUser()\n    }\n  }, [])\n\n  useEffect(() => {\n    if (data && data.getUser) {\n      dispatch(setUser(data.getUser))\n    }\n  }, [data, dispatch])\n\n  useEffect(() => {\n    if (user.authenticated && user.register) {\n      dispatch(\n        setModal([\n          {\n            path: '/',\n            title: 'Добро пожаловать!',\n            component: ({ close }) => <Welcome close={close} />\n          }\n        ])\n      )\n    }\n  }, [user, dispatch])\n\n  useEffect(() => {\n    const query = router.query\n\n    if (query.article) {\n      const id = b64DecodeUnicode(query.article)\n      recall(onArticleLink, { id })()\n    }\n\n    if (query.category) {\n      const id = b64DecodeUnicode(query.category)\n      recall(onCategoryLink, { id })()\n    }\n\n    if (query.project) {\n      const id = b64DecodeUnicode(query.project)\n      const owned = user?.projects?.find((candidate) => candidate.id === id)\n      recall(onProjectLink, getProjectLinkProps(id, user, owned, dispatch, mutate, recall))()\n    }\n\n    if (query.role) {\n      const id = b64DecodeUnicode(query.role)\n      recall(onRoleLink, { id })()\n    }\n\n    if (query.user) {\n      const id = b64DecodeUnicode(query.user)\n      const owned = id === user?.name\n      recall(onUserLink, getUserLinkProps(id, user, owned))()\n    }\n\n    if (query.ticket) {\n      const id = b64DecodeUnicode(query.ticket)\n      recall(onTicketLink, { id, auth: user?.email })()\n    }\n  }, [user, router])\n\n  return (\n    <React.Fragment>\n      <Head>\n        <title>Загрузка...</title>\n      </Head>\n\n      {loading ? (\n        <FixedLoader>\n          <Spinner />\n        </FixedLoader>\n      ) : (\n        children\n      )}\n\n      <Drawer\n        key={drawer.history.length}\n        side={drawer.side}\n        half={drawer.half}\n        isOpen={drawer.open}\n        onBack={onDrawerBack}>\n        <Container>\n          <Header>\n            {drawer.side === 'left' && drawer.half ? (\n              <Button appearance={'clear'} onClick={() => router.push('/')}>\n                <BrandLogo src={'/images/logo.png'} alt={'Logotype'} />\n              </Button>\n            ) : (\n              <BackButton size={'s'} kind={'icon'} onClick={onDrawerBack} revert>\n                <Icon icon={'arrowLeft'} size={'s'} stroke={'var(--default-color-accent)'} />\n              </BackButton>\n            )}\n\n            {drawer.title && (\n              <Difinition color={drawer.color} icon={drawer.icon} text={drawer.title} />\n            )}\n          </Header>\n          {drawer.title && <Divider clear />}\n\n          {drawer.content}\n        </Container>\n      </Drawer>\n\n      <Snacks snacks={snacks} onRemove={(snack) => dispatch(removeItem(snack.id))} />\n      <Modal size={modal?.size} routes={modal?.routes} onHide={onModalHide} />\n\n      {root.mutation && (\n        <Mutator mutation={root.mutation} variables={root.variables} callback={root.callback} />\n      )}\n    </React.Fragment>\n  )\n}\n\nexport default MainLayout\n"]},"metadata":{},"sourceType":"module"}