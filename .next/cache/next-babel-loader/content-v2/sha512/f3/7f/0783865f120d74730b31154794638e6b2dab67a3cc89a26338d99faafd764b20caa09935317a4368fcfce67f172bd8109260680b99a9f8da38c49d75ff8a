{"ast":null,"code":"import React from 'react';\nimport { useRouter } from 'next/router';\nimport styled from 'styled-components';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { initializeApollo } from '../apollo';\nimport { useHelper } from '../hooks/useHelper';\nimport { useMutate } from '../hooks/useMutate';\nimport ProjectCard from '../components/ProjectCard';\nimport { updateUser } from '../store/actions/user';\nimport { onProjectLink, onProjectAdd, onProjectScreenshot } from '../store/helpers/project';\nimport { onUserAboutMore, onUserLink } from '../store/helpers/user';\nimport queries from '../graphql/queries';\nimport ContentLayout from '../layouts/content';\nconst TITLE = 'Проекты';\nconst START_OFFSET = 6;\nconst LIMIT = 6;\nconst Container = styled.aside.withConfig({\n  displayName: \"projects__Container\",\n  componentId: \"sc-3yxn9c-0\"\n})([\"display:grid;grid-template-columns:repeat(auto-fit,minmax(442px,1fr));grid-gap:var(--default-gap);@media only screen and (max-width:768px){grid-template-columns:repeat(auto-fit,minmax(285px,1fr));}\"]);\n\nconst Projects = ({\n  store\n}) => {\n  const recall = useHelper();\n  const mutate = useMutate();\n  const router = useRouter();\n  const user = useSelector(state => state.user);\n  const dispatch = useDispatch();\n  return /*#__PURE__*/React.createElement(ContentLayout, {\n    title: TITLE,\n    limit: LIMIT,\n    query: queries.GET_PROJECTS,\n    startOffset: START_OFFSET,\n    store: {\n      documents: store === null || store === void 0 ? void 0 : store.projects\n    }\n  }, ({\n    documents\n  }) => /*#__PURE__*/React.createElement(Container, null, documents.map(project => {\n    var _user$projects, _project$company;\n\n    const owned = user === null || user === void 0 ? void 0 : (_user$projects = user.projects) === null || _user$projects === void 0 ? void 0 : _user$projects.find(candidate => candidate.id === project.id);\n    if (project.category.id !== router.query.category) return null;\n    return /*#__PURE__*/React.createElement(ProjectCard, {\n      key: project.id,\n      project: project,\n      owned: owned,\n      liked: !!((user === null || user === void 0 ? void 0 : user.likedProjects) || []).find(item => item.id === project.id),\n      onLink: recall(onProjectLink, {\n        id: project.id,\n        auth: user,\n        owned\n      }),\n      onLike: (user === null || user === void 0 ? void 0 : user.email) && mutate(queries.LIKE_PROJECT, {\n        id: project.id\n      }, response => dispatch(updateUser(response.data.likeProject))),\n      onAdd: (user === null || user === void 0 ? void 0 : user.email) && recall(onProjectAdd, {\n        id: project.id\n      }),\n      onAboutMore: recall(onUserAboutMore, {\n        user: project\n      }),\n      onCompanyLink: recall(onUserLink, {\n        id: (_project$company = project.company) === null || _project$company === void 0 ? void 0 : _project$company.email,\n        auth: user === null || user === void 0 ? void 0 : user.email,\n        recipient: project.author,\n        query: queries.GET_USER_CHATS,\n        mutation: queries.SEND_MESSAGE\n      }),\n      onScreenshotClick: (_, key) => recall(onProjectScreenshot, {\n        screenshots: [project.preview, ...project.screenshots],\n        key\n      })()\n    });\n  })));\n};\n\nexport async function getServerSideProps() {\n  const client = initializeApollo();\n  let projects = [];\n  let categories = [];\n\n  try {\n    const response = await client.query({\n      query: queries.GET_META_PROJECTS,\n      variables: {\n        status: 'PUBLISHED'\n      }\n    });\n\n    if (response && response.data) {\n      projects = response.data.getProjects;\n      categories = response.data.getCategories;\n    }\n  } catch (err) {\n    console.log(err);\n  }\n\n  return {\n    props: {\n      store: {\n        projects,\n        categories\n      }\n    }\n  };\n}\nexport default Projects;","map":{"version":3,"sources":["C:/Users/dan82/Documents/workspace/FREELANCE/atomic/atomic-frontend/pages/projects.js"],"names":["React","useRouter","styled","useSelector","useDispatch","initializeApollo","useHelper","useMutate","ProjectCard","updateUser","onProjectLink","onProjectAdd","onProjectScreenshot","onUserAboutMore","onUserLink","queries","ContentLayout","TITLE","START_OFFSET","LIMIT","Container","aside","Projects","store","recall","mutate","router","user","state","dispatch","GET_PROJECTS","documents","projects","map","project","owned","find","candidate","id","category","query","likedProjects","item","auth","email","LIKE_PROJECT","response","data","likeProject","company","recipient","author","GET_USER_CHATS","mutation","SEND_MESSAGE","_","key","screenshots","preview","getServerSideProps","client","categories","GET_META_PROJECTS","variables","status","getProjects","getCategories","err","console","log","props"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,OAAOC,MAAP,MAAmB,mBAAnB;AACA,SAASC,WAAT,EAAsBC,WAAtB,QAAyC,aAAzC;AAEA,SAASC,gBAAT,QAAiC,WAAjC;AACA,SAASC,SAAT,QAA0B,oBAA1B;AACA,SAASC,SAAT,QAA0B,oBAA1B;AACA,OAAOC,WAAP,MAAwB,2BAAxB;AACA,SAASC,UAAT,QAA2B,uBAA3B;AACA,SAASC,aAAT,EAAwBC,YAAxB,EAAsCC,mBAAtC,QAAiE,0BAAjE;AACA,SAASC,eAAT,EAA0BC,UAA1B,QAA4C,uBAA5C;AACA,OAAOC,OAAP,MAAoB,oBAApB;AACA,OAAOC,aAAP,MAA0B,oBAA1B;AAEA,MAAMC,KAAK,GAAG,SAAd;AACA,MAAMC,YAAY,GAAG,CAArB;AACA,MAAMC,KAAK,GAAG,CAAd;AAEA,MAAMC,SAAS,GAAGlB,MAAM,CAACmB,KAAV;AAAA;AAAA;AAAA,6MAAf;;AAUA,MAAMC,QAAQ,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,KAAe;AAC9B,QAAMC,MAAM,GAAGlB,SAAS,EAAxB;AACA,QAAMmB,MAAM,GAAGlB,SAAS,EAAxB;AACA,QAAMmB,MAAM,GAAGzB,SAAS,EAAxB;AACA,QAAM0B,IAAI,GAAGxB,WAAW,CAAEyB,KAAD,IAAWA,KAAK,CAACD,IAAlB,CAAxB;AACA,QAAME,QAAQ,GAAGzB,WAAW,EAA5B;AAEA,sBACE,oBAAC,aAAD;AACE,IAAA,KAAK,EAAEa,KADT;AAEE,IAAA,KAAK,EAAEE,KAFT;AAGE,IAAA,KAAK,EAAEJ,OAAO,CAACe,YAHjB;AAIE,IAAA,WAAW,EAAEZ,YAJf;AAKE,IAAA,KAAK,EAAE;AAAEa,MAAAA,SAAS,EAAER,KAAF,aAAEA,KAAF,uBAAEA,KAAK,CAAES;AAApB;AALT,KAMG,CAAC;AAAED,IAAAA;AAAF,GAAD,kBACC,oBAAC,SAAD,QACGA,SAAS,CAACE,GAAV,CAAeC,OAAD,IAAa;AAAA;;AAC1B,UAAMC,KAAK,GAAGR,IAAH,aAAGA,IAAH,yCAAGA,IAAI,CAAEK,QAAT,mDAAG,eAAgBI,IAAhB,CAAsBC,SAAD,IAAeA,SAAS,CAACC,EAAV,KAAiBJ,OAAO,CAACI,EAA7D,CAAd;AAEA,QAAIJ,OAAO,CAACK,QAAR,CAAiBD,EAAjB,KAAwBZ,MAAM,CAACc,KAAP,CAAaD,QAAzC,EAAmD,OAAO,IAAP;AAEnD,wBACE,oBAAC,WAAD;AACE,MAAA,GAAG,EAAEL,OAAO,CAACI,EADf;AAEE,MAAA,OAAO,EAAEJ,OAFX;AAGE,MAAA,KAAK,EAAEC,KAHT;AAIE,MAAA,KAAK,EAAE,CAAC,CAAC,CAAC,CAAAR,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAEc,aAAN,KAAuB,EAAxB,EAA4BL,IAA5B,CAAkCM,IAAD,IAAUA,IAAI,CAACJ,EAAL,KAAYJ,OAAO,CAACI,EAA/D,CAJX;AAKE,MAAA,MAAM,EAAEd,MAAM,CAACd,aAAD,EAAgB;AAAE4B,QAAAA,EAAE,EAAEJ,OAAO,CAACI,EAAd;AAAkBK,QAAAA,IAAI,EAAEhB,IAAxB;AAA8BQ,QAAAA;AAA9B,OAAhB,CALhB;AAME,MAAA,MAAM,EACJ,CAAAR,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAEiB,KAAN,KACAnB,MAAM,CAACV,OAAO,CAAC8B,YAAT,EAAuB;AAAEP,QAAAA,EAAE,EAAEJ,OAAO,CAACI;AAAd,OAAvB,EAA4CQ,QAAD,IAC/CjB,QAAQ,CAACpB,UAAU,CAACqC,QAAQ,CAACC,IAAT,CAAcC,WAAf,CAAX,CADJ,CARV;AAYE,MAAA,KAAK,EAAE,CAAArB,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAEiB,KAAN,KAAepB,MAAM,CAACb,YAAD,EAAe;AAAE2B,QAAAA,EAAE,EAAEJ,OAAO,CAACI;AAAd,OAAf,CAZ9B;AAaE,MAAA,WAAW,EAAEd,MAAM,CAACX,eAAD,EAAkB;AAAEc,QAAAA,IAAI,EAAEO;AAAR,OAAlB,CAbrB;AAcE,MAAA,aAAa,EAAEV,MAAM,CAACV,UAAD,EAAa;AAChCwB,QAAAA,EAAE,sBAAEJ,OAAO,CAACe,OAAV,qDAAE,iBAAiBL,KADW;AAEhCD,QAAAA,IAAI,EAAEhB,IAAF,aAAEA,IAAF,uBAAEA,IAAI,CAAEiB,KAFoB;AAGhCM,QAAAA,SAAS,EAAEhB,OAAO,CAACiB,MAHa;AAIhCX,QAAAA,KAAK,EAAEzB,OAAO,CAACqC,cAJiB;AAKhCC,QAAAA,QAAQ,EAAEtC,OAAO,CAACuC;AALc,OAAb,CAdvB;AAqBE,MAAA,iBAAiB,EAAE,CAACC,CAAD,EAAIC,GAAJ,KACjBhC,MAAM,CAACZ,mBAAD,EAAsB;AAC1B6C,QAAAA,WAAW,EAAE,CAACvB,OAAO,CAACwB,OAAT,EAAkB,GAAGxB,OAAO,CAACuB,WAA7B,CADa;AAE1BD,QAAAA;AAF0B,OAAtB,CAAN;AAtBJ,MADF;AA8BD,GAnCA,CADH,CAPJ,CADF;AAiDD,CAxDD;;AA0DA,OAAO,eAAeG,kBAAf,GAAoC;AACzC,QAAMC,MAAM,GAAGvD,gBAAgB,EAA/B;AAEA,MAAI2B,QAAQ,GAAG,EAAf;AACA,MAAI6B,UAAU,GAAG,EAAjB;;AAEA,MAAI;AACF,UAAMf,QAAQ,GAAG,MAAMc,MAAM,CAACpB,KAAP,CAAa;AAClCA,MAAAA,KAAK,EAAEzB,OAAO,CAAC+C,iBADmB;AAElCC,MAAAA,SAAS,EAAE;AACTC,QAAAA,MAAM,EAAE;AADC;AAFuB,KAAb,CAAvB;;AAOA,QAAIlB,QAAQ,IAAIA,QAAQ,CAACC,IAAzB,EAA+B;AAC7Bf,MAAAA,QAAQ,GAAGc,QAAQ,CAACC,IAAT,CAAckB,WAAzB;AACAJ,MAAAA,UAAU,GAAGf,QAAQ,CAACC,IAAT,CAAcmB,aAA3B;AACD;AACF,GAZD,CAYE,OAAOC,GAAP,EAAY;AACZC,IAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD;;AAED,SAAO;AACLG,IAAAA,KAAK,EAAE;AACL/C,MAAAA,KAAK,EAAE;AACLS,QAAAA,QADK;AAEL6B,QAAAA;AAFK;AADF;AADF,GAAP;AAQD;AAED,eAAevC,QAAf","sourcesContent":["import React from 'react'\nimport { useRouter } from 'next/router'\nimport styled from 'styled-components'\nimport { useSelector, useDispatch } from 'react-redux'\n\nimport { initializeApollo } from '../apollo'\nimport { useHelper } from '../hooks/useHelper'\nimport { useMutate } from '../hooks/useMutate'\nimport ProjectCard from '../components/ProjectCard'\nimport { updateUser } from '../store/actions/user'\nimport { onProjectLink, onProjectAdd, onProjectScreenshot } from '../store/helpers/project'\nimport { onUserAboutMore, onUserLink } from '../store/helpers/user'\nimport queries from '../graphql/queries'\nimport ContentLayout from '../layouts/content'\n\nconst TITLE = 'Проекты'\nconst START_OFFSET = 6\nconst LIMIT = 6\n\nconst Container = styled.aside`\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(442px, 1fr));\n  grid-gap: var(--default-gap);\n\n  @media only screen and (max-width: 768px) {\n    grid-template-columns: repeat(auto-fit, minmax(285px, 1fr));\n  }\n`\n\nconst Projects = ({ store }) => {\n  const recall = useHelper()\n  const mutate = useMutate()\n  const router = useRouter()\n  const user = useSelector((state) => state.user)\n  const dispatch = useDispatch()\n\n  return (\n    <ContentLayout\n      title={TITLE}\n      limit={LIMIT}\n      query={queries.GET_PROJECTS}\n      startOffset={START_OFFSET}\n      store={{ documents: store?.projects }}>\n      {({ documents }) => (\n        <Container>\n          {documents.map((project) => {\n            const owned = user?.projects?.find((candidate) => candidate.id === project.id)\n\n            if (project.category.id !== router.query.category) return null\n\n            return (\n              <ProjectCard\n                key={project.id}\n                project={project}\n                owned={owned}\n                liked={!!(user?.likedProjects || []).find((item) => item.id === project.id)}\n                onLink={recall(onProjectLink, { id: project.id, auth: user, owned })}\n                onLike={\n                  user?.email &&\n                  mutate(queries.LIKE_PROJECT, { id: project.id }, (response) =>\n                    dispatch(updateUser(response.data.likeProject))\n                  )\n                }\n                onAdd={user?.email && recall(onProjectAdd, { id: project.id })}\n                onAboutMore={recall(onUserAboutMore, { user: project })}\n                onCompanyLink={recall(onUserLink, {\n                  id: project.company?.email,\n                  auth: user?.email,\n                  recipient: project.author,\n                  query: queries.GET_USER_CHATS,\n                  mutation: queries.SEND_MESSAGE\n                })}\n                onScreenshotClick={(_, key) =>\n                  recall(onProjectScreenshot, {\n                    screenshots: [project.preview, ...project.screenshots],\n                    key\n                  })()\n                }\n              />\n            )\n          })}\n        </Container>\n      )}\n    </ContentLayout>\n  )\n}\n\nexport async function getServerSideProps() {\n  const client = initializeApollo()\n\n  let projects = []\n  let categories = []\n\n  try {\n    const response = await client.query({\n      query: queries.GET_META_PROJECTS,\n      variables: {\n        status: 'PUBLISHED'\n      }\n    })\n\n    if (response && response.data) {\n      projects = response.data.getProjects\n      categories = response.data.getCategories\n    }\n  } catch (err) {\n    console.log(err)\n  }\n\n  return {\n    props: {\n      store: {\n        projects,\n        categories\n      }\n    }\n  }\n}\n\nexport default Projects\n"]},"metadata":{},"sourceType":"module"}