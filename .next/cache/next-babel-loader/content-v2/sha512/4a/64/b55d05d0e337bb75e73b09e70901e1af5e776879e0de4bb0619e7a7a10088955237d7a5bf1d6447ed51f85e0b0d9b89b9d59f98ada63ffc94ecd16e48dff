{"ast":null,"code":"import { useEffect } from 'react';\nimport { useRouter } from 'next/router';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { b64DecodeUnicode, b64EncodeUnicode } from '../atomic-ui/utils/functions';\nimport { useHelper } from './useHelper';\nimport { useMutate } from './useMutate';\nimport { onArticleLink } from '../store/helpers/article';\nimport { onCategoryLink } from '../store/helpers/category';\nimport { onProjectAdd, onProjectLink } from '../store/helpers/project';\nimport { onRoleLink } from '../store/helpers/role';\nimport { onUserLink } from '../store/helpers/user';\nimport { onTicketLink } from '../store/helpers/ticket';\nimport { updateUser } from '../store/actions/user';\nimport queries from '../graphql/queries';\nimport { setItem } from \"../store/actions/snacks\";\nexport const getProjectLinkProps = (id, user, owned, dispatch, mutate, recall, callback) => ({\n  id,\n  auth: user === null || user === void 0 ? void 0 : user.email,\n  liked: !!((user === null || user === void 0 ? void 0 : user.likedProjects) || []).find(item => item.id === id),\n  onLike: user.email && mutate(queries.LIKE_PROJECT, {\n    id\n  }, response => dispatch(updateUser(response.data.likeProject))),\n  onAdd: user.email && recall(onProjectAdd, {\n    id,\n    folders: user === null || user === void 0 ? void 0 : user.folders,\n    mutations: {\n      addProject: queries.ADD_USER_PROJECT,\n      createFolder: queries.ADD_USER_FOLDER\n    },\n    callback\n  }),\n  owned\n});\nexport const getUserLinkProps = (id, user, owned) => ({\n  id,\n  auth: user === null || user === void 0 ? void 0 : user.email,\n  owned,\n  queries: {\n    userChats: queries.GET_USER_CHATS,\n    chat: queries.GET_CHAT\n  },\n  mutations: {\n    addUserChat: queries.ADD_USER_CHAT,\n    sendMessage: queries.SEND_MESSAGE\n  }\n});\nexport const invokeRecall = (recall, mutate, user, dispatch, query) => {\n  const getMalformed = parameter => {\n    try {\n      if (parameter) {\n        return b64DecodeUnicode(parameter);\n      }\n    } catch (_unused) {\n      dispatch(setItem({\n        type: 'error',\n        message: 'Неправильный URL'\n      }));\n    }\n\n    return null;\n  };\n\n  if (query.article) {\n    const id = b64DecodeUnicode(query.article);\n    recall(onArticleLink, {\n      id\n    })();\n  }\n\n  if (query.category) {\n    const id = b64DecodeUnicode(query.category);\n    recall(onCategoryLink, {\n      id\n    })();\n  }\n\n  if (query.project) {\n    var _user$projects;\n\n    const id = b64DecodeUnicode(query.project);\n    const owned = user === null || user === void 0 ? void 0 : (_user$projects = user.projects) === null || _user$projects === void 0 ? void 0 : _user$projects.find(candidate => candidate.id === id);\n    recall(onProjectLink, getProjectLinkProps(id, user, owned, dispatch, mutate, recall))();\n  }\n\n  if (query.role) {\n    const id = b64DecodeUnicode(query.role);\n    recall(onRoleLink, {\n      id\n    })();\n  }\n\n  if (query.user) {\n    const id = b64DecodeUnicode(query.user);\n    const owned = id === (user === null || user === void 0 ? void 0 : user.name);\n    recall(onUserLink, getUserLinkProps(id, user, owned))();\n  }\n\n  if (query.ticket) {\n    const id = b64DecodeUnicode(query.ticket);\n    recall(onTicketLink, {\n      id,\n      auth: user === null || user === void 0 ? void 0 : user.email\n    })();\n  }\n};\nexport const useEntityQuery = () => {\n  const recall = useHelper();\n  const mutate = useMutate();\n  const router = useRouter();\n  const user = useSelector(state => state.user);\n  const dispatch = useDispatch();\n\n  const setQuery = async (str, entity, callback) => {\n    await router.push({\n      pathname: router.pathname,\n      query: {\n        [entity]: b64EncodeUnicode(str)\n      }\n    }, undefined, {\n      shallow: true\n    });\n    if (callback) callback(str);\n  };\n\n  const useDetectQuery = () => {\n    useEffect(() => {\n      const query = router.query;\n\n      if (Object.entries(query).length === 1) {\n        invokeRecall(recall, mutate, user, dispatch, query);\n      }\n    }, [router]);\n  };\n\n  return {\n    setQuery,\n    useDetectQuery\n  };\n};\nexport default useEntityQuery;","map":{"version":3,"sources":["D:/Documents/Workspace/FREELANCE/atomic/atomic-frontend/hooks/useEntityQuery.js"],"names":["useEffect","useRouter","useDispatch","useSelector","b64DecodeUnicode","b64EncodeUnicode","useHelper","useMutate","onArticleLink","onCategoryLink","onProjectAdd","onProjectLink","onRoleLink","onUserLink","onTicketLink","updateUser","queries","setItem","getProjectLinkProps","id","user","owned","dispatch","mutate","recall","callback","auth","email","liked","likedProjects","find","item","onLike","LIKE_PROJECT","response","data","likeProject","onAdd","folders","mutations","addProject","ADD_USER_PROJECT","createFolder","ADD_USER_FOLDER","getUserLinkProps","userChats","GET_USER_CHATS","chat","GET_CHAT","addUserChat","ADD_USER_CHAT","sendMessage","SEND_MESSAGE","invokeRecall","query","getMalformed","parameter","type","message","article","category","project","projects","candidate","role","name","ticket","useEntityQuery","router","state","setQuery","str","entity","push","pathname","undefined","shallow","useDetectQuery","Object","entries","length"],"mappings":"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","sourcesContent":["import { useEffect } from 'react'\nimport { useRouter } from 'next/router'\nimport { useDispatch, useSelector } from 'react-redux'\n\nimport { b64DecodeUnicode, b64EncodeUnicode } from '../atomic-ui/utils/functions'\n\nimport { useHelper } from './useHelper'\nimport { useMutate } from './useMutate'\nimport { onArticleLink } from '../store/helpers/article'\nimport { onCategoryLink } from '../store/helpers/category'\nimport { onProjectAdd, onProjectLink } from '../store/helpers/project'\nimport { onRoleLink } from '../store/helpers/role'\nimport { onUserLink } from '../store/helpers/user'\nimport { onTicketLink } from '../store/helpers/ticket'\nimport { updateUser } from '../store/actions/user'\nimport queries from '../graphql/queries'\nimport {setItem} from \"../store/actions/snacks\";\n\nexport const getProjectLinkProps = (id, user, owned, dispatch, mutate, recall, callback) => ({\n  id,\n  auth: user?.email,\n  liked: !!(user?.likedProjects || []).find((item) => item.id === id),\n  onLike:\n    user.email &&\n    mutate(queries.LIKE_PROJECT, { id }, (response) =>\n      dispatch(updateUser(response.data.likeProject))\n    ),\n  onAdd:\n    user.email &&\n    recall(onProjectAdd, {\n      id,\n      folders: user?.folders,\n      mutations: {\n        addProject: queries.ADD_USER_PROJECT,\n        createFolder: queries.ADD_USER_FOLDER\n      },\n      callback\n    }),\n  owned\n})\n\nexport const getUserLinkProps = (id, user, owned) => ({\n  id,\n  auth: user?.email,\n  owned,\n  queries: {\n    userChats: queries.GET_USER_CHATS,\n    chat: queries.GET_CHAT\n  },\n  mutations: {\n    addUserChat: queries.ADD_USER_CHAT,\n    sendMessage: queries.SEND_MESSAGE\n  }\n})\n\nexport const invokeRecall = (recall, mutate, user, dispatch, query) => {\n  const getMalformed = (parameter) => {\n    try {\n      if (parameter) {\n        return b64DecodeUnicode(parameter)\n      }\n    }\n    catch {\n      dispatch(\n       setItem({\n         type: 'error',\n         message: 'Неправильный URL'\n       })\n      )\n    }\n    return null\n  }\n\n  if (query.article) {\n    const id = b64DecodeUnicode(query.article)\n    recall(onArticleLink, { id })()\n  }\n\n  if (query.category) {\n    const id = b64DecodeUnicode(query.category)\n    recall(onCategoryLink, { id })()\n  }\n\n  if (query.project) {\n    const id = b64DecodeUnicode(query.project)\n    const owned = user?.projects?.find((candidate) => candidate.id === id)\n    recall(onProjectLink, getProjectLinkProps(id, user, owned, dispatch, mutate, recall))()\n  }\n\n  if (query.role) {\n    const id = b64DecodeUnicode(query.role)\n    recall(onRoleLink, { id })()\n  }\n\n  if (query.user) {\n    const id = b64DecodeUnicode(query.user)\n    const owned = id === user?.name\n    recall(onUserLink, getUserLinkProps(id, user, owned))()\n  }\n\n  if (query.ticket) {\n    const id = b64DecodeUnicode(query.ticket)\n    recall(onTicketLink, { id, auth: user?.email })()\n  }\n}\n\nexport const useEntityQuery = () => {\n  const recall = useHelper()\n  const mutate = useMutate()\n  const router = useRouter()\n\n  const user = useSelector((state) => state.user)\n  const dispatch = useDispatch()\n\n  const setQuery = async (str, entity, callback) => {\n    await router.push(\n      {\n        pathname: router.pathname,\n        query: {\n          [entity]: b64EncodeUnicode(str)\n        }\n      },\n      undefined,\n      { shallow: true }\n    )\n    if (callback) callback(str)\n  }\n\n  const useDetectQuery = () => {\n    useEffect(() => {\n      const query = router.query\n      if (Object.entries(query).length === 1) {\n        invokeRecall(recall, mutate, user, dispatch, query)\n      }\n    }, [router])\n  }\n\n  return { setQuery, useDetectQuery }\n}\n\nexport default useEntityQuery\n"]},"metadata":{},"sourceType":"module"}