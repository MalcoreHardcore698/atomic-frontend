{"ast":null,"code":"import React, { useEffect } from 'react';\nimport Head from 'next/head';\nimport { useRouter } from 'next/router';\nimport styled from 'styled-components';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useLazyQuery, useMutation } from '@apollo/react-hooks';\nimport Row from '../atomic-ui/components/Row';\nimport Column from '../atomic-ui/components/Column';\nimport Snacks from '../atomic-ui/components/Snacks';\nimport Difinition from '../atomic-ui/components/Difinition';\nimport Spinner from '../atomic-ui/components/Spinner';\nimport Drawer from '../atomic-ui/components/Drawer';\nimport Button from '../atomic-ui/components/Button';\nimport Icon from '../atomic-ui/components/Icon';\nimport Divider from '../atomic-ui/components/Divider';\nimport Modal from '../atomic-ui/components/Modal';\nimport Text from '../atomic-ui/components/Text';\nimport { FixedLoader } from '../components/Styled';\nimport { removeItem, clearItems } from '../store/actions/snacks';\nimport { setUser } from '../store/actions/user';\nimport { setDrawer } from '../store/actions/drawer';\nimport { setModal } from '../store/actions/modal';\nimport { setMutate } from '../store/actions/root';\nimport queries from '../graphql/queries';\nimport config from '../config';\nimport useEntityQuery from '../hooks/useEntityQuery';\nconst LIFETIME_OF_SNACK = 3000;\nconst Container = styled(Column).withConfig({\n  displayName: \"main__Container\",\n  componentId: \"r90a11-0\"\n})([\"height:100%;flex-grow:1;&.fade-enter{opacity:0;}&.fade-enter-active{opacity:1;transition:opacity 100ms,blur 100ms;}&.fade-exit{opacity:1;}&.fade-exit-active{opacity:0;transition:opacity 100ms,blur 100ms;}\"]);\nexport const BrandLogo = styled.img.withConfig({\n  displayName: \"main__BrandLogo\",\n  componentId: \"r90a11-1\"\n})([\"object-fit:contain;width:100%;height:100%;\"]);\nconst Header = styled(Row).withConfig({\n  displayName: \"main__Header\",\n  componentId: \"r90a11-2\"\n})([\"display:flex;grid-gap:var(--default-gap);\"]);\nconst GuideButton = styled(Button).withConfig({\n  displayName: \"main__GuideButton\",\n  componentId: \"r90a11-3\"\n})([\"display:flex;justify-content:center;align-items:center;color:var(--default-color-accent);\"]);\nconst BackButton = styled(Button).withConfig({\n  displayName: \"main__BackButton\",\n  componentId: \"r90a11-4\"\n})([\"display:none;@media only screen and (max-width:480px){display:flex;justify-content:center;align-items:center;}\"]);\n\nconst Welcome = ({\n  close\n}) => {\n  const router = useRouter();\n  return /*#__PURE__*/React.createElement(Column, {\n    style: {\n      padding: '15px'\n    }\n  }, /*#__PURE__*/React.createElement(Text, null, \"Atomic - \\u0441\\u0432\\u043E\\u0435\\u043E\\u0431\\u0440\\u0430\\u0437\\u043D\\u0430\\u044F \\u043F\\u043B\\u043E\\u0449\\u0430\\u0434\\u043A\\u0430 \\u0434\\u043B\\u044F \\u043F\\u0435\\u0440\\u0435\\u0433\\u043E\\u0432\\u043E\\u0440\\u043E\\u0432 \\u043C\\u0435\\u0436\\u0434\\u0443 \\u043F\\u0440\\u0435\\u0434\\u0441\\u0442\\u0430\\u0432\\u0438\\u0442\\u0435\\u043B\\u044F\\u043C\\u0438 \\u0438\\u043D\\u0434\\u0443\\u0441\\u0442\\u0440\\u0438\\u0438. \\u0410\\u043D\\u0430\\u043B\\u043E\\u0433\\u0438\\u0447\\u043D\\u043E \\u0441\\u043E\\u0446\\u0438\\u0430\\u043B\\u044C\\u043D\\u043E\\u0439 \\u0441\\u0435\\u0442\\u0438 \\u043D\\u0430 \\u0441\\u0430\\u0439\\u0442\\u0435 \\u0435\\u0441\\u0442\\u044C \\u0432\\u043E\\u0437\\u043C\\u043E\\u0436\\u043D\\u043E\\u0441\\u0442\\u044C \\u0440\\u0435\\u0430\\u0433\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C \\u043D\\u0430 \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B, \\u043F\\u043E\\u0434\\u043F\\u0438\\u0441\\u044B\\u0432\\u0430\\u0442\\u044C\\u0441\\u044F \\u043D\\u0430 \\u0440\\u0430\\u0437\\u0440\\u0430\\u0431\\u043E\\u0442\\u0447\\u0438\\u043A\\u043E\\u0432 \\u0438 \\u0437\\u0430\\u043A\\u0430\\u0437\\u0447\\u0438\\u043A\\u043E\\u0432, \\u043E\\u0446\\u0435\\u043D\\u0438\\u0432\\u0430\\u0442\\u044C \\u0438\\u0445 \\u0430\\u043A\\u043A\\u0430\\u0443\\u043D\\u0442\\u044B \\u0438 \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B, \\u043E\\u0431\\u0449\\u0430\\u0442\\u044C\\u0441\\u044F \\u043C\\u0435\\u0436\\u0434\\u0443 \\u0441\\u043E\\u0431\\u043E\\u0439 \\u0438 \\u0434\\u0435\\u043B\\u0438\\u0442\\u044C\\u0441\\u044F \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0435\\u0439 \\u0440\\u0435\\u0441\\u0443\\u0440\\u0441\\u0430 \\u043D\\u0430 \\u043B\\u044E\\u0431\\u044B\\u0445 \\u0434\\u0440\\u0443\\u0433\\u0438\\u0445 \\u043F\\u043B\\u043E\\u0449\\u0430\\u0434\\u043A\\u0430\\u0445.\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: close\n  }, \"\\u0412\\u043F\\u0435\\u0440\\u0435\\u0434!\"), /*#__PURE__*/React.createElement(Divider, {\n    clear: true\n  }), /*#__PURE__*/React.createElement(GuideButton, {\n    onClick: () => {\n      close();\n      return router.push('/guide');\n    },\n    appearance: 'clear'\n  }, \"\\u0418\\u043D\\u0441\\u0442\\u0440\\u0443\\u043A\\u0446\\u0438\\u044F\"));\n};\n\nconst Mutator = ({\n  mutation,\n  variables,\n  callback\n}) => {\n  const [action] = useMutation(mutation);\n  const dispatch = useDispatch();\n  useEffect(() => {\n    async function mutate() {\n      const response = await action({\n        variables\n      });\n      dispatch(setMutate(null, null));\n      if (callback) await callback(response);\n    }\n\n    mutate().then();\n  }, [action, dispatch, variables, callback]);\n  return null;\n};\n\nexport const MainLayout = ({\n  children\n}) => {\n  const router = useRouter();\n  const {\n    useDetectQuery\n  } = useEntityQuery();\n  const [getUser, {\n    data,\n    loading\n  }] = useLazyQuery(queries.GET_USER);\n  const {\n    root,\n    user,\n    drawer,\n    snacks,\n    modal\n  } = useSelector(state => state);\n  const dispatch = useDispatch();\n\n  const onDrawerBack = async () => {\n    await router.push({\n      pathname: router.pathname,\n      query: {}\n    }, undefined, {\n      shallow: true\n    });\n    dispatch(setDrawer(null));\n  };\n\n  const onModalHide = () => {\n    dispatch(setModal(null));\n  };\n\n  useEffect(() => {\n    if ((snacks === null || snacks === void 0 ? void 0 : snacks.length) > 0) {\n      setTimeout(() => dispatch(clearItems()), LIFETIME_OF_SNACK);\n    }\n  }, [snacks]);\n  useEffect(() => {\n    if (true) {\n      const token = localStorage.getItem(config.get('secret'));\n      if (token) getUser();\n    }\n  }, []);\n  useEffect(() => {\n    if (data && data.getUser) {\n      dispatch(setUser(data.getUser));\n    }\n  }, [data, dispatch]);\n  useEffect(() => {\n    if (user.authenticated && user.register) {\n      dispatch(setModal([{\n        path: '/',\n        title: 'Добро пожаловать!',\n        component: ({\n          close\n        }) => /*#__PURE__*/React.createElement(Welcome, {\n          close: close\n        })\n      }]));\n    }\n  }, [user, dispatch]);\n  useDetectQuery();\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Head, null, /*#__PURE__*/React.createElement(\"title\", null, \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\")), loading ? /*#__PURE__*/React.createElement(FixedLoader, null, /*#__PURE__*/React.createElement(Spinner, null)) : children, /*#__PURE__*/React.createElement(Drawer, {\n    key: drawer.history.length,\n    side: drawer.side,\n    half: drawer.half,\n    isOpen: drawer.open,\n    onBack: onDrawerBack\n  }, /*#__PURE__*/React.createElement(Container, null, /*#__PURE__*/React.createElement(Header, null, drawer.side === 'left' && drawer.half ? /*#__PURE__*/React.createElement(Button, {\n    appearance: 'clear',\n    onClick: () => router.push('/')\n  }, /*#__PURE__*/React.createElement(BrandLogo, {\n    src: '/images/logo.png',\n    alt: 'Logotype'\n  })) : /*#__PURE__*/React.createElement(BackButton, {\n    size: 's',\n    kind: 'icon',\n    onClick: onDrawerBack,\n    revert: true\n  }, /*#__PURE__*/React.createElement(Icon, {\n    icon: 'arrowLeft',\n    size: 's',\n    stroke: 'var(--default-color-accent)'\n  })), drawer.title && /*#__PURE__*/React.createElement(Difinition, {\n    color: drawer.color,\n    icon: drawer.icon,\n    text: drawer.title\n  })), drawer.title && /*#__PURE__*/React.createElement(Divider, {\n    clear: true\n  }), drawer.content)), /*#__PURE__*/React.createElement(Snacks, {\n    snacks: snacks,\n    onRemove: snack => dispatch(removeItem(snack.id))\n  }), /*#__PURE__*/React.createElement(Modal, {\n    size: modal === null || modal === void 0 ? void 0 : modal.size,\n    routes: modal === null || modal === void 0 ? void 0 : modal.routes,\n    onHide: onModalHide\n  }), root.mutation && /*#__PURE__*/React.createElement(Mutator, {\n    mutation: root.mutation,\n    variables: root.variables,\n    callback: root.callback\n  }));\n};\nexport default MainLayout;","map":null,"metadata":{},"sourceType":"module"}