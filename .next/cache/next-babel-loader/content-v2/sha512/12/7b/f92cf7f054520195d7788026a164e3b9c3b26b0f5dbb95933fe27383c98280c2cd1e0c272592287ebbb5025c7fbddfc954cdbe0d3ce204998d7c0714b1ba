{"ast":null,"code":"import React, { useCallback, useMemo } from 'react';\nimport { Controller, useForm } from 'react-hook-form';\nimport { useSelector } from 'react-redux';\nimport styled from 'styled-components';\nimport Column from '../../atomic-ui/components/Column';\nimport Row from '../../atomic-ui/components/Row';\nimport Switch from '../../atomic-ui/components/Switch';\nimport Divider from '../../atomic-ui/components/Divider';\nimport Transition from '../../atomic-ui/components/Transition';\nimport DatePicker from '../../atomic-ui/components/DatePicker';\nimport { useSearch } from '../../hooks/useSearch';\nimport AsyncSelect from '../AsyncSelect';\nexport const Wrap = styled(Column).withConfig({\n  displayName: \"FilterBar__Wrap\",\n  componentId: \"sc-1lvfs1u-0\"\n})([\"width:100%;&.fade-enter{opacity:0;}&.fade-enter-active{opacity:1;transition:opacity 100ms,blur 100ms;}&.fade-exit{opacity:1;}&.fade-exit-active{opacity:0;transition:opacity 100ms,blur 100ms;}\"]);\nexport const Form = styled.form.withConfig({\n  displayName: \"FilterBar__Form\",\n  componentId: \"sc-1lvfs1u-1\"\n})([\"display:flex;flex-direction:column;grid-gap:var(--default-gap);width:100%;\"]);\nexport const List = styled(Row).withConfig({\n  displayName: \"FilterBar__List\",\n  componentId: \"sc-1lvfs1u-2\"\n})([\"display:grid;grid-template-columns:repeat(auto-fit,minmax(256px,1fr));@media only screen and (max-width:480px){grid-gap:var(--default-gap);}\"]);\nexport const parseToParams = params => {\n  const getValue = value => {\n    if (value instanceof Date) {\n      return value.getTime().toString();\n    }\n\n    if (Array.isArray(value)) {\n      return value.map(selectValue => selectValue.value);\n    }\n\n    return (value === null || value === void 0 ? void 0 : value.value) || value;\n  };\n\n  return Object.entries(params).filter(([_, value]) => value).reduce((acc, [key, value]) => ({ ...acc,\n    [key]: getValue(value)\n  }), {});\n};\nexport const Filter = ({\n  isOpen = true,\n  duration,\n  sort,\n  filter\n}) => {\n  const {\n    search,\n    params\n  } = useSelector(state => ({\n    search: state.root.search,\n    params: state.root.params\n  }));\n  const {\n    control,\n    getValues\n  } = useForm();\n  const [onSearch] = useSearch();\n  const decorate = useCallback(callback => value => {\n    if (callback) callback(value);\n    onSearch(search, parseToParams(getValues()));\n  }, [search, getValues, onSearch]);\n  const filters = useMemo(() => (filter || []).map(item => {\n    switch (item.type) {\n      case 'DATEPICKER':\n        return /*#__PURE__*/React.createElement(Controller, {\n          key: item.name,\n          control: control,\n          name: item.name,\n          defaultValue: getValues(item.name) || params && params[(item === null || item === void 0 ? void 0 : item.name) || ''] || null,\n          render: ({\n            value,\n            onChange\n          }) => /*#__PURE__*/React.createElement(DatePicker, {\n            defaultValue: value,\n            placeholder: item.label,\n            onChange: decorate(onChange),\n            withNavigate: true\n          })\n        });\n\n      case 'SELECT':\n        return /*#__PURE__*/React.createElement(Controller, {\n          key: item.name,\n          control: control,\n          name: item.name,\n          defaultValue: getValues(item.name) || null,\n          render: ({\n            value,\n            onChange\n          }) => /*#__PURE__*/React.createElement(AsyncSelect, {\n            name: item.name,\n            query: item.query,\n            defaultValue: value,\n            type: item.queryType,\n            placeholder: item.label,\n            variables: item.variables,\n            selectValueField: item.selectValueField,\n            selectLabelField: item.selectLabelField,\n            selectRestrictions: item.selectRestrictions,\n            selectLabelDecorator: item.selectLabelDecorator,\n            onChange: decorate(onChange)\n          })\n        });\n\n      case 'MULTISELECT':\n        return /*#__PURE__*/React.createElement(Controller, {\n          key: item.name,\n          control: control,\n          name: item.name,\n          defaultValue: getValues(item.name) || null,\n          render: ({\n            value,\n            onChange\n          }) => /*#__PURE__*/React.createElement(AsyncSelect, {\n            name: item.name,\n            query: item.query,\n            defaultValue: value,\n            type: item.queryType,\n            placeholder: item.label,\n            variables: item.variables,\n            selectValueField: item.selectValueField,\n            selectLabelField: item.selectLabelField,\n            selectRestrictions: item.selectRestrictions,\n            selectLabelDecorator: item.selectLabelDecorator,\n            onChange: decorate(onChange),\n            isMulti: true\n          })\n        });\n\n      default:\n        return null;\n    }\n  }), [params, control, filter, decorate, getValues]);\n  const options = useMemo(() => sort || [], [sort]);\n  return /*#__PURE__*/React.createElement(Transition, {\n    in: isOpen,\n    animation: 'fade',\n    timeout: duration\n  }, /*#__PURE__*/React.createElement(Wrap, null, /*#__PURE__*/React.createElement(Form, null, /*#__PURE__*/React.createElement(Divider, {\n    clear: true\n  }), filters && filters.length > 0 && /*#__PURE__*/React.createElement(List, null, filters.map(filter => filter)), options && options.length > 0 && /*#__PURE__*/React.createElement(Row, null, /*#__PURE__*/React.createElement(Controller, {\n    name: 'sort',\n    control: control,\n    defaultValue: getValues('sort') || (params === null || params === void 0 ? void 0 : params.sort) && options.find(option => (option === null || option === void 0 ? void 0 : option.value) === params.sort) || options[0] || null,\n    render: ({\n      value,\n      onChange\n    }) => /*#__PURE__*/React.createElement(Switch, {\n      defaultValue: value,\n      onChange: decorate(onChange),\n      options: options,\n      stretch: true\n    })\n  })), /*#__PURE__*/React.createElement(Divider, {\n    clear: true\n  }))));\n};\nFilter.defaultProps = {\n  duration: 150\n};\nexport default Filter;","map":{"version":3,"sources":["D:/Documents/Workspace/FREELANCE/atomic/atomic-frontend/components/FilterBar/index.js"],"names":["React","useCallback","useMemo","Controller","useForm","useSelector","styled","Column","Row","Switch","Divider","Transition","DatePicker","useSearch","AsyncSelect","Wrap","Form","form","List","parseToParams","params","getValue","value","Date","getTime","toString","Array","isArray","map","selectValue","Object","entries","filter","_","reduce","acc","key","Filter","isOpen","duration","sort","search","state","root","control","getValues","onSearch","decorate","callback","filters","item","type","name","onChange","label","query","queryType","variables","selectValueField","selectLabelField","selectRestrictions","selectLabelDecorator","options","length","find","option","defaultProps"],"mappings":"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","sourcesContent":["import React, { useCallback, useMemo } from 'react'\nimport { Controller, useForm } from 'react-hook-form'\nimport { useSelector } from 'react-redux'\nimport styled from 'styled-components'\n\nimport Column from '../../atomic-ui/components/Column'\nimport Row from '../../atomic-ui/components/Row'\nimport Switch from '../../atomic-ui/components/Switch'\nimport Divider from '../../atomic-ui/components/Divider'\nimport Transition from '../../atomic-ui/components/Transition'\nimport DatePicker from '../../atomic-ui/components/DatePicker'\nimport { useSearch } from '../../hooks/useSearch'\n\nimport AsyncSelect from '../AsyncSelect'\n\nexport const Wrap = styled(Column)`\n  width: 100%;\n\n  &.fade-enter {\n    opacity: 0;\n  }\n\n  &.fade-enter-active {\n    opacity: 1;\n    transition: opacity 100ms, blur 100ms;\n  }\n\n  &.fade-exit {\n    opacity: 1;\n  }\n\n  &.fade-exit-active {\n    opacity: 0;\n    transition: opacity 100ms, blur 100ms;\n  }\n`\n\nexport const Form = styled.form`\n  display: flex;\n  flex-direction: column;\n  grid-gap: var(--default-gap);\n  width: 100%;\n`\n\nexport const List = styled(Row)`\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(256px, 1fr));\n\n  @media only screen and (max-width: 480px) {\n    grid-gap: var(--default-gap);\n  }\n`\n\nexport const parseToParams = (params) => {\n  const getValue = (value) => {\n    if (value instanceof Date) {\n      return value.getTime().toString()\n    }\n    if (Array.isArray(value)) {\n      return value.map((selectValue) => selectValue.value)\n    }\n    return value?.value || value\n  }\n\n  return (\n   Object.entries(params)\n    .filter(([_, value]) => value)\n    .reduce(\n     (acc, [key, value]) => ({\n       ...acc, [key]: getValue(value)\n     }),\n     {}\n    )\n  )\n}\n\nexport const Filter = ({ isOpen = true, duration, sort, filter }) => {\n  const { search, params } = useSelector((state) => ({\n    search: state.root.search,\n    params: state.root.params\n  }))\n  const { control, getValues } = useForm()\n  const [onSearch] = useSearch()\n\n  const decorate = useCallback(\n   (callback) =>\n      (value) => {\n        if (callback) callback(value)\n        onSearch(search, parseToParams(getValues()))\n      },\n    [search, getValues, onSearch]\n  )\n\n  const filters = useMemo(() => (filter || []).map((item) => {\n    switch (item.type) {\n      case 'DATEPICKER':\n        return (\n          <Controller\n            key={item.name}\n            control={control}\n            name={item.name}\n            defaultValue={getValues(item.name) || (params && params[item?.name || '']) || null}\n            render={({ value, onChange }) => (\n              <DatePicker\n                defaultValue={value}\n                placeholder={item.label}\n                onChange={decorate(onChange)}\n                withNavigate\n              />\n            )}\n          />\n        )\n      case 'SELECT':\n        return (\n          <Controller\n            key={item.name}\n            control={control}\n            name={item.name}\n            defaultValue={getValues(item.name) || null}\n            render={({ value, onChange }) => (\n              <AsyncSelect\n               name={item.name}\n               query={item.query}\n               defaultValue={value}\n               type={item.queryType}\n               placeholder={item.label}\n               variables={item.variables}\n               selectValueField={item.selectValueField}\n               selectLabelField={item.selectLabelField}\n               selectRestrictions={item.selectRestrictions}\n               selectLabelDecorator={item.selectLabelDecorator}\n               onChange={decorate(onChange)}\n              />\n            )}\n          />\n        )\n      case 'MULTISELECT':\n        return (\n         <Controller\n          key={item.name}\n          control={control}\n          name={item.name}\n          defaultValue={getValues(item.name) || null}\n          render={({ value, onChange }) => (\n           <AsyncSelect\n            name={item.name}\n            query={item.query}\n            defaultValue={value}\n            type={item.queryType}\n            placeholder={item.label}\n            variables={item.variables}\n            selectValueField={item.selectValueField}\n            selectLabelField={item.selectLabelField}\n            selectRestrictions={item.selectRestrictions}\n            selectLabelDecorator={item.selectLabelDecorator}\n            onChange={decorate(onChange)}\n            isMulti\n           />\n          )}\n         />\n        )\n      default:\n        return null\n    }\n  }), [params, control, filter, decorate, getValues])\n\n  const options = useMemo(() => sort || [], [sort])\n\n  return (\n    <Transition in={isOpen} animation={'fade'} timeout={duration}>\n      <Wrap>\n        <Form>\n          <Divider clear />\n          {filters && filters.length > 0 && <List>{filters.map((filter) => filter)}</List>}\n          {options && options.length > 0 && (\n            <Row>\n              <Controller\n               name={'sort'}\n               control={control}\n               defaultValue={\n                 getValues('sort') ||\n                 (params?.sort && options.find((option) => option?.value === params.sort)) ||\n                 options[0] ||\n                 null\n               }\n               render={({ value, onChange }) => (\n                <Switch\n                  defaultValue={value}\n                  onChange={decorate(onChange)}\n                  options={options}\n                  stretch\n                />\n               )}\n              />\n            </Row>\n          )}\n          <Divider clear />\n        </Form>\n      </Wrap>\n    </Transition>\n  )\n}\n\nFilter.defaultProps = {\n  duration: 150\n}\n\nexport default Filter\n"]},"metadata":{},"sourceType":"module"}