{"ast":null,"code":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useEffect, useState } from 'react';\nimport styled, { css } from 'styled-components';\nimport { useQuery, useLazyQuery, useMutation } from '@apollo/react-hooks';\nimport Row from '../../atomic-ui/components/Row';\nimport Column from '../../atomic-ui/components/Column';\nimport Member from '../../atomic-ui/components/Member';\nimport Alert from '../../atomic-ui/components/Alert';\nimport Search from '../../atomic-ui/components/Search';\nimport Spinner from '../../atomic-ui/components/Spinner';\nimport { Loader } from '../Styled';\nimport { Wrap as WrapForm } from '../Form';\nimport MessengerChat from '../MessengerChat';\nimport queries from '../../graphql/queries';\nexport var Wrap = styled(Row).withConfig({\n  displayName: \"Messenger__Wrap\",\n  componentId: \"sc-1hnkbvn-0\"\n})([\"height:100%;flex-grow:1;\", \"{width:100%;padding:0;}@media only screen and (max-width:568px){flex-direction:column;}\", \" \", \" \", \"\"], WrapForm, function (_ref) {\n  var appearance = _ref.appearance;\n  return appearance === 'default' && css([\"padding:var(--default-gap);background:var(--surface-background);border:var(--surface-border);border-radius:var(--surface-border-radius);box-shadow:var(--surface-shadow);\"]);\n}, function (_ref2) {\n  var appearance = _ref2.appearance;\n  return appearance === 'ghost' && css([\"padding:0;border:none;background:none;border-radius:0;box-shadow:none;\"]);\n}, function (_ref3) {\n  var appearance = _ref3.appearance;\n  return appearance === 'clear' && css([\"padding:0;border:none;background:none;border-radius:0;box-shadow:none;\"]);\n});\nexport var ChatsSearch = styled(Search).withConfig({\n  displayName: \"Messenger__ChatsSearch\",\n  componentId: \"sc-1hnkbvn-1\"\n})([\"margin-bottom:10px;\"]);\nexport var Chats = styled(Column).withConfig({\n  displayName: \"Messenger__Chats\",\n  componentId: \"sc-1hnkbvn-2\"\n})([\"grid-gap:0;width:320px;@media only screen and (max-width:568px){width:100%;}\"]);\nexport var Chat = styled(Member).withConfig({\n  displayName: \"Messenger__Chat\",\n  componentId: \"sc-1hnkbvn-3\"\n})([\"margin:0;padding:10px 0;border-radius:var(--surface-border-radius);transition:all 150ms ease;\", \"\"], function (_ref4) {\n  var active = _ref4.active;\n  return active && css([\"background:var(--input-background);padding:10px;\"]);\n});\nexport var getUnreadedMessages = function getUnreadedMessages(messages, sender) {\n  return (messages || []).reduce(function (acc, item) {\n    var _item$user;\n\n    return acc + (item.type === 'UNREADED' && ((_item$user = item.user) === null || _item$user === void 0 ? void 0 : _item$user.email) !== sender.email ? 1 : 0);\n  }, 0);\n};\nexport var getLastMessage = function getLastMessage(messages, sender) {\n  var _message$user;\n\n  var list = messages || [];\n  var message = list[list.length - 1];\n  if (!message) return '';\n  return \"\".concat(((_message$user = message.user) === null || _message$user === void 0 ? void 0 : _message$user.email) === sender.email ? 'Вы: ' : '').concat(message.text);\n};\nexport var getExtendMessages = function getExtendMessages(messages, sender) {\n  return messages.map(function (message) {\n    return _objectSpread(_objectSpread({}, message), {}, {\n      side: sender.name === message.user.name ? 'owner' : 'observer'\n    });\n  });\n};\nexport var Messenger = function Messenger(_ref5) {\n  var appearance = _ref5.appearance,\n      recipient = _ref5.recipient,\n      sender = _ref5.sender,\n      onAttach = _ref5.onAttach,\n      onMemberLink = _ref5.onMemberLink,\n      props = _objectWithoutProperties(_ref5, [\"appearance\", \"recipient\", \"sender\", \"onAttach\", \"onMemberLink\"]);\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      currentChat = _useState2[0],\n      setCurrentChat = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      loading = _useState4[0],\n      setLoading = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      chats = _useState6[0],\n      setChats = _useState6[1];\n\n  var _useState7 = useState([]),\n      _useState8 = _slicedToArray(_useState7, 2),\n      userChats = _useState8[0],\n      setUserChats = _useState8[1];\n\n  var _useState9 = useState([]),\n      _useState10 = _slicedToArray(_useState9, 2),\n      ticketChats = _useState10[0],\n      setTicketChats = _useState10[1];\n\n  var _useLazyQuery = useLazyQuery(queries.GET_CHAT),\n      _useLazyQuery2 = _slicedToArray(_useLazyQuery, 2),\n      getChat = _useLazyQuery2[0],\n      _useLazyQuery2$ = _useLazyQuery2[1],\n      chat = _useLazyQuery2$.data,\n      loadingChat = _useLazyQuery2$.loading,\n      errorChat = _useLazyQuery2$.error,\n      refetchChat = _useLazyQuery2$.refetch;\n\n  var _useLazyQuery3 = useLazyQuery(queries.GET_TICKET),\n      _useLazyQuery4 = _slicedToArray(_useLazyQuery3, 2),\n      getTicket = _useLazyQuery4[0],\n      _useLazyQuery4$ = _useLazyQuery4[1],\n      ticket = _useLazyQuery4$.data,\n      loadingTicket = _useLazyQuery4$.loading,\n      errorTicket = _useLazyQuery4$.error,\n      refetchTicket = _useLazyQuery4$.refetch;\n\n  var _useQuery = useQuery(queries.GET_USER_CHATS),\n      dataUserChats = _useQuery.data,\n      loadingUserChats = _useQuery.loading,\n      errorUserChats = _useQuery.error,\n      getUserChats = _useQuery.refetch;\n\n  var _useQuery2 = useQuery(queries.GET_USER_TICKETS),\n      dataTicketChats = _useQuery2.data,\n      loadingTicketChats = _useQuery2.loading,\n      errorUserTickets = _useQuery2.error,\n      getUserTickets = _useQuery2.refetch;\n\n  var _useMutation = useMutation(queries.SEND_MESSAGE),\n      _useMutation2 = _slicedToArray(_useMutation, 2),\n      sendMessage = _useMutation2[0],\n      _useMutation2$ = _useMutation2[1],\n      dataSendMessage = _useMutation2$.data,\n      loadingSendMessage = _useMutation2$.loading,\n      errorSendMessage = _useMutation2$.error;\n\n  var _useMutation3 = useMutation(queries.SEND_TICKET_MESSAGE),\n      _useMutation4 = _slicedToArray(_useMutation3, 2),\n      sendTicketMessage = _useMutation4[0],\n      _useMutation4$ = _useMutation4[1],\n      dataUserSendMessage = _useMutation4$.data,\n      loadingUserSendMessage = _useMutation4$.loading,\n      errorUserSendMessage = _useMutation4$.error;\n\n  var _useMutation5 = useMutation(queries.ADD_USER_CHAT),\n      _useMutation6 = _slicedToArray(_useMutation5, 1),\n      addUserChat = _useMutation6[0];\n\n  useEffect(function () {\n    if (recipient) {\n      addUserChat({\n        variables: {\n          recipient: recipient.email\n        }\n      }).then(function () {\n        getUserChats();\n        getUserTickets();\n      });\n    }\n  }, [recipient, addUserChat]);\n  useEffect(function () {\n    if (recipient && !currentChat && !loadingUserChats && dataUserChats !== null && dataUserChats !== void 0 && dataUserChats.getUserChats) {\n      var _dataUserChats$getUse;\n\n      var id = (_dataUserChats$getUse = dataUserChats.getUserChats.find(function (userChat) {\n        return userChat.chat.members.find(function (member) {\n          return member.name === recipient.name;\n        });\n      })) === null || _dataUserChats$getUse === void 0 ? void 0 : _dataUserChats$getUse.chat.id;\n      if (id) getChat({\n        variables: {\n          id: id\n        }\n      });\n    }\n  }, [recipient, dataUserChats, loadingUserChats]);\n  useEffect(function () {\n    if (!loadingChat && chat !== null && chat !== void 0 && chat.getChat) {\n      setCurrentChat(chat.getChat);\n    }\n  }, [chat, loadingChat]);\n  useEffect(function () {\n    if (!loadingTicket && ticket !== null && ticket !== void 0 && ticket.getTicket) {\n      setCurrentChat(ticket.getTicket);\n    }\n  }, [ticket, loadingTicket]);\n  useEffect(function () {\n    if (!loadingSendMessage && dataSendMessage) {\n      setCurrentChat(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, {\n          messages: getExtendMessages(dataSendMessage.sendMessage, sender)\n        });\n      });\n    }\n  }, [sender, dataSendMessage, loadingSendMessage]);\n  useEffect(function () {\n    if (!loadingUserSendMessage && dataUserSendMessage) {\n      setCurrentChat(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, {\n          messages: getExtendMessages(dataUserSendMessage.sendTicketMessage, sender)\n        });\n      });\n    }\n  }, [sender, dataUserSendMessage, loadingUserSendMessage]);\n  useEffect(function () {\n    if (!loadingUserChats && dataUserChats !== null && dataUserChats !== void 0 && dataUserChats.getUserChats) {\n      setUserChats(dataUserChats.getUserChats);\n    }\n  }, [dataUserChats, loadingUserChats]);\n  useEffect(function () {\n    if (!loadingTicketChats && dataTicketChats !== null && dataTicketChats !== void 0 && dataTicketChats.getUserTickets) {\n      setTicketChats(dataTicketChats.getUserTickets);\n    }\n  }, [dataTicketChats, loadingTicketChats]);\n  useEffect(function () {\n    setChats(userChats.concat(ticketChats));\n  }, [userChats, ticketChats]);\n  return /*#__PURE__*/React.createElement(Wrap, _extends({}, props, {\n    appearance: appearance\n  }), /*#__PURE__*/React.createElement(Chats, null, /*#__PURE__*/React.createElement(ChatsSearch, {\n    appearance: 'ghost'\n  }), !loadingChat && !loadingTicket && !loadingUserChats && !loadingTicketChats && !loadingSendMessage && !loadingUserSendMessage && chats.length > 0 ? chats.map(function (chat) {\n    var _chat$chat, _chat$chat2, _chat$counsellor, _chat$chat3, _chat$chat3$members$f, _chat$counsellor2, _chat$counsellor2$ava, _chat$chat4, _chat$chat5, _chat$chat6, _chat$chat7, _chat$chat10;\n\n    return /*#__PURE__*/React.createElement(Chat, {\n      key: ((_chat$chat = chat.chat) === null || _chat$chat === void 0 ? void 0 : _chat$chat.id) || chat.id,\n      name: ((_chat$chat2 = chat.chat) === null || _chat$chat2 === void 0 ? void 0 : _chat$chat2.members.filter(function (member) {\n        return member.name !== sender.name;\n      })[0].name) || ((_chat$counsellor = chat.counsellor) === null || _chat$counsellor === void 0 ? void 0 : _chat$counsellor.name),\n      avatar: ((_chat$chat3 = chat.chat) === null || _chat$chat3 === void 0 ? void 0 : (_chat$chat3$members$f = _chat$chat3.members.filter(function (member) {\n        return member.name !== sender.name;\n      })[0].avatar) === null || _chat$chat3$members$f === void 0 ? void 0 : _chat$chat3$members$f.path) || ((_chat$counsellor2 = chat.counsellor) === null || _chat$counsellor2 === void 0 ? void 0 : (_chat$counsellor2$ava = _chat$counsellor2.avatar) === null || _chat$counsellor2$ava === void 0 ? void 0 : _chat$counsellor2$ava.path) || '/images/avatar-default.png',\n      budge: ((_chat$chat4 = chat.chat) === null || _chat$chat4 === void 0 ? void 0 : _chat$chat4.messages) && getUnreadedMessages((_chat$chat5 = chat.chat) === null || _chat$chat5 === void 0 ? void 0 : _chat$chat5.messages, sender) || chat.messages && getUnreadedMessages(chat.messages, sender) || null,\n      position: ((_chat$chat6 = chat.chat) === null || _chat$chat6 === void 0 ? void 0 : _chat$chat6.messages) && getLastMessage((_chat$chat7 = chat.chat) === null || _chat$chat7 === void 0 ? void 0 : _chat$chat7.messages, sender) || chat.messages && getLastMessage(chat.messages, sender) || null,\n      onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        var _chat$chat8;\n\n        var _chat$chat9, variables, _variables;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                setLoading(true);\n\n                if (!((_chat$chat8 = chat.chat) !== null && _chat$chat8 !== void 0 && _chat$chat8.id)) {\n                  _context.next = 13;\n                  break;\n                }\n\n                variables = {\n                  id: (_chat$chat9 = chat.chat) === null || _chat$chat9 === void 0 ? void 0 : _chat$chat9.id\n                };\n\n                if (!refetchChat) {\n                  _context.next = 8;\n                  break;\n                }\n\n                _context.next = 6;\n                return refetchChat(variables);\n\n              case 6:\n                _context.next = 10;\n                break;\n\n              case 8:\n                _context.next = 10;\n                return getChat({\n                  variables: variables\n                });\n\n              case 10:\n                setCurrentChat(chat.chat);\n                _context.next = 22;\n                break;\n\n              case 13:\n                _variables = {\n                  id: chat.id\n                };\n\n                if (!refetchTicket) {\n                  _context.next = 19;\n                  break;\n                }\n\n                _context.next = 17;\n                return refetchTicket(_variables);\n\n              case 17:\n                _context.next = 21;\n                break;\n\n              case 19:\n                _context.next = 21;\n                return getTicket({\n                  variables: _variables\n                });\n\n              case 21:\n                setCurrentChat(chat);\n\n              case 22:\n                setLoading(false);\n\n              case 23:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      })),\n      active: currentChat && currentChat.id === (((_chat$chat10 = chat.chat) === null || _chat$chat10 === void 0 ? void 0 : _chat$chat10.id) || chat.id)\n    });\n  }) : loadingChat || loadingTicket || loadingUserChats || loadingTicketChats || loadingSendMessage || loadingUserSendMessage ? /*#__PURE__*/React.createElement(Loader, null, /*#__PURE__*/React.createElement(Spinner, null)) : /*#__PURE__*/React.createElement(Alert, {\n    style: {\n      marginTop: 15\n    }\n  }, \"\\u0410\\u043A\\u0442\\u0438\\u0432\\u043D\\u044B\\u0435 \\u0447\\u0430\\u0442\\u044B \\u043E\\u0442\\u0441\\u0443\\u0442\\u0441\\u0442\\u0432\\u0443\\u044E\\u0442\")), /*#__PURE__*/React.createElement(MessengerChat, {\n    chat: currentChat && _objectSpread(_objectSpread({}, currentChat), {}, {\n      messages: currentChat.messages.map(function (message) {\n        return _objectSpread(_objectSpread({}, message), {}, {\n          side: sender.name === message.user.name ? 'owner' : 'observer'\n        });\n      })\n    }),\n    appearance: 'ghost',\n    error: errorChat || errorTicket || errorUserChats || errorUserTickets || errorSendMessage || errorUserSendMessage,\n    loading: loading || loadingTicket || loadingChat || loadingUserChats || loadingTicketChats || loadingSendMessage || loadingUserSendMessage,\n    onLink: onMemberLink,\n    onAttach: onAttach,\n    onSubmit: function onSubmit(value) {\n      if (currentChat.members) {\n        var candidate = currentChat.members.find(function (member) {\n          return member.email !== sender.email;\n        });\n        sendMessage({\n          variables: {\n            sender: sender.email,\n            recipient: (recipient === null || recipient === void 0 ? void 0 : recipient.email) || (candidate === null || candidate === void 0 ? void 0 : candidate.email),\n            text: value\n          }\n        });\n      } else {\n        var _currentChat$author;\n\n        sendTicketMessage({\n          variables: {\n            ticket: currentChat.id,\n            recipient: (_currentChat$author = currentChat.author) === null || _currentChat$author === void 0 ? void 0 : _currentChat$author.email,\n            text: value,\n            isClient: true\n          }\n        });\n      }\n    }\n  }));\n};\nMessenger.defaultProps = {\n  appearance: 'default'\n};\nexport default Messenger;","map":{"version":3,"sources":["C:/Users/dan82/Documents/workspace/FREELANCE/atomic/atomic-frontend/components/Messenger/index.js"],"names":["React","useEffect","useState","styled","css","useQuery","useLazyQuery","useMutation","Row","Column","Member","Alert","Search","Spinner","Loader","Wrap","WrapForm","MessengerChat","queries","appearance","ChatsSearch","Chats","Chat","active","getUnreadedMessages","messages","sender","reduce","acc","item","type","user","email","getLastMessage","list","message","length","text","getExtendMessages","map","side","name","Messenger","recipient","onAttach","onMemberLink","props","currentChat","setCurrentChat","loading","setLoading","chats","setChats","userChats","setUserChats","ticketChats","setTicketChats","GET_CHAT","getChat","chat","data","loadingChat","errorChat","error","refetchChat","refetch","GET_TICKET","getTicket","ticket","loadingTicket","errorTicket","refetchTicket","GET_USER_CHATS","dataUserChats","loadingUserChats","errorUserChats","getUserChats","GET_USER_TICKETS","dataTicketChats","loadingTicketChats","errorUserTickets","getUserTickets","SEND_MESSAGE","sendMessage","dataSendMessage","loadingSendMessage","errorSendMessage","SEND_TICKET_MESSAGE","sendTicketMessage","dataUserSendMessage","loadingUserSendMessage","errorUserSendMessage","ADD_USER_CHAT","addUserChat","variables","then","id","find","userChat","members","member","prev","concat","filter","counsellor","avatar","path","marginTop","value","candidate","author","isClient","defaultProps"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\nimport styled, { css } from 'styled-components'\nimport { useQuery, useLazyQuery, useMutation } from '@apollo/react-hooks'\n\nimport Row from '../../atomic-ui/components/Row'\nimport Column from '../../atomic-ui/components/Column'\nimport Member from '../../atomic-ui/components/Member'\nimport Alert from '../../atomic-ui/components/Alert'\nimport Search from '../../atomic-ui/components/Search'\nimport Spinner from '../../atomic-ui/components/Spinner'\n\nimport { Loader } from '../Styled'\nimport { Wrap as WrapForm } from '../Form'\nimport MessengerChat from '../MessengerChat'\nimport queries from '../../graphql/queries'\n\nexport const Wrap = styled(Row)`\n  height: 100%;\n  flex-grow: 1;\n\n  ${WrapForm} {\n    width: 100%;\n    padding: 0;\n  }\n\n  @media only screen and (max-width: 568px) {\n    flex-direction: column;\n  }\n\n  ${({ appearance }) =>\n    appearance === 'default' &&\n    css`\n      padding: var(--default-gap);\n      background: var(--surface-background);\n      border: var(--surface-border);\n      border-radius: var(--surface-border-radius);\n      box-shadow: var(--surface-shadow);\n    `}\n\n  ${({ appearance }) =>\n    appearance === 'ghost' &&\n    css`\n      padding: 0;\n      border: none;\n      background: none;\n      border-radius: 0;\n      box-shadow: none;\n    `}\n\n  ${({ appearance }) =>\n    appearance === 'clear' &&\n    css`\n      padding: 0;\n      border: none;\n      background: none;\n      border-radius: 0;\n      box-shadow: none;\n    `}\n`\n\nexport const ChatsSearch = styled(Search)`\n  margin-bottom: 10px;\n`\n\nexport const Chats = styled(Column)`\n  grid-gap: 0;\n  width: 320px;\n\n  @media only screen and (max-width: 568px) {\n    width: 100%;\n  }\n`\n\nexport const Chat = styled(Member)`\n  margin: 0;\n  padding: 10px 0;\n  border-radius: var(--surface-border-radius);\n  transition: all 150ms ease;\n\n  ${({ active }) =>\n    active &&\n    css`\n      background: var(--input-background);\n      padding: 10px;\n    `}\n`\n\nexport const getUnreadedMessages = (messages, sender) =>\n  (messages || []).reduce(\n    (acc, item) => acc + (item.type === 'UNREADED' && item.user?.email !== sender.email ? 1 : 0),\n    0\n  )\n\nexport const getLastMessage = (messages, sender) => {\n  const list = messages || []\n  const message = list[list.length - 1]\n  if (!message) return ''\n  return `${message.user?.email === sender.email ? 'Вы: ' : ''}${message.text}`\n}\n\nexport const getExtendMessages = (messages, sender) =>\n  messages.map((message) => ({\n    ...message,\n    side: sender.name === message.user.name ? 'owner' : 'observer'\n  }))\n\nexport const Messenger = ({ appearance, recipient, sender, onAttach, onMemberLink, ...props }) => {\n  const [currentChat, setCurrentChat] = useState(null)\n  const [loading, setLoading] = useState(false)\n  const [chats, setChats] = useState([])\n  const [userChats, setUserChats] = useState([])\n  const [ticketChats, setTicketChats] = useState([])\n\n  const [\n    getChat,\n    { data: chat, loading: loadingChat, error: errorChat, refetch: refetchChat }\n  ] = useLazyQuery(queries.GET_CHAT)\n  const [\n    getTicket,\n    { data: ticket, loading: loadingTicket, error: errorTicket, refetch: refetchTicket }\n  ] = useLazyQuery(queries.GET_TICKET)\n\n  const {\n    data: dataUserChats,\n    loading: loadingUserChats,\n    error: errorUserChats,\n    refetch: getUserChats\n  } = useQuery(queries.GET_USER_CHATS)\n\n  const {\n    data: dataTicketChats,\n    loading: loadingTicketChats,\n    error: errorUserTickets,\n    refetch: getUserTickets\n  } = useQuery(queries.GET_USER_TICKETS)\n\n  const [\n    sendMessage,\n    { data: dataSendMessage, loading: loadingSendMessage, error: errorSendMessage }\n  ] = useMutation(queries.SEND_MESSAGE)\n  const [\n    sendTicketMessage,\n    { data: dataUserSendMessage, loading: loadingUserSendMessage, error: errorUserSendMessage }\n  ] = useMutation(queries.SEND_TICKET_MESSAGE)\n  const [addUserChat] = useMutation(queries.ADD_USER_CHAT)\n\n  useEffect(() => {\n    if (recipient) {\n      addUserChat({\n        variables: { recipient: recipient.email }\n      }).then(() => {\n        getUserChats()\n        getUserTickets()\n      })\n    }\n  }, [recipient, addUserChat])\n\n  useEffect(() => {\n    if (recipient && !currentChat && !loadingUserChats && dataUserChats?.getUserChats) {\n      const id = dataUserChats.getUserChats.find((userChat) =>\n        userChat.chat.members.find((member) => member.name === recipient.name)\n      )?.chat.id\n\n      if (id) getChat({ variables: { id } })\n    }\n  }, [recipient, dataUserChats, loadingUserChats])\n\n  useEffect(() => {\n    if (!loadingChat && chat?.getChat) {\n      setCurrentChat(chat.getChat)\n    }\n  }, [chat, loadingChat])\n\n  useEffect(() => {\n    if (!loadingTicket && ticket?.getTicket) {\n      setCurrentChat(ticket.getTicket)\n    }\n  }, [ticket, loadingTicket])\n\n  useEffect(() => {\n    if (!loadingSendMessage && dataSendMessage) {\n      setCurrentChat((prev) => ({\n        ...prev,\n        messages: getExtendMessages(dataSendMessage.sendMessage, sender)\n      }))\n    }\n  }, [sender, dataSendMessage, loadingSendMessage])\n\n  useEffect(() => {\n    if (!loadingUserSendMessage && dataUserSendMessage) {\n      setCurrentChat((prev) => ({\n        ...prev,\n        messages: getExtendMessages(dataUserSendMessage.sendTicketMessage, sender)\n      }))\n    }\n  }, [sender, dataUserSendMessage, loadingUserSendMessage])\n\n  useEffect(() => {\n    if (!loadingUserChats && dataUserChats?.getUserChats) {\n      setUserChats(dataUserChats.getUserChats)\n    }\n  }, [dataUserChats, loadingUserChats])\n\n  useEffect(() => {\n    if (!loadingTicketChats && dataTicketChats?.getUserTickets) {\n      setTicketChats(dataTicketChats.getUserTickets)\n    }\n  }, [dataTicketChats, loadingTicketChats])\n\n  useEffect(() => {\n    setChats(userChats.concat(ticketChats))\n  }, [userChats, ticketChats])\n\n  return (\n    <Wrap {...props} appearance={appearance}>\n      <Chats>\n        <ChatsSearch appearance={'ghost'} />\n        {!loadingChat &&\n        !loadingTicket &&\n        !loadingUserChats &&\n        !loadingTicketChats &&\n        !loadingSendMessage &&\n        !loadingUserSendMessage &&\n        chats.length > 0 ? (\n          chats.map((chat) => (\n            <Chat\n              key={chat.chat?.id || chat.id}\n              name={\n                chat.chat?.members.filter((member) => member.name !== sender.name)[0].name ||\n                chat.counsellor?.name\n              }\n              avatar={\n                chat.chat?.members.filter((member) => member.name !== sender.name)[0].avatar\n                  ?.path ||\n                chat.counsellor?.avatar?.path ||\n                '/images/avatar-default.png'\n              }\n              budge={\n                (chat.chat?.messages && getUnreadedMessages(chat.chat?.messages, sender)) ||\n                (chat.messages && getUnreadedMessages(chat.messages, sender)) ||\n                null\n              }\n              position={\n                (chat.chat?.messages && getLastMessage(chat.chat?.messages, sender)) ||\n                (chat.messages && getLastMessage(chat.messages, sender)) ||\n                null\n              }\n              onClick={async () => {\n                setLoading(true)\n                if (chat.chat?.id) {\n                  const variables = { id: chat.chat?.id }\n                  if (refetchChat) await refetchChat(variables)\n                  else await getChat({ variables })\n                  setCurrentChat(chat.chat)\n                } else {\n                  const variables = { id: chat.id }\n                  if (refetchTicket) await refetchTicket(variables)\n                  else await getTicket({ variables })\n                  setCurrentChat(chat)\n                }\n                setLoading(false)\n              }}\n              active={currentChat && currentChat.id === (chat.chat?.id || chat.id)}\n            />\n          ))\n        ) : loadingChat ||\n          loadingTicket ||\n          loadingUserChats ||\n          loadingTicketChats ||\n          loadingSendMessage ||\n          loadingUserSendMessage ? (\n          <Loader>\n            <Spinner />\n          </Loader>\n        ) : (\n          <Alert style={{ marginTop: 15 }}>Активные чаты отсутствуют</Alert>\n        )}\n      </Chats>\n      <MessengerChat\n        chat={\n          currentChat && {\n            ...currentChat,\n            messages: currentChat.messages.map((message) => ({\n              ...message,\n              side: sender.name === message.user.name ? 'owner' : 'observer'\n            }))\n          }\n        }\n        appearance={'ghost'}\n        error={\n          errorChat ||\n          errorTicket ||\n          errorUserChats ||\n          errorUserTickets ||\n          errorSendMessage ||\n          errorUserSendMessage\n        }\n        loading={\n          loading ||\n          loadingTicket ||\n          loadingChat ||\n          loadingUserChats ||\n          loadingTicketChats ||\n          loadingSendMessage ||\n          loadingUserSendMessage\n        }\n        onLink={onMemberLink}\n        onAttach={onAttach}\n        onSubmit={(value) => {\n          if (currentChat.members) {\n            const candidate = currentChat.members.find((member) => member.email !== sender.email)\n            sendMessage({\n              variables: {\n                sender: sender.email,\n                recipient: recipient?.email || candidate?.email,\n                text: value\n              }\n            })\n          } else {\n            sendTicketMessage({\n              variables: {\n                ticket: currentChat.id,\n                recipient: currentChat.author?.email,\n                text: value,\n                isClient: true\n              }\n            })\n          }\n        }}\n      />\n    </Wrap>\n  )\n}\n\nMessenger.defaultProps = {\n  appearance: 'default'\n}\n\nexport default Messenger\n"]},"metadata":{},"sourceType":"module"}