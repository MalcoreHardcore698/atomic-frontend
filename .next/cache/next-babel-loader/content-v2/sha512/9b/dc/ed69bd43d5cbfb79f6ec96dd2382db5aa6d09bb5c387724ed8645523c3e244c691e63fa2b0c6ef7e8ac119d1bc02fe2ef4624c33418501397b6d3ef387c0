{"ast":null,"code":"var _s2 = $RefreshSig$();\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nimport React, { useState, useEffect } from 'react';\nimport styled, { css } from 'styled-components';\nimport { useQuery, useMutation } from '@apollo/react-hooks';\nimport Column from '../../atomic-ui/components/Column';\nimport Title from '../../atomic-ui/components/Title';\nimport Image from '../../atomic-ui/components/Image';\nimport Meta from '../../atomic-ui/components/Meta';\nimport Divider from '../../atomic-ui/components/Divider';\nimport Alert from '../../atomic-ui/components/Alert';\nimport Spinner from '../../atomic-ui/components/Spinner';\nimport HTMLView from '../HTMLView';\nimport Comments from '../Comments';\nimport { Loader } from '../Styled';\nimport queries from '../../graphql/queries';\nexport var Wrap = styled(Column).withConfig({\n  displayName: \"ArticleView__Wrap\",\n  componentId: \"sc-12lysue-0\"\n})([\"flex-grow:1;\", \" \", \" \", \"\"], function (_ref) {\n  var appearance = _ref.appearance;\n  return appearance === 'default' && css([\"padding:var(--default-gap);background:var(--surface-background);border:var(--surface-border);border-radius:var(--surface-border-radius);box-shadow:var(--surface-shadow);\"]);\n}, function (_ref2) {\n  var appearance = _ref2.appearance;\n  return appearance === 'ghost' && css([\"padding:0;border:none;background:none;border-radius:0;box-shadow:none;\"]);\n}, function (_ref3) {\n  var appearance = _ref3.appearance;\n  return appearance === 'clear' && css([\"padding:0;border:none;background:none;border-radius:0;box-shadow:none;\"]);\n});\n_c = Wrap;\nexport var Poster = styled(Image).withConfig({\n  displayName: \"ArticleView__Poster\",\n  componentId: \"sc-12lysue-1\"\n})([\"object-fit:cover;width:100%;height:512px;border-radius:var(--surface-border-radius);@media only screen and (max-width:480px){height:256px;}\"]);\n_c2 = Poster;\nexport var Content = styled(Column).withConfig({\n  displayName: \"ArticleView__Content\",\n  componentId: \"sc-12lysue-2\"\n})([\"grid-gap:0;\"]);\n_c3 = Content;\nexport var View = function View(_ref4) {\n  _s2();\n\n  var _data$getArticle$cate;\n\n  var article = _ref4.article,\n      appearance = _ref4.appearance,\n      className = _ref4.className,\n      style = _ref4.style,\n      onLink = _ref4.onLink,\n      onCommentLink = _ref4.onCommentLink,\n      onCommentReply = _ref4.onCommentReply;\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      comments = _useState2[0],\n      setComments = _useState2[1];\n\n  var _useQuery = useQuery(queries.GET_ARTICLE, {\n    variables: {\n      id: article\n    }\n  }),\n      data = _useQuery.data,\n      loading = _useQuery.loading,\n      error = _useQuery.error;\n\n  var _useQuery2 = useQuery(queries.GET_COMMENTS, {\n    variables: {\n      id: article\n    }\n  }),\n      dataComments = _useQuery2.data,\n      loadingComments = _useQuery2.loading,\n      errorComments = _useQuery2.error;\n\n  var _useMutation = useMutation(queries.SEND_COMMENT),\n      _useMutation2 = _slicedToArray(_useMutation, 2),\n      sendComment = _useMutation2[0],\n      _useMutation2$ = _useMutation2[1],\n      dataSendComment = _useMutation2$.data,\n      loadingSendComment = _useMutation2$.loading,\n      errorSendComment = _useMutation2$.error;\n\n  var _useMutation3 = useMutation(queries.LIKE_COMMENT),\n      _useMutation4 = _slicedToArray(_useMutation3, 1),\n      likeComment = _useMutation4[0];\n\n  useEffect(function () {\n    if (!loadingComments && dataComments) {\n      setComments(dataComments.getComments);\n    }\n  }, [dataComments, loadingComments]);\n  useEffect(function () {\n    if (!loadingSendComment && dataSendComment) {\n      setComments(dataSendComment.sendComment);\n    }\n  }, [dataSendComment, loadingSendComment]);\n  return /*#__PURE__*/React.createElement(Wrap, {\n    className: className,\n    style: style,\n    appearance: appearance\n  }, !loading && data.getArticle ? /*#__PURE__*/React.createElement(React.Fragment, null, data.getArticle.preview && /*#__PURE__*/React.createElement(Poster, {\n    src: data.getArticle.preview.path\n  }), /*#__PURE__*/React.createElement(Content, null, /*#__PURE__*/React.createElement(Meta, {\n    date: data.getArticle.createdAt,\n    category: (_data$getArticle$cate = data.getArticle.category) === null || _data$getArticle$cate === void 0 ? void 0 : _data$getArticle$cate.name\n  }), /*#__PURE__*/React.createElement(Title, {\n    tag: 'h3',\n    onClick: onLink,\n    style: {\n      marginTop: -5,\n      marginBottom: 5\n    }\n  }, data.getArticle.title), data.getArticle.body && /*#__PURE__*/React.createElement(HTMLView, {\n    content: data.getArticle.body\n  })), /*#__PURE__*/React.createElement(Divider, {\n    clear: true\n  }), /*#__PURE__*/React.createElement(Title, {\n    tag: 'h4'\n  }, \"\\u041A\\u043E\\u043C\\u043C\\u0435\\u043D\\u0442\\u0430\\u0440\\u0438\\u0438\"), /*#__PURE__*/React.createElement(Comments, {\n    comments: comments,\n    appearance: 'ghost',\n    error: errorComments || errorSendComment,\n    loading: loadingComments || loadingSendComment,\n    onLink: onCommentLink,\n    onReply: onCommentReply,\n    onLike: function onLike(id, liked) {\n      return likeComment({\n        variables: {\n          comment: id,\n          liked: liked\n        }\n      });\n    },\n    onSubmit: function onSubmit(value) {\n      return sendComment({\n        variables: {\n          article: data.getArticle.id,\n          text: value\n        }\n      });\n    }\n  })) : error ? /*#__PURE__*/React.createElement(Alert, {\n    appearance: 'error',\n    style: {\n      width: '100%',\n      textAlign: 'center'\n    }\n  }, \"\\u0423\\u043F\\u0441! \\u041D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u044E \\u043E \\u0441\\u0442\\u0430\\u0442\\u044C\\u0435\") : /*#__PURE__*/React.createElement(Loader, null, /*#__PURE__*/React.createElement(Spinner, null)));\n};\n\n_s2(View, \"5FE1OAqW9DcTx314s03+vZJleOI=\", false, function () {\n  return [useQuery, useQuery, useMutation, useMutation];\n});\n\n_c4 = View;\nView.defaultProps = {\n  appearance: 'default'\n};\nexport default View;\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"Wrap\");\n$RefreshReg$(_c2, \"Poster\");\n$RefreshReg$(_c3, \"Content\");\n$RefreshReg$(_c4, \"View\");","map":{"version":3,"sources":["C:/Users/dan82/Documents/workspace/FREELANCE/atomic/atomic-frontend/components/ArticleView/index.js"],"names":["React","useState","useEffect","styled","css","useQuery","useMutation","Column","Title","Image","Meta","Divider","Alert","Spinner","HTMLView","Comments","Loader","queries","Wrap","appearance","Poster","Content","View","article","className","style","onLink","onCommentLink","onCommentReply","comments","setComments","GET_ARTICLE","variables","id","data","loading","error","GET_COMMENTS","dataComments","loadingComments","errorComments","SEND_COMMENT","sendComment","dataSendComment","loadingSendComment","errorSendComment","LIKE_COMMENT","likeComment","getComments","getArticle","preview","path","createdAt","category","name","marginTop","marginBottom","title","body","liked","comment","value","text","width","textAlign","defaultProps"],"mappings":";;;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,OAAOC,MAAP,IAAiBC,GAAjB,QAA4B,mBAA5B;AACA,SAASC,QAAT,EAAmBC,WAAnB,QAAsC,qBAAtC;AAEA,OAAOC,MAAP,MAAmB,mCAAnB;AACA,OAAOC,KAAP,MAAkB,kCAAlB;AACA,OAAOC,KAAP,MAAkB,kCAAlB;AACA,OAAOC,IAAP,MAAiB,iCAAjB;AACA,OAAOC,OAAP,MAAoB,oCAApB;AACA,OAAOC,KAAP,MAAkB,kCAAlB;AACA,OAAOC,OAAP,MAAoB,oCAApB;AAEA,OAAOC,QAAP,MAAqB,aAArB;AACA,OAAOC,QAAP,MAAqB,aAArB;AACA,SAASC,MAAT,QAAuB,WAAvB;AACA,OAAOC,OAAP,MAAoB,uBAApB;AAEA,OAAO,IAAMC,IAAI,GAAGf,MAAM,CAACI,MAAD,CAAT;AAAA;AAAA;AAAA,mCAGb;AAAA,MAAGY,UAAH,QAAGA,UAAH;AAAA,SACAA,UAAU,KAAK,SAAf,IACAf,GADA,+KADA;AAAA,CAHa,EAab;AAAA,MAAGe,UAAH,SAAGA,UAAH;AAAA,SACAA,UAAU,KAAK,OAAf,IACAf,GADA,4EADA;AAAA,CAba,EAuBb;AAAA,MAAGe,UAAH,SAAGA,UAAH;AAAA,SACAA,UAAU,KAAK,OAAf,IACAf,GADA,4EADA;AAAA,CAvBa,CAAV;KAAMc,I;AAkCb,OAAO,IAAME,MAAM,GAAGjB,MAAM,CAACM,KAAD,CAAT;AAAA;AAAA;AAAA,mJAAZ;MAAMW,M;AAWb,OAAO,IAAMC,OAAO,GAAGlB,MAAM,CAACI,MAAD,CAAT;AAAA;AAAA;AAAA,mBAAb;MAAMc,O;AAIb,OAAO,IAAMC,IAAI,GAAG,SAAPA,IAAO,QAQd;AAAA;;AAAA;;AAAA,MAPJC,OAOI,SAPJA,OAOI;AAAA,MANJJ,UAMI,SANJA,UAMI;AAAA,MALJK,SAKI,SALJA,SAKI;AAAA,MAJJC,KAII,SAJJA,KAII;AAAA,MAHJC,MAGI,SAHJA,MAGI;AAAA,MAFJC,aAEI,SAFJA,aAEI;AAAA,MADJC,cACI,SADJA,cACI;;AAAA,kBAC4B3B,QAAQ,CAAC,EAAD,CADpC;AAAA;AAAA,MACG4B,QADH;AAAA,MACaC,WADb;;AAAA,kBAG6BzB,QAAQ,CAACY,OAAO,CAACc,WAAT,EAAsB;AAC7DC,IAAAA,SAAS,EAAE;AACTC,MAAAA,EAAE,EAAEV;AADK;AADkD,GAAtB,CAHrC;AAAA,MAGIW,IAHJ,aAGIA,IAHJ;AAAA,MAGUC,OAHV,aAGUA,OAHV;AAAA,MAGmBC,KAHnB,aAGmBA,KAHnB;;AAAA,mBAS2E/B,QAAQ,CACrFY,OAAO,CAACoB,YAD6E,EAErF;AACEL,IAAAA,SAAS,EAAE;AACTC,MAAAA,EAAE,EAAEV;AADK;AADb,GAFqF,CATnF;AAAA,MASUe,YATV,cASIJ,IATJ;AAAA,MASiCK,eATjC,cASwBJ,OATxB;AAAA,MASyDK,aATzD,cASkDJ,KATlD;;AAAA,qBAqBA9B,WAAW,CAACW,OAAO,CAACwB,YAAT,CArBX;AAAA;AAAA,MAmBFC,WAnBE;AAAA;AAAA,MAoBMC,eApBN,kBAoBAT,IApBA;AAAA,MAoBgCU,kBApBhC,kBAoBuBT,OApBvB;AAAA,MAoB2DU,gBApB3D,kBAoBoDT,KApBpD;;AAAA,sBAuBkB9B,WAAW,CAACW,OAAO,CAAC6B,YAAT,CAvB7B;AAAA;AAAA,MAuBGC,WAvBH;;AAyBJ7C,EAAAA,SAAS,CAAC,YAAM;AACd,QAAI,CAACqC,eAAD,IAAoBD,YAAxB,EAAsC;AACpCR,MAAAA,WAAW,CAACQ,YAAY,CAACU,WAAd,CAAX;AACD;AACF,GAJQ,EAIN,CAACV,YAAD,EAAeC,eAAf,CAJM,CAAT;AAMArC,EAAAA,SAAS,CAAC,YAAM;AACd,QAAI,CAAC0C,kBAAD,IAAuBD,eAA3B,EAA4C;AAC1Cb,MAAAA,WAAW,CAACa,eAAe,CAACD,WAAjB,CAAX;AACD;AACF,GAJQ,EAIN,CAACC,eAAD,EAAkBC,kBAAlB,CAJM,CAAT;AAMA,sBACE,oBAAC,IAAD;AAAM,IAAA,SAAS,EAAEpB,SAAjB;AAA4B,IAAA,KAAK,EAAEC,KAAnC;AAA0C,IAAA,UAAU,EAAEN;AAAtD,KACG,CAACgB,OAAD,IAAYD,IAAI,CAACe,UAAjB,gBACC,oBAAC,KAAD,CAAO,QAAP,QACGf,IAAI,CAACe,UAAL,CAAgBC,OAAhB,iBAA2B,oBAAC,MAAD;AAAQ,IAAA,GAAG,EAAEhB,IAAI,CAACe,UAAL,CAAgBC,OAAhB,CAAwBC;AAArC,IAD9B,eAGE,oBAAC,OAAD,qBACE,oBAAC,IAAD;AAAM,IAAA,IAAI,EAAEjB,IAAI,CAACe,UAAL,CAAgBG,SAA5B;AAAuC,IAAA,QAAQ,2BAAElB,IAAI,CAACe,UAAL,CAAgBI,QAAlB,0DAAE,sBAA0BC;AAA3E,IADF,eAEE,oBAAC,KAAD;AAAO,IAAA,GAAG,EAAE,IAAZ;AAAkB,IAAA,OAAO,EAAE5B,MAA3B;AAAmC,IAAA,KAAK,EAAE;AAAE6B,MAAAA,SAAS,EAAE,CAAC,CAAd;AAAiBC,MAAAA,YAAY,EAAE;AAA/B;AAA1C,KACGtB,IAAI,CAACe,UAAL,CAAgBQ,KADnB,CAFF,EAMGvB,IAAI,CAACe,UAAL,CAAgBS,IAAhB,iBAAwB,oBAAC,QAAD;AAAU,IAAA,OAAO,EAAExB,IAAI,CAACe,UAAL,CAAgBS;AAAnC,IAN3B,CAHF,eAYE,oBAAC,OAAD;AAAS,IAAA,KAAK;AAAd,IAZF,eAcE,oBAAC,KAAD;AAAO,IAAA,GAAG,EAAE;AAAZ,0EAdF,eAeE,oBAAC,QAAD;AACE,IAAA,QAAQ,EAAE7B,QADZ;AAEE,IAAA,UAAU,EAAE,OAFd;AAGE,IAAA,KAAK,EAAEW,aAAa,IAAIK,gBAH1B;AAIE,IAAA,OAAO,EAAEN,eAAe,IAAIK,kBAJ9B;AAKE,IAAA,MAAM,EAAEjB,aALV;AAME,IAAA,OAAO,EAAEC,cANX;AAOE,IAAA,MAAM,EAAE,gBAACK,EAAD,EAAK0B,KAAL;AAAA,aACNZ,WAAW,CAAC;AACVf,QAAAA,SAAS,EAAE;AAAE4B,UAAAA,OAAO,EAAE3B,EAAX;AAAe0B,UAAAA,KAAK,EAALA;AAAf;AADD,OAAD,CADL;AAAA,KAPV;AAYE,IAAA,QAAQ,EAAE,kBAACE,KAAD;AAAA,aACRnB,WAAW,CAAC;AACVV,QAAAA,SAAS,EAAE;AACTT,UAAAA,OAAO,EAAEW,IAAI,CAACe,UAAL,CAAgBhB,EADhB;AAET6B,UAAAA,IAAI,EAAED;AAFG;AADD,OAAD,CADH;AAAA;AAZZ,IAfF,CADD,GAsCGzB,KAAK,gBACP,oBAAC,KAAD;AAAO,IAAA,UAAU,EAAE,OAAnB;AAA4B,IAAA,KAAK,EAAE;AAAE2B,MAAAA,KAAK,EAAE,MAAT;AAAiBC,MAAAA,SAAS,EAAE;AAA5B;AAAnC,mPADO,gBAKP,oBAAC,MAAD,qBACE,oBAAC,OAAD,OADF,CA5CJ,CADF;AAmDD,CAhGM;;IAAM1C,I;UAWsBjB,Q,EAM8CA,Q,EAY3EC,W,EAEkBA,W;;;MA/BXgB,I;AAkGbA,IAAI,CAAC2C,YAAL,GAAoB;AAClB9C,EAAAA,UAAU,EAAE;AADM,CAApB;AAIA,eAAeG,IAAf","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport styled, { css } from 'styled-components'\nimport { useQuery, useMutation } from '@apollo/react-hooks'\n\nimport Column from '../../atomic-ui/components/Column'\nimport Title from '../../atomic-ui/components/Title'\nimport Image from '../../atomic-ui/components/Image'\nimport Meta from '../../atomic-ui/components/Meta'\nimport Divider from '../../atomic-ui/components/Divider'\nimport Alert from '../../atomic-ui/components/Alert'\nimport Spinner from '../../atomic-ui/components/Spinner'\n\nimport HTMLView from '../HTMLView'\nimport Comments from '../Comments'\nimport { Loader } from '../Styled'\nimport queries from '../../graphql/queries'\n\nexport const Wrap = styled(Column)`\n  flex-grow: 1;\n\n  ${({ appearance }) =>\n    appearance === 'default' &&\n    css`\n      padding: var(--default-gap);\n      background: var(--surface-background);\n      border: var(--surface-border);\n      border-radius: var(--surface-border-radius);\n      box-shadow: var(--surface-shadow);\n    `}\n\n  ${({ appearance }) =>\n    appearance === 'ghost' &&\n    css`\n      padding: 0;\n      border: none;\n      background: none;\n      border-radius: 0;\n      box-shadow: none;\n    `}\n\n  ${({ appearance }) =>\n    appearance === 'clear' &&\n    css`\n      padding: 0;\n      border: none;\n      background: none;\n      border-radius: 0;\n      box-shadow: none;\n    `}\n`\n\nexport const Poster = styled(Image)`\n  object-fit: cover;\n  width: 100%;\n  height: 512px;\n  border-radius: var(--surface-border-radius);\n\n  @media only screen and (max-width: 480px) {\n    height: 256px;\n  }\n`\n\nexport const Content = styled(Column)`\n  grid-gap: 0;\n`\n\nexport const View = ({\n  article,\n  appearance,\n  className,\n  style,\n  onLink,\n  onCommentLink,\n  onCommentReply\n}) => {\n  const [comments, setComments] = useState([])\n\n  const { data, loading, error } = useQuery(queries.GET_ARTICLE, {\n    variables: {\n      id: article\n    }\n  })\n\n  const { data: dataComments, loading: loadingComments, error: errorComments } = useQuery(\n    queries.GET_COMMENTS,\n    {\n      variables: {\n        id: article\n      }\n    }\n  )\n\n  const [\n    sendComment,\n    { data: dataSendComment, loading: loadingSendComment, error: errorSendComment }\n  ] = useMutation(queries.SEND_COMMENT)\n\n  const [likeComment] = useMutation(queries.LIKE_COMMENT)\n\n  useEffect(() => {\n    if (!loadingComments && dataComments) {\n      setComments(dataComments.getComments)\n    }\n  }, [dataComments, loadingComments])\n\n  useEffect(() => {\n    if (!loadingSendComment && dataSendComment) {\n      setComments(dataSendComment.sendComment)\n    }\n  }, [dataSendComment, loadingSendComment])\n\n  return (\n    <Wrap className={className} style={style} appearance={appearance}>\n      {!loading && data.getArticle ? (\n        <React.Fragment>\n          {data.getArticle.preview && <Poster src={data.getArticle.preview.path} />}\n\n          <Content>\n            <Meta date={data.getArticle.createdAt} category={data.getArticle.category?.name} />\n            <Title tag={'h3'} onClick={onLink} style={{ marginTop: -5, marginBottom: 5 }}>\n              {data.getArticle.title}\n            </Title>\n\n            {data.getArticle.body && <HTMLView content={data.getArticle.body} />}\n          </Content>\n\n          <Divider clear />\n\n          <Title tag={'h4'}>Комментарии</Title>\n          <Comments\n            comments={comments}\n            appearance={'ghost'}\n            error={errorComments || errorSendComment}\n            loading={loadingComments || loadingSendComment}\n            onLink={onCommentLink}\n            onReply={onCommentReply}\n            onLike={(id, liked) =>\n              likeComment({\n                variables: { comment: id, liked }\n              })\n            }\n            onSubmit={(value) =>\n              sendComment({\n                variables: {\n                  article: data.getArticle.id,\n                  text: value\n                }\n              })\n            }\n          />\n        </React.Fragment>\n      ) : error ? (\n        <Alert appearance={'error'} style={{ width: '100%', textAlign: 'center' }}>\n          Упс! Не удалось загрузить информацию о статье\n        </Alert>\n      ) : (\n        <Loader>\n          <Spinner />\n        </Loader>\n      )}\n    </Wrap>\n  )\n}\n\nView.defaultProps = {\n  appearance: 'default'\n}\n\nexport default View\n"]},"metadata":{},"sourceType":"module"}