{"ast":null,"code":"import React, { useState } from 'react';\nimport styled from 'styled-components';\nimport { Controller } from 'react-hook-form';\nimport { useQuery, useLazyQuery } from '@apollo/react-hooks';\nimport Row from '../../atomic-ui/components/Row';\nimport Column from '../../atomic-ui/components/Column';\nimport Message from '../../atomic-ui/components/Message';\nimport Input from '../../atomic-ui/components/Input';\nimport Button from '../../atomic-ui/components/Button';\nimport Icon from '../../atomic-ui/components/Icon';\nimport Text from '../../atomic-ui/components/Text';\nimport Difinition from '../../atomic-ui/components/Difinition';\nimport Title from '../../atomic-ui/components/Title';\nimport Alert from '../../atomic-ui/components/Alert';\nimport Select from '../../atomic-ui/components/Select';\nimport Divider from '../../atomic-ui/components/Divider';\nimport Spinner from '../../atomic-ui/components/Spinner';\nimport { getLabelCategory } from '../../utils/functions';\nimport { Loader } from '../Styled';\nimport Form from '../Form';\nimport queries from '../../graphql/queries';\nexport const Wrap = styled(Column).withConfig({\n  displayName: \"FormTicket__Wrap\",\n  componentId: \"n5aw2g-0\"\n})([\"width:100%;\"]);\nexport const Header = styled(Row).withConfig({\n  displayName: \"FormTicket__Header\",\n  componentId: \"n5aw2g-1\"\n})([\"justify-content:space-between;width:100%;\"]);\nexport const Messages = styled(Column).withConfig({\n  displayName: \"FormTicket__Messages\",\n  componentId: \"n5aw2g-2\"\n})([\"position:relative;background:#fbfbfb;border-radius:var(--surface-border-radius);padding:var(--default-gap);padding-top:55px;flex-grow:1;\"]);\nexport const Meta = styled(Row).withConfig({\n  displayName: \"FormTicket__Meta\",\n  componentId: \"n5aw2g-3\"\n})([\"position:absolute;top:0;left:0;width:100%;justify-content:space-between;padding:8px var(--default-gap);border-radius:var(--surface-border-radius) var(--surface-border-radius) 0 0;background:var(--ghost-color-background);\"]);\nexport const Empty = styled(Text).withConfig({\n  displayName: \"FormTicket__Empty\",\n  componentId: \"n5aw2g-4\"\n})([\"display:flex;justify-content:center;align-items:center;width:100%;height:100%;\"]);\nexport const LIMIT_USERS = 15;\nexport const Ticket = ({\n  ticket,\n  categories,\n  appearance,\n  mutation,\n  className,\n  onFinish,\n  onReport,\n  onLink,\n  onAttach,\n  onSubmit,\n  ...props\n}) => {\n  const [offsetUsers, setOffsetUsers] = useState(0);\n  const {\n    data,\n    loading: loadingTicket,\n    error: errorTicket\n  } = ticket ? useQuery(queries.GET_TICKET, {\n    variables: {\n      id: ticket\n    }\n  }) : {\n    data: {\n      getTicket: {}\n    },\n    loading: false,\n    error: false\n  };\n  const [loadUsers, {\n    data: dataUsers,\n    loading: loadingUsers,\n    refetch: searchUsers,\n    fetchMore: updateUsers\n  }] = ticket ? useLazyQuery(queries.GET_USERS) : {\n    data: {\n      getUsers: {}\n    },\n    loading: false,\n    error: false\n  };\n\n  if (!ticket) {\n    return /*#__PURE__*/React.createElement(Form, {\n      className: className,\n      appearance: appearance,\n      mutation: mutation,\n      onSubmit: onSubmit\n    }, ({\n      register,\n      loading,\n      errors,\n      control,\n      getValues\n    }) => {\n      var _data$getTicket, _data$getTicket2, _data$getTicket3, _data$getTicket4;\n\n      return !loadingTicket && data ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Column, null, /*#__PURE__*/React.createElement(Title, {\n        tag: 'h4'\n      }, \"\\u041E\\u0441\\u043D\\u043E\\u0432\\u043D\\u043E\\u0435\"), errors && errors.title && /*#__PURE__*/React.createElement(Alert, {\n        style: {\n          width: '100%'\n        },\n        appearance: 'error'\n      }, \"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u043D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u043E\\u0431\\u0440\\u0430\\u0449\\u0435\\u043D\\u0438\\u0435\"), /*#__PURE__*/React.createElement(Input, {\n        type: 'text',\n        name: 'title',\n        ref: register({\n          required: true\n        }),\n        defaultValue: getValues('title') || ((_data$getTicket = data.getTicket) === null || _data$getTicket === void 0 ? void 0 : _data$getTicket.title),\n        placeholder: 'Название',\n        appearance: 'ghost',\n        disabled: loading\n      }), /*#__PURE__*/React.createElement(Controller, {\n        name: 'author',\n        control: control,\n        defaultValue: (_data$getTicket2 = data.getTicket) !== null && _data$getTicket2 !== void 0 && _data$getTicket2.author ? {\n          value: data.getTicket.author.id,\n          label: data.getTicket.author.name\n        } : null,\n        render: ({\n          ref,\n          value,\n          onChange\n        }) => /*#__PURE__*/React.createElement(Select, {\n          options: !loadingUsers && dataUsers ? dataUsers.getUsers.map(user => ({\n            value: user,\n            label: user.name\n          })) : [],\n          appearance: 'ghost',\n          defaultValue: value,\n          placeholder: 'Выберите автора обращения',\n          onChange: onChange,\n          onMenuOpen: loadUsers,\n          onKeyDown: e => {\n            // Pressed ENTER\n            if (e.keyCode === 13) {\n              // searchUsers({\n              //   search: userSelectInput\n              // })\n              console.log(ref);\n            }\n          },\n          onMenuScrollToBottom: async () => {\n            await updateUsers({\n              variables: {\n                offset: offsetUsers,\n                limit: LIMIT_USERS\n              }\n            });\n            setOffsetUsers(prev => prev + LIMIT_USERS);\n          },\n          isLoading: loadingUsers,\n          isSearchable: true\n        })\n      }), /*#__PURE__*/React.createElement(Controller, {\n        name: 'counsellor',\n        control: control,\n        defaultValue: (_data$getTicket3 = data.getTicket) !== null && _data$getTicket3 !== void 0 && _data$getTicket3.counsellor ? {\n          value: data.getTicket.counsellor.id,\n          label: data.getTicket.counsellor.name\n        } : null,\n        render: ({\n          value,\n          onChange\n        }) => /*#__PURE__*/React.createElement(Select, {\n          options: !loadingUsers && dataUsers ? dataUsers.getUsers.map(user => ({\n            value: user,\n            label: user.name\n          })) : [],\n          appearance: 'ghost',\n          defaultValue: value,\n          placeholder: 'Выберите советника',\n          onChange: onChange,\n          isLoading: loadingUsers,\n          isSearchable: true\n        })\n      }), /*#__PURE__*/React.createElement(Controller, {\n        name: 'category',\n        control: control,\n        defaultValue: (_data$getTicket4 = data.getTicket) !== null && _data$getTicket4 !== void 0 && _data$getTicket4.category ? {\n          value: data.getTicket.category.id,\n          label: getLabelCategory(data.getTicket.category.name)\n        } : null,\n        render: ({\n          value,\n          onChange\n        }) => /*#__PURE__*/React.createElement(Select, {\n          appearance: 'ghost',\n          placeholder: 'Выберите раздел',\n          options: categories.filter(item => item.type === 'TICKET').map(item => ({\n            value: item.id,\n            label: getLabelCategory(item.name)\n          })),\n          onChange: onChange,\n          defaultValue: value,\n          isLoading: loading,\n          isClearable: true\n        })\n      })), /*#__PURE__*/React.createElement(Divider, {\n        clear: true\n      }), /*#__PURE__*/React.createElement(Row, null, /*#__PURE__*/React.createElement(Button, {\n        style: {\n          flexGrow: 1\n        },\n        type: 'submit',\n        disabled: loading\n      }, \"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C\"))) : errorTicket ? /*#__PURE__*/React.createElement(Alert, {\n        appearance: 'error',\n        style: {\n          width: '100%',\n          textAlign: 'center'\n        }\n      }, \"\\u0423\\u043F\\u0441! \\u041D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u044E \\u043E \\u0441\\u0442\\u0430\\u0442\\u044C\\u0435\") : /*#__PURE__*/React.createElement(Loader, null, /*#__PURE__*/React.createElement(Spinner, null));\n    });\n  }\n\n  return /*#__PURE__*/React.createElement(Wrap, props, /*#__PURE__*/React.createElement(Header, null, /*#__PURE__*/React.createElement(Difinition, {\n    label: 'Номер обращения',\n    text: (ticket === null || ticket === void 0 ? void 0 : ticket.token) || '-'\n  }), /*#__PURE__*/React.createElement(Row, null, /*#__PURE__*/React.createElement(Button, {\n    onClick: onFinish,\n    disabled: !ticket\n  }, \"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C \\u043E\\u0431\\u0440\\u0430\\u0449\\u0435\\u043D\\u0438\\u0435\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: onReport,\n    kind: 'icon',\n    appearance: 'red',\n    disabled: !ticket\n  }, /*#__PURE__*/React.createElement(Icon, {\n    icon: 'flag',\n    stroke: 'white'\n  })))), /*#__PURE__*/React.createElement(Messages, null, /*#__PURE__*/React.createElement(Meta, null, /*#__PURE__*/React.createElement(Text, null, \"\\u0422\\u0435\\u043C\\u0430: \", ticket.title), /*#__PURE__*/React.createElement(Text, null, ticket.createdAt)), ticket && ticket.messages && ticket.messages.length > 0 ? ticket.messages.map(message => /*#__PURE__*/React.createElement(Message, {\n    key: message.id,\n    avatar: message.avatar,\n    side: message.side,\n    name: message.name,\n    text: message.text,\n    time: message.time,\n    onLink: onLink\n  })) : /*#__PURE__*/React.createElement(Empty, null, \"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u043E\\u0431\\u0440\\u0430\\u0449\\u0435\\u043D\\u0438\\u0435\")), /*#__PURE__*/React.createElement(Row, null, /*#__PURE__*/React.createElement(Button, {\n    kind: 'icon',\n    onSubmit: onAttach\n  }, /*#__PURE__*/React.createElement(Icon, {\n    icon: 'attach',\n    stroke: 'white'\n  })), /*#__PURE__*/React.createElement(Input, {\n    placeholder: 'Отправьте сообщенение...',\n    appearance: appearance\n  }), /*#__PURE__*/React.createElement(Button, {\n    kind: 'icon',\n    onSubmit: onSubmit\n  }, /*#__PURE__*/React.createElement(Icon, {\n    icon: 'send',\n    stroke: 'white'\n  }))));\n};\nexport default Ticket;","map":{"version":3,"sources":["C:/Users/dan82/Documents/workspace/FREELANCE/atomic/atomic-frontend/components/FormTicket/index.js"],"names":["React","useState","styled","Controller","useQuery","useLazyQuery","Row","Column","Message","Input","Button","Icon","Text","Difinition","Title","Alert","Select","Divider","Spinner","getLabelCategory","Loader","Form","queries","Wrap","Header","Messages","Meta","Empty","LIMIT_USERS","Ticket","ticket","categories","appearance","mutation","className","onFinish","onReport","onLink","onAttach","onSubmit","props","offsetUsers","setOffsetUsers","data","loading","loadingTicket","error","errorTicket","GET_TICKET","variables","id","getTicket","loadUsers","dataUsers","loadingUsers","refetch","searchUsers","fetchMore","updateUsers","GET_USERS","getUsers","register","errors","control","getValues","title","width","required","author","value","label","name","ref","onChange","map","user","e","keyCode","console","log","offset","limit","prev","counsellor","category","filter","item","type","flexGrow","textAlign","token","createdAt","messages","length","message","avatar","side","text","time"],"mappings":"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","sourcesContent":["import React, { useState } from 'react'\nimport styled from 'styled-components'\nimport { Controller } from 'react-hook-form'\nimport { useQuery, useLazyQuery } from '@apollo/react-hooks'\n\nimport Row from '../../atomic-ui/components/Row'\nimport Column from '../../atomic-ui/components/Column'\nimport Message from '../../atomic-ui/components/Message'\nimport Input from '../../atomic-ui/components/Input'\nimport Button from '../../atomic-ui/components/Button'\nimport Icon from '../../atomic-ui/components/Icon'\nimport Text from '../../atomic-ui/components/Text'\nimport Difinition from '../../atomic-ui/components/Difinition'\nimport Title from '../../atomic-ui/components/Title'\nimport Alert from '../../atomic-ui/components/Alert'\nimport Select from '../../atomic-ui/components/Select'\nimport Divider from '../../atomic-ui/components/Divider'\nimport Spinner from '../../atomic-ui/components/Spinner'\n\nimport { getLabelCategory } from '../../utils/functions'\nimport { Loader } from '../Styled'\nimport Form from '../Form'\nimport queries from '../../graphql/queries'\n\nexport const Wrap = styled(Column)`\n  width: 100%;\n`\n\nexport const Header = styled(Row)`\n  justify-content: space-between;\n  width: 100%;\n`\n\nexport const Messages = styled(Column)`\n  position: relative;\n  background: #fbfbfb;\n  border-radius: var(--surface-border-radius);\n  padding: var(--default-gap);\n  padding-top: 55px;\n  flex-grow: 1;\n`\n\nexport const Meta = styled(Row)`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  justify-content: space-between;\n  padding: 8px var(--default-gap);\n  border-radius: var(--surface-border-radius) var(--surface-border-radius) 0 0;\n  background: var(--ghost-color-background);\n`\n\nexport const Empty = styled(Text)`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  height: 100%;\n`\n\nexport const LIMIT_USERS = 15\n\nexport const Ticket = ({\n  ticket,\n  categories,\n  appearance,\n  mutation,\n  className,\n  onFinish,\n  onReport,\n  onLink,\n  onAttach,\n  onSubmit,\n  ...props\n}) => {\n  const [offsetUsers, setOffsetUsers] = useState(0)\n  const { data, loading: loadingTicket, error: errorTicket } = ticket\n    ? useQuery(queries.GET_TICKET, {\n        variables: {\n          id: ticket\n        }\n      })\n    : { data: { getTicket: {} }, loading: false, error: false }\n\n  const [\n    loadUsers,\n    { data: dataUsers, loading: loadingUsers, refetch: searchUsers, fetchMore: updateUsers }\n  ] = ticket\n    ? useLazyQuery(queries.GET_USERS)\n    : { data: { getUsers: {} }, loading: false, error: false }\n\n  if (!ticket) {\n    return (\n      <Form className={className} appearance={appearance} mutation={mutation} onSubmit={onSubmit}>\n        {({ register, loading, errors, control, getValues }) =>\n          !loadingTicket && data ? (\n            <React.Fragment>\n              <Column>\n                <Title tag={'h4'}>Основное</Title>\n\n                {errors && errors.title && (\n                  <Alert style={{ width: '100%' }} appearance={'error'}>\n                    Введите название обращение\n                  </Alert>\n                )}\n                <Input\n                  type={'text'}\n                  name={'title'}\n                  ref={register({ required: true })}\n                  defaultValue={getValues('title') || data.getTicket?.title}\n                  placeholder={'Название'}\n                  appearance={'ghost'}\n                  disabled={loading}\n                />\n\n                <Controller\n                  name={'author'}\n                  control={control}\n                  defaultValue={\n                    data.getTicket?.author\n                      ? {\n                          value: data.getTicket.author.id,\n                          label: data.getTicket.author.name\n                        }\n                      : null\n                  }\n                  render={({ ref, value, onChange }) => (\n                    <Select\n                      options={\n                        !loadingUsers && dataUsers\n                          ? dataUsers.getUsers.map((user) => ({\n                              value: user,\n                              label: user.name\n                            }))\n                          : []\n                      }\n                      appearance={'ghost'}\n                      defaultValue={value}\n                      placeholder={'Выберите автора обращения'}\n                      onChange={onChange}\n                      onMenuOpen={loadUsers}\n                      onKeyDown={(e) => {\n                        // Pressed ENTER\n                        if (e.keyCode === 13) {\n                          // searchUsers({\n                          //   search: userSelectInput\n                          // })\n                          console.log(ref)\n                        }\n                      }}\n                      onMenuScrollToBottom={async () => {\n                        await updateUsers({\n                          variables: {\n                            offset: offsetUsers,\n                            limit: LIMIT_USERS\n                          }\n                        })\n                        setOffsetUsers((prev) => prev + LIMIT_USERS)\n                      }}\n                      isLoading={loadingUsers}\n                      isSearchable\n                    />\n                  )}\n                />\n\n                <Controller\n                  name={'counsellor'}\n                  control={control}\n                  defaultValue={\n                    data.getTicket?.counsellor\n                      ? {\n                          value: data.getTicket.counsellor.id,\n                          label: data.getTicket.counsellor.name\n                        }\n                      : null\n                  }\n                  render={({ value, onChange }) => (\n                    <Select\n                      options={\n                        !loadingUsers && dataUsers\n                          ? dataUsers.getUsers.map((user) => ({\n                              value: user,\n                              label: user.name\n                            }))\n                          : []\n                      }\n                      appearance={'ghost'}\n                      defaultValue={value}\n                      placeholder={'Выберите советника'}\n                      onChange={onChange}\n                      isLoading={loadingUsers}\n                      isSearchable\n                    />\n                  )}\n                />\n\n                <Controller\n                  name={'category'}\n                  control={control}\n                  defaultValue={\n                    data.getTicket?.category\n                      ? {\n                          value: data.getTicket.category.id,\n                          label: getLabelCategory(data.getTicket.category.name)\n                        }\n                      : null\n                  }\n                  render={({ value, onChange }) => (\n                    <Select\n                      appearance={'ghost'}\n                      placeholder={'Выберите раздел'}\n                      options={categories\n                        .filter((item) => item.type === 'TICKET')\n                        .map((item) => ({\n                          value: item.id,\n                          label: getLabelCategory(item.name)\n                        }))}\n                      onChange={onChange}\n                      defaultValue={value}\n                      isLoading={loading}\n                      isClearable\n                    />\n                  )}\n                />\n              </Column>\n\n              <Divider clear />\n\n              <Row>\n                <Button style={{ flexGrow: 1 }} type={'submit'} disabled={loading}>\n                  Создать\n                </Button>\n              </Row>\n            </React.Fragment>\n          ) : errorTicket ? (\n            <Alert appearance={'error'} style={{ width: '100%', textAlign: 'center' }}>\n              Упс! Не удалось загрузить информацию о статье\n            </Alert>\n          ) : (\n            <Loader>\n              <Spinner />\n            </Loader>\n          )\n        }\n      </Form>\n    )\n  }\n\n  return (\n    <Wrap {...props}>\n      <Header>\n        <Difinition label={'Номер обращения'} text={ticket?.token || '-'} />\n\n        <Row>\n          <Button onClick={onFinish} disabled={!ticket}>\n            Закрыть обращение\n          </Button>\n          <Button onClick={onReport} kind={'icon'} appearance={'red'} disabled={!ticket}>\n            <Icon icon={'flag'} stroke={'white'} />\n          </Button>\n        </Row>\n      </Header>\n\n      <Messages>\n        <Meta>\n          <Text>Тема: {ticket.title}</Text>\n          <Text>{ticket.createdAt}</Text>\n        </Meta>\n\n        {ticket && ticket.messages && ticket.messages.length > 0 ? (\n          ticket.messages.map((message) => (\n            <Message\n              key={message.id}\n              avatar={message.avatar}\n              side={message.side}\n              name={message.name}\n              text={message.text}\n              time={message.time}\n              onLink={onLink}\n            />\n          ))\n        ) : (\n          <Empty>Выберите обращение</Empty>\n        )}\n      </Messages>\n\n      <Row>\n        <Button kind={'icon'} onSubmit={onAttach}>\n          <Icon icon={'attach'} stroke={'white'} />\n        </Button>\n        <Input placeholder={'Отправьте сообщенение...'} appearance={appearance} />\n        <Button kind={'icon'} onSubmit={onSubmit}>\n          <Icon icon={'send'} stroke={'white'} />\n        </Button>\n      </Row>\n    </Wrap>\n  )\n}\n\nexport default Ticket\n"]},"metadata":{},"sourceType":"module"}