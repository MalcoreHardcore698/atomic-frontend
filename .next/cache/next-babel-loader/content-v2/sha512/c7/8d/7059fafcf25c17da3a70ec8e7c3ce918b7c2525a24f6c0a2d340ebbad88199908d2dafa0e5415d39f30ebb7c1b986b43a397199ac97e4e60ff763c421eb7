{"ast":null,"code":"var _s2 = $RefreshSig$();\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nimport React, { useState, useEffect } from 'react';\nimport styled, { css } from 'styled-components';\nimport { useLazyQuery } from '@apollo/react-hooks';\nimport { v4 } from 'uuid';\nimport Column from '../atomic-ui/components/Column';\nimport Alert from '../atomic-ui/components/Alert';\nimport DatePicker from '../atomic-ui/components/DatePicker';\nimport Spinner from '../atomic-ui/components/Spinner';\nimport Select from '../atomic-ui/components/Select';\nimport { useInfiniteScroll } from '../hooks/useInfiniteScroll';\nimport DefaultLayout from '../layouts/default';\nimport DashboardLayout from './dashboard';\nimport FilterBar from '../components/FilterBar';\nimport SearchBar from '../components/SearchBar';\nimport HandleBar from '../components/HandleBar';\nimport { LowerLoader } from '../components/Styled';\nvar Wrap = styled(Column).withConfig({\n  displayName: \"content__Wrap\",\n  componentId: \"sc-1afm75p-0\"\n})([\"margin-top:120px;margin-bottom:80px;\", \" @media only screen and (max-width:480px){margin-top:0;}\"], function (_ref) {\n  var clear = _ref.clear;\n  return clear && css([\"margin:0;\"]);\n});\n_c = Wrap;\n\nvar ContentLayout = function ContentLayout(_ref2) {\n  _s2();\n\n  var title = _ref2.title,\n      store = _ref2.store,\n      query = _ref2.query,\n      handle = _ref2.handle,\n      filters = _ref2.filters,\n      options = _ref2.options,\n      research = _ref2.research,\n      scaffold = _ref2.scaffold,\n      dashboard = _ref2.dashboard,\n      _ref2$variables = _ref2.variables,\n      variables = _ref2$variables === void 0 ? {} : _ref2$variables,\n      _ref2$limit = _ref2.limit,\n      limit = _ref2$limit === void 0 ? 6 : _ref2$limit,\n      _ref2$startOffset = _ref2.startOffset,\n      startOffset = _ref2$startOffset === void 0 ? 6 : _ref2$startOffset,\n      initialize = _ref2.initialize,\n      children = _ref2.children;\n  var Layout = dashboard ? DashboardLayout : DefaultLayout;\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      date = _useState2[0],\n      onChangeDate = _useState2[1];\n\n  var _useState3 = useState(),\n      _useState4 = _slicedToArray(_useState3, 2),\n      select = _useState4[0],\n      onChangeSelect = _useState4[1];\n\n  var _useState5 = useState(null),\n      _useState6 = _slicedToArray(_useState5, 2),\n      search = _useState6[0],\n      setSearch = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      isFetching = _useState8[0],\n      setFetching = _useState8[1];\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      visibleFilter = _useState10[0],\n      setVisibleFilter = _useState10[1];\n\n  var _useState11 = useState(startOffset),\n      _useState12 = _slicedToArray(_useState11, 2),\n      offset = _useState12[0],\n      setOffset = _useState12[1];\n\n  var _useState13 = useState((store === null || store === void 0 ? void 0 : store.documents) || []),\n      _useState14 = _slicedToArray(_useState13, 2),\n      documents = _useState14[0],\n      setDocuments = _useState14[1];\n\n  var _useLazyQuery = useLazyQuery(query),\n      _useLazyQuery2 = _slicedToArray(_useLazyQuery, 2),\n      loadDocumentsBySearch = _useLazyQuery2[0],\n      _useLazyQuery2$ = _useLazyQuery2[1],\n      dataBySearch = _useLazyQuery2$.data,\n      loadingBySearch = _useLazyQuery2$.loading,\n      errorBySearch = _useLazyQuery2$.error,\n      refetchBySearch = _useLazyQuery2$.refetch;\n\n  var _useLazyQuery3 = useLazyQuery(query),\n      _useLazyQuery4 = _slicedToArray(_useLazyQuery3, 2),\n      loadDocuments = _useLazyQuery4[0],\n      _useLazyQuery4$ = _useLazyQuery4[1],\n      data = _useLazyQuery4$.data,\n      loading = _useLazyQuery4$.loading,\n      error = _useLazyQuery4$.error,\n      refetch = _useLazyQuery4$.refetch;\n\n  var getFilters = function getFilters() {\n    return filters.map(function (filter) {\n      switch (filter.type) {\n        case 'DATEPICKER':\n          return /*#__PURE__*/React.createElement(DatePicker, {\n            key: v4(),\n            value: date,\n            placeholder: filter.placeholder || 'Дата публикации',\n            onChange: onChangeDate,\n            withNavigate: true\n          });\n\n        case 'SELECT':\n          return /*#__PURE__*/React.createElement(Select, {\n            key: v4(),\n            options: filter.options,\n            placeholder: filter.placeholder || 'Раздел',\n            selected: select,\n            onChange: function onChange(item) {\n              return onChangeSelect(item);\n            }\n          });\n\n        default:\n          return null;\n      }\n    });\n  };\n\n  var onSearch = function onSearch(value) {\n    setDocuments([]);\n\n    if (value) {\n      setSearch(value);\n      loadDocumentsBySearch({\n        variables: _objectSpread(_objectSpread({}, variables), {}, {\n          search: value,\n          offset: 0,\n          limit: startOffset\n        })\n      });\n    } else {\n      var result = _objectSpread(_objectSpread({}, variables), {}, {\n        offset: 0,\n        limit: limit\n      });\n\n      setSearch(null);\n      if (refetch) refetch(result);else loadDocuments({\n        variables: result\n      });\n    }\n\n    setOffset(0);\n  };\n\n  useInfiniteScroll({\n    callbackOnBottom: function () {\n      var _callbackOnBottom = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        var updateOffset, result;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                updateOffset = function updateOffset() {\n                  return setOffset(function (prev) {\n                    return prev + limit;\n                  });\n                };\n\n                if (!(!loading && !isFetching)) {\n                  _context.next = 18;\n                  break;\n                }\n\n                setFetching(true);\n                result = _objectSpread(_objectSpread({}, variables), {}, {\n                  offset: offset,\n                  limit: limit\n                });\n\n                if (!search) {\n                  _context.next = 9;\n                  break;\n                }\n\n                _context.next = 7;\n                return refetchBySearch(variables);\n\n              case 7:\n                _context.next = 17;\n                break;\n\n              case 9:\n                if (!refetch) {\n                  _context.next = 15;\n                  break;\n                }\n\n                _context.next = 12;\n                return refetch(result);\n\n              case 12:\n                updateOffset();\n                _context.next = 17;\n                break;\n\n              case 15:\n                _context.next = 17;\n                return loadDocuments({\n                  variables: result\n                });\n\n              case 17:\n                setFetching(false);\n\n              case 18:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function callbackOnBottom() {\n        return _callbackOnBottom.apply(this, arguments);\n      }\n\n      return callbackOnBottom;\n    }(),\n    offset: 850\n  });\n  useEffect(function () {\n    if (initialize) loadDocuments({\n      variables: {\n        offset: offset,\n        limit: limit\n      }\n    });\n  }, [initialize]);\n  useEffect(function () {\n    if (research) onSearch(research);\n  }, [research]);\n  useEffect(function () {\n    var isCommon = !search && !loading && data;\n    var isSearch = search && !loadingBySearch && dataBySearch;\n    var result = isCommon || isSearch;\n    if (result) setDocuments(function (prev) {\n      return [].concat(_toConsumableArray(prev), _toConsumableArray(result[Object.keys(result)[0]]));\n    });\n  }, [search, loading, loadingBySearch, data, dataBySearch]);\n  return /*#__PURE__*/React.createElement(Layout, {\n    title: title,\n    scaffold: scaffold\n  }, /*#__PURE__*/React.createElement(Wrap, {\n    clear: scaffold || dashboard\n  }, !scaffold && !dashboard && /*#__PURE__*/React.createElement(SearchBar, {\n    onChangeFilter: function onChangeFilter() {\n      return setVisibleFilter(!visibleFilter);\n    },\n    onSubmit: onSearch\n  }), dashboard && handle && /*#__PURE__*/React.createElement(HandleBar, {\n    title: title,\n    icon: handle.icon,\n    buttonCreateText: handle.buttonCreateText,\n    onCreate: handle.onCreate,\n    onChangeVisibleFilter: function onChangeVisibleFilter() {\n      return setVisibleFilter(!visibleFilter);\n    },\n    onChangeDisplayMethod: handle.onChangeDisplayMethod\n  }), (filters || options) && /*#__PURE__*/React.createElement(FilterBar, {\n    isOpen: visibleFilter,\n    filters: getFilters(),\n    options: options\n  }), React.createElement(children, {\n    documents: documents\n  }), search && !loadingBySearch && documents.length === 0 && /*#__PURE__*/React.createElement(Alert, {\n    style: {\n      width: '100%',\n      textAlign: 'center'\n    }\n  }, \"\\u041F\\u043E \\u0432\\u0430\\u0448\\u0435\\u043C\\u0443 \\u0437\\u0430\\u043F\\u0440\\u043E\\u0441\\u0443 \\u043D\\u0438\\u0447\\u0435\\u0433\\u043E \\u043D\\u0435 \\u043D\\u0430\\u0439\\u0434\\u0435\\u043D\\u043E\"), (search && errorBySearch || !search && error) && /*#__PURE__*/React.createElement(Alert, {\n    appearance: 'error',\n    style: {\n      width: '100%',\n      textAlign: 'center'\n    }\n  }, \"\\u041D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0434\\u0430\\u043D\\u043D\\u044B\\u0435\"), (isFetching || !error && loading || search && !errorBySearch && loadingBySearch) && /*#__PURE__*/React.createElement(LowerLoader, null, /*#__PURE__*/React.createElement(Spinner, null)), !search && !loading && !loadingBySearch && !errorBySearch && documents.length === 0 && /*#__PURE__*/React.createElement(Alert, {\n    style: {\n      width: '100%',\n      textAlign: 'center'\n    }\n  }, \"\\u0414\\u0430\\u043D\\u043D\\u044B\\u0445 \\u043D\\u0435\\u0442\")));\n};\n\n_s2(ContentLayout, \"1XgaKvqOTz5kXOrvCKj8512xjJA=\", false, function () {\n  return [useLazyQuery, useLazyQuery, useInfiniteScroll];\n});\n\n_c2 = ContentLayout;\nexport default ContentLayout;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Wrap\");\n$RefreshReg$(_c2, \"ContentLayout\");","map":{"version":3,"sources":["C:/Users/dan82/Documents/workspace/FREELANCE/atomic/atomic-frontend/layouts/content.js"],"names":["React","useState","useEffect","styled","css","useLazyQuery","v4","Column","Alert","DatePicker","Spinner","Select","useInfiniteScroll","DefaultLayout","DashboardLayout","FilterBar","SearchBar","HandleBar","LowerLoader","Wrap","clear","ContentLayout","title","store","query","handle","filters","options","research","scaffold","dashboard","variables","limit","startOffset","initialize","children","Layout","date","onChangeDate","select","onChangeSelect","search","setSearch","isFetching","setFetching","visibleFilter","setVisibleFilter","offset","setOffset","documents","setDocuments","loadDocumentsBySearch","dataBySearch","data","loadingBySearch","loading","errorBySearch","error","refetchBySearch","refetch","loadDocuments","getFilters","map","filter","type","placeholder","item","onSearch","value","result","callbackOnBottom","updateOffset","prev","isCommon","isSearch","Object","keys","icon","buttonCreateText","onCreate","onChangeDisplayMethod","createElement","length","width","textAlign"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport styled, { css } from 'styled-components'\nimport { useLazyQuery } from '@apollo/react-hooks'\nimport { v4 } from 'uuid'\n\nimport Column from '../atomic-ui/components/Column'\nimport Alert from '../atomic-ui/components/Alert'\nimport DatePicker from '../atomic-ui/components/DatePicker'\nimport Spinner from '../atomic-ui/components/Spinner'\nimport Select from '../atomic-ui/components/Select'\n\nimport { useInfiniteScroll } from '../hooks/useInfiniteScroll'\nimport DefaultLayout from '../layouts/default'\nimport DashboardLayout from './dashboard'\nimport FilterBar from '../components/FilterBar'\nimport SearchBar from '../components/SearchBar'\nimport HandleBar from '../components/HandleBar'\nimport { LowerLoader } from '../components/Styled'\n\nconst Wrap = styled(Column)`\n  margin-top: 120px;\n  margin-bottom: 80px;\n\n  ${({ clear }) =>\n    clear &&\n    css`\n      margin: 0;\n    `}\n\n  @media only screen and (max-width: 480px) {\n    margin-top: 0;\n  }\n`\n\nconst ContentLayout = ({\n  title,\n  store,\n  query,\n  handle,\n  filters,\n  options,\n  research,\n  scaffold,\n  dashboard,\n  variables = {},\n  limit = 6,\n  startOffset = 6,\n  initialize,\n  children\n}) => {\n  const Layout = dashboard ? DashboardLayout : DefaultLayout\n  const [date, onChangeDate] = useState()\n  const [select, onChangeSelect] = useState()\n  const [search, setSearch] = useState(null)\n  const [isFetching, setFetching] = useState(false)\n  const [visibleFilter, setVisibleFilter] = useState(false)\n  const [offset, setOffset] = useState(startOffset)\n  const [documents, setDocuments] = useState(store?.documents || [])\n\n  const [\n    loadDocumentsBySearch,\n    { data: dataBySearch, loading: loadingBySearch, error: errorBySearch, refetch: refetchBySearch }\n  ] = useLazyQuery(query)\n\n  const [loadDocuments, { data, loading, error, refetch }] = useLazyQuery(query)\n\n  const getFilters = () => {\n    return filters.map((filter) => {\n      switch (filter.type) {\n        case 'DATEPICKER':\n          return (\n            <DatePicker\n              key={v4()}\n              value={date}\n              placeholder={filter.placeholder || 'Дата публикации'}\n              onChange={onChangeDate}\n              withNavigate\n            />\n          )\n        case 'SELECT':\n          return (\n            <Select\n              key={v4()}\n              options={filter.options}\n              placeholder={filter.placeholder || 'Раздел'}\n              selected={select}\n              onChange={(item) => onChangeSelect(item)}\n            />\n          )\n        default:\n          return null\n      }\n    })\n  }\n\n  const onSearch = (value) => {\n    setDocuments([])\n    if (value) {\n      setSearch(value)\n      loadDocumentsBySearch({\n        variables: { ...variables, search: value, offset: 0, limit: startOffset }\n      })\n    } else {\n      const result = { ...variables, offset: 0, limit }\n\n      setSearch(null)\n\n      if (refetch) refetch(result)\n      else loadDocuments({ variables: result })\n    }\n    setOffset(0)\n  }\n\n  useInfiniteScroll({\n    callbackOnBottom: async () => {\n      const updateOffset = () => setOffset((prev) => prev + limit)\n\n      if (!loading && !isFetching) {\n        setFetching(true)\n\n        const result = { ...variables, offset, limit }\n\n        if (search) {\n          await refetchBySearch(variables)\n        } else {\n          if (refetch) {\n            await refetch(result)\n            updateOffset()\n          } else {\n            await loadDocuments({ variables: result })\n          }\n        }\n\n        setFetching(false)\n      }\n    },\n    offset: 850\n  })\n\n  useEffect(() => {\n    if (initialize) loadDocuments({ variables: { offset, limit } })\n  }, [initialize])\n\n  useEffect(() => {\n    if (research) onSearch(research)\n  }, [research])\n\n  useEffect(() => {\n    const isCommon = !search && !loading && data\n    const isSearch = search && !loadingBySearch && dataBySearch\n    const result = isCommon || isSearch\n    if (result) setDocuments((prev) => [...prev, ...result[Object.keys(result)[0]]])\n  }, [search, loading, loadingBySearch, data, dataBySearch])\n\n  return (\n    <Layout title={title} scaffold={scaffold}>\n      <Wrap clear={scaffold || dashboard}>\n        {!scaffold && !dashboard && (\n          <SearchBar onChangeFilter={() => setVisibleFilter(!visibleFilter)} onSubmit={onSearch} />\n        )}\n\n        {dashboard && handle && (\n          <HandleBar\n            title={title}\n            icon={handle.icon}\n            buttonCreateText={handle.buttonCreateText}\n            onCreate={handle.onCreate}\n            onChangeVisibleFilter={() => setVisibleFilter(!visibleFilter)}\n            onChangeDisplayMethod={handle.onChangeDisplayMethod}\n          />\n        )}\n\n        {(filters || options) && (\n          <FilterBar isOpen={visibleFilter} filters={getFilters()} options={options} />\n        )}\n\n        {React.createElement(children, { documents })}\n\n        {search && !loadingBySearch && documents.length === 0 && (\n          <Alert style={{ width: '100%', textAlign: 'center' }}>\n            По вашему запросу ничего не найдено\n          </Alert>\n        )}\n\n        {((search && errorBySearch) || (!search && error)) && (\n          <Alert appearance={'error'} style={{ width: '100%', textAlign: 'center' }}>\n            Не удалось загрузить данные\n          </Alert>\n        )}\n\n        {(isFetching || (!error && loading) || (search && !errorBySearch && loadingBySearch)) && (\n          <LowerLoader>\n            <Spinner />\n          </LowerLoader>\n        )}\n\n        {!search && !loading && !loadingBySearch && !errorBySearch && documents.length === 0 && (\n          <Alert style={{ width: '100%', textAlign: 'center' }}>Данных нет</Alert>\n        )}\n      </Wrap>\n    </Layout>\n  )\n}\n\nexport default ContentLayout\n"]},"metadata":{},"sourceType":"module"}